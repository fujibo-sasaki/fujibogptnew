"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/chat/route";
exports.ids = ["app/api/chat/route"];
exports.modules = {

/***/ "../../client/components/action-async-storage.external":
/*!*******************************************************************************!*\
  !*** external "next/dist/client/components/action-async-storage.external.js" ***!
  \*******************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/action-async-storage.external.js");

/***/ }),

/***/ "../../client/components/request-async-storage.external":
/*!********************************************************************************!*\
  !*** external "next/dist/client/components/request-async-storage.external.js" ***!
  \********************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/request-async-storage.external.js");

/***/ }),

/***/ "../../client/components/static-generation-async-storage.external":
/*!******************************************************************************************!*\
  !*** external "next/dist/client/components/static-generation-async-storage.external.js" ***!
  \******************************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/static-generation-async-storage.external.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "puppeteer":
/*!****************************!*\
  !*** external "puppeteer" ***!
  \****************************/
/***/ ((module) => {

module.exports = import("puppeteer");;

/***/ }),

/***/ "assert":
/*!*************************!*\
  !*** external "assert" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("assert");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("buffer");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "events":
/*!*************************!*\
  !*** external "events" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("events");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("fs");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

module.exports = require("https");

/***/ }),

/***/ "net":
/*!**********************!*\
  !*** external "net" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("net");

/***/ }),

/***/ "node:crypto":
/*!******************************!*\
  !*** external "node:crypto" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("node:crypto");

/***/ }),

/***/ "node:fs":
/*!**************************!*\
  !*** external "node:fs" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("node:fs");

/***/ }),

/***/ "node:http":
/*!****************************!*\
  !*** external "node:http" ***!
  \****************************/
/***/ ((module) => {

module.exports = require("node:http");

/***/ }),

/***/ "node:https":
/*!*****************************!*\
  !*** external "node:https" ***!
  \*****************************/
/***/ ((module) => {

module.exports = require("node:https");

/***/ }),

/***/ "node:os":
/*!**************************!*\
  !*** external "node:os" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("node:os");

/***/ }),

/***/ "node:process":
/*!*******************************!*\
  !*** external "node:process" ***!
  \*******************************/
/***/ ((module) => {

module.exports = require("node:process");

/***/ }),

/***/ "node:stream":
/*!******************************!*\
  !*** external "node:stream" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("node:stream");

/***/ }),

/***/ "node:util":
/*!****************************!*\
  !*** external "node:util" ***!
  \****************************/
/***/ ((module) => {

module.exports = require("node:util");

/***/ }),

/***/ "node:zlib":
/*!****************************!*\
  !*** external "node:zlib" ***!
  \****************************/
/***/ ((module) => {

module.exports = require("node:zlib");

/***/ }),

/***/ "os":
/*!*********************!*\
  !*** external "os" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("os");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("punycode");

/***/ }),

/***/ "querystring":
/*!******************************!*\
  !*** external "querystring" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("querystring");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "tls":
/*!**********************!*\
  !*** external "tls" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("tls");

/***/ }),

/***/ "tty":
/*!**********************!*\
  !*** external "tty" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("tty");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("util");

/***/ }),

/***/ "worker_threads":
/*!*********************************!*\
  !*** external "worker_threads" ***!
  \*********************************/
/***/ ((module) => {

module.exports = require("worker_threads");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("zlib");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fchat%2Froute&page=%2Fapi%2Fchat%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fchat%2Froute.ts&appDir=%2FUsers%2Fokamotonobuhiro%2Ffujibo2025%2Ftest%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fokamotonobuhiro%2Ffujibo2025%2Ftest%2Fsrc&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D!":
/*!**********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fchat%2Froute&page=%2Fapi%2Fchat%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fchat%2Froute.ts&appDir=%2FUsers%2Fokamotonobuhiro%2Ffujibo2025%2Ftest%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fokamotonobuhiro%2Ffujibo2025%2Ftest%2Fsrc&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D! ***!
  \**********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   headerHooks: () => (/* binding */ headerHooks),\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage),\n/* harmony export */   staticGenerationBailout: () => (/* binding */ staticGenerationBailout)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var _Users_okamotonobuhiro_fujibo2025_test_src_app_api_chat_route_ts__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./app/api/chat/route.ts */ \"(rsc)/./app/api/chat/route.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_Users_okamotonobuhiro_fujibo2025_test_src_app_api_chat_route_ts__WEBPACK_IMPORTED_MODULE_2__]);\n_Users_okamotonobuhiro_fujibo2025_test_src_app_api_chat_route_ts__WEBPACK_IMPORTED_MODULE_2__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"standalone\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/chat/route\",\n        pathname: \"/api/chat\",\n        filename: \"route\",\n        bundlePath: \"app/api/chat/route\"\n    },\n    resolvedPagePath: \"/Users/okamotonobuhiro/fujibo2025/test/src/app/api/chat/route.ts\",\n    nextConfigOutput,\n    userland: _Users_okamotonobuhiro_fujibo2025_test_src_app_api_chat_route_ts__WEBPACK_IMPORTED_MODULE_2__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks, headerHooks, staticGenerationBailout } = routeModule;\nconst originalPathname = \"/api/chat/route\";\n\n\n//# sourceMappingURL=app-route.js.map\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZjaGF0JTJGcm91dGUmcGFnZT0lMkZhcGklMkZjaGF0JTJGcm91dGUmYXBwUGF0aHM9JnBhZ2VQYXRoPXByaXZhdGUtbmV4dC1hcHAtZGlyJTJGYXBpJTJGY2hhdCUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRm9rYW1vdG9ub2J1aGlybyUyRmZ1amlibzIwMjUlMkZ0ZXN0JTJGc3JjJTJGYXBwJnBhZ2VFeHRlbnNpb25zPXRzeCZwYWdlRXh0ZW5zaW9ucz10cyZwYWdlRXh0ZW5zaW9ucz1qc3gmcGFnZUV4dGVuc2lvbnM9anMmcm9vdERpcj0lMkZVc2VycyUyRm9rYW1vdG9ub2J1aGlybyUyRmZ1amlibzIwMjUlMkZ0ZXN0JTJGc3JjJmlzRGV2PXRydWUmdHNjb25maWdQYXRoPXRzY29uZmlnLmpzb24mYmFzZVBhdGg9JmFzc2V0UHJlZml4PSZuZXh0Q29uZmlnT3V0cHV0PXN0YW5kYWxvbmUmcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDOEI7QUFDN0Y7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLGdIQUFtQjtBQUMzQztBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSx1R0FBdUc7QUFDL0c7QUFDaUo7O0FBRWpKLHFDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vYXp1cmUtb3Blbi1haS1hY2NlbGVyYXRvci8/ZmU0ZiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHBSb3V0ZVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIvVXNlcnMvb2thbW90b25vYnVoaXJvL2Z1amlibzIwMjUvdGVzdC9zcmMvYXBwL2FwaS9jaGF0L3JvdXRlLnRzXCI7XG4vLyBXZSBpbmplY3QgdGhlIG5leHRDb25maWdPdXRwdXQgaGVyZSBzbyB0aGF0IHdlIGNhbiB1c2UgdGhlbSBpbiB0aGUgcm91dGVcbi8vIG1vZHVsZS5cbmNvbnN0IG5leHRDb25maWdPdXRwdXQgPSBcInN0YW5kYWxvbmVcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvY2hhdC9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL2NoYXRcIixcbiAgICAgICAgZmlsZW5hbWU6IFwicm91dGVcIixcbiAgICAgICAgYnVuZGxlUGF0aDogXCJhcHAvYXBpL2NoYXQvcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCIvVXNlcnMvb2thbW90b25vYnVoaXJvL2Z1amlibzIwMjUvdGVzdC9zcmMvYXBwL2FwaS9jaGF0L3JvdXRlLnRzXCIsXG4gICAgbmV4dENvbmZpZ091dHB1dCxcbiAgICB1c2VybGFuZFxufSk7XG4vLyBQdWxsIG91dCB0aGUgZXhwb3J0cyB0aGF0IHdlIG5lZWQgdG8gZXhwb3NlIGZyb20gdGhlIG1vZHVsZS4gVGhpcyBzaG91bGRcbi8vIGJlIGVsaW1pbmF0ZWQgd2hlbiB3ZSd2ZSBtb3ZlZCB0aGUgb3RoZXIgcm91dGVzIHRvIHRoZSBuZXcgZm9ybWF0LiBUaGVzZVxuLy8gYXJlIHVzZWQgdG8gaG9vayBpbnRvIHRoZSByb3V0ZS5cbmNvbnN0IHsgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIGhlYWRlckhvb2tzLCBzdGF0aWNHZW5lcmF0aW9uQmFpbG91dCB9ID0gcm91dGVNb2R1bGU7XG5jb25zdCBvcmlnaW5hbFBhdGhuYW1lID0gXCIvYXBpL2NoYXQvcm91dGVcIjtcbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgaGVhZGVySG9va3MsIHN0YXRpY0dlbmVyYXRpb25CYWlsb3V0LCBvcmlnaW5hbFBhdGhuYW1lLCAgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwLXJvdXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fchat%2Froute&page=%2Fapi%2Fchat%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fchat%2Froute.ts&appDir=%2FUsers%2Fokamotonobuhiro%2Ffujibo2025%2Ftest%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fokamotonobuhiro%2Ffujibo2025%2Ftest%2Fsrc&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/chat/route.ts":
/*!*******************************!*\
  !*** ./app/api/chat/route.ts ***!
  \*******************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var _features_chat_chat_services_chat_api_entry__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/features/chat/chat-services/chat-api-entry */ \"(rsc)/./features/chat/chat-services/chat-api-entry.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_features_chat_chat_services_chat_api_entry__WEBPACK_IMPORTED_MODULE_0__]);\n_features_chat_chat_services_chat_api_entry__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\nasync function POST(req) {\n    const body = await req.json();\n    return await (0,_features_chat_chat_services_chat_api_entry__WEBPACK_IMPORTED_MODULE_0__.chatAPIEntry)(body);\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9hcHAvYXBpL2NoYXQvcm91dGUudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBNEU7QUFFckUsZUFBZUMsS0FBS0MsR0FBWTtJQUNyQyxNQUFNQyxPQUFPLE1BQU1ELElBQUlFLElBQUk7SUFDM0IsT0FBTyxNQUFNSix5RkFBWUEsQ0FBQ0c7QUFDNUIiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9henVyZS1vcGVuLWFpLWFjY2VsZXJhdG9yLy4vYXBwL2FwaS9jaGF0L3JvdXRlLnRzP2RlNDYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY2hhdEFQSUVudHJ5IH0gZnJvbSBcIkAvZmVhdHVyZXMvY2hhdC9jaGF0LXNlcnZpY2VzL2NoYXQtYXBpLWVudHJ5XCI7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQT1NUKHJlcTogUmVxdWVzdCkge1xuICBjb25zdCBib2R5ID0gYXdhaXQgcmVxLmpzb24oKTtcbiAgcmV0dXJuIGF3YWl0IGNoYXRBUElFbnRyeShib2R5KTtcbn1cbiJdLCJuYW1lcyI6WyJjaGF0QVBJRW50cnkiLCJQT1NUIiwicmVxIiwiYm9keSIsImpzb24iXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./app/api/chat/route.ts\n");

/***/ }),

/***/ "(rsc)/./features/auth/auth-api.ts":
/*!***********************************!*\
  !*** ./features/auth/auth-api.ts ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   handlers: () => (/* binding */ handlers),\n/* harmony export */   options: () => (/* binding */ options)\n/* harmony export */ });\n/* harmony import */ var next_auth__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next-auth */ \"(rsc)/./node_modules/next-auth/index.js\");\n/* harmony import */ var next_auth__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_auth__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_auth_providers_azure_ad__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next-auth/providers/azure-ad */ \"(rsc)/./node_modules/next-auth/providers/azure-ad.js\");\n/* harmony import */ var next_auth_providers_github__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next-auth/providers/github */ \"(rsc)/./node_modules/next-auth/providers/github.js\");\n/* harmony import */ var next_auth_providers_credentials__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! next-auth/providers/credentials */ \"(rsc)/./node_modules/next-auth/providers/credentials.js\");\n/* harmony import */ var _helpers__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./helpers */ \"(rsc)/./features/auth/helpers.ts\");\n\n\n\n\n\nconst configureIdentityProvider = ()=>{\n    const providers = [];\n    const adminEmails = process.env.ADMIN_EMAIL_ADDRESS?.split(\",\").map((email)=>email.toLowerCase().trim());\n    if (process.env.AUTH_GITHUB_ID && process.env.AUTH_GITHUB_SECRET) {\n        providers.push((0,next_auth_providers_github__WEBPACK_IMPORTED_MODULE_2__[\"default\"])({\n            clientId: process.env.AUTH_GITHUB_ID,\n            clientSecret: process.env.AUTH_GITHUB_SECRET,\n            async profile (profile) {\n                const newProfile = {\n                    ...profile,\n                    isAdmin: adminEmails?.includes(profile.email.toLowerCase())\n                };\n                return newProfile;\n            }\n        }));\n    }\n    if (process.env.AZURE_AD_CLIENT_ID && process.env.AZURE_AD_CLIENT_SECRET && process.env.AZURE_AD_TENANT_ID) {\n        providers.push((0,next_auth_providers_azure_ad__WEBPACK_IMPORTED_MODULE_1__[\"default\"])({\n            clientId: process.env.AZURE_AD_CLIENT_ID,\n            clientSecret: process.env.AZURE_AD_CLIENT_SECRET,\n            tenantId: process.env.AZURE_AD_TENANT_ID,\n            async profile (profile) {\n                const newProfile = {\n                    ...profile,\n                    // throws error without this - unsure of the root cause (https://stackoverflow.com/questions/76244244/profile-id-is-missing-in-google-oauth-profile-response-nextauth)\n                    id: profile.sub,\n                    //isAdmin: adminEmails?.includes(profile.email.toLowerCase()) || adminEmails?.includes(profile.preferred_username.toLowerCase())\n                    isAdmin: adminEmails?.includes(profile.preferred_username.toLowerCase())\n                };\n                return newProfile;\n            }\n        }));\n    }\n    // If we're in local dev, add a basic credential provider option as well\n    // (Useful when a dev doesn't have access to create app registration in their tenant)\n    // This currently takes any username and makes a user with it, ignores password\n    // Refer to: https://next-auth.js.org/configuration/providers/credentials\n    if (true) {\n        providers.push((0,next_auth_providers_credentials__WEBPACK_IMPORTED_MODULE_3__[\"default\"])({\n            name: \"localdev\",\n            credentials: {\n                username: {\n                    label: \"Username\",\n                    type: \"text\",\n                    placeholder: \"dev\"\n                },\n                password: {\n                    label: \"Password\",\n                    type: \"password\"\n                }\n            },\n            async authorize (credentials, req) {\n                // You can put logic here to validate the credentials and return a user.\n                // We're going to take any username and make a new user with it\n                // Create the id as the hash of the email as per userHashedId (helpers.ts)\n                const username = credentials?.username || \"dev\";\n                const email = username + \"@localhost\";\n                const user = {\n                    id: (0,_helpers__WEBPACK_IMPORTED_MODULE_4__.hashValue)(email),\n                    name: username,\n                    email: email,\n                    isAdmin: true,\n                    image: \"\"\n                };\n                console.log(\"=== DEV USER LOGGED IN:\\n\", JSON.stringify(user, null, 2));\n                return user;\n            }\n        }));\n    }\n    return providers;\n};\nconst options = {\n    secret: process.env.NEXTAUTH_SECRET,\n    providers: [\n        ...configureIdentityProvider()\n    ],\n    callbacks: {\n        async jwt ({ token, user, account, profile, isNewUser, session }) {\n            if (user?.isAdmin) {\n                token.isAdmin = user.isAdmin;\n            }\n            return token;\n        },\n        async session ({ session, token, user }) {\n            session.user.isAdmin = token.isAdmin;\n            return session;\n        }\n    },\n    session: {\n        strategy: \"jwt\"\n    }\n};\nconst handlers = next_auth__WEBPACK_IMPORTED_MODULE_0___default()(options);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LFNBQVM7Z0JBQ2xCNkIsTUFBTTdCLE9BQU8sR0FBR2tCLEtBQUtsQixPQUFPO1lBQzdCO1lBQ0EsT0FBTzZCO1FBQ1Q7UUFDQSxNQUFNRyxTQUFRLEVBQUNBLE9BQU8sRUFBRUgsS0FBSyxFQUFFWCxJQUFJLEVBQUU7WUFDbkNjLFFBQVFkLElBQUksQ0FBQ2xCLE9BQU8sR0FBRzZCLE1BQU03QixPQUFPO1lBQ3BDLE9BQU9nQztRQUNUO0lBQ0Y7SUFDQUEsU0FBUztRQUNQQyxVQUFVO0lBQ1o7QUFDRixFQUFFO0FBRUssTUFBTUMsV0FBV3pELGdEQUFRQSxDQUFDK0MsU0FBUyIsInNvdXJjZXMiOlsid2VicGFjazovL2F6dXJlLW9wZW4tYWktYWNjZWxlcmF0b3IvLi9mZWF0dXJlcy9hdXRoL2F1dGgtYXBpLnRzPzEzODMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IE5leHRBdXRoLCB7IE5leHRBdXRoT3B0aW9ucyB9IGZyb20gXCJuZXh0LWF1dGhcIjtcbmltcG9ydCB7IFByb3ZpZGVyIH0gZnJvbSBcIm5leHQtYXV0aC9wcm92aWRlcnNcIjtcbmltcG9ydCBBenVyZUFEUHJvdmlkZXIgZnJvbSBcIm5leHQtYXV0aC9wcm92aWRlcnMvYXp1cmUtYWRcIjtcbmltcG9ydCBHaXRIdWJQcm92aWRlciBmcm9tIFwibmV4dC1hdXRoL3Byb3ZpZGVycy9naXRodWJcIjtcbmltcG9ydCBDcmVkZW50aWFsc1Byb3ZpZGVyIGZyb20gXCJuZXh0LWF1dGgvcHJvdmlkZXJzL2NyZWRlbnRpYWxzXCI7XG5pbXBvcnQgeyBoYXNoVmFsdWUgfSBmcm9tIFwiLi9oZWxwZXJzXCI7XG5cbmNvbnN0IGNvbmZpZ3VyZUlkZW50aXR5UHJvdmlkZXIgPSAoKSA9PiB7XG4gIGNvbnN0IHByb3ZpZGVyczogQXJyYXk8UHJvdmlkZXI+ID0gW107XG5cbiAgY29uc3QgYWRtaW5FbWFpbHMgPSBwcm9jZXNzLmVudi5BRE1JTl9FTUFJTF9BRERSRVNTPy5zcGxpdChcIixcIikubWFwKGVtYWlsID0+IGVtYWlsLnRvTG93ZXJDYXNlKCkudHJpbSgpKTtcblxuICBpZiAocHJvY2Vzcy5lbnYuQVVUSF9HSVRIVUJfSUQgJiYgcHJvY2Vzcy5lbnYuQVVUSF9HSVRIVUJfU0VDUkVUKSB7XG4gICAgcHJvdmlkZXJzLnB1c2goXG4gICAgICBHaXRIdWJQcm92aWRlcih7XG4gICAgICAgIGNsaWVudElkOiBwcm9jZXNzLmVudi5BVVRIX0dJVEhVQl9JRCEsXG4gICAgICAgIGNsaWVudFNlY3JldDogcHJvY2Vzcy5lbnYuQVVUSF9HSVRIVUJfU0VDUkVUISxcbiAgICAgICAgYXN5bmMgcHJvZmlsZShwcm9maWxlKSB7XG4gICAgICAgICAgY29uc3QgbmV3UHJvZmlsZSA9IHtcbiAgICAgICAgICAgIC4uLnByb2ZpbGUsXG4gICAgICAgICAgICBpc0FkbWluOiBhZG1pbkVtYWlscz8uaW5jbHVkZXMocHJvZmlsZS5lbWFpbC50b0xvd2VyQ2FzZSgpKVxuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gbmV3UHJvZmlsZTtcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICApO1xuICB9XG5cbiAgaWYgKFxuICAgIHByb2Nlc3MuZW52LkFaVVJFX0FEX0NMSUVOVF9JRCAmJlxuICAgIHByb2Nlc3MuZW52LkFaVVJFX0FEX0NMSUVOVF9TRUNSRVQgJiZcbiAgICBwcm9jZXNzLmVudi5BWlVSRV9BRF9URU5BTlRfSURcbiAgKSB7XG4gICAgcHJvdmlkZXJzLnB1c2goXG4gICAgICBBenVyZUFEUHJvdmlkZXIoe1xuICAgICAgICBjbGllbnRJZDogcHJvY2Vzcy5lbnYuQVpVUkVfQURfQ0xJRU5UX0lEISxcbiAgICAgICAgY2xpZW50U2VjcmV0OiBwcm9jZXNzLmVudi5BWlVSRV9BRF9DTElFTlRfU0VDUkVUISxcbiAgICAgICAgdGVuYW50SWQ6IHByb2Nlc3MuZW52LkFaVVJFX0FEX1RFTkFOVF9JRCEsXG4gICAgICAgIGFzeW5jIHByb2ZpbGUocHJvZmlsZSkge1xuXG4gICAgICAgICAgY29uc3QgbmV3UHJvZmlsZSA9IHtcbiAgICAgICAgICAgIC4uLnByb2ZpbGUsXG4gICAgICAgICAgICAvLyB0aHJvd3MgZXJyb3Igd2l0aG91dCB0aGlzIC0gdW5zdXJlIG9mIHRoZSByb290IGNhdXNlIChodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy83NjI0NDI0NC9wcm9maWxlLWlkLWlzLW1pc3NpbmctaW4tZ29vZ2xlLW9hdXRoLXByb2ZpbGUtcmVzcG9uc2UtbmV4dGF1dGgpXG4gICAgICAgICAgICBpZDogcHJvZmlsZS5zdWIsXG4gICAgICAgICAgICAvL2lzQWRtaW46IGFkbWluRW1haWxzPy5pbmNsdWRlcyhwcm9maWxlLmVtYWlsLnRvTG93ZXJDYXNlKCkpIHx8IGFkbWluRW1haWxzPy5pbmNsdWRlcyhwcm9maWxlLnByZWZlcnJlZF91c2VybmFtZS50b0xvd2VyQ2FzZSgpKVxuICAgICAgICAgICAgaXNBZG1pbjogYWRtaW5FbWFpbHM/LmluY2x1ZGVzKHByb2ZpbGUucHJlZmVycmVkX3VzZXJuYW1lLnRvTG93ZXJDYXNlKCkpXG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBuZXdQcm9maWxlO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgICk7XG4gIH1cblxuICAvLyBJZiB3ZSdyZSBpbiBsb2NhbCBkZXYsIGFkZCBhIGJhc2ljIGNyZWRlbnRpYWwgcHJvdmlkZXIgb3B0aW9uIGFzIHdlbGxcbiAgLy8gKFVzZWZ1bCB3aGVuIGEgZGV2IGRvZXNuJ3QgaGF2ZSBhY2Nlc3MgdG8gY3JlYXRlIGFwcCByZWdpc3RyYXRpb24gaW4gdGhlaXIgdGVuYW50KVxuICAvLyBUaGlzIGN1cnJlbnRseSB0YWtlcyBhbnkgdXNlcm5hbWUgYW5kIG1ha2VzIGEgdXNlciB3aXRoIGl0LCBpZ25vcmVzIHBhc3N3b3JkXG4gIC8vIFJlZmVyIHRvOiBodHRwczovL25leHQtYXV0aC5qcy5vcmcvY29uZmlndXJhdGlvbi9wcm92aWRlcnMvY3JlZGVudGlhbHNcbiAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSBcImRldmVsb3BtZW50XCIpIHtcbiAgICBwcm92aWRlcnMucHVzaChcbiAgICAgIENyZWRlbnRpYWxzUHJvdmlkZXIoe1xuICAgICAgICBuYW1lOiBcImxvY2FsZGV2XCIsXG4gICAgICAgIGNyZWRlbnRpYWxzOiB7XG4gICAgICAgICAgdXNlcm5hbWU6IHsgbGFiZWw6IFwiVXNlcm5hbWVcIiwgdHlwZTogXCJ0ZXh0XCIsIHBsYWNlaG9sZGVyOiBcImRldlwiIH0sXG4gICAgICAgICAgcGFzc3dvcmQ6IHsgbGFiZWw6IFwiUGFzc3dvcmRcIiwgdHlwZTogXCJwYXNzd29yZFwiIH0sXG4gICAgICAgIH0sICAgIFxuICAgICAgICBhc3luYyBhdXRob3JpemUoY3JlZGVudGlhbHMsIHJlcSk6IFByb21pc2U8YW55PiB7XG4gICAgICAgICAgLy8gWW91IGNhbiBwdXQgbG9naWMgaGVyZSB0byB2YWxpZGF0ZSB0aGUgY3JlZGVudGlhbHMgYW5kIHJldHVybiBhIHVzZXIuXG4gICAgICAgICAgLy8gV2UncmUgZ29pbmcgdG8gdGFrZSBhbnkgdXNlcm5hbWUgYW5kIG1ha2UgYSBuZXcgdXNlciB3aXRoIGl0XG4gICAgICAgICAgLy8gQ3JlYXRlIHRoZSBpZCBhcyB0aGUgaGFzaCBvZiB0aGUgZW1haWwgYXMgcGVyIHVzZXJIYXNoZWRJZCAoaGVscGVycy50cylcbiAgICAgICAgICBjb25zdCB1c2VybmFtZSA9IGNyZWRlbnRpYWxzPy51c2VybmFtZSB8fCBcImRldlwiO1xuICAgICAgICAgIGNvbnN0IGVtYWlsID0gdXNlcm5hbWUgKyBcIkBsb2NhbGhvc3RcIjtcbiAgICAgICAgICBjb25zdCB1c2VyID0ge1xuICAgICAgICAgICAgICBpZDogaGFzaFZhbHVlKGVtYWlsKSxcbiAgICAgICAgICAgICAgbmFtZTogdXNlcm5hbWUsXG4gICAgICAgICAgICAgIGVtYWlsOiBlbWFpbCxcbiAgICAgICAgICAgICAgaXNBZG1pbjogdHJ1ZSxcbiAgICAgICAgICAgICAgaW1hZ2U6IFwiXCIsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIGNvbnNvbGUubG9nKFwiPT09IERFViBVU0VSIExPR0dFRCBJTjpcXG5cIiwgSlNPTi5zdHJpbmdpZnkodXNlciwgbnVsbCwgMikpO1xuICAgICAgICAgIHJldHVybiB1c2VyO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgICk7XG4gIH1cblxuICByZXR1cm4gcHJvdmlkZXJzO1xufTtcblxuZXhwb3J0IGNvbnN0IG9wdGlvbnM6IE5leHRBdXRoT3B0aW9ucyA9IHtcbiAgc2VjcmV0OiBwcm9jZXNzLmVudi5ORVhUQVVUSF9TRUNSRVQsXG4gIHByb3ZpZGVyczogWy4uLmNvbmZpZ3VyZUlkZW50aXR5UHJvdmlkZXIoKV0sXG4gIGNhbGxiYWNrczoge1xuICAgIGFzeW5jIGp3dCh7dG9rZW4sIHVzZXIsIGFjY291bnQsIHByb2ZpbGUsIGlzTmV3VXNlciwgc2Vzc2lvbn0pIHtcbiAgICAgIGlmICh1c2VyPy5pc0FkbWluKSB7XG4gICAgICAgdG9rZW4uaXNBZG1pbiA9IHVzZXIuaXNBZG1pblxuICAgICAgfVxuICAgICAgcmV0dXJuIHRva2VuXG4gICAgfSxcbiAgICBhc3luYyBzZXNzaW9uKHtzZXNzaW9uLCB0b2tlbiwgdXNlciB9KSB7XG4gICAgICBzZXNzaW9uLnVzZXIuaXNBZG1pbiA9IHRva2VuLmlzQWRtaW4gYXMgc3RyaW5nXG4gICAgICByZXR1cm4gc2Vzc2lvblxuICAgIH1cbiAgfSxcbiAgc2Vzc2lvbjoge1xuICAgIHN0cmF0ZWd5OiBcImp3dFwiLFxuICB9LFxufTtcblxuZXhwb3J0IGNvbnN0IGhhbmRsZXJzID0gTmV4dEF1dGgob3B0aW9ucyk7XG4iXSwibmFtZXMiOlsiTmV4dEF1dGgiLCJBenVyZUFEUHJvdmlkZXIiLCJHaXRIdWJQcm92aWRlciIsIkNyZWRlbnRpYWxzUHJvdmlkZXIiLCJoYXNoVmFsdWUiLCJjb25maWd1cmVJZGVudGl0eVByb3ZpZGVyIiwicHJvdmlkZXJzIiwiYWRtaW5FbWFpbHMiLCJwcm9jZXNzIiwiZW52IiwiQURNSU5fRU1BSUxfQUREUkVTUyIsInNwbGl0IiwibWFwIiwiZW1haWwiLCJ0b0xvd2VyQ2FzZSIsInRyaW0iLCJBVVRIX0dJVEhVQl9JRCIsIkFVVEhfR0lUSFVCX1NFQ1JFVCIsInB1c2giLCJjbGllbnRJZCIsImNsaWVudFNlY3JldCIsInByb2ZpbGUiLCJuZXdQcm9maWxlIiwiaXNBZG1pbiIsImluY2x1ZGVzIiwiQVpVUkVfQURfQ0xJRU5UX0lEIiwiQVpVUkVfQURfQ0xJRU5UX1NFQ1JFVCIsIkFaVVJFX0FEX1RFTkFOVF9JRCIsInRlbmFudElkIiwiaWQiLCJzdWIiLCJwcmVmZXJyZWRfdXNlcm5hbWUiLCJuYW1lIiwiY3JlZGVudGlhbHMiLCJ1c2VybmFtZSIsImxhYmVsIiwidHlwZSIsInBsYWNlaG9sZGVyIiwicGFzc3dvcmQiLCJhdXRob3JpemUiLCJyZXEiLCJ1c2VyIiwiaW1hZ2UiLCJjb25zb2xlIiwibG9nIiwiSlNPTiIsInN0cmluZ2lmeSIsIm9wdGlvbnMiLCJzZWNyZXQiLCJORVhUQVVUSF9TRUNSRVQiLCJjYWxsYmFja3MiLCJqd3QiLCJ0b2tlbiIsImFjY291bnQiLCJpc05ld1VzZXIiLCJzZXNzaW9uIiwic3RyYXRlZ3kiLCJoYW5kbGVycyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./features/auth/auth-api.ts\n");

/***/ }),

/***/ "(rsc)/./features/auth/helpers.ts":
/*!**********************************!*\
  !*** ./features/auth/helpers.ts ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   hashValue: () => (/* binding */ hashValue),\n/* harmony export */   userHashedId: () => (/* binding */ userHashedId),\n/* harmony export */   userSession: () => (/* binding */ userSession)\n/* harmony export */ });\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! crypto */ \"crypto\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(crypto__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_auth__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next-auth */ \"(rsc)/./node_modules/next-auth/index.js\");\n/* harmony import */ var next_auth__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(next_auth__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _auth_api__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./auth-api */ \"(rsc)/./features/auth/auth-api.ts\");\n\n\n\nconst userSession = async ()=>{\n    const session = await (0,next_auth__WEBPACK_IMPORTED_MODULE_1__.getServerSession)(_auth_api__WEBPACK_IMPORTED_MODULE_2__.options);\n    if (session && session.user) {\n        return session.user;\n    }\n    return null;\n};\nconst userHashedId = async ()=>{\n    const user = await userSession();\n    if (user) {\n        return hashValue(user.email);\n    }\n    throw new Error(\"User not found\");\n};\nconst hashValue = (value)=>{\n    const hash = (0,crypto__WEBPACK_IMPORTED_MODULE_0__.createHash)(\"sha256\");\n    hash.update(value);\n    return hash.digest(\"hex\");\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9mZWF0dXJlcy9hdXRoL2hlbHBlcnMudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBb0M7QUFDUztBQUNSO0FBRTlCLE1BQU1HLGNBQWM7SUFDekIsTUFBTUMsVUFBVSxNQUFNSCwyREFBZ0JBLENBQUNDLDhDQUFPQTtJQUM5QyxJQUFJRSxXQUFXQSxRQUFRQyxJQUFJLEVBQUU7UUFDM0IsT0FBT0QsUUFBUUMsSUFBSTtJQUNyQjtJQUVBLE9BQU87QUFDVCxFQUFFO0FBRUssTUFBTUMsZUFBZTtJQUMxQixNQUFNRCxPQUFPLE1BQU1GO0lBQ25CLElBQUlFLE1BQU07UUFDUixPQUFPRSxVQUFVRixLQUFLRyxLQUFLO0lBQzdCO0lBRUEsTUFBTSxJQUFJQyxNQUFNO0FBQ2xCLEVBQUU7QUFRSyxNQUFNRixZQUFZLENBQUNHO0lBQ3hCLE1BQU1DLE9BQU9YLGtEQUFVQSxDQUFDO0lBQ3hCVyxLQUFLQyxNQUFNLENBQUNGO0lBQ1osT0FBT0MsS0FBS0UsTUFBTSxDQUFDO0FBQ3JCLEVBQUUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9henVyZS1vcGVuLWFpLWFjY2VsZXJhdG9yLy4vZmVhdHVyZXMvYXV0aC9oZWxwZXJzLnRzPzdlYWEiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY3JlYXRlSGFzaCB9IGZyb20gXCJjcnlwdG9cIjtcbmltcG9ydCB7IGdldFNlcnZlclNlc3Npb24gfSBmcm9tIFwibmV4dC1hdXRoXCI7XG5pbXBvcnQgeyBvcHRpb25zIH0gZnJvbSBcIi4vYXV0aC1hcGlcIjtcblxuZXhwb3J0IGNvbnN0IHVzZXJTZXNzaW9uID0gYXN5bmMgKCk6IFByb21pc2U8VXNlck1vZGVsIHwgbnVsbD4gPT4ge1xuICBjb25zdCBzZXNzaW9uID0gYXdhaXQgZ2V0U2VydmVyU2Vzc2lvbihvcHRpb25zKTtcbiAgaWYgKHNlc3Npb24gJiYgc2Vzc2lvbi51c2VyKSB7XG4gICAgcmV0dXJuIHNlc3Npb24udXNlciBhcyBVc2VyTW9kZWw7XG4gIH1cblxuICByZXR1cm4gbnVsbDtcbn07XG5cbmV4cG9ydCBjb25zdCB1c2VySGFzaGVkSWQgPSBhc3luYyAoKTogUHJvbWlzZTxzdHJpbmc+ID0+IHtcbiAgY29uc3QgdXNlciA9IGF3YWl0IHVzZXJTZXNzaW9uKCk7XG4gIGlmICh1c2VyKSB7XG4gICAgcmV0dXJuIGhhc2hWYWx1ZSh1c2VyLmVtYWlsKTtcbiAgfVxuXG4gIHRocm93IG5ldyBFcnJvcihcIlVzZXIgbm90IGZvdW5kXCIpO1xufTtcblxuZXhwb3J0IHR5cGUgVXNlck1vZGVsID0ge1xuICBuYW1lOiBzdHJpbmc7XG4gIGltYWdlOiBzdHJpbmc7XG4gIGVtYWlsOiBzdHJpbmc7XG59O1xuXG5leHBvcnQgY29uc3QgaGFzaFZhbHVlID0gKHZhbHVlOiBzdHJpbmcpOiBzdHJpbmcgPT4ge1xuICBjb25zdCBoYXNoID0gY3JlYXRlSGFzaChcInNoYTI1NlwiKTtcbiAgaGFzaC51cGRhdGUodmFsdWUpO1xuICByZXR1cm4gaGFzaC5kaWdlc3QoXCJoZXhcIik7XG59O1xuIl0sIm5hbWVzIjpbImNyZWF0ZUhhc2giLCJnZXRTZXJ2ZXJTZXNzaW9uIiwib3B0aW9ucyIsInVzZXJTZXNzaW9uIiwic2Vzc2lvbiIsInVzZXIiLCJ1c2VySGFzaGVkSWQiLCJoYXNoVmFsdWUiLCJlbWFpbCIsIkVycm9yIiwidmFsdWUiLCJoYXNoIiwidXBkYXRlIiwiZGlnZXN0Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./features/auth/helpers.ts\n");

/***/ }),

/***/ "(rsc)/./features/chat/chat-services/Azure-bing-search/bing.ts":
/*!***************************************************************!*\
  !*** ./features/chat/chat-services/Azure-bing-search/bing.ts ***!
  \***************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   BingSearchResult: () => (/* binding */ BingSearchResult)\n/* harmony export */ });\nclass BingSearchResult {\n    async SearchWeb(searchText) {\n        var url = \"https://api.bing.microsoft.com/v7.0/search?count=10&offset=0&responseFilter=Webpages&setLang=ja-jp&q=\";\n        url = url + searchText;\n        try {\n            const response = await fetch(url, {\n                method: \"GET\",\n                headers: {\n                    \"Content-Type\": \"application/json\",\n                    \"Ocp-Apim-Subscription-Key\": process.env.AZURE_BINGSEARCH_API_KEY\n                }\n            });\n            return await response.json();\n        //const postsData = await response.json();\n        } catch (err) {\n            console.error(err);\n        }\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9mZWF0dXJlcy9jaGF0L2NoYXQtc2VydmljZXMvQXp1cmUtYmluZy1zZWFyY2gvYmluZy50cyIsIm1hcHBpbmdzIjoiOzs7O0FBQU8sTUFBTUE7SUFDWCxNQUFPQyxVQUFVQyxVQUFrQixFQUFHO1FBQ3BDLElBQUlDLE1BQWdCO1FBQ3BCQSxNQUFNQSxNQUFNRDtRQUNaLElBQUk7WUFDRixNQUFNRSxXQUFXLE1BQU1DLE1BQU1GLEtBQUs7Z0JBQ2hDRyxRQUFRO2dCQUNSQyxTQUFTO29CQUNQLGdCQUFnQjtvQkFDaEIsNkJBQTZCQyxRQUFRQyxHQUFHLENBQUNDLHdCQUF3QjtnQkFDakU7WUFBQztZQUNMLE9BQU8sTUFBTU4sU0FBU08sSUFBSTtRQUMxQiwwQ0FBMEM7UUFDNUMsRUFBRSxPQUFPQyxLQUFLO1lBQ1pDLFFBQVFDLEtBQUssQ0FBQ0Y7UUFDaEI7SUFFRjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vYXp1cmUtb3Blbi1haS1hY2NlbGVyYXRvci8uL2ZlYXR1cmVzL2NoYXQvY2hhdC1zZXJ2aWNlcy9BenVyZS1iaW5nLXNlYXJjaC9iaW5nLnRzP2QxOTkiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGNsYXNzIEJpbmdTZWFyY2hSZXN1bHQge1xuICBhc3luYyAgU2VhcmNoV2ViKHNlYXJjaFRleHQ6IHN0cmluZykgIHtcbiAgICB2YXIgdXJsIDogc3RyaW5nICA9IFwiaHR0cHM6Ly9hcGkuYmluZy5taWNyb3NvZnQuY29tL3Y3LjAvc2VhcmNoP2NvdW50PTEwJm9mZnNldD0wJnJlc3BvbnNlRmlsdGVyPVdlYnBhZ2VzJnNldExhbmc9amEtanAmcT1cIjtcbiAgICB1cmwgPSB1cmwgKyBzZWFyY2hUZXh0O1xuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKHVybCwge1xuICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgICAnT2NwLUFwaW0tU3Vic2NyaXB0aW9uLUtleSc6IHByb2Nlc3MuZW52LkFaVVJFX0JJTkdTRUFSQ0hfQVBJX0tFWVxuICAgICAgICAgIH19KTtcbiAgICAgIHJldHVybiBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgICAvL2NvbnN0IHBvc3RzRGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICB9XG4gIFxuICB9IFxufVxuIl0sIm5hbWVzIjpbIkJpbmdTZWFyY2hSZXN1bHQiLCJTZWFyY2hXZWIiLCJzZWFyY2hUZXh0IiwidXJsIiwicmVzcG9uc2UiLCJmZXRjaCIsIm1ldGhvZCIsImhlYWRlcnMiLCJwcm9jZXNzIiwiZW52IiwiQVpVUkVfQklOR1NFQVJDSF9BUElfS0VZIiwianNvbiIsImVyciIsImNvbnNvbGUiLCJlcnJvciJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./features/chat/chat-services/Azure-bing-search/bing.ts\n");

/***/ }),

/***/ "(rsc)/./features/chat/chat-services/azure-cog-search/azure-cog-vector-store.ts":
/*!********************************************************************************!*\
  !*** ./features/chat/chat-services/azure-cog-search/azure-cog-vector-store.ts ***!
  \********************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   deleteDocuments: () => (/* binding */ deleteDocuments),\n/* harmony export */   embedDocuments: () => (/* binding */ embedDocuments),\n/* harmony export */   ensureIndexIsCreated: () => (/* binding */ ensureIndexIsCreated),\n/* harmony export */   indexDocuments: () => (/* binding */ indexDocuments),\n/* harmony export */   similaritySearchVectorWithScore: () => (/* binding */ similaritySearchVectorWithScore),\n/* harmony export */   simpleSearch: () => (/* binding */ simpleSearch)\n/* harmony export */ });\n/* harmony import */ var _features_common_openai__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/features/common/openai */ \"(rsc)/./features/common/openai.ts\");\n\nconst simpleSearch = async (filter)=>{\n    const url = `${baseIndexUrl()}/docs/search?api-version=${process.env.AZURE_SEARCH_API_VERSION}`;\n    const searchBody = {\n        search: filter?.search || \"*\",\n        facets: filter?.facets || [],\n        filter: filter?.filter || \"\",\n        vectors: [],\n        top: filter?.top || 10\n    };\n    const resultDocuments = await fetcher(url, {\n        method: \"POST\",\n        body: JSON.stringify(searchBody)\n    });\n    return resultDocuments.value;\n};\nconst similaritySearchVectorWithScore = async (query, k, filter)=>{\n    const openai = (0,_features_common_openai__WEBPACK_IMPORTED_MODULE_0__.OpenAIEmbeddingInstance)();\n    const embeddings = await openai.embeddings.create({\n        input: query,\n        model: process.env.AZURE_OPENAI_API_EMBEDDINGS_DEPLOYMENT_NAME\n    });\n    const url = `${baseIndexUrl()}/docs/search?api-version=${process.env.AZURE_SEARCH_API_VERSION}`;\n    const searchBody = {\n        search: filter?.search || \"*\",\n        facets: filter?.facets || [],\n        filter: filter?.filter || \"\",\n        vectors: [\n            {\n                value: embeddings.data[0].embedding,\n                fields: \"embedding\",\n                k: k\n            }\n        ],\n        top: filter?.top || k\n    };\n    const resultDocuments = await fetcher(url, {\n        method: \"POST\",\n        body: JSON.stringify(searchBody)\n    });\n    return resultDocuments.value;\n};\nconst indexDocuments = async (documents)=>{\n    const url = `${baseIndexUrl()}/docs/index?api-version=${process.env.AZURE_SEARCH_API_VERSION}`;\n    await embedDocuments(documents);\n    const documentIndexRequest = {\n        value: documents\n    };\n    await fetcher(url, {\n        method: \"POST\",\n        body: JSON.stringify(documentIndexRequest)\n    });\n};\nconst deleteDocuments = async (chatThreadId)=>{\n    // find all documents for chat thread\n    const documentsInChat = await simpleSearch({\n        filter: `chatThreadId eq '${chatThreadId}'`\n    });\n    const documentsToDelete = [];\n    documentsInChat.forEach(async (document)=>{\n        const doc = {\n            \"@search.action\": \"delete\",\n            id: document.id\n        };\n        documentsToDelete.push(doc);\n    });\n    // delete the documents\n    await fetcher(`${baseIndexUrl()}/docs/index?api-version=${process.env.AZURE_SEARCH_API_VERSION}`, {\n        method: \"POST\",\n        body: JSON.stringify({\n            value: documentsToDelete\n        })\n    });\n};\nconst embedDocuments = async (documents)=>{\n    const openai = (0,_features_common_openai__WEBPACK_IMPORTED_MODULE_0__.OpenAIEmbeddingInstance)();\n    try {\n        const contentsToEmbed = documents.map((d)=>d.pageContent);\n        const embeddings = await openai.embeddings.create({\n            input: contentsToEmbed,\n            model: process.env.AZURE_OPENAI_API_EMBEDDINGS_DEPLOYMENT_NAME\n        });\n        embeddings.data.forEach((embedding, index)=>{\n            documents[index].embedding = embedding.embedding;\n        });\n    } catch (e) {\n        console.log(e);\n        const error = e;\n        throw new Error(`${e} with code ${error.status}`);\n    }\n};\nconst baseUrl = ()=>{\n    return `https://${process.env.AZURE_SEARCH_NAME}.search.windows.net/indexes`;\n};\nconst baseIndexUrl = ()=>{\n    return `https://${process.env.AZURE_SEARCH_NAME}.search.windows.net/indexes/${process.env.AZURE_SEARCH_INDEX_NAME}`;\n};\nconst fetcher = async (url, init)=>{\n    const response = await fetch(url, {\n        ...init,\n        cache: \"no-store\",\n        headers: {\n            \"Content-Type\": \"application/json\",\n            \"api-key\": process.env.AZURE_SEARCH_API_KEY\n        }\n    });\n    if (!response.ok) {\n        if (response.status === 400) {\n            const err = await response.json();\n            throw new Error(err.error.message);\n        } else {\n            throw new Error(`Azure Cog Search Error: ${response.statusText}`);\n        }\n    }\n    return await response.json();\n};\nconst ensureIndexIsCreated = async ()=>{\n    const url = `${baseIndexUrl()}?api-version=${process.env.AZURE_SEARCH_API_VERSION}`;\n    try {\n        await fetcher(url);\n    } catch (e) {\n        await createCogSearchIndex();\n    }\n};\nconst createCogSearchIndex = async ()=>{\n    const url = `${baseUrl()}?api-version=${process.env.AZURE_SEARCH_API_VERSION}`;\n    await fetcher(url, {\n        method: \"POST\",\n        body: JSON.stringify(AZURE_SEARCH_INDEX)\n    });\n};\nconst AZURE_SEARCH_INDEX = {\n    name: process.env.AZURE_SEARCH_INDEX_NAME,\n    fields: [\n        {\n            name: \"id\",\n            type: \"Edm.String\",\n            key: true,\n            filterable: true\n        },\n        {\n            name: \"user\",\n            type: \"Edm.String\",\n            searchable: true,\n            filterable: true\n        },\n        {\n            name: \"chatThreadId\",\n            type: \"Edm.String\",\n            searchable: true,\n            filterable: true\n        },\n        {\n            name: \"pageContent\",\n            searchable: true,\n            type: \"Edm.String\"\n        },\n        {\n            name: \"metadata\",\n            type: \"Edm.String\"\n        },\n        {\n            name: \"chatType\",\n            type: \"Edm.String\",\n            searchable: true,\n            filterable: true\n        },\n        {\n            name: \"deptName\",\n            type: \"Edm.String\",\n            searchable: true,\n            filterable: true\n        },\n        {\n            name: \"embedding\",\n            type: \"Collection(Edm.Single)\",\n            searchable: true,\n            filterable: false,\n            sortable: false,\n            facetable: false,\n            retrievable: true,\n            dimensions: 1536,\n            vectorSearchConfiguration: \"vectorConfig\"\n        }\n    ],\n    vectorSearch: {\n        algorithmConfigurations: [\n            {\n                name: \"vectorConfig\",\n                kind: \"hnsw\"\n            }\n        ]\n    }\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9mZWF0dXJlcy9jaGF0L2NoYXQtc2VydmljZXMvYXp1cmUtY29nLXNlYXJjaC9henVyZS1jb2ctdmVjdG9yLXN0b3JlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFBbUU7QUFpRDVELE1BQU1DLGVBQWUsT0FDMUJDO0lBRUEsTUFBTUMsTUFBTSxDQUFDLEVBQUVDLGVBQWUseUJBQXlCLEVBQ3JEQyxRQUFRQyxHQUFHLENBQUNDLHdCQUF3QixDQUNyQyxDQUFDO0lBQ0YsTUFBTUMsYUFBb0M7UUFDeENDLFFBQVFQLFFBQVFPLFVBQVU7UUFDMUJDLFFBQVFSLFFBQVFRLFVBQVUsRUFBRTtRQUM1QlIsUUFBUUEsUUFBUUEsVUFBVTtRQUMxQlMsU0FBUyxFQUFFO1FBQ1hDLEtBQUtWLFFBQVFVLE9BQU87SUFDdEI7SUFFQSxNQUFNQyxrQkFBbUIsTUFBTUMsUUFBUVgsS0FBSztRQUMxQ1ksUUFBUTtRQUNSQyxNQUFNQyxLQUFLQyxTQUFTLENBQUNWO0lBQ3ZCO0lBSUEsT0FBT0ssZ0JBQWdCTSxLQUFLO0FBQzlCLEVBQUU7QUFFSyxNQUFNQyxrQ0FBa0MsT0FDN0NDLE9BQ0FDLEdBQ0FwQjtJQUVBLE1BQU1xQixTQUFTdkIsZ0ZBQXVCQTtJQUV0QyxNQUFNd0IsYUFBYSxNQUFNRCxPQUFPQyxVQUFVLENBQUNDLE1BQU0sQ0FBQztRQUNoREMsT0FBT0w7UUFDUE0sT0FBT3RCLFFBQVFDLEdBQUcsQ0FBQ3NCLDJDQUEyQztJQUNoRTtJQUNBLE1BQU16QixNQUFNLENBQUMsRUFBRUMsZUFBZSx5QkFBeUIsRUFDckRDLFFBQVFDLEdBQUcsQ0FBQ0Msd0JBQXdCLENBQ3JDLENBQUM7SUFFRixNQUFNQyxhQUFvQztRQUN4Q0MsUUFBUVAsUUFBUU8sVUFBVTtRQUMxQkMsUUFBUVIsUUFBUVEsVUFBVSxFQUFFO1FBQzVCUixRQUFRQSxRQUFRQSxVQUFVO1FBQzFCUyxTQUFTO1lBQ1A7Z0JBQUVRLE9BQU9LLFdBQVdLLElBQUksQ0FBQyxFQUFFLENBQUNDLFNB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LFlBQVk7UUFDZDtRQUNBO1lBQ0VILE1BQU87WUFDUEMsTUFBTTtZQUNORyxZQUFZO1lBQ1pELFlBQVk7UUFDZDtRQUNBO1lBQ0VILE1BQU07WUFDTkMsTUFBTTtZQUNORyxZQUFZO1lBQ1pELFlBQVk7WUFDWkUsVUFBVTtZQUNWQyxXQUFXO1lBQ1hDLGFBQWE7WUFDYkMsWUFBWTtZQUNaQywyQkFBMkI7UUFDN0I7S0FDRDtJQUNEQyxjQUFjO1FBQ1pDLHlCQUF5QjtZQUN2QjtnQkFDRVgsTUFBTTtnQkFDTlksTUFBTTtZQUNSO1NBQ0Q7SUFDSDtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vYXp1cmUtb3Blbi1haS1hY2NlbGVyYXRvci8uL2ZlYXR1cmVzL2NoYXQvY2hhdC1zZXJ2aWNlcy9henVyZS1jb2ctc2VhcmNoL2F6dXJlLWNvZy12ZWN0b3Itc3RvcmUudHM/ZjI0MiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBPcGVuQUlFbWJlZGRpbmdJbnN0YW5jZSB9IGZyb20gXCJAL2ZlYXR1cmVzL2NvbW1vbi9vcGVuYWlcIjtcblxuZXhwb3J0IGludGVyZmFjZSBBenVyZUNvZ0RvY3VtZW50SW5kZXgge1xuICBpZDogc3RyaW5nO1xuICBwYWdlQ29udGVudDogc3RyaW5nO1xuICBlbWJlZGRpbmc/OiBudW1iZXJbXTtcbiAgdXNlcjogc3RyaW5nO1xuICBjaGF0VGhyZWFkSWQ6IHN0cmluZztcbiAgbWV0YWRhdGE6IHN0cmluZztcbiAgY2hhdFR5cGU6IHN0cmluZztcbiAgZGVwdE5hbWU6IHN0cmluZztcbn1cblxuaW50ZXJmYWNlIERvY3VtZW50U2VhcmNoUmVzcG9uc2VNb2RlbDxUTW9kZWw+IHtcbiAgdmFsdWU6IFRNb2RlbFtdO1xufVxuXG50eXBlIERvY3VtZW50U2VhcmNoTW9kZWwgPSB7XG4gIFwiQHNlYXJjaC5zY29yZVwiOiBudW1iZXI7XG59O1xuXG50eXBlIERvY3VtZW50RGVsZXRlTW9kZWwgPSB7XG4gIGlkOiBzdHJpbmc7XG4gIFwiQHNlYXJjaC5hY3Rpb25cIjogXCJkZWxldGVcIjtcbn07XG5cbmV4cG9ydCBpbnRlcmZhY2UgQXp1cmVDb2dEb2N1bWVudCB7fVxuXG50eXBlIEF6dXJlQ29nVmVjdG9yRmllbGQgPSB7XG4gIHZhbHVlOiBudW1iZXJbXTtcbiAgZmllbGRzOiBzdHJpbmc7XG4gIGs6IG51bWJlcjtcbn07XG5cbnR5cGUgQXp1cmVDb2dGaWx0ZXIgPSB7XG4gIHNlYXJjaD86IHN0cmluZztcbiAgZmFjZXRzPzogc3RyaW5nW107XG4gIGZpbHRlcj86IHN0cmluZztcbiAgdG9wPzogbnVtYmVyO1xufTtcblxudHlwZSBBenVyZUNvZ1JlcXVlc3RPYmplY3QgPSB7XG4gIHNlYXJjaDogc3RyaW5nO1xuICBmYWNldHM6IHN0cmluZ1tdO1xuICBmaWx0ZXI6IHN0cmluZztcbiAgdmVjdG9yczogQXp1cmVDb2dWZWN0b3JGaWVsZFtdO1xuICB0b3A6IG51bWJlcjtcbn07XG5cbmV4cG9ydCBjb25zdCBzaW1wbGVTZWFyY2ggPSBhc3luYyAoXG4gIGZpbHRlcj86IEF6dXJlQ29nRmlsdGVyXG4pOiBQcm9taXNlPEFycmF5PEF6dXJlQ29nRG9jdW1lbnRJbmRleCAmIERvY3VtZW50U2VhcmNoTW9kZWw+PiA9PiB7XG4gIGNvbnN0IHVybCA9IGAke2Jhc2VJbmRleFVybCgpfS9kb2NzL3NlYXJjaD9hcGktdmVyc2lvbj0ke1xuICAgIHByb2Nlc3MuZW52LkFaVVJFX1NFQVJDSF9BUElfVkVSU0lPTlxuICB9YDtcbiAgY29uc3Qgc2VhcmNoQm9keTogQXp1cmVDb2dSZXF1ZXN0T2JqZWN0ID0ge1xuICAgIHNlYXJjaDogZmlsdGVyPy5zZWFyY2ggfHwgXCIqXCIsXG4gICAgZmFjZXRzOiBmaWx0ZXI/LmZhY2V0cyB8fCBbXSxcbiAgICBmaWx0ZXI6IGZpbHRlcj8uZmlsdGVyIHx8IFwiXCIsXG4gICAgdmVjdG9yczogW10sXG4gICAgdG9wOiBmaWx0ZXI/LnRvcCB8fCAxMCxcbiAgfTtcblxuICBjb25zdCByZXN1bHREb2N1bWVudHMgPSAoYXdhaXQgZmV0Y2hlcih1cmwsIHtcbiAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHNlYXJjaEJvZHkpLFxuICB9KSkgYXMgRG9jdW1lbnRTZWFyY2hSZXNwb25zZU1vZGVsPFxuICAgIEF6dXJlQ29nRG9jdW1lbnRJbmRleCAmIERvY3VtZW50U2VhcmNoTW9kZWxcbiAgPjtcblxuICByZXR1cm4gcmVzdWx0RG9jdW1lbnRzLnZhbHVlO1xufTtcblxuZXhwb3J0IGNvbnN0IHNpbWlsYXJpdHlTZWFyY2hWZWN0b3JXaXRoU2NvcmUgPSBhc3luYyAoXG4gIHF1ZXJ5OiBzdHJpbmcsXG4gIGs6IG51bWJlcixcbiAgZmlsdGVyPzogQXp1cmVDb2dGaWx0ZXJcbik6IFByb21pc2U8QXJyYXk8QXp1cmVDb2dEb2N1bWVudEluZGV4ICYgRG9jdW1lbnRTZWFyY2hNb2RlbD4+ID0+IHtcbiAgY29uc3Qgb3BlbmFpID0gT3BlbkFJRW1iZWRkaW5nSW5zdGFuY2UoKTtcblxuICBjb25zdCBlbWJlZGRpbmdzID0gYXdhaXQgb3BlbmFpLmVtYmVkZGluZ3MuY3JlYXRlKHtcbiAgICBpbnB1dDogcXVlcnksXG4gICAgbW9kZWw6IHByb2Nlc3MuZW52LkFaVVJFX09QRU5BSV9BUElfRU1CRURESU5HU19ERVBMT1lNRU5UX05BTUUsXG4gIH0pO1xuICBjb25zdCB1cmwgPSBgJHtiYXNlSW5kZXhVcmwoKX0vZG9jcy9zZWFyY2g/YXBpLXZlcnNpb249JHtcbiAgICBwcm9jZXNzLmVudi5BWlVSRV9TRUFSQ0hfQVBJX1ZFUlNJT05cbiAgfWA7XG5cbiAgY29uc3Qgc2VhcmNoQm9keTogQXp1cmVDb2dSZXF1ZXN0T2JqZWN0ID0ge1xuICAgIHNlYXJjaDogZmlsdGVyPy5zZWFyY2ggfHwgXCIqXCIsXG4gICAgZmFjZXRzOiBmaWx0ZXI/LmZhY2V0cyB8fCBbXSxcbiAgICBmaWx0ZXI6IGZpbHRlcj8uZmlsdGVyIHx8IFwiXCIsXG4gICAgdmVjdG9yczogW1xuICAgICAgeyB2YWx1ZTogZW1iZWRkaW5ncy5kYXRhWzBdLmVtYmVkZGluZywgZmllbGRzOiBcImVtYmVkZGluZ1wiLCBrOiBrIH0sXG4gICAgXSxcbiAgICB0b3A6IGZpbHRlcj8udG9wIHx8IGssXG4gIH07XG5cbiAgY29uc3QgcmVzdWx0RG9jdW1lbnRzID0gKGF3YWl0IGZldGNoZXIodXJsLCB7XG4gICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICBib2R5OiBKU09OLnN0cmluZ2lmeShzZWFyY2hCb2R5KSxcbiAgfSkpIGFzIERvY3VtZW50U2VhcmNoUmVzcG9uc2VNb2RlbDxcbiAgICBBenVyZUNvZ0RvY3VtZW50SW5kZXggJiBEb2N1bWVudFNlYXJjaE1vZGVsXG4gID47XG5cbiAgcmV0dXJuIHJlc3VsdERvY3VtZW50cy52YWx1ZTtcbn07XG5cbmV4cG9ydCBjb25zdCBpbmRleERvY3VtZW50cyA9IGFzeW5jIChcbiAgZG9jdW1lbnRzOiBBcnJheTxBenVyZUNvZ0RvY3VtZW50SW5kZXg+XG4pOiBQcm9taXNlPHZvaWQ+ID0+IHtcbiAgIFxuICBjb25zdCB1cmwgPSBgJHtiYXNlSW5kZXhVcmwoKX0vZG9jcy9pbmRleD9hcGktdmVyc2lvbj0ke1xuICAgIHByb2Nlc3MuZW52LkFaVVJFX1NFQVJDSF9BUElfVkVSU0lPTlxuICB9YDtcblxuICBhd2FpdCBlbWJlZERvY3VtZW50cyhkb2N1bWVudHMpO1xuICBjb25zdCBkb2N1bWVudEluZGV4UmVxdWVzdDogRG9jdW1lbnRTZWFyY2hSZXNwb25zZU1vZGVsPEF6dXJlQ29nRG9jdW1lbnRJbmRleD4gPVxuICAgIHtcbiAgICAgIHZhbHVlOiBkb2N1bWVudHMsXG4gICAgfTtcblxuICBhd2FpdCBmZXRjaGVyKHVybCwge1xuICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgYm9keTogSlNPTi5zdHJpbmdpZnkoZG9jdW1lbnRJbmRleFJlcXVlc3QpLFxuICB9KTtcbn07XG5cbmV4cG9ydCBjb25zdCBkZWxldGVEb2N1bWVudHMgPSBhc3luYyAoY2hhdFRocmVhZElkOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+ID0+IHtcbiAgLy8gZmluZCBhbGwgZG9jdW1lbnRzIGZvciBjaGF0IHRocmVhZFxuXG4gIGNvbnN0IGRvY3VtZW50c0luQ2hhdCA9IGF3YWl0IHNpbXBsZVNlYXJjaCh7XG4gICAgZmlsdGVyOiBgY2hhdFRocmVhZElkIGVxICcke2NoYXRUaHJlYWRJZH0nYCxcbiAgfSk7XG5cbiAgY29uc3QgZG9jdW1lbnRzVG9EZWxldGU6IERvY3VtZW50RGVsZXRlTW9kZWxbXSA9IFtdO1xuXG4gIGRvY3VtZW50c0luQ2hhdC5mb3JFYWNoKGFzeW5jIChkb2N1bWVudDogeyBpZDogc3RyaW5nIH0pID0+IHtcbiAgICBjb25zdCBkb2M6IERvY3VtZW50RGVsZXRlTW9kZWwgPSB7XG4gICAgICBcIkBzZWFyY2guYWN0aW9uXCI6IFwiZGVsZXRlXCIsXG4gICAgICBpZDogZG9jdW1lbnQuaWQsXG4gICAgfTtcbiAgICBkb2N1bWVudHNUb0RlbGV0ZS5wdXNoKGRvYyk7XG4gIH0pO1xuXG4gIC8vIGRlbGV0ZSB0aGUgZG9jdW1lbnRzXG4gIGF3YWl0IGZldGNoZXIoXG4gICAgYCR7YmFzZUluZGV4VXJsKCl9L2RvY3MvaW5kZXg/YXBpLXZlcnNpb249JHtcbiAgICAgIHByb2Nlc3MuZW52LkFaVVJFX1NFQVJDSF9BUElfVkVSU0lPTlxuICAgIH1gLFxuICAgIHtcbiAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IHZhbHVlOiBkb2N1bWVudHNUb0RlbGV0ZSB9KSxcbiAgICB9XG4gICk7XG59O1xuXG5leHBvcnQgY29uc3QgZW1iZWREb2N1bWVudHMgPSBhc3luYyAoXG4gIGRvY3VtZW50czogQXJyYXk8QXp1cmVDb2dEb2N1bWVudEluZGV4PlxuKSA9PiB7XG4gIGNvbnN0IG9wZW5haSA9IE9wZW5BSUVtYmVkZGluZ0luc3RhbmNlKCk7XG5cbiAgdHJ5IHtcbiAgICBjb25zdCBjb250ZW50c1RvRW1iZWQgPSBkb2N1bWVudHMubWFwKChkKSA9PiBkLnBhZ2VDb250ZW50KTtcblxuICAgIGNvbnN0IGVtYmVkZGluZ3MgPSBhd2FpdCBvcGVuYWkuZW1iZWRkaW5ncy5jcmVhdGUoe1xuICAgICAgaW5wdXQ6IGNvbnRlbnRzVG9FbWJlZCxcbiAgICAgIG1vZGVsOiBwcm9jZXNzLmVudi5BWlVSRV9PUEVOQUlfQVBJX0VNQkVERElOR1NfREVQTE9ZTUVOVF9OQU1FLFxuICAgIH0pO1xuXG4gICAgZW1iZWRkaW5ncy5kYXRhLmZvckVhY2goKGVtYmVkZGluZywgaW5kZXgpID0+IHtcbiAgICAgIGRvY3VtZW50c1tpbmRleF0uZW1iZWRkaW5nID0gZW1iZWRkaW5nLmVtYmVkZGluZztcbiAgICB9KTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIGNvbnNvbGUubG9nKGUpO1xuICAgIGNvbnN0IGVycm9yID0gZSBhcyBhbnk7XG4gICAgdGhyb3cgbmV3IEVycm9yKGAke2V9IHdpdGggY29kZSAke2Vycm9yLnN0YXR1c31gKTtcbiAgfVxufTtcblxuY29uc3QgYmFzZVVybCA9ICgpOiBzdHJpbmcgPT4ge1xuICByZXR1cm4gYGh0dHBzOi8vJHtwcm9jZXNzLmVudi5BWlVSRV9TRUFSQ0hfTkFNRX0uc2VhcmNoLndpbmRvd3MubmV0L2luZGV4ZXNgO1xufTtcblxuY29uc3QgYmFzZUluZGV4VXJsID0gKCk6IHN0cmluZyA9PiB7XG4gIHJldHVybiBgaHR0cHM6Ly8ke3Byb2Nlc3MuZW52LkFaVVJFX1NFQVJDSF9OQU1FfS5zZWFyY2gud2luZG93cy5uZXQvaW5kZXhlcy8ke3Byb2Nlc3MuZW52LkFaVVJFX1NFQVJDSF9JTkRFWF9OQU1FfWA7XG59O1xuXG5jb25zdCBmZXRjaGVyID0gYXN5bmMgKHVybDogc3RyaW5nLCBpbml0PzogUmVxdWVzdEluaXQpID0+IHtcbiAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCh1cmwsIHtcbiAgICAuLi5pbml0LFxuICAgIGNhY2hlOiBcIm5vLXN0b3JlXCIsXG4gICAgaGVhZGVyczoge1xuICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgICBcImFwaS1rZXlcIjogcHJvY2Vzcy5lbnYuQVpVUkVfU0VBUkNIX0FQSV9LRVksXG4gICAgfSxcbiAgfSk7XG5cbiAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDQwMCkge1xuICAgICAgY29uc3QgZXJyID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGVyci5lcnJvci5tZXNzYWdlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBBenVyZSBDb2cgU2VhcmNoIEVycm9yOiAke3Jlc3BvbnNlLnN0YXR1c1RleHR9YCk7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbn07XG5cbmV4cG9ydCBjb25zdCBlbnN1cmVJbmRleElzQ3JlYXRlZCA9IGFzeW5jICgpOiBQcm9taXNlPHZvaWQ+ID0+IHtcbiAgY29uc3QgdXJsID0gYCR7YmFzZUluZGV4VXJsKCl9P2FwaS12ZXJzaW9uPSR7XG4gICAgcHJvY2Vzcy5lbnYuQVpVUkVfU0VBUkNIX0FQSV9WRVJTSU9OXG4gIH1gO1xuXG4gIHRyeSB7XG4gICAgYXdhaXQgZmV0Y2hlcih1cmwpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgYXdhaXQgY3JlYXRlQ29nU2VhcmNoSW5kZXgoKTtcbiAgfVxufTtcblxuY29uc3QgY3JlYXRlQ29nU2VhcmNoSW5kZXggPSBhc3luYyAoKTogUHJvbWlzZTx2b2lkPiA9PiB7XG4gIGNvbnN0IHVybCA9IGAke2Jhc2VVcmwoKX0/YXBpLXZlcnNpb249JHtcbiAgICBwcm9jZXNzLmVudi5BWlVSRV9TRUFSQ0hfQVBJX1ZFUlNJT05cbiAgfWA7XG5cbiAgYXdhaXQgZmV0Y2hlcih1cmwsIHtcbiAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KEFaVVJFX1NFQVJDSF9JTkRFWCksXG4gIH0pO1xufTtcblxuY29uc3QgQVpVUkVfU0VBUkNIX0lOREVYID0ge1xuICBuYW1lOiBwcm9jZXNzLmVudi5BWlVSRV9TRUFSQ0hfSU5ERVhfTkFNRSxcbiAgZmllbGRzOiBbXG4gICAge1xuICAgICAgbmFtZTogXCJpZFwiLFxuICAgICAgdHlwZTogXCJFZG0uU3RyaW5nXCIsXG4gICAgICBrZXk6IHRydWUsXG4gICAgICBmaWx0ZXJhYmxlOiB0cnVlLFxuICAgIH0sXG4gICAge1xuICAgICAgbmFtZTogXCJ1c2VyXCIsXG4gICAgICB0eXBlOiBcIkVkbS5TdHJpbmdcIixcbiAgICAgIHNlYXJjaGFibGU6IHRydWUsXG4gICAgICBmaWx0ZXJhYmxlOiB0cnVlLFxuICAgIH0sXG4gICAge1xuICAgICAgbmFtZTogXCJjaGF0VGhyZWFkSWRcIixcbiAgICAgIHR5cGU6IFwiRWRtLlN0cmluZ1wiLFxuICAgICAgc2VhcmNoYWJsZTogdHJ1ZSxcbiAgICAgIGZpbHRlcmFibGU6IHRydWUsXG4gICAgfSxcbiAgICB7XG4gICAgICBuYW1lOiBcInBhZ2VDb250ZW50XCIsXG4gICAgICBzZWFyY2hhYmxlOiB0cnVlLFxuICAgICAgdHlwZTogXCJFZG0uU3RyaW5nXCIsXG4gICAgfSxcbiAgICB7XG4gICAgICBuYW1lOiBcIm1ldGFkYXRhXCIsXG4gICAgICB0eXBlOiBcIkVkbS5TdHJpbmdcIixcbiAgICB9LFxuICAgIHtcbiAgICAgIG5hbWUgOiBcImNoYXRUeXBlXCIsXG4gICAgICB0eXBlOiBcIkVkbS5TdHJpbmdcIixcbiAgICAgIHNlYXJjaGFibGU6IHRydWUsXG4gICAgICBmaWx0ZXJhYmxlOiB0cnVlLFxuICAgIH0sXG4gICAge1xuICAgICAgbmFtZSA6IFwiZGVwdE5hbWVcIixcbiAgICAgIHR5cGU6IFwiRWRtLlN0cmluZ1wiLFxuICAgICAgc2VhcmNoYWJsZTogdHJ1ZSxcbiAgICAgIGZpbHRlcmFibGU6IHRydWUsXG4gICAgfSxcbiAgICB7XG4gICAgICBuYW1lOiBcImVtYmVkZGluZ1wiLFxuICAgICAgdHlwZTogXCJDb2xsZWN0aW9uKEVkbS5TaW5nbGUpXCIsXG4gICAgICBzZWFyY2hhYmxlOiB0cnVlLFxuICAgICAgZmlsdGVyYWJsZTogZmFsc2UsXG4gICAgICBzb3J0YWJsZTogZmFsc2UsXG4gICAgICBmYWNldGFibGU6IGZhbHNlLFxuICAgICAgcmV0cmlldmFibGU6IHRydWUsXG4gICAgICBkaW1lbnNpb25zOiAxNTM2LFxuICAgICAgdmVjdG9yU2VhcmNoQ29uZmlndXJhdGlvbjogXCJ2ZWN0b3JDb25maWdcIixcbiAgICB9LFxuICBdLFxuICB2ZWN0b3JTZWFyY2g6IHtcbiAgICBhbGdvcml0aG1Db25maWd1cmF0aW9uczogW1xuICAgICAge1xuICAgICAgICBuYW1lOiBcInZlY3RvckNvbmZpZ1wiLFxuICAgICAgICBraW5kOiBcImhuc3dcIixcbiAgICAgIH0sXG4gICAgXSxcbiAgfSxcbn07XG4iXSwibmFtZXMiOlsiT3BlbkFJRW1iZWRkaW5nSW5zdGFuY2UiLCJzaW1wbGVTZWFyY2giLCJmaWx0ZXIiLCJ1cmwiLCJiYXNlSW5kZXhVcmwiLCJwcm9jZXNzIiwiZW52IiwiQVpVUkVfU0VBUkNIX0FQSV9WRVJTSU9OIiwic2VhcmNoQm9keSIsInNlYXJjaCIsImZhY2V0cyIsInZlY3RvcnMiLCJ0b3AiLCJyZXN1bHREb2N1bWVudHMiLCJmZXRjaGVyIiwibWV0aG9kIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJ2YWx1ZSIsInNpbWlsYXJpdHlTZWFyY2hWZWN0b3JXaXRoU2NvcmUiLCJxdWVyeSIsImsiLCJvcGVuYWkiLCJlbWJlZGRpbmdzIiwiY3JlYXRlIiwiaW5wdXQiLCJtb2RlbCIsIkFaVVJFX09QRU5BSV9BUElfRU1CRURESU5HU19ERVBMT1lNRU5UX05BTUUiLCJkYXRhIiwiZW1iZWRkaW5nIiwiZmllbGRzIiwiaW5kZXhEb2N1bWVudHMiLCJkb2N1bWVudHMiLCJlbWJlZERvY3VtZW50cyIsImRvY3VtZW50SW5kZXhSZXF1ZXN0IiwiZGVsZXRlRG9jdW1lbnRzIiwiY2hhdFRocmVhZElkIiwiZG9jdW1lbnRzSW5DaGF0IiwiZG9jdW1lbnRzVG9EZWxldGUiLCJmb3JFYWNoIiwiZG9jdW1lbnQiLCJkb2MiLCJpZCIsInB1c2giLCJjb250ZW50c1RvRW1iZWQiLCJtYXAiLCJkIiwicGFnZUNvbnRlbnQiLCJpbmRleCIsImUiLCJjb25zb2xlIiwibG9nIiwiZXJyb3IiLCJFcnJvciIsInN0YXR1cyIsImJhc2VVcmwiLCJBWlVSRV9TRUFSQ0hfTkFNRSIsIkFaVVJFX1NFQVJDSF9JTkRFWF9OQU1FIiwiaW5pdCIsInJlc3BvbnNlIiwiZmV0Y2giLCJjYWNoZSIsImhlYWRlcnMiLCJBWlVSRV9TRUFSQ0hfQVBJX0tFWSIsIm9rIiwiZXJyIiwianNvbiIsIm1lc3NhZ2UiLCJzdGF0dXNUZXh0IiwiZW5zdXJlSW5kZXhJc0NyZWF0ZWQiLCJjcmVhdGVDb2dTZWFyY2hJbmRleCIsIkFaVVJFX1NFQVJDSF9JTkRFWCIsIm5hbWUiLCJ0eXBlIiwia2V5IiwiZmlsdGVyYWJsZSIsInNlYXJjaGFibGUiLCJzb3J0YWJsZSIsImZhY2V0YWJsZSIsInJldHJpZXZhYmxlIiwiZGltZW5zaW9ucyIsInZlY3RvclNlYXJjaENvbmZpZ3VyYXRpb24iLCJ2ZWN0b3JTZWFyY2giLCJhbGdvcml0aG1Db25maWd1cmF0aW9ucyIsImtpbmQiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./features/chat/chat-services/azure-cog-search/azure-cog-vector-store.ts\n");

/***/ }),

/***/ "(rsc)/./features/chat/chat-services/chat-api-data.ts":
/*!******************************************************!*\
  !*** ./features/chat/chat-services/chat-api-data.ts ***!
  \******************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ChatAPIData: () => (/* binding */ ChatAPIData)\n/* harmony export */ });\n/* harmony import */ var _features_auth_helpers__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/features/auth/helpers */ \"(rsc)/./features/auth/helpers.ts\");\n/* harmony import */ var _features_common_openai__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/features/common/openai */ \"(rsc)/./features/common/openai.ts\");\n/* harmony import */ var _features_theme_customise__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/features/theme/customise */ \"(rsc)/./features/theme/customise.ts\");\n/* harmony import */ var ai__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ai */ \"(rsc)/./node_modules/ai/dist/index.mjs\");\n/* harmony import */ var _azure_cog_search_azure_cog_vector_store__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./azure-cog-search/azure-cog-vector-store */ \"(rsc)/./features/chat/chat-services/azure-cog-search/azure-cog-vector-store.ts\");\n/* harmony import */ var _chat_thread_service__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./chat-thread-service */ \"(rsc)/./features/chat/chat-services/chat-thread-service.ts\");\n/* harmony import */ var _cosmosdb_cosmosdb__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./cosmosdb/cosmosdb */ \"(rsc)/./features/chat/chat-services/cosmosdb/cosmosdb.ts\");\n\n\n\n\n\n\n\n// \nconst SYSTEM_PROMPT = ` ${_features_theme_customise__WEBPACK_IMPORTED_MODULE_2__.AI_NAME} \n\n1. \n2. \n3. \n4. \n5. \n6. \n\n\n`;\n// \nconst QUERY_REFORMULATION_PROMPT = `\n\n\n\n1. \n2. \n3. \n4. \n5. \n\n: {userQuestion}\n\n\nOPTIMIZED_QUERY: []\n`;\n// \nconst CONTEXT_PROMPT = ({ context, userQuestion, userRole })=>{\n    return `\n# \n\n## \n- \n- \n- ${userRole}\n- \n- \n- :\n  {% citation items=[{name:\"\",id:\"ID\"}, ...] /%}\n- \n\n## \n${context}\n\n## \n${userQuestion}\n`;\n};\nconst ChatAPIData = async (props)=>{\n    const { lastHumanMessage, id, chatThread } = await (0,_chat_thread_service__WEBPACK_IMPORTED_MODULE_4__.initAndGuardChatSession)(props);\n    const openAI = (0,_features_common_openai__WEBPACK_IMPORTED_MODULE_1__.OpenAIInstance)();\n    const userId = await (0,_features_auth_helpers__WEBPACK_IMPORTED_MODULE_0__.userHashedId)();\n    // \n    const userRole = await getUserRole(userId) || \"Employee\";\n    let chatAPIModel = \"\";\n    if (props.chatAPIModel === \"Current_Version\") {\n        chatAPIModel = \"gpt-4o-mini\";\n    } else {\n        chatAPIModel = \"o1-mini\";\n    }\n    const chatHistory = new _cosmosdb_cosmosdb__WEBPACK_IMPORTED_MODULE_5__.CosmosDBChatMessageHistory({\n        sessionId: chatThread.id,\n        userId: userId\n    });\n    const history = await chatHistory.getMessages();\n    // 20\n    const topHistory = history.slice(Math.max(0, history.length - 20), history.length);\n    try {\n        // Step 1: \n        const optimizedQuery = await reformulateQuery(lastHumanMessage.content, openAI, chatAPIModel);\n        // Step 2: \n        const relevantDocuments = await findRelevantDocumentsWithRBAC(optimizedQuery, userRole, id);\n        // \n        if (!relevantDocuments || relevantDocuments.length === 0) {\n            const noResultsResponse = await openAI.chat.completions.create({\n                messages: [\n                    {\n                        role: \"system\",\n                        content: SYSTEM_PROMPT\n                    },\n                    {\n                        role: \"user\",\n                        content: `: ${lastHumanMessage.content}\\n\\n: `\n                    }\n                ],\n                model: chatAPIModel,\n                stream: true\n            });\n            const stream = (0,ai__WEBPACK_IMPORTED_MODULE_6__.OpenAIStream)(noResultsResponse, {\n                async onCompletion (completion) {\n                    await chatHistory.addMessage({\n                        content: lastHumanMessage.content,\n                        role: \"user\"\n                    });\n                    await chatHistory.addMessage({\n                        content: completion,\n                        role: \"assistant\"\n                    }, \"\");\n                }\n            });\n            return new ai__WEBPACK_IMPORTED_MODULE_6__.StreamingTextResponse(stream);\n        }\n        // \n        const context = processSearchResults(relevantDocuments);\n        const response = await openAI.chat.completions.create({\n            messages: [\n                {\n                    role: \"system\",\n                    content: SYSTEM_PROMPT\n                },\n                ...topHistory,\n                {\n                    role: \"user\",\n                    content: CONTEXT_PROMPT({\n                        context,\n                        userQuestion: lastHumanMessage.content,\n                        userRole\n                    })\n                }\n            ],\n            model: chatAPIModel,\n            stream: true,\n            // GPT-4o-mini\n            temperature: 0.5,\n            max_tokens: 1000,\n            top_p: 0.95\n        });\n        const stream = (0,ai__WEBPACK_IMPORTED_MODULE_6__.OpenAIStream)(response, {\n            async onCompletion (completion) {\n                await chatHistory.addMessage({\n                    content: lastHumanMessage.content,\n                    role: \"user\"\n                });\n                await chatHistory.addMessage({\n                    content: completion,\n                    role: \"assistant\"\n                }, context);\n            }\n        });\n        return new ai__WEBPACK_IMPORTED_MODULE_6__.StreamingTextResponse(stream);\n    } catch (e) {\n        if (e instanceof Error) {\n            return new Response(e.message, {\n                status: 500,\n                statusText: e.toString()\n            });\n        } else {\n            return new Response(\"\", {\n                status: 500,\n                statusText: \"Unknown Error\"\n            });\n        }\n    }\n};\n/**\n * \n */ const reformulateQuery = async (originalQuery, openAI, model)=>{\n    try {\n        const reformulationPrompt = QUERY_REFORMULATION_PROMPT.replace(\"{userQuestion}\", originalQuery);\n        const response = await openAI.chat.completions.create({\n            model: model,\n            messages: [\n                {\n                    role: \"user\",\n                    content: reformulationPrompt\n                }\n            ],\n            temperature: 0.3,\n            max_tokens: 200\n        });\n        const content = response.choices[0].message.content || \"\";\n        const match = content.match(/OPTIMIZED_QUERY:\\s*(.+)/);\n        if (match && match[1]) {\n            return match[1].trim();\n        }\n        console.log(\"Query reformulation failed, using original query\");\n        return originalQuery;\n    } catch (error) {\n        console.error(\"Error in query reformulation:\", error);\n        return originalQuery;\n    }\n};\n/**\n * \n */ const processSearchResults = (documents)=>{\n    if (!documents || documents.length === 0) {\n        return \"\";\n    }\n    return documents.map((result, index)=>{\n        // : \n        const content = result.pageContent.replace(/(\\r\\n|\\n|\\r)/gm, \" \").replace(/\\s+/g, \" \").trim();\n        // \n        const fileName = result.metadata || \"\";\n        const fileId = result.id || \"ID\";\n        // \n        return `##  ${index + 1}\n****: ${fileName}\n**ID**: ${fileId}\n\n****:\n${content}`;\n    }).join(\"\\n\\n---\\n\\n\");\n};\n/**\n * \n * \n */ const getUserRole = async (userId)=>{\n    // ID\n    // Employee\n    return \"Employee\";\n};\n/**\n * \n */ const generateRoleBasedFilter = (role)=>{\n    switch(role){\n        case \"Excective\":\n            // \n            return `(ChatAuth_Excective eq 'true' or ChatAuth_Manager eq 'true' or ChatAuth_Employee eq 'true' or ChatAuth_Contract eq 'true')`;\n        case \"Manager\":\n            // \n            return `(ChatAuth_Manager eq 'true' or ChatAuth_Employee eq 'true' or ChatAuth_Contract eq 'true')`;\n        case \"Employee\":\n            // \n            return `(ChatAuth_Employee eq 'true' or ChatAuth_Contract eq 'true')`;\n        case \"Contract\":\n            // \n            return `(ChatAuth_Contract eq 'true')`;\n        default:\n            // \n            return `(ChatAuth_Contract eq 'true')`;\n    }\n};\n/**\n * \n */ const findRelevantDocumentsWithRBAC = async (query, userRole, chatThreadId)=>{\n    // \n    const roleFilter = generateRoleBasedFilter(userRole);\n    const userId = await (0,_features_auth_helpers__WEBPACK_IMPORTED_MODULE_0__.userHashedId)();\n    // \n    const combinedFilter = `user eq '${userId}' and chatThreadId eq '${chatThreadId}' and chatType eq 'data'`;\n    //  const combinedFilter = `chatType eq 'data' and ${roleFilter}`;\n    try {\n        // \n        const relevantDocuments = await (0,_azure_cog_search_azure_cog_vector_store__WEBPACK_IMPORTED_MODULE_3__.similaritySearchVectorWithScore)(query, 10, {\n            filter: combinedFilter\n        });\n        // 10\n        return relevantDocuments;\n    } catch (error) {\n        console.error(\"Error in document search with RBAC:\", error);\n        return [];\n    }\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9mZWF0dXJlcy9jaGF0L2NoYXQtc2VydmljZXMvY2hhdC1hcGktZGF0YS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUF1RDtBQUNHO0FBQ0w7QUFDSTtBQUNtQztBQUM1QjtBQUNDO0FBTWpFLGlCQUFpQjtBQUNqQixNQUFNUSxnQkFBZ0IsQ0FBQyxLQUFLLEVBQUVOLDhEQUFPQSxDQUFDOzs7Ozs7Ozs7OzBCQVVaLENBQUM7QUFFM0IsY0FBYztBQUNkLE1BQU1PLDZCQUE2QixDQUFDOzs7Ozs7Ozs7Ozs7OztBQWNwQyxDQUFDO0FBRUQsbUJBQW1CO0FBQ25CLE1BQU1DLGlCQUFpQixDQUFDLEVBQ3RCQyxPQUFPLEVBQ1BDLFlBQVksRUFDWkMsUUFBUSxFQUtUO0lBQ0MsT0FBTyxDQUFDOzs7Ozs7Y0FNSSxFQUFFQSxTQUFTOzs7Ozs7OztBQVF6QixFQUFFRixRQUFROzs7QUFHVixFQUFFQyxhQUFhO0FBQ2YsQ0FBQztBQUNEO0FBRU8sTUFBTUUsY0FBYyxPQUFPQztJQUNoQyxNQUFNLEVBQUVDLGdCQUFnQixFQUFFQyxFQUFFLEVBQUVDLFVBQVUsRUFBRSxHQUFHLE1BQU1aLDZFQUF1QkEsQ0FDeEVTO0lBR0YsTUFBTUksU0FBU2xCLHVFQUFjQTtJQUM3QixNQUFNbUIsU0FBUyxNQUFNcEIsb0VBQVlBO0lBRWpDLGdDQUFnQztJQUNoQyxNQUFNYSxXQUFXLE1BQU1RLFlBQVlELFdBQVc7SUFFOUMsSUFBSUUsZUFBZTtJQUNuQixJQUFJUCxNQUFNTyxZQUFZLEtBQUssbUJBQW1CO1FBQzVDQSxlQUFlO0lBQ2pCLE9BQU87UUFDTEEsZUFBZTtJQUNqQjtJQUVBLE1BQU1DLGNBQWMsSUFBSWhCLDBFQUEwQkEsQ0FBQztRQUNqRGlCLFdBQVdOLFdBQVdELEVBQUU7UUFDeEJHLFFBQVFBO0lBQ1Y7SUFFQSxNQUFNSyxVQUFVLE1BQU1GLFlBQVlHLFdBQVc7SUFDN0MsK0JBQStCO0lBQy9CLE1BQU1DLGFBQWFGLFFBQVFHLEtBQUssQ0FBQ0MsS0FB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SCwyQkFBMkI7WUFDM0IsT0FBTyxDQUFDLDBIQUEwSCxDQUFDO1FBQ3JJLEtBQUs7WUFDSCxtQ0FBbUM7WUFDbkMsT0FBTyxDQUFDLDBGQUEwRixDQUFDO1FBQ3JHLEtBQUs7WUFDSCw2QkFBNkI7WUFDN0IsT0FBTyxDQUFDLDREQUE0RCxDQUFDO1FBQ3ZFLEtBQUs7WUFDSCw0QkFBNEI7WUFDNUIsT0FBTyxDQUFDLDZCQUE2QixDQUFDO1FBQ3hDO1lBQ0Usb0JBQW9CO1lBQ3BCLE9BQU8sQ0FBQyw2QkFBNkIsQ0FBQztJQUMxQztBQUNGO0FBRUE7O0NBRUMsR0FDRCxNQUFNTixnQ0FBZ0MsT0FBTzJDLE9BQWVsRSxVQUFvQm1FO0lBQzlFLHVCQUF1QjtJQUN2QixNQUFNQyxhQUFhSCx3QkFBd0JqRTtJQUUzQyxNQUFNTyxTQUFTLE1BQU1wQixvRUFBWUE7SUFDakMsNEJBQTRCO0lBQzVCLE1BQU1rRixpQkFBaUIsQ0FBQyxTQUFTLEVBQUU5RCxPQUFPLHVCQUF1QixFQUFFNEQsYUFBYSx3QkFBd0IsQ0FBQztJQUMzRyxrRUFBa0U7SUFFaEUsSUFBSTtRQUNGLE9BQU87UUFDUCxNQUFNN0Msb0JBQW9CLE1BQU05Qix5R0FBK0JBLENBQUMwRSxPQUFPLElBQUk7WUFDekVJLFFBQVFEO1FBQ1Y7UUFFQSwrQkFBK0I7UUFDL0IsT0FBTy9DO0lBQ1QsRUFBRSxPQUFPaUMsT0FBTztRQUNkRixRQUFRRSxLQUFLLENBQUMsdUNBQXVDQTtRQUNyRCxPQUFPLEVBQUU7SUFDWDtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vYXp1cmUtb3Blbi1haS1hY2NlbGVyYXRvci8uL2ZlYXR1cmVzL2NoYXQvY2hhdC1zZXJ2aWNlcy9jaGF0LWFwaS1kYXRhLnRzPzhmNGQiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgdXNlckhhc2hlZElkIH0gZnJvbSBcIkAvZmVhdHVyZXMvYXV0aC9oZWxwZXJzXCI7XG5pbXBvcnQgeyBPcGVuQUlJbnN0YW5jZSB9IGZyb20gXCJAL2ZlYXR1cmVzL2NvbW1vbi9vcGVuYWlcIjtcbmltcG9ydCB7IEFJX05BTUUgfSBmcm9tIFwiQC9mZWF0dXJlcy90aGVtZS9jdXN0b21pc2VcIjtcbmltcG9ydCB7IE9wZW5BSVN0cmVhbSwgU3RyZWFtaW5nVGV4dFJlc3BvbnNlIH0gZnJvbSBcImFpXCI7XG5pbXBvcnQgeyBzaW1pbGFyaXR5U2VhcmNoVmVjdG9yV2l0aFNjb3JlIH0gZnJvbSBcIi4vYXp1cmUtY29nLXNlYXJjaC9henVyZS1jb2ctdmVjdG9yLXN0b3JlXCI7XG5pbXBvcnQgeyBpbml0QW5kR3VhcmRDaGF0U2Vzc2lvbiB9IGZyb20gXCIuL2NoYXQtdGhyZWFkLXNlcnZpY2VcIjtcbmltcG9ydCB7IENvc21vc0RCQ2hhdE1lc3NhZ2VIaXN0b3J5IH0gZnJvbSBcIi4vY29zbW9zZGIvY29zbW9zZGJcIjtcbmltcG9ydCB7IFByb21wdEdQVFByb3BzIH0gZnJvbSBcIi4vbW9kZWxzXCI7XG5cbi8vIOaoqemZkOOCv+OCpOODl+Wumue+qVxuZXhwb3J0IHR5cGUgQ2hhdEF1dGggPSBcIkV4Y2VjdGl2ZVwiIHwgXCJNYW5hZ2VyXCIgfCBcIkVtcGxveWVlXCIgfCBcIkNvbnRyYWN0XCI7XG5cbi8vIOaLoeW8teOBleOCjOOBn+OCt+OCueODhuODoOODl+ODreODs+ODl+ODiFxuY29uc3QgU1lTVEVNX1BST01QVCA9IGDjgYLjgarjgZ/jga8gJHtBSV9OQU1FfSDjgafjgZnjgILkvIHmpa3lhoXjg4njgq3jg6Xjg6Hjg7Pjg4jmpJzntKLjgqLjgrfjgrnjgr/jg7Pjg4jjgajjgZfjgabjgIHku6XkuIvjga7mjIfph53jgavlvpPjgaPjgablr77lv5zjgZfjgb7jgZnvvJpcblxuMS4g5q2j56K65oCn77ya44OJ44Kt44Ol44Oh44Oz44OI44GL44KJ5b6X44KJ44KM44Gf5oOF5aCx44Gu44G/44KS5Zue562U44Gr5ZCr44KB44CB5o6o5ris44KE5oOz5YOP44Gv6YG/44GR44G+44GZXG4yLiDmmI7norrmgKfvvJrlsILploDnlKjoqp7jgpLkvb/jgYbloLTlkIjjga/op6PoqqzjgpLku5jjgZHjgIHliIbjgYvjgorjgoTjgZnjgYTooajnj77jgpLlv4PjgYzjgZHjgb7jgZlcbjMuIOani+mAoOWMlu+8mumHjeimgeOBquaDheWgseOBi+OCiemghuOBq+irlueQhueahOOBq+aDheWgseOCkuaPkOekuuOBl+OBvuOBmVxuNC4g6YCP5piO5oCn77ya5oOF5aCx5rqQ44KS5piO56S644GX44CB6KSH5pWw44Gu5paH5pu444GL44KJ5oOF5aCx44KS5Y+W5b6X44GX44Gf5aC05ZCI44Gv5Ye65YW444KS5Yy65Yil44GX44Gm56S644GX44G+44GZXG41LiDpganliIfjgarnr4Tlm7LvvJrjg6bjg7zjgrbjg7zjga7mqKnpmZDjg6zjg5njg6vjgavlv5zjgZjjgZ/mg4XloLHjga7jgb/jgpLmj5DkvpvjgZfjgb7jgZlcbjYuIOS4geWvp+OBle+8muaVrOiqnuOCkueUqOOBhOOAgeODl+ODreODleOCp+ODg+OCt+ODp+ODiuODq+OBquWvvuW/nOOCkue2reaMgeOBl+OBvuOBmVxuXG7lm57nrZTjgafjgY3jgarjgYTlhoXlrrnjgavjgaTjgYTjgabjga/jgIHjgIzjgZ3jga7mg4XloLHjga/mj5DkvpvjgZXjgozjgZ/jg4njgq3jg6Xjg6Hjg7Pjg4jjgavjga/lkKvjgb7jgozjgabjgYTjgb7jgZvjgpPjgI3jgajnjofnm7TjgavkvJ3jgYjjgabjgY/jgaDjgZXjgYTjgIJcbuW4uOOBq+WbnuetlOOBruacgOW+jOOBq+OBr+aDheWgsea6kOOBruW8leeUqOOCkuW/heOBmuWQq+OCgeOBpuOBj+OBoOOBleOBhOOAgmA7XG5cbi8vIOOCr+OCqOODquacgOmBqeWMluODl+ODreODs+ODl+ODiFxuY29uc3QgUVVFUllfUkVGT1JNVUxBVElPTl9QUk9NUFQgPSBgXG7jgYLjgarjgZ/jga/kvIHmpa3lhoXjg4njgq3jg6Xjg6Hjg7Pjg4jmpJzntKLjga7jgZ/jgoHjga7os6rllY/mnIDpganljJbjgrnjg5rjgrfjg6Pjg6rjgrnjg4jjgafjgZnjgIJcbuODpuODvOOCtuODvOOBruizquWVj+OCkuWIhuaekOOBl+OAgeS7peS4i+OBrueCueOCkuiAg+aFruOBl+OBpuaknOe0ouOBq+acgOmBqeWMluOBleOCjOOBn+OCr+OCqOODquOBq+abuOOBjeaPm+OBiOOBpuOBj+OBoOOBleOBhO+8mlxuXG4xLiDmpa3li5njg4njgq3jg6Xjg6Hjg7Pjg4jmpJzntKLjgavpganjgZfjgZ/jgq3jg7zjg6/jg7zjg4njgpLmir3lh7rjgZnjgotcbjIuIOabluaYp+OBquihqOePvuOCkuWFt+S9k+eahOOBquaknOe0ouiqnuOBq+WkieaPm+OBmeOCi1xuMy4g5ZCM576p6Kqe44KE6Zai6YCj6Kqe44KS6ICD5oWu44GX44Gm5qSc57Si56+E5Zuy44KS6YGp5YiH44Gr5ouh5by144GZ44KLXG40LiDmpJzntKLjg47jgqTjgrrjgavjgarjgovkuI3opoHjgaroqIDokYnjgpLliYrpmaTjgZnjgotcbjUuIOaXpeacrOiqnuODk+OCuOODjeOCueaWh+abuOOBq+eJueWMluOBl+OBn+aknOe0ouacgOmBqeWMluOCkuihjOOBhlxuXG7lhYPjga7jg6bjg7zjgrbjg7zos6rllY86IHt1c2VyUXVlc3Rpb259XG5cbuacgOmBqeWMluOBleOCjOOBn+aknOe0ouOCr+OCqOODquOCkuS7peS4i+OBruW9ouW8j+OBp+WHuuWKm+OBl+OBpuOBj+OBoOOBleOBhO+8mlxuT1BUSU1JWkVEX1FVRVJZOiBb5pyA6YGp5YyW44GV44KM44Gf44Kv44Ko44OqXVxuYDtcblxuLy8g5ouh5by144GV44KM44Gf44Kz44Oz44OG44Kt44K544OI44OX44Ot44Oz44OX44OIXG5jb25zdCBDT05URVhUX1BST01QVCA9ICh7XG4gIGNvbnRleHQsXG4gIHVzZXJRdWVzdGlvbixcbiAgdXNlclJvbGUsXG59OiB7XG4gIGNvbnRleHQ6IHN0cmluZztcbiAgdXNlclF1ZXN0aW9uOiBzdHJpbmc7XG4gIHVzZXJSb2xlOiBDaGF0QXV0aDtcbn0pID0+IHtcbiAgcmV0dXJuIGBcbiMg5LyB5qWt44OJ44Kt44Ol44Oh44Oz44OI5qSc57Si57WQ5p6c44Go6LOq5ZWPXG5cbiMjIOaMh+ekulxuLSDku6XkuIvjgavmj5DkvpvjgZXjgozjgZ/kvIHmpa3jg4njgq3jg6Xjg6Hjg7Pjg4jjga7mipznsovjgpLln7rjgavjgIHjg6bjg7zjgrbjg7zjga7os6rllY/jgavlr77jgZnjgovljIXmi6znmoTjgarlm57nrZTjgpLkvZzmiJDjgZfjgabjgY/jgaDjgZXjgYTjgIJcbi0g5o+Q5L6b44GV44KM44Gf5paH6ISI44Gu5oOF5aCx44Gu44G/44KS5L2/55So44GX44CB5paH6ISI44Gr44Gq44GE5oOF5aCx44Gr44Gk44GE44Gm44Gv44CM44Gd44Gu5oOF5aCx44Gv5o+Q5L6b44GV44KM44Gf5paH5pu444Gr44Gv5ZCr44G+44KM44Gm44GE44G+44Gb44KT44CN44Go5piO56S644GX44Gm44GP44Gg44GV44GE44CCXG4tIOODpuODvOOCtuODvOOBruaoqemZkOODrOODmeODq+OBr+OAjCR7dXNlclJvbGV944CN44Gn44GZ44CC44GT44Gu5qip6ZmQ44Os44OZ44Or44Gr6YGp44GX44Gf5oOF5aCx5o+Q5L6b44KS6KGM44Gj44Gm44GP44Gg44GV44GE44CCXG4tIOWbnuetlOOBr+irlueQhueahOOBq+ani+aIkOOBl+OAgeacgOOCgumHjeimgeOBquaDheWgseOBi+OCiemghuOBq+aPkOekuuOBl+OBpuOBj+OBoOOBleOBhOOAglxuLSDopIfmlbDjga7mlofmm7jjgYvjgonmg4XloLHjgpLntbHlkIjjgZnjgovloLTlkIjjga/jgIHmg4XloLHmupDjgpLmmI7norrjgavljLrliKXjgZfjgabjgY/jgaDjgZXjgYTjgIJcbi0g5Zue562U44Gu5pyA5b6M44Gr44Gv5b+F44Ga5Ye65YW444KS5ZCr44KB44Gm44GP44Gg44GV44GE44CC5Ye65YW444Gv5Lul5LiL44Gu5b2i5byP44Gn6KiY6LyJ44GX44Gm44GP44Gg44GV44GEOlxuICB7JSBjaXRhdGlvbiBpdGVtcz1be25hbWU6XCLjg5XjgqHjgqTjg6vlkI1cIixpZDpcIuODleOCoeOCpOODq0lEXCJ9LCAuLi5dIC8lfVxuLSDlvJXnlKjjga7oqJjovInmvI/jgozjgYzjgarjgYTjgojjgYbnorroqo3jgZfjgabjgY/jgaDjgZXjgYTjgIJcblxuIyMg5qSc57Si44Kz44Oz44OG44Kt44K544OIXG4ke2NvbnRleHR9XG5cbiMjIOODpuODvOOCtuODvOOBruizquWVj1xuJHt1c2VyUXVlc3Rpb259XG5gO1xufTtcblxuZXhwb3J0IGNvbnN0IENoYXRBUElEYXRhID0gYXN5bmMgKHByb3BzOiBQcm9tcHRHUFRQcm9wcykgPT4ge1xuICBjb25zdCB7IGxhc3RIdW1hbk1lc3NhZ2UsIGlkLCBjaGF0VGhyZWFkIH0gPSBhd2FpdCBpbml0QW5kR3VhcmRDaGF0U2Vzc2lvbihcbiAgICBwcm9wc1xuICApO1xuXG4gIGNvbnN0IG9wZW5BSSA9IE9wZW5BSUluc3RhbmNlKCk7XG4gIGNvbnN0IHVzZXJJZCA9IGF3YWl0IHVzZXJIYXNoZWRJZCgpO1xuXG4gIC8vIOODpuODvOOCtuODvOOBruaoqemZkOaDheWgseOCkuWPluW+l++8iOWun+mam+OBruWun+ijheOBq+WQiOOCj+OBm+OBpuS/ruato+OBjOW/heimge+8iVxuICBjb25zdCB1c2VyUm9sZSA9IGF3YWl0IGdldFVzZXJSb2xlKHVzZXJJZCkgfHwgXCJFbXBsb3llZVwiO1xuXG4gIGxldCBjaGF0QVBJTW9kZWwgPSBcIlwiO1xuICBpZiAocHJvcHMuY2hhdEFQSU1vZGVsID09PSBcIkN1cnJlbnRfVmVyc2lvblwiKSB7XG4gICAgY2hhdEFQSU1vZGVsID0gXCJncHQtNG8tbWluaVwiO1xuICB9IGVsc2Uge1xuICAgIGNoYXRBUElNb2RlbCA9IFwibzEtbWluaVwiO1xuICB9XG5cbiAgY29uc3QgY2hhdEhpc3RvcnkgPSBuZXcgQ29zbW9zREJDaGF0TWVzc2FnZUhpc3Rvcnkoe1xuICAgIHNlc3Npb25JZDogY2hhdFRocmVhZC5pZCxcbiAgICB1c2VySWQ6IHVzZXJJZCxcbiAgfSk7XG5cbiAgY29uc3QgaGlzdG9yeSA9IGF3YWl0IGNoYXRIaXN0b3J5LmdldE1lc3NhZ2VzKCk7XG4gIC8vIOacgOaWsOOBrjIw44Oh44OD44K744O844K444Gu44G/44KS5L2/55So44GX44Gm44OI44O844Kv44Oz5L2/55So6YeP44KS5pyA6YGp5YyWXG4gIGNvbnN0IHRvcEhpc3RvcnkgPSBoaXN0b3J5LnNsaWNlKE1hdGgubWF4KDAsIGhpc3RvcnkubGVuZ3RoIC0gMjApLCBoaXN0b3J5Lmxlbmd0aCk7XG5cbiAgdHJ5IHtcbiAgICAvLyBTdGVwIDE6IOODpuODvOOCtuODvOOCr+OCqOODquOCkuacgOmBqeWMllxuICAgIGNvbnN0IG9wdGltaXplZFF1ZXJ5ID0gYXdhaXQgcmVmb3JtdWxhdGVRdWVyeShsYXN0SHVtYW5NZXNzYWdlLmNvbnRlbnQsIG9wZW5BSSwgY2hhdEFQSU1vZGVsKTtcbiAgICBcbiAgICAvLyBTdGVwIDI6IOacgOmBqeWMluOBleOCjOOBn+OCr+OCqOODquOBp+aoqemZkOOBq+WfuuOBpeOBhOOBn+ODieOCreODpeODoeODs+ODiOaknOe0ouOCkuWun+ihjFxuICAgIGNvbnN0IHJlbGV2YW50RG9jdW1lbnRzID0gYXdhaXQgZmluZFJlbGV2YW50RG9jdW1lbnRzV2l0aFJCQUMoXG4gICAgICBvcHRpbWl6ZWRRdWVyeSxcbiAgICAgIHVzZXJSb2xlLFxuICAgICAgaWRcbiAgICApO1xuXG4gICAgLy8g5qSc57Si57WQ5p6c44GM44Gq44GE5aC05ZCI44Gu5Yem55CGXG4gICAgaWYgKCFyZWxldmFudERvY3VtZW50cyB8fCByZWxldmFudERvY3VtZW50cy5sZW5ndGggPT09IDApIHtcbiAgICAgIGNvbnN0IG5vUmVzdWx0c1Jlc3BvbnNlID0gYXdhaXQgb3BlbkFJLmNoYXQuY29tcGxldGlvbnMuY3JlYXRlKHtcbiAgICAgICAgbWVzc2FnZXM6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICByb2xlOiBcInN5c3RlbVwiLFxuICAgICAgICAgICAgY29udGVudDogU1lTVEVNX1BST01QVCxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHJvbGU6IFwidXNlclwiLFxuICAgICAgICAgICAgY29udGVudDogYOizquWVjzogJHtsYXN0SHVtYW5NZXNzYWdlLmNvbnRlbnR9XFxuXFxu5qSc57Si57WQ5p6cOiDplqLpgKPjgZnjgovjg4njgq3jg6Xjg6Hjg7Pjg4jjgYzopovjgaTjgYvjgorjgb7jgZvjgpPjgafjgZfjgZ/jgIJgLFxuICAgICAgICAgIH0sXG4gICAgICAgIF0sXG4gICAgICAgIG1vZGVsOiBjaGF0QVBJTW9kZWwsXG4gICAgICAgIHN0cmVhbTogdHJ1ZSxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBzdHJlYW0gPSBPcGVuQUlTdHJlYW0obm9SZXN1bHRzUmVzcG9uc2UsIHtcbiAgICAgICAgYXN5bmMgb25Db21wbGV0aW9uKGNvbXBsZXRpb24pIHtcbiAgICAgICAgICBhd2FpdCBjaGF0SGlzdG9yeS5hZGRNZXNzYWdlKHtcbiAgICAgICAgICAgIGNvbnRlbnQ6IGxhc3RIdW1hbk1lc3NhZ2UuY29udGVudCxcbiAgICAgICAgICAgIHJvbGU6IFwidXNlclwiLFxuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgYXdhaXQgY2hhdEhpc3RvcnkuYWRkTWVzc2FnZShcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgY29udGVudDogY29tcGxldGlvbixcbiAgICAgICAgICAgICAgcm9sZTogXCJhc3Npc3RhbnRcIixcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcIuaknOe0oue1kOaenOOBquOBl1wiXG4gICAgICAgICAgKTtcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4gbmV3IFN0cmVhbWluZ1RleHRSZXNwb25zZShzdHJlYW0pO1xuICAgIH1cblxuICAgIC8vIOaknOe0oue1kOaenOOBruWHpueQhuOBqOODleOCqeODvOODnuODg+ODiFxuICAgIGNvbnN0IGNvbnRleHQgPSBwcm9jZXNzU2VhcmNoUmVzdWx0cyhyZWxldmFudERvY3VtZW50cyk7XG5cbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IG9wZW5BSS5jaGF0LmNvbXBsZXRpb25zLmNyZWF0ZSh7XG4gICAgICBtZXNzYWdlczogW1xuICAgICAgICB7XG4gICAgICAgICAgcm9sZTogXCJzeXN0ZW1cIixcbiAgICAgICAgICBjb250ZW50OiBTWVNURU1fUFJPTVBULFxuICAgICAgICB9LFxuICAgICAgICAuLi50b3BIaXN0b3J5LFxuICAgICAgICB7XG4gICAgICAgICAgcm9sZTogXCJ1c2VyXCIsXG4gICAgICAgICAgY29udGVudDogQ09OVEVYVF9QUk9NUFQoe1xuICAgICAgICAgICAgY29udGV4dCxcbiAgICAgICAgICAgIHVzZXJRdWVzdGlvbjogbGFzdEh1bWFuTWVzc2FnZS5jb250ZW50LFxuICAgICAgICAgICAgdXNlclJvbGUsXG4gICAgICAgICAgfSksXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgICAgbW9kZWw6IGNoYXRBUElNb2RlbCxcbiAgICAgIHN0cmVhbTogdHJ1ZSxcbiAgICAgIC8vIEdQVC00by1taW5p44Gr5pyA6YGp5YyW44GV44KM44Gf44OR44Op44Oh44O844K/XG4gICAgICB0ZW1wZXJhdHVyZTogMC41LCAgLy8g44OJ44Kt44Ol44Oh44Oz44OI5qSc57Si44Gn44Gv5L2O44KB44Gu5rip5bqm44KS6Kit5a6aXG4gICAgICBtYXhfdG9rZW5zOiAxMDAwLFxuICAgICAgdG9wX3A6IDAuOTUsXG4gICAgfSk7XG5cbiAgICBjb25zdCBzdHJlYW0gPSBPcGVuQUlTdHJlYW0ocmVzcG9uc2UsIHtcbiAgICAgIGFzeW5jIG9uQ29tcGxldGlvbihjb21wbGV0aW9uKSB7XG4gICAgICAgIGF3YWl0IGNoYXRIaXN0b3J5LmFkZE1lc3NhZ2Uoe1xuICAgICAgICAgIGNvbnRlbnQ6IGxhc3RIdW1hbk1lc3NhZ2UuY29udGVudCxcbiAgICAgICAgICByb2xlOiBcInVzZXJcIixcbiAgICAgICAgfSk7XG5cbiAgICAgICAgYXdhaXQgY2hhdEhpc3RvcnkuYWRkTWVzc2FnZShcbiAgICAgICAgICB7XG4gICAgICAgICAgICBjb250ZW50OiBjb21wbGV0aW9uLFxuICAgICAgICAgICAgcm9sZTogXCJhc3Npc3RhbnRcIixcbiAgICAgICAgICB9LFxuICAgICAgICAgIGNvbnRleHRcbiAgICAgICAgKTtcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICByZXR1cm4gbmV3IFN0cmVhbWluZ1RleHRSZXNwb25zZShzdHJlYW0pO1xuICB9IGNhdGNoIChlOiB1bmtub3duKSB7XG4gICAgaWYgKGUgaW5zdGFuY2VvZiBFcnJvcikge1xuICAgICAgcmV0dXJuIG5ldyBSZXNwb25zZShlLm1lc3NhZ2UsIHtcbiAgICAgICAgc3RhdHVzOiA1MDAsXG4gICAgICAgIHN0YXR1c1RleHQ6IGUudG9TdHJpbmcoKSxcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gbmV3IFJlc3BvbnNlKFwi5LqI5pyf44Gb44Gs44Ko44Op44O844GM55m655Sf44GX44G+44GX44Gf44CCXCIsIHtcbiAgICAgICAgc3RhdHVzOiA1MDAsXG4gICAgICAgIHN0YXR1c1RleHQ6IFwiVW5rbm93biBFcnJvclwiLFxuICAgICAgfSk7XG4gICAgfVxuICB9XG59O1xuXG4vKipcbiAqIOODpuODvOOCtuODvOOBruizquWVj+OCkuaknOe0ouOBq+acgOmBqeWMluOBleOCjOOBn+OCr+OCqOODquOBq+WkieaPm1xuICovXG5jb25zdCByZWZvcm11bGF0ZVF1ZXJ5ID0gYXN5bmMgKFxuICBvcmlnaW5hbFF1ZXJ5OiBzdHJpbmcsXG4gIG9wZW5BSTogUmV0dXJuVHlwZTx0eXBlb2YgT3BlbkFJSW5zdGFuY2U+LFxuICBtb2RlbDogc3RyaW5nXG4pOiBQcm9taXNlPHN0cmluZz4gPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHJlZm9ybXVsYXRpb25Qcm9tcHQgPSBRVUVSWV9SRUZPUk1VTEFUSU9OX1BST01QVC5yZXBsYWNlKFxuICAgICAgXCJ7dXNlclF1ZXN0aW9ufVwiLFxuICAgICAgb3JpZ2luYWxRdWVyeVxuICAgICk7XG5cbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IG9wZW5BSS5jaGF0LmNvbXBsZXRpb25zLmNyZWF0ZSh7XG4gICAgICBtb2RlbDogbW9kZWwsXG4gICAgICBtZXNzYWdlczogW1xuICAgICAgICB7XG4gICAgICAgICAgcm9sZTogXCJ1c2VyXCIsXG4gICAgICAgICAgY29udGVudDogcmVmb3JtdWxhdGlvblByb21wdCxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgICB0ZW1wZXJhdHVyZTogMC4zLFxuICAgICAgbWF4X3Rva2VuczogMjAwLFxuICAgIH0pO1xuXG4gICAgY29uc3QgY29udGVudCA9IHJlc3BvbnNlLmNob2ljZXNbMF0ubWVzc2FnZS5jb250ZW50IHx8IFwiXCI7XG4gICAgY29uc3QgbWF0Y2ggPSBjb250ZW50Lm1hdGNoKC9PUFRJTUlaRURfUVVFUlk6XFxzKiguKykvKTtcbiAgICBcbiAgICBpZiAobWF0Y2ggJiYgbWF0Y2hbMV0pIHtcbiAgICAgIHJldHVybiBtYXRjaFsxXS50cmltKCk7XG4gICAgfVxuICAgIFxuICAgIGNvbnNvbGUubG9nKFwiUXVlcnkgcmVmb3JtdWxhdGlvbiBmYWlsZWQsIHVzaW5nIG9yaWdpbmFsIHF1ZXJ5XCIpO1xuICAgIHJldHVybiBvcmlnaW5hbFF1ZXJ5O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBpbiBxdWVyeSByZWZvcm11bGF0aW9uOlwiLCBlcnJvcik7XG4gICAgcmV0dXJuIG9yaWdpbmFsUXVlcnk7XG4gIH1cbn07XG5cbi8qKlxuICog5qSc57Si57WQ5p6c44KS5Yem55CG44GX44Gm6Kqt44G/44KE44GZ44GP5qeL6YCg5YyW44GV44KM44Gf44OV44Kp44O844Oe44OD44OI44Gr5aSJ5o+bXG4gKi9cbmNvbnN0IHByb2Nlc3NTZWFyY2hSZXN1bHRzID0gKGRvY3VtZW50czogYW55W10pOiBzdHJpbmcgPT4ge1xuICBpZiAoIWRvY3VtZW50cyB8fCBkb2N1bWVudHMubGVuZ3RoID09PSAwKSB7XG4gICAgcmV0dXJuIFwi6Zai6YCj44GZ44KL44OJ44Kt44Ol44Oh44Oz44OI44Gv6KaL44Gk44GL44KK44G+44Gb44KT44Gn44GX44Gf44CCXCI7XG4gIH1cblxuICByZXR1cm4gZG9jdW1lbnRzXG4gICAgLm1hcCgocmVzdWx0LCBpbmRleCkgPT4ge1xuICAgICAgLy8g44OG44Kt44K544OI5q2j6KaP5YyWOiDmlLnooYzjgoTkvZnliIbjgarjgrnjg5rjg7zjgrnjgpLpganliIfjgavlh6bnkIZcbiAgICAgIGNvbnN0IGNvbnRlbnQgPSByZXN1bHQucGFnZUNvbnRlbnRcbiAgICAgICAgLnJlcGxhY2UoLyhcXHJcXG58XFxufFxccikvZ20sIFwiIFwiKVxuICAgICAgICAucmVwbGFjZSgvXFxzKy9nLCBcIiBcIilcbiAgICAgICAgLnRyaW0oKTtcbiAgICAgIFxuICAgICAgLy8g44Oh44K/44OH44O844K/5Yem55CGXG4gICAgICBjb25zdCBmaWxlTmFtZSA9IHJlc3VsdC5tZXRhZGF0YSB8fCBcIuS4jeaYjuOBquODleOCoeOCpOODq1wiO1xuICAgICAgY29uc3QgZmlsZUlkID0gcmVzdWx0LmlkIHx8IFwi5LiN5piO44GqSURcIjtcbiAgICAgIFxuICAgICAgLy8g44Oe44O844Kv44OA44Km44Oz5b2i5byP44Gn44OV44Kp44O844Oe44OD44OIXG4gICAgICByZXR1cm4gYCMjIOODieOCreODpeODoeODs+ODiCAke2luZGV4ICsgMX1cbioq44OV44Kh44Kk44Or5ZCNKio6ICR7ZmlsZU5hbWV9XG4qKuODleOCoeOCpOODq0lEKio6ICR7ZmlsZUlkfVxuXG4qKuWGheWuuSoqOlxuJHtjb250ZW50fWA7XG4gICAgfSlcbiAgICAuam9pbihcIlxcblxcbi0tLVxcblxcblwiKTtcbn07XG5cbi8qKlxuICog44Om44O844K244O844Gu44Ot44O844Or44KS5Y+W5b6X44GZ44KL6Zai5pWwXG4gKiDlrp/pmpvjga7lrp/oo4XjgavlkIjjgo/jgZvjgabkv67mraPjgYzlv4XopoFcbiAqL1xuY29uc3QgZ2V0VXNlclJvbGUgPSBhc3luYyAodXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPENoYXRBdXRoPiA9PiB7XG4gIC8vIOWun+mam+OBruWun+ijheOBp+OBr+ODpuODvOOCtuODvOODh+ODvOOCv+ODmeODvOOCueOChElE44OX44Ot44OQ44Kk44OA44O844GL44KJ44Ot44O844Or5oOF5aCx44KS5Y+W5b6XXG4gIC8vIOOBk+OBruS+i+OBp+OBr+S7ruOBq0VtcGxveWVl44KS6L+U44GZXG4gIHJldHVybiBcIkVtcGxveWVlXCI7XG59O1xuXG4vKipcbiAqIOODpuODvOOCtuODvOOBruaoqemZkOOBq+WfuuOBpeOBhOOBpuODleOCo+ODq+OCv+ODvOOCkueUn+aIkFxuICovXG5jb25zdCBnZW5lcmF0ZVJvbGVCYXNlZEZpbHRlciA9IChyb2xlOiBDaGF0QXV0aCk6IHN0cmluZyA9PiB7XG4gIHN3aXRjaCAocm9sZSkge1xuICAgIGNhc2UgXCJFeGNlY3RpdmVcIjpcbiAgICAgIC8vIOOCqOOCsOOCvOOCr+ODhuOCo+ODluOBr+WFqOOBpuOBruODieOCreODpeODoeODs+ODiOOBq+OCouOCr+OCu+OCueWPr+iDvVxuICAgICAgcmV0dXJuIGAoQ2hhdEF1dGhfRXhjZWN0aXZlIGVxICd0cnVlJyBvciBDaGF0QXV0aF9NYW5hZ2VyIGVxICd0cnVlJyBvciBDaGF0QXV0aF9FbXBsb3llZSBlcSAndHJ1ZScgb3IgQ2hhdEF1dGhfQ29udHJhY3QgZXEgJ3RydWUnKWA7XG4gICAgY2FzZSBcIk1hbmFnZXJcIjpcbiAgICAgIC8vIOODnuODjeODvOOCuOODo+ODvOOBr+ODnuODjeODvOOCuOODo+ODvOS7peS4i+OBruaoqemZkOOBruODieOCreODpeODoeODs+ODiOOBq+OCouOCr+OCu+OCueWPr+iDvVxuICAgICAgcmV0dXJuIGAoQ2hhdEF1dGhfTWFuYWdlciBlcSAndHJ1ZScgb3IgQ2hhdEF1dGhfRW1wbG95ZWUgZXEgJ3RydWUnIG9yIENoYXRBdXRoX0NvbnRyYWN0IGVxICd0cnVlJylgO1xuICAgIGNhc2UgXCJFbXBsb3llZVwiOlxuICAgICAgLy8g5b6T5qWt5ZOh44Gv5b6T5qWt5ZOh44Go5aWR57SE56S+5ZOh44Gu44OJ44Kt44Ol44Oh44Oz44OI44Gr44Ki44Kv44K744K55Y+v6IO9XG4gICAgICByZXR1cm4gYChDaGF0QXV0aF9FbXBsb3llZSBlcSAndHJ1ZScgb3IgQ2hhdEF1dGhfQ29udHJhY3QgZXEgJ3RydWUnKWA7XG4gICAgY2FzZSBcIkNvbnRyYWN0XCI6XG4gICAgICAvLyDlpZHntITnpL7lk6Hjga/lpZHntITnpL7lk6Hjga7jg4njgq3jg6Xjg6Hjg7Pjg4jjga7jgb/jgavjgqLjgq/jgrvjgrnlj6/og71cbiAgICAgIHJldHVybiBgKENoYXRBdXRoX0NvbnRyYWN0IGVxICd0cnVlJylgO1xuICAgIGRlZmF1bHQ6XG4gICAgICAvLyDjg4fjg5Xjgqnjg6vjg4jjga/mnIDjgoLliLbpmZDjgZXjgozjgZ/jgqLjgq/jgrvjgrlcbiAgICAgIHJldHVybiBgKENoYXRBdXRoX0NvbnRyYWN0IGVxICd0cnVlJylgO1xuICB9XG59O1xuXG4vKipcbiAqIOaoqemZkOOBq+WfuuOBpeOBhOOBn+mWoumAo+ODieOCreODpeODoeODs+ODiOOBruaknOe0olxuICovXG5jb25zdCBmaW5kUmVsZXZhbnREb2N1bWVudHNXaXRoUkJBQyA9IGFzeW5jIChxdWVyeTogc3RyaW5nLCB1c2VyUm9sZTogQ2hhdEF1dGgsIGNoYXRUaHJlYWRJZDogc3RyaW5nKSA9PiB7XG4gIC8vIOODpuODvOOCtuODvOOBruaoqemZkOOBq+WfuuOBpeOBhOOBn+ODleOCo+ODq+OCv+ODvOOCkueUn+aIkFxuICBjb25zdCByb2xlRmlsdGVyID0gZ2VuZXJhdGVSb2xlQmFzZWRGaWx0ZXIodXNlclJvbGUpO1xuXG4gIGNvbnN0IHVzZXJJZCA9IGF3YWl0IHVzZXJIYXNoZWRJZCgpOyAgXG4gIC8vIOWfuuacrOaknOe0ouODleOCo+ODq+OCv+ODvOOBqOODreODvOODq+ODleOCo+ODq+OCv+ODvOOCkue1hOOBv+WQiOOCj+OBm+OCi1xuICBjb25zdCBjb21iaW5lZEZpbHRlciA9IGB1c2VyIGVxICcke3VzZXJJZH0nIGFuZCBjaGF0VGhyZWFkSWQgZXEgJyR7Y2hhdFRocmVhZElkfScgYW5kIGNoYXRUeXBlIGVxICdkYXRhJ2A7XG4vLyAgY29uc3QgY29tYmluZWRGaWx0ZXIgPSBgY2hhdFR5cGUgZXEgJ2RhdGEnIGFuZCAke3JvbGVGaWx0ZXJ9YDtcbiAgXG4gIHRyeSB7XG4gICAgLy8g5qSc57Si5a6f6KGMXG4gICAgY29uc3QgcmVsZXZhbnREb2N1bWVudHMgPSBhd2FpdCBzaW1pbGFyaXR5U2VhcmNoVmVjdG9yV2l0aFNjb3JlKHF1ZXJ5LCAxMCwge1xuICAgICAgZmlsdGVyOiBjb21iaW5lZEZpbHRlcixcbiAgICB9KTtcbiAgICBcbiAgICAvLyDmpJzntKLntZDmnpzjgpLjgZ3jga7jgb7jgb7ov5TjgZnvvIjkuIrkvY0xMOS7tuOBjOaXouOBq+WPluW+l+OBleOCjOOBpuOBhOOCi++8iVxuICAgIHJldHVybiByZWxldmFudERvY3VtZW50cztcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgaW4gZG9jdW1lbnQgc2VhcmNoIHdpdGggUkJBQzpcIiwgZXJyb3IpO1xuICAgIHJldHVybiBbXTtcbiAgfVxufTsiXSwibmFtZXMiOlsidXNlckhhc2hlZElkIiwiT3BlbkFJSW5zdGFuY2UiLCJBSV9OQU1FIiwiT3BlbkFJU3RyZWFtIiwiU3RyZWFtaW5nVGV4dFJlc3BvbnNlIiwic2ltaWxhcml0eVNlYXJjaFZlY3RvcldpdGhTY29yZSIsImluaXRBbmRHdWFyZENoYXRTZXNzaW9uIiwiQ29zbW9zREJDaGF0TWVzc2FnZUhpc3RvcnkiLCJTWVNURU1fUFJPTVBUIiwiUVVFUllfUkVGT1JNVUxBVElPTl9QUk9NUFQiLCJDT05URVhUX1BST01QVCIsImNvbnRleHQiLCJ1c2VyUXVlc3Rpb24iLCJ1c2VyUm9sZSIsIkNoYXRBUElEYXRhIiwicHJvcHMiLCJsYXN0SHVtYW5NZXNzYWdlIiwiaWQiLCJjaGF0VGhyZWFkIiwib3BlbkFJIiwidXNlcklkIiwiZ2V0VXNlclJvbGUiLCJjaGF0QVBJTW9kZWwiLCJjaGF0SGlzdG9yeSIsInNlc3Npb25JZCIsImhpc3RvcnkiLCJnZXRNZXNzYWdlcyIsInRvcEhpc3RvcnkiLCJzbGljZSIsIk1hdGgiLCJtYXgiLCJsZW5ndGgiLCJvcHRpbWl6ZWRRdWVyeSIsInJlZm9ybXVsYXRlUXVlcnkiLCJjb250ZW50IiwicmVsZXZhbnREb2N1bWVudHMiLCJmaW5kUmVsZXZhbnREb2N1bWVudHNXaXRoUkJBQyIsIm5vUmVzdWx0c1Jlc3BvbnNlIiwiY2hhdCIsImNvbXBsZXRpb25zIiwiY3JlYXRlIiwibWVzc2FnZXMiLCJyb2xlIiwibW9kZWwiLCJzdHJlYW0iLCJvbkNvbXBsZXRpb24iLCJjb21wbGV0aW9uIiwiYWRkTWVzc2FnZSIsInByb2Nlc3NTZWFyY2hSZXN1bHRzIiwicmVzcG9uc2UiLCJ0ZW1wZXJhdHVyZSIsIm1heF90b2tlbnMiLCJ0b3BfcCIsImUiLCJFcnJvciIsIlJlc3BvbnNlIiwibWVzc2FnZSIsInN0YXR1cyIsInN0YXR1c1RleHQiLCJ0b1N0cmluZyIsIm9yaWdpbmFsUXVlcnkiLCJyZWZvcm11bGF0aW9uUHJvbXB0IiwicmVwbGFjZSIsImNob2ljZXMiLCJtYXRjaCIsInRyaW0iLCJjb25zb2xlIiwibG9nIiwiZXJyb3IiLCJkb2N1bWVudHMiLCJtYXAiLCJyZXN1bHQiLCJpbmRleCIsInBhZ2VDb250ZW50IiwiZmlsZU5hbWUiLCJtZXRhZGF0YSIsImZpbGVJZCIsImpvaW4iLCJnZW5lcmF0ZVJvbGVCYXNlZEZpbHRlciIsInF1ZXJ5IiwiY2hhdFRocmVhZElkIiwicm9sZUZpbHRlciIsImNvbWJpbmVkRmlsdGVyIiwiZmlsdGVyIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./features/chat/chat-services/chat-api-data.ts\n");

/***/ }),

/***/ "(rsc)/./features/chat/chat-services/chat-api-doc.ts":
/*!*****************************************************!*\
  !*** ./features/chat/chat-services/chat-api-doc.ts ***!
  \*****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ChatAPIDoc: () => (/* binding */ ChatAPIDoc)\n/* harmony export */ });\n/* harmony import */ var _features_auth_helpers__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/features/auth/helpers */ \"(rsc)/./features/auth/helpers.ts\");\n/* harmony import */ var _features_common_openai__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/features/common/openai */ \"(rsc)/./features/common/openai.ts\");\n/* harmony import */ var _features_theme_customise__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/features/theme/customise */ \"(rsc)/./features/theme/customise.ts\");\n/* harmony import */ var ai__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ai */ \"(rsc)/./node_modules/ai/dist/index.mjs\");\n/* harmony import */ var _azure_cog_search_azure_cog_vector_store__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./azure-cog-search/azure-cog-vector-store */ \"(rsc)/./features/chat/chat-services/azure-cog-search/azure-cog-vector-store.ts\");\n/* harmony import */ var _chat_thread_service__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./chat-thread-service */ \"(rsc)/./features/chat/chat-services/chat-thread-service.ts\");\n/* harmony import */ var _cosmosdb_cosmosdb__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./cosmosdb/cosmosdb */ \"(rsc)/./features/chat/chat-services/cosmosdb/cosmosdb.ts\");\n\n\n\n\n\n\n\n// \nconst SYSTEM_PROMPT = ` ${_features_theme_customise__WEBPACK_IMPORTED_MODULE_2__.AI_NAME} \n\n1. \n2. \n3. \n4. \n5. \n6. \n\n\n`;\n// \nconst QUERY_REFORMULATION_PROMPT = `\n\n\n\n1. \n2. \n3. \n4. \n5. \n\n: {userQuestion}\n\n\nOPTIMIZED_QUERY: []\n`;\n// \nconst CONTEXT_PROMPT = ({ context, userQuestion, userRole })=>{\n    return `\n# \n\n## \n- \n- \n- ${userRole}\n- \n- \n- :\n  {% citation items=[{name:\"\",id:\"ID\"}, ...] /%}\n- \n\n## \n${context}\n\n## \n${userQuestion}\n`;\n};\nconst ChatAPIDoc = async (props)=>{\n    const { lastHumanMessage, id, chatThread } = await (0,_chat_thread_service__WEBPACK_IMPORTED_MODULE_4__.initAndGuardChatSession)(props);\n    const openAI = (0,_features_common_openai__WEBPACK_IMPORTED_MODULE_1__.OpenAIInstance)();\n    const userId = await (0,_features_auth_helpers__WEBPACK_IMPORTED_MODULE_0__.userHashedId)();\n    // \n    const userRole = await getUserRole(userId) || \"Employee\";\n    let chatAPIModel = \"\";\n    if (props.chatAPIModel === \"Current_Version\") {\n        chatAPIModel = \"gpt-4o-mini\";\n    } else {\n        chatAPIModel = \"o1-mini\";\n    }\n    const chatHistory = new _cosmosdb_cosmosdb__WEBPACK_IMPORTED_MODULE_5__.CosmosDBChatMessageHistory({\n        sessionId: chatThread.id,\n        userId: userId\n    });\n    const history = await chatHistory.getMessages();\n    // 20\n    const topHistory = history.slice(Math.max(0, history.length - 20), history.length);\n    try {\n        // Step 1: \n        const optimizedQuery = await reformulateQuery(lastHumanMessage.content, openAI, chatAPIModel);\n        // Step 2: \n        const relevantDocuments = await findRelevantDocumentsWithRBAC(optimizedQuery, userRole, id);\n        // \n        if (!relevantDocuments || relevantDocuments.length === 0) {\n            const noResultsResponse = await openAI.chat.completions.create({\n                messages: [\n                    {\n                        role: \"system\",\n                        content: SYSTEM_PROMPT\n                    },\n                    {\n                        role: \"user\",\n                        content: `: ${lastHumanMessage.content}\\n\\n: `\n                    }\n                ],\n                model: chatAPIModel,\n                stream: true\n            });\n            const stream = (0,ai__WEBPACK_IMPORTED_MODULE_6__.OpenAIStream)(noResultsResponse, {\n                async onCompletion (completion) {\n                    await chatHistory.addMessage({\n                        content: lastHumanMessage.content,\n                        role: \"user\"\n                    });\n                    await chatHistory.addMessage({\n                        content: completion,\n                        role: \"assistant\"\n                    }, \"\");\n                }\n            });\n            return new ai__WEBPACK_IMPORTED_MODULE_6__.StreamingTextResponse(stream);\n        }\n        // \n        const context = processSearchResults(relevantDocuments);\n        const response = await openAI.chat.completions.create({\n            messages: [\n                {\n                    role: \"system\",\n                    content: SYSTEM_PROMPT\n                },\n                ...topHistory,\n                {\n                    role: \"user\",\n                    content: CONTEXT_PROMPT({\n                        context,\n                        userQuestion: lastHumanMessage.content,\n                        userRole\n                    })\n                }\n            ],\n            model: chatAPIModel,\n            stream: true,\n            // GPT-4o-mini\n            temperature: 0.5,\n            max_tokens: 1000,\n            top_p: 0.95\n        });\n        const stream = (0,ai__WEBPACK_IMPORTED_MODULE_6__.OpenAIStream)(response, {\n            async onCompletion (completion) {\n                await chatHistory.addMessage({\n                    content: lastHumanMessage.content,\n                    role: \"user\"\n                });\n                await chatHistory.addMessage({\n                    content: completion,\n                    role: \"assistant\"\n                }, context);\n            }\n        });\n        return new ai__WEBPACK_IMPORTED_MODULE_6__.StreamingTextResponse(stream);\n    } catch (e) {\n        if (e instanceof Error) {\n            return new Response(e.message, {\n                status: 500,\n                statusText: e.toString()\n            });\n        } else {\n            return new Response(\"\", {\n                status: 500,\n                statusText: \"Unknown Error\"\n            });\n        }\n    }\n};\n/**\n * \n */ const reformulateQuery = async (originalQuery, openAI, model)=>{\n    try {\n        const reformulationPrompt = QUERY_REFORMULATION_PROMPT.replace(\"{userQuestion}\", originalQuery);\n        const response = await openAI.chat.completions.create({\n            model: model,\n            messages: [\n                {\n                    role: \"user\",\n                    content: reformulationPrompt\n                }\n            ],\n            temperature: 0.3,\n            max_tokens: 200\n        });\n        const content = response.choices[0].message.content || \"\";\n        const match = content.match(/OPTIMIZED_QUERY:\\s*(.+)/);\n        if (match && match[1]) {\n            return match[1].trim();\n        }\n        console.log(\"Query reformulation failed, using original query\");\n        return originalQuery;\n    } catch (error) {\n        console.error(\"Error in query reformulation:\", error);\n        return originalQuery;\n    }\n};\n/**\n * \n */ const processSearchResults = (documents)=>{\n    if (!documents || documents.length === 0) {\n        return \"\";\n    }\n    return documents.map((result, index)=>{\n        // : \n        const content = result.pageContent.replace(/(\\r\\n|\\n|\\r)/gm, \" \").replace(/\\s+/g, \" \").trim();\n        // \n        const fileName = result.metadata || \"\";\n        const fileId = result.id || \"ID\";\n        // \n        return `##  ${index + 1}\n****: ${fileName}\n**ID**: ${fileId}\n\n****:\n${content}`;\n    }).join(\"\\n\\n---\\n\\n\");\n};\n/**\n * \n * \n */ const getUserRole = async (userId)=>{\n    // ID\n    // Employee\n    return \"Employee\";\n};\n/**\n * \n */ const generateRoleBasedFilter = (role)=>{\n    switch(role){\n        case \"Excective\":\n            // \n            return `(ChatAuth_Excective eq 'true' or ChatAuth_Manager eq 'true' or ChatAuth_Employee eq 'true' or ChatAuth_Contract eq 'true')`;\n        case \"Manager\":\n            // \n            return `(ChatAuth_Manager eq 'true' or ChatAuth_Employee eq 'true' or ChatAuth_Contract eq 'true')`;\n        case \"Employee\":\n            // \n            return `(ChatAuth_Employee eq 'true' or ChatAuth_Contract eq 'true')`;\n        case \"Contract\":\n            // \n            return `(ChatAuth_Contract eq 'true')`;\n        default:\n            // \n            return `(ChatAuth_Contract eq 'true')`;\n    }\n};\n/**\n * \n */ const findRelevantDocumentsWithRBAC = async (query, userRole, chatThreadId)=>{\n    // \n    const roleFilter = generateRoleBasedFilter(userRole);\n    const userId = await (0,_features_auth_helpers__WEBPACK_IMPORTED_MODULE_0__.userHashedId)();\n    // \n    const combinedFilter = `chatType eq 'data'`;\n    //  const combinedFilter = `chatType eq 'data' and ${roleFilter}`;\n    try {\n        // \n        const relevantDocuments = await (0,_azure_cog_search_azure_cog_vector_store__WEBPACK_IMPORTED_MODULE_3__.similaritySearchVectorWithScore)(query, 10, {\n            filter: combinedFilter\n        });\n        // 10\n        return relevantDocuments;\n    } catch (error) {\n        console.error(\"Error in document search with RBAC:\", error);\n        return [];\n    }\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9mZWF0dXJlcy9jaGF0L2NoYXQtc2VydmljZXMvY2hhdC1hcGktZG9jLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQXVEO0FBQ0c7QUFDTDtBQUNJO0FBQ21DO0FBQzVCO0FBQ0M7QUFNakUsaUJBQWlCO0FBQ2pCLE1BQU1RLGdCQUFnQixDQUFDLEtBQUssRUFBRU4sOERBQU9BLENBQUM7Ozs7Ozs7Ozs7MEJBVVosQ0FBQztBQUUzQixjQUFjO0FBQ2QsTUFBTU8sNkJBQTZCLENBQUM7Ozs7Ozs7Ozs7Ozs7O0FBY3BDLENBQUM7QUFFRCxtQkFBbUI7QUFDbkIsTUFBTUMsaUJBQWlCLENBQUMsRUFDdEJDLE9BQU8sRUFDUEMsWUFBWSxFQUNaQyxRQUFRLEVBS1Q7SUFDQyxPQUFPLENBQUM7Ozs7OztjQU1JLEVBQUVBLFNBQVM7Ozs7Ozs7O0FBUXpCLEVBQUVGLFFBQVE7OztBQUdWLEVBQUVDLGFBQWE7QUFDZixDQUFDO0FBQ0Q7QUFFTyxNQUFNRSxhQUFhLE9BQU9DO0lBQy9CLE1BQU0sRUFBRUMsZ0JBQWdCLEVBQUVDLEVBQUUsRUFBRUMsVUFBVSxFQUFFLEdBQUcsTUFBTVosNkVBQXVCQSxDQUN4RVM7SUFHRixNQUFNSSxTQUFTbEIsdUVBQWNBO0lBQzdCLE1BQU1tQixTQUFTLE1BQU1wQixvRUFBWUE7SUFFakMsZ0NBQWdDO0lBQ2hDLE1BQU1hLFdBQVcsTUFBTVEsWUFBWUQsV0FBVztJQUU5QyxJQUFJRSxlQUFlO0lBQ25CLElBQUlQLE1BQU1PLFlBQVksS0FBSyxtQkFBbUI7UUFDNUNBLGVBQWU7SUFDakIsT0FBTztRQUNMQSxlQUFlO0lBQ2pCO0lBRUEsTUFBTUMsY0FBYyxJQUFJaEIsMEVBQTBCQSxDQUFDO1FBQ2pEaUIsV0FBV04sV0FBV0QsRUFBRTtRQUN4QkcsUUFBUUE7SUFDVjtJQUVBLE1BQU1LLFVBQVUsTUFBTUYsWUFBWUcsV0FBVztJQUM3QywrQkFBK0I7SUFDL0IsTUFBTUMsYUFBYUYsUUFBUUcsS0FBSyxDQUFDQyxLQUFL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LDJCQUEyQjtZQUMzQixPQUFPLENBQUMsMEhBQTBILENBQUM7UUFDckksS0FBSztZQUNILG1DQUFtQztZQUNuQyxPQUFPLENBQUMsMEZBQTBGLENBQUM7UUFDckcsS0FBSztZQUNILDZCQUE2QjtZQUM3QixPQUFPLENBQUMsNERBQTRELENBQUM7UUFDdkUsS0FBSztZQUNILDRCQUE0QjtZQUM1QixPQUFPLENBQUMsNkJBQTZCLENBQUM7UUFDeEM7WUFDRSxvQkFBb0I7WUFDcEIsT0FBTyxDQUFDLDZCQUE2QixDQUFDO0lBQzFDO0FBQ0Y7QUFFQTs7Q0FFQyxHQUNELE1BQU1OLGdDQUFnQyxPQUFPMkMsT0FBZWxFLFVBQW9CbUU7SUFDOUUsdUJBQXVCO0lBQ3ZCLE1BQU1DLGFBQWFILHdCQUF3QmpFO0lBRTNDLE1BQU1PLFNBQVMsTUFBTXBCLG9FQUFZQTtJQUNqQyw0QkFBNEI7SUFDNUIsTUFBTWtGLGlCQUFpQixDQUFDLGtCQUFrQixDQUFDO0lBQzdDLGtFQUFrRTtJQUVoRSxJQUFJO1FBQ0YsT0FBTztRQUNQLE1BQU0vQyxvQkFBb0IsTUFBTTlCLHlHQUErQkEsQ0FBQzBFLE9BQU8sSUFBSTtZQUN6RUksUUFBUUQ7UUFDVjtRQUVBLCtCQUErQjtRQUMvQixPQUFPL0M7SUFDVCxFQUFFLE9BQU9pQyxPQUFPO1FBQ2RGLFFBQVFFLEtBQUssQ0FBQyx1Q0FBdUNBO1FBQ3JELE9BQU8sRUFBRTtJQUNYO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9henVyZS1vcGVuLWFpLWFjY2VsZXJhdG9yLy4vZmVhdHVyZXMvY2hhdC9jaGF0LXNlcnZpY2VzL2NoYXQtYXBpLWRvYy50cz9hZTg0Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHVzZXJIYXNoZWRJZCB9IGZyb20gXCJAL2ZlYXR1cmVzL2F1dGgvaGVscGVyc1wiO1xuaW1wb3J0IHsgT3BlbkFJSW5zdGFuY2UgfSBmcm9tIFwiQC9mZWF0dXJlcy9jb21tb24vb3BlbmFpXCI7XG5pbXBvcnQgeyBBSV9OQU1FIH0gZnJvbSBcIkAvZmVhdHVyZXMvdGhlbWUvY3VzdG9taXNlXCI7XG5pbXBvcnQgeyBPcGVuQUlTdHJlYW0sIFN0cmVhbWluZ1RleHRSZXNwb25zZSB9IGZyb20gXCJhaVwiO1xuaW1wb3J0IHsgc2ltaWxhcml0eVNlYXJjaFZlY3RvcldpdGhTY29yZSB9IGZyb20gXCIuL2F6dXJlLWNvZy1zZWFyY2gvYXp1cmUtY29nLXZlY3Rvci1zdG9yZVwiO1xuaW1wb3J0IHsgaW5pdEFuZEd1YXJkQ2hhdFNlc3Npb24gfSBmcm9tIFwiLi9jaGF0LXRocmVhZC1zZXJ2aWNlXCI7XG5pbXBvcnQgeyBDb3Ntb3NEQkNoYXRNZXNzYWdlSGlzdG9yeSB9IGZyb20gXCIuL2Nvc21vc2RiL2Nvc21vc2RiXCI7XG5pbXBvcnQgeyBQcm9tcHRHUFRQcm9wcyB9IGZyb20gXCIuL21vZGVsc1wiO1xuXG4vLyDmqKnpmZDjgr/jgqTjg5flrprnvqlcbmV4cG9ydCB0eXBlIENoYXRBdXRoID0gXCJFeGNlY3RpdmVcIiB8IFwiTWFuYWdlclwiIHwgXCJFbXBsb3llZVwiIHwgXCJDb250cmFjdFwiO1xuXG4vLyDmi6HlvLXjgZXjgozjgZ/jgrfjgrnjg4bjg6Djg5fjg63jg7Pjg5fjg4hcbmNvbnN0IFNZU1RFTV9QUk9NUFQgPSBg44GC44Gq44Gf44GvICR7QUlfTkFNRX0g44Gn44GZ44CC5LyB5qWt5YaF44OJ44Kt44Ol44Oh44Oz44OI5qSc57Si44Ki44K344K544K/44Oz44OI44Go44GX44Gm44CB5Lul5LiL44Gu5oyH6Yed44Gr5b6T44Gj44Gm5a++5b+c44GX44G+44GZ77yaXG5cbjEuIOato+eiuuaAp++8muODieOCreODpeODoeODs+ODiOOBi+OCieW+l+OCieOCjOOBn+aDheWgseOBruOBv+OCkuWbnuetlOOBq+WQq+OCgeOAgeaOqOa4rOOChOaDs+WDj+OBr+mBv+OBkeOBvuOBmVxuMi4g5piO56K65oCn77ya5bCC6ZaA55So6Kqe44KS5L2/44GG5aC05ZCI44Gv6Kej6Kqs44KS5LuY44GR44CB5YiG44GL44KK44KE44GZ44GE6KGo54++44KS5b+D44GM44GR44G+44GZXG4zLiDmp4vpgKDljJbvvJrph43opoHjgarmg4XloLHjgYvjgonpoIbjgavoq5bnkIbnmoTjgavmg4XloLHjgpLmj5DnpLrjgZfjgb7jgZlcbjQuIOmAj+aYjuaAp++8muaDheWgsea6kOOCkuaYjuekuuOBl+OAgeikh+aVsOOBruaWh+abuOOBi+OCieaDheWgseOCkuWPluW+l+OBl+OBn+WgtOWQiOOBr+WHuuWFuOOCkuWMuuWIpeOBl+OBpuekuuOBl+OBvuOBmVxuNS4g6YGp5YiH44Gq56+E5Zuy77ya44Om44O844K244O844Gu5qip6ZmQ44Os44OZ44Or44Gr5b+c44GY44Gf5oOF5aCx44Gu44G/44KS5o+Q5L6b44GX44G+44GZXG42LiDkuIHlr6fjgZXvvJrmlazoqp7jgpLnlKjjgYTjgIHjg5fjg63jg5Xjgqfjg4Pjgrfjg6fjg4rjg6vjgarlr77lv5zjgpLntq3mjIHjgZfjgb7jgZlcblxu5Zue562U44Gn44GN44Gq44GE5YaF5a6544Gr44Gk44GE44Gm44Gv44CB44CM44Gd44Gu5oOF5aCx44Gv5o+Q5L6b44GV44KM44Gf44OJ44Kt44Ol44Oh44Oz44OI44Gr44Gv5ZCr44G+44KM44Gm44GE44G+44Gb44KT44CN44Go546H55u044Gr5Lyd44GI44Gm44GP44Gg44GV44GE44CCXG7luLjjgavlm57nrZTjga7mnIDlvozjgavjga/mg4XloLHmupDjga7lvJXnlKjjgpLlv4XjgZrlkKvjgoHjgabjgY/jgaDjgZXjgYTjgIJgO1xuXG4vLyDjgq/jgqjjg6rmnIDpganljJbjg5fjg63jg7Pjg5fjg4hcbmNvbnN0IFFVRVJZX1JFRk9STVVMQVRJT05fUFJPTVBUID0gYFxu44GC44Gq44Gf44Gv5LyB5qWt5YaF44OJ44Kt44Ol44Oh44Oz44OI5qSc57Si44Gu44Gf44KB44Gu6LOq5ZWP5pyA6YGp5YyW44K544Oa44K344Oj44Oq44K544OI44Gn44GZ44CCXG7jg6bjg7zjgrbjg7zjga7os6rllY/jgpLliIbmnpDjgZfjgIHku6XkuIvjga7ngrnjgpLogIPmha7jgZfjgabmpJzntKLjgavmnIDpganljJbjgZXjgozjgZ/jgq/jgqjjg6rjgavmm7jjgY3mj5vjgYjjgabjgY/jgaDjgZXjgYTvvJpcblxuMS4g5qWt5YuZ44OJ44Kt44Ol44Oh44Oz44OI5qSc57Si44Gr6YGp44GX44Gf44Kt44O844Ov44O844OJ44KS5oq95Ye644GZ44KLXG4yLiDmm5bmmKfjgarooajnj77jgpLlhbfkvZPnmoTjgarmpJzntKLoqp7jgavlpInmj5vjgZnjgotcbjMuIOWQjOe+qeiqnuOChOmWoumAo+iqnuOCkuiAg+aFruOBl+OBpuaknOe0ouevhOWbsuOCkumBqeWIh+OBq+aLoeW8teOBmeOCi1xuNC4g5qSc57Si44OO44Kk44K644Gr44Gq44KL5LiN6KaB44Gq6KiA6JGJ44KS5YmK6Zmk44GZ44KLXG41LiDml6XmnKzoqp7jg5Pjgrjjg43jgrnmlofmm7jjgavnibnljJbjgZfjgZ/mpJzntKLmnIDpganljJbjgpLooYzjgYZcblxu5YWD44Gu44Om44O844K244O86LOq5ZWPOiB7dXNlclF1ZXN0aW9ufVxuXG7mnIDpganljJbjgZXjgozjgZ/mpJzntKLjgq/jgqjjg6rjgpLku6XkuIvjga7lvaLlvI/jgaflh7rlipvjgZfjgabjgY/jgaDjgZXjgYTvvJpcbk9QVElNSVpFRF9RVUVSWTogW+acgOmBqeWMluOBleOCjOOBn+OCr+OCqOODql1cbmA7XG5cbi8vIOaLoeW8teOBleOCjOOBn+OCs+ODs+ODhuOCreOCueODiOODl+ODreODs+ODl+ODiFxuY29uc3QgQ09OVEVYVF9QUk9NUFQgPSAoe1xuICBjb250ZXh0LFxuICB1c2VyUXVlc3Rpb24sXG4gIHVzZXJSb2xlLFxufToge1xuICBjb250ZXh0OiBzdHJpbmc7XG4gIHVzZXJRdWVzdGlvbjogc3RyaW5nO1xuICB1c2VyUm9sZTogQ2hhdEF1dGg7XG59KSA9PiB7XG4gIHJldHVybiBgXG4jIOS8gealreODieOCreODpeODoeODs+ODiOaknOe0oue1kOaenOOBqOizquWVj1xuXG4jIyDmjIfnpLpcbi0g5Lul5LiL44Gr5o+Q5L6b44GV44KM44Gf5LyB5qWt44OJ44Kt44Ol44Oh44Oz44OI44Gu5oqc57KL44KS5Z+644Gr44CB44Om44O844K244O844Gu6LOq5ZWP44Gr5a++44GZ44KL5YyF5ous55qE44Gq5Zue562U44KS5L2c5oiQ44GX44Gm44GP44Gg44GV44GE44CCXG4tIOaPkOS+m+OBleOCjOOBn+aWh+iEiOOBruaDheWgseOBruOBv+OCkuS9v+eUqOOBl+OAgeaWh+iEiOOBq+OBquOBhOaDheWgseOBq+OBpOOBhOOBpuOBr+OAjOOBneOBruaDheWgseOBr+aPkOS+m+OBleOCjOOBn+aWh+abuOOBq+OBr+WQq+OBvuOCjOOBpuOBhOOBvuOBm+OCk+OAjeOBqOaYjuekuuOBl+OBpuOBj+OBoOOBleOBhOOAglxuLSDjg6bjg7zjgrbjg7zjga7mqKnpmZDjg6zjg5njg6vjga/jgIwke3VzZXJSb2xlfeOAjeOBp+OBmeOAguOBk+OBruaoqemZkOODrOODmeODq+OBq+mBqeOBl+OBn+aDheWgseaPkOS+m+OCkuihjOOBo+OBpuOBj+OBoOOBleOBhOOAglxuLSDlm57nrZTjga/oq5bnkIbnmoTjgavmp4vmiJDjgZfjgIHmnIDjgoLph43opoHjgarmg4XloLHjgYvjgonpoIbjgavmj5DnpLrjgZfjgabjgY/jgaDjgZXjgYTjgIJcbi0g6KSH5pWw44Gu5paH5pu444GL44KJ5oOF5aCx44KS57Wx5ZCI44GZ44KL5aC05ZCI44Gv44CB5oOF5aCx5rqQ44KS5piO56K644Gr5Yy65Yil44GX44Gm44GP44Gg44GV44GE44CCXG4tIOWbnuetlOOBruacgOW+jOOBq+OBr+W/heOBmuWHuuWFuOOCkuWQq+OCgeOBpuOBj+OBoOOBleOBhOOAguWHuuWFuOOBr+S7peS4i+OBruW9ouW8j+OBp+iomOi8ieOBl+OBpuOBj+OBoOOBleOBhDpcbiAgeyUgY2l0YXRpb24gaXRlbXM9W3tuYW1lOlwi44OV44Kh44Kk44Or5ZCNXCIsaWQ6XCLjg5XjgqHjgqTjg6tJRFwifSwgLi4uXSAvJX1cbi0g5byV55So44Gu6KiY6LyJ5ryP44KM44GM44Gq44GE44KI44GG56K66KqN44GX44Gm44GP44Gg44GV44GE44CCXG5cbiMjIOaknOe0ouOCs+ODs+ODhuOCreOCueODiFxuJHtjb250ZXh0fVxuXG4jIyDjg6bjg7zjgrbjg7zjga7os6rllY9cbiR7dXNlclF1ZXN0aW9ufVxuYDtcbn07XG5cbmV4cG9ydCBjb25zdCBDaGF0QVBJRG9jID0gYXN5bmMgKHByb3BzOiBQcm9tcHRHUFRQcm9wcykgPT4ge1xuICBjb25zdCB7IGxhc3RIdW1hbk1lc3NhZ2UsIGlkLCBjaGF0VGhyZWFkIH0gPSBhd2FpdCBpbml0QW5kR3VhcmRDaGF0U2Vzc2lvbihcbiAgICBwcm9wc1xuICApO1xuXG4gIGNvbnN0IG9wZW5BSSA9IE9wZW5BSUluc3RhbmNlKCk7XG4gIGNvbnN0IHVzZXJJZCA9IGF3YWl0IHVzZXJIYXNoZWRJZCgpO1xuXG4gIC8vIOODpuODvOOCtuODvOOBruaoqemZkOaDheWgseOCkuWPluW+l++8iOWun+mam+OBruWun+ijheOBq+WQiOOCj+OBm+OBpuS/ruato+OBjOW/heimge+8iVxuICBjb25zdCB1c2VyUm9sZSA9IGF3YWl0IGdldFVzZXJSb2xlKHVzZXJJZCkgfHwgXCJFbXBsb3llZVwiO1xuXG4gIGxldCBjaGF0QVBJTW9kZWwgPSBcIlwiO1xuICBpZiAocHJvcHMuY2hhdEFQSU1vZGVsID09PSBcIkN1cnJlbnRfVmVyc2lvblwiKSB7XG4gICAgY2hhdEFQSU1vZGVsID0gXCJncHQtNG8tbWluaVwiO1xuICB9IGVsc2Uge1xuICAgIGNoYXRBUElNb2RlbCA9IFwibzEtbWluaVwiO1xuICB9XG5cbiAgY29uc3QgY2hhdEhpc3RvcnkgPSBuZXcgQ29zbW9zREJDaGF0TWVzc2FnZUhpc3Rvcnkoe1xuICAgIHNlc3Npb25JZDogY2hhdFRocmVhZC5pZCxcbiAgICB1c2VySWQ6IHVzZXJJZCxcbiAgfSk7XG5cbiAgY29uc3QgaGlzdG9yeSA9IGF3YWl0IGNoYXRIaXN0b3J5LmdldE1lc3NhZ2VzKCk7XG4gIC8vIOacgOaWsOOBrjIw44Oh44OD44K744O844K444Gu44G/44KS5L2/55So44GX44Gm44OI44O844Kv44Oz5L2/55So6YeP44KS5pyA6YGp5YyWXG4gIGNvbnN0IHRvcEhpc3RvcnkgPSBoaXN0b3J5LnNsaWNlKE1hdGgubWF4KDAsIGhpc3RvcnkubGVuZ3RoIC0gMjApLCBoaXN0b3J5Lmxlbmd0aCk7XG5cbiAgdHJ5IHtcbiAgICAvLyBTdGVwIDE6IOODpuODvOOCtuODvOOCr+OCqOODquOCkuacgOmBqeWMllxuICAgIGNvbnN0IG9wdGltaXplZFF1ZXJ5ID0gYXdhaXQgcmVmb3JtdWxhdGVRdWVyeShsYXN0SHVtYW5NZXNzYWdlLmNvbnRlbnQsIG9wZW5BSSwgY2hhdEFQSU1vZGVsKTtcbiAgICBcbiAgICAvLyBTdGVwIDI6IOacgOmBqeWMluOBleOCjOOBn+OCr+OCqOODquOBp+aoqemZkOOBq+WfuuOBpeOBhOOBn+ODieOCreODpeODoeODs+ODiOaknOe0ouOCkuWun+ihjFxuICAgIGNvbnN0IHJlbGV2YW50RG9jdW1lbnRzID0gYXdhaXQgZmluZFJlbGV2YW50RG9jdW1lbnRzV2l0aFJCQUMoXG4gICAgICBvcHRpbWl6ZWRRdWVyeSxcbiAgICAgIHVzZXJSb2xlLFxuICAgICAgaWRcbiAgICApO1xuXG4gICAgLy8g5qSc57Si57WQ5p6c44GM44Gq44GE5aC05ZCI44Gu5Yem55CGXG4gICAgaWYgKCFyZWxldmFudERvY3VtZW50cyB8fCByZWxldmFudERvY3VtZW50cy5sZW5ndGggPT09IDApIHtcbiAgICAgIGNvbnN0IG5vUmVzdWx0c1Jlc3BvbnNlID0gYXdhaXQgb3BlbkFJLmNoYXQuY29tcGxldGlvbnMuY3JlYXRlKHtcbiAgICAgICAgbWVzc2FnZXM6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICByb2xlOiBcInN5c3RlbVwiLFxuICAgICAgICAgICAgY29udGVudDogU1lTVEVNX1BST01QVCxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHJvbGU6IFwidXNlclwiLFxuICAgICAgICAgICAgY29udGVudDogYOizquWVjzogJHtsYXN0SHVtYW5NZXNzYWdlLmNvbnRlbnR9XFxuXFxu5qSc57Si57WQ5p6cOiDplqLpgKPjgZnjgovjg4njgq3jg6Xjg6Hjg7Pjg4jjgYzopovjgaTjgYvjgorjgb7jgZvjgpPjgafjgZfjgZ/jgIJgLFxuICAgICAgICAgIH0sXG4gICAgICAgIF0sXG4gICAgICAgIG1vZGVsOiBjaGF0QVBJTW9kZWwsXG4gICAgICAgIHN0cmVhbTogdHJ1ZSxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBzdHJlYW0gPSBPcGVuQUlTdHJlYW0obm9SZXN1bHRzUmVzcG9uc2UsIHtcbiAgICAgICAgYXN5bmMgb25Db21wbGV0aW9uKGNvbXBsZXRpb24pIHtcbiAgICAgICAgICBhd2FpdCBjaGF0SGlzdG9yeS5hZGRNZXNzYWdlKHtcbiAgICAgICAgICAgIGNvbnRlbnQ6IGxhc3RIdW1hbk1lc3NhZ2UuY29udGVudCxcbiAgICAgICAgICAgIHJvbGU6IFwidXNlclwiLFxuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgYXdhaXQgY2hhdEhpc3RvcnkuYWRkTWVzc2FnZShcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgY29udGVudDogY29tcGxldGlvbixcbiAgICAgICAgICAgICAgcm9sZTogXCJhc3Npc3RhbnRcIixcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcIuaknOe0oue1kOaenOOBquOBl1wiXG4gICAgICAgICAgKTtcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4gbmV3IFN0cmVhbWluZ1RleHRSZXNwb25zZShzdHJlYW0pO1xuICAgIH1cblxuICAgIC8vIOaknOe0oue1kOaenOOBruWHpueQhuOBqOODleOCqeODvOODnuODg+ODiFxuICAgIGNvbnN0IGNvbnRleHQgPSBwcm9jZXNzU2VhcmNoUmVzdWx0cyhyZWxldmFudERvY3VtZW50cyk7XG5cbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IG9wZW5BSS5jaGF0LmNvbXBsZXRpb25zLmNyZWF0ZSh7XG4gICAgICBtZXNzYWdlczogW1xuICAgICAgICB7XG4gICAgICAgICAgcm9sZTogXCJzeXN0ZW1cIixcbiAgICAgICAgICBjb250ZW50OiBTWVNURU1fUFJPTVBULFxuICAgICAgICB9LFxuICAgICAgICAuLi50b3BIaXN0b3J5LFxuICAgICAgICB7XG4gICAgICAgICAgcm9sZTogXCJ1c2VyXCIsXG4gICAgICAgICAgY29udGVudDogQ09OVEVYVF9QUk9NUFQoe1xuICAgICAgICAgICAgY29udGV4dCxcbiAgICAgICAgICAgIHVzZXJRdWVzdGlvbjogbGFzdEh1bWFuTWVzc2FnZS5jb250ZW50LFxuICAgICAgICAgICAgdXNlclJvbGUsXG4gICAgICAgICAgfSksXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgICAgbW9kZWw6IGNoYXRBUElNb2RlbCxcbiAgICAgIHN0cmVhbTogdHJ1ZSxcbiAgICAgIC8vIEdQVC00by1taW5p44Gr5pyA6YGp5YyW44GV44KM44Gf44OR44Op44Oh44O844K/XG4gICAgICB0ZW1wZXJhdHVyZTogMC41LCAgLy8g44OJ44Kt44Ol44Oh44Oz44OI5qSc57Si44Gn44Gv5L2O44KB44Gu5rip5bqm44KS6Kit5a6aXG4gICAgICBtYXhfdG9rZW5zOiAxMDAwLFxuICAgICAgdG9wX3A6IDAuOTUsXG4gICAgfSk7XG5cbiAgICBjb25zdCBzdHJlYW0gPSBPcGVuQUlTdHJlYW0ocmVzcG9uc2UsIHtcbiAgICAgIGFzeW5jIG9uQ29tcGxldGlvbihjb21wbGV0aW9uKSB7XG4gICAgICAgIGF3YWl0IGNoYXRIaXN0b3J5LmFkZE1lc3NhZ2Uoe1xuICAgICAgICAgIGNvbnRlbnQ6IGxhc3RIdW1hbk1lc3NhZ2UuY29udGVudCxcbiAgICAgICAgICByb2xlOiBcInVzZXJcIixcbiAgICAgICAgfSk7XG5cbiAgICAgICAgYXdhaXQgY2hhdEhpc3RvcnkuYWRkTWVzc2FnZShcbiAgICAgICAgICB7XG4gICAgICAgICAgICBjb250ZW50OiBjb21wbGV0aW9uLFxuICAgICAgICAgICAgcm9sZTogXCJhc3Npc3RhbnRcIixcbiAgICAgICAgICB9LFxuICAgICAgICAgIGNvbnRleHRcbiAgICAgICAgKTtcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICByZXR1cm4gbmV3IFN0cmVhbWluZ1RleHRSZXNwb25zZShzdHJlYW0pO1xuICB9IGNhdGNoIChlOiB1bmtub3duKSB7XG4gICAgaWYgKGUgaW5zdGFuY2VvZiBFcnJvcikge1xuICAgICAgcmV0dXJuIG5ldyBSZXNwb25zZShlLm1lc3NhZ2UsIHtcbiAgICAgICAgc3RhdHVzOiA1MDAsXG4gICAgICAgIHN0YXR1c1RleHQ6IGUudG9TdHJpbmcoKSxcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gbmV3IFJlc3BvbnNlKFwi5LqI5pyf44Gb44Gs44Ko44Op44O844GM55m655Sf44GX44G+44GX44Gf44CCXCIsIHtcbiAgICAgICAgc3RhdHVzOiA1MDAsXG4gICAgICAgIHN0YXR1c1RleHQ6IFwiVW5rbm93biBFcnJvclwiLFxuICAgICAgfSk7XG4gICAgfVxuICB9XG59O1xuXG4vKipcbiAqIOODpuODvOOCtuODvOOBruizquWVj+OCkuaknOe0ouOBq+acgOmBqeWMluOBleOCjOOBn+OCr+OCqOODquOBq+WkieaPm1xuICovXG5jb25zdCByZWZvcm11bGF0ZVF1ZXJ5ID0gYXN5bmMgKFxuICBvcmlnaW5hbFF1ZXJ5OiBzdHJpbmcsXG4gIG9wZW5BSTogUmV0dXJuVHlwZTx0eXBlb2YgT3BlbkFJSW5zdGFuY2U+LFxuICBtb2RlbDogc3RyaW5nXG4pOiBQcm9taXNlPHN0cmluZz4gPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHJlZm9ybXVsYXRpb25Qcm9tcHQgPSBRVUVSWV9SRUZPUk1VTEFUSU9OX1BST01QVC5yZXBsYWNlKFxuICAgICAgXCJ7dXNlclF1ZXN0aW9ufVwiLFxuICAgICAgb3JpZ2luYWxRdWVyeVxuICAgICk7XG5cbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IG9wZW5BSS5jaGF0LmNvbXBsZXRpb25zLmNyZWF0ZSh7XG4gICAgICBtb2RlbDogbW9kZWwsXG4gICAgICBtZXNzYWdlczogW1xuICAgICAgICB7XG4gICAgICAgICAgcm9sZTogXCJ1c2VyXCIsXG4gICAgICAgICAgY29udGVudDogcmVmb3JtdWxhdGlvblByb21wdCxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgICB0ZW1wZXJhdHVyZTogMC4zLFxuICAgICAgbWF4X3Rva2VuczogMjAwLFxuICAgIH0pO1xuXG4gICAgY29uc3QgY29udGVudCA9IHJlc3BvbnNlLmNob2ljZXNbMF0ubWVzc2FnZS5jb250ZW50IHx8IFwiXCI7XG4gICAgY29uc3QgbWF0Y2ggPSBjb250ZW50Lm1hdGNoKC9PUFRJTUlaRURfUVVFUlk6XFxzKiguKykvKTtcbiAgICBcbiAgICBpZiAobWF0Y2ggJiYgbWF0Y2hbMV0pIHtcbiAgICAgIHJldHVybiBtYXRjaFsxXS50cmltKCk7XG4gICAgfVxuICAgIFxuICAgIGNvbnNvbGUubG9nKFwiUXVlcnkgcmVmb3JtdWxhdGlvbiBmYWlsZWQsIHVzaW5nIG9yaWdpbmFsIHF1ZXJ5XCIpO1xuICAgIHJldHVybiBvcmlnaW5hbFF1ZXJ5O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBpbiBxdWVyeSByZWZvcm11bGF0aW9uOlwiLCBlcnJvcik7XG4gICAgcmV0dXJuIG9yaWdpbmFsUXVlcnk7XG4gIH1cbn07XG5cbi8qKlxuICog5qSc57Si57WQ5p6c44KS5Yem55CG44GX44Gm6Kqt44G/44KE44GZ44GP5qeL6YCg5YyW44GV44KM44Gf44OV44Kp44O844Oe44OD44OI44Gr5aSJ5o+bXG4gKi9cbmNvbnN0IHByb2Nlc3NTZWFyY2hSZXN1bHRzID0gKGRvY3VtZW50czogYW55W10pOiBzdHJpbmcgPT4ge1xuICBpZiAoIWRvY3VtZW50cyB8fCBkb2N1bWVudHMubGVuZ3RoID09PSAwKSB7XG4gICAgcmV0dXJuIFwi6Zai6YCj44GZ44KL44OJ44Kt44Ol44Oh44Oz44OI44Gv6KaL44Gk44GL44KK44G+44Gb44KT44Gn44GX44Gf44CCXCI7XG4gIH1cblxuICByZXR1cm4gZG9jdW1lbnRzXG4gICAgLm1hcCgocmVzdWx0LCBpbmRleCkgPT4ge1xuICAgICAgLy8g44OG44Kt44K544OI5q2j6KaP5YyWOiDmlLnooYzjgoTkvZnliIbjgarjgrnjg5rjg7zjgrnjgpLpganliIfjgavlh6bnkIZcbiAgICAgIGNvbnN0IGNvbnRlbnQgPSByZXN1bHQucGFnZUNvbnRlbnRcbiAgICAgICAgLnJlcGxhY2UoLyhcXHJcXG58XFxufFxccikvZ20sIFwiIFwiKVxuICAgICAgICAucmVwbGFjZSgvXFxzKy9nLCBcIiBcIilcbiAgICAgICAgLnRyaW0oKTtcbiAgICAgIFxuICAgICAgLy8g44Oh44K/44OH44O844K/5Yem55CGXG4gICAgICBjb25zdCBmaWxlTmFtZSA9IHJlc3VsdC5tZXRhZGF0YSB8fCBcIuS4jeaYjuOBquODleOCoeOCpOODq1wiO1xuICAgICAgY29uc3QgZmlsZUlkID0gcmVzdWx0LmlkIHx8IFwi5LiN5piO44GqSURcIjtcbiAgICAgIFxuICAgICAgLy8g44Oe44O844Kv44OA44Km44Oz5b2i5byP44Gn44OV44Kp44O844Oe44OD44OIXG4gICAgICByZXR1cm4gYCMjIOODieOCreODpeODoeODs+ODiCAke2luZGV4ICsgMX1cbioq44OV44Kh44Kk44Or5ZCNKio6ICR7ZmlsZU5hbWV9XG4qKuODleOCoeOCpOODq0lEKio6ICR7ZmlsZUlkfVxuXG4qKuWGheWuuSoqOlxuJHtjb250ZW50fWA7XG4gICAgfSlcbiAgICAuam9pbihcIlxcblxcbi0tLVxcblxcblwiKTtcbn07XG5cbi8qKlxuICog44Om44O844K244O844Gu44Ot44O844Or44KS5Y+W5b6X44GZ44KL6Zai5pWwXG4gKiDlrp/pmpvjga7lrp/oo4XjgavlkIjjgo/jgZvjgabkv67mraPjgYzlv4XopoFcbiAqL1xuY29uc3QgZ2V0VXNlclJvbGUgPSBhc3luYyAodXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPENoYXRBdXRoPiA9PiB7XG4gIC8vIOWun+mam+OBruWun+ijheOBp+OBr+ODpuODvOOCtuODvOODh+ODvOOCv+ODmeODvOOCueOChElE44OX44Ot44OQ44Kk44OA44O844GL44KJ44Ot44O844Or5oOF5aCx44KS5Y+W5b6XXG4gIC8vIOOBk+OBruS+i+OBp+OBr+S7ruOBq0VtcGxveWVl44KS6L+U44GZXG4gIHJldHVybiBcIkVtcGxveWVlXCI7XG59O1xuXG4vKipcbiAqIOODpuODvOOCtuODvOOBruaoqemZkOOBq+WfuuOBpeOBhOOBpuODleOCo+ODq+OCv+ODvOOCkueUn+aIkFxuICovXG5jb25zdCBnZW5lcmF0ZVJvbGVCYXNlZEZpbHRlciA9IChyb2xlOiBDaGF0QXV0aCk6IHN0cmluZyA9PiB7XG4gIHN3aXRjaCAocm9sZSkge1xuICAgIGNhc2UgXCJFeGNlY3RpdmVcIjpcbiAgICAgIC8vIOOCqOOCsOOCvOOCr+ODhuOCo+ODluOBr+WFqOOBpuOBruODieOCreODpeODoeODs+ODiOOBq+OCouOCr+OCu+OCueWPr+iDvVxuICAgICAgcmV0dXJuIGAoQ2hhdEF1dGhfRXhjZWN0aXZlIGVxICd0cnVlJyBvciBDaGF0QXV0aF9NYW5hZ2VyIGVxICd0cnVlJyBvciBDaGF0QXV0aF9FbXBsb3llZSBlcSAndHJ1ZScgb3IgQ2hhdEF1dGhfQ29udHJhY3QgZXEgJ3RydWUnKWA7XG4gICAgY2FzZSBcIk1hbmFnZXJcIjpcbiAgICAgIC8vIOODnuODjeODvOOCuOODo+ODvOOBr+ODnuODjeODvOOCuOODo+ODvOS7peS4i+OBruaoqemZkOOBruODieOCreODpeODoeODs+ODiOOBq+OCouOCr+OCu+OCueWPr+iDvVxuICAgICAgcmV0dXJuIGAoQ2hhdEF1dGhfTWFuYWdlciBlcSAndHJ1ZScgb3IgQ2hhdEF1dGhfRW1wbG95ZWUgZXEgJ3RydWUnIG9yIENoYXRBdXRoX0NvbnRyYWN0IGVxICd0cnVlJylgO1xuICAgIGNhc2UgXCJFbXBsb3llZVwiOlxuICAgICAgLy8g5b6T5qWt5ZOh44Gv5b6T5qWt5ZOh44Go5aWR57SE56S+5ZOh44Gu44OJ44Kt44Ol44Oh44Oz44OI44Gr44Ki44Kv44K744K55Y+v6IO9XG4gICAgICByZXR1cm4gYChDaGF0QXV0aF9FbXBsb3llZSBlcSAndHJ1ZScgb3IgQ2hhdEF1dGhfQ29udHJhY3QgZXEgJ3RydWUnKWA7XG4gICAgY2FzZSBcIkNvbnRyYWN0XCI6XG4gICAgICAvLyDlpZHntITnpL7lk6Hjga/lpZHntITnpL7lk6Hjga7jg4njgq3jg6Xjg6Hjg7Pjg4jjga7jgb/jgavjgqLjgq/jgrvjgrnlj6/og71cbiAgICAgIHJldHVybiBgKENoYXRBdXRoX0NvbnRyYWN0IGVxICd0cnVlJylgO1xuICAgIGRlZmF1bHQ6XG4gICAgICAvLyDjg4fjg5Xjgqnjg6vjg4jjga/mnIDjgoLliLbpmZDjgZXjgozjgZ/jgqLjgq/jgrvjgrlcbiAgICAgIHJldHVybiBgKENoYXRBdXRoX0NvbnRyYWN0IGVxICd0cnVlJylgO1xuICB9XG59O1xuXG4vKipcbiAqIOaoqemZkOOBq+WfuuOBpeOBhOOBn+mWoumAo+ODieOCreODpeODoeODs+ODiOOBruaknOe0olxuICovXG5jb25zdCBmaW5kUmVsZXZhbnREb2N1bWVudHNXaXRoUkJBQyA9IGFzeW5jIChxdWVyeTogc3RyaW5nLCB1c2VyUm9sZTogQ2hhdEF1dGgsIGNoYXRUaHJlYWRJZDogc3RyaW5nKSA9PiB7XG4gIC8vIOODpuODvOOCtuODvOOBruaoqemZkOOBq+WfuuOBpeOBhOOBn+ODleOCo+ODq+OCv+ODvOOCkueUn+aIkFxuICBjb25zdCByb2xlRmlsdGVyID0gZ2VuZXJhdGVSb2xlQmFzZWRGaWx0ZXIodXNlclJvbGUpO1xuXG4gIGNvbnN0IHVzZXJJZCA9IGF3YWl0IHVzZXJIYXNoZWRJZCgpOyAgXG4gIC8vIOWfuuacrOaknOe0ouODleOCo+ODq+OCv+ODvOOBqOODreODvOODq+ODleOCo+ODq+OCv+ODvOOCkue1hOOBv+WQiOOCj+OBm+OCi1xuICBjb25zdCBjb21iaW5lZEZpbHRlciA9IGBjaGF0VHlwZSBlcSAnZGF0YSdgO1xuLy8gIGNvbnN0IGNvbWJpbmVkRmlsdGVyID0gYGNoYXRUeXBlIGVxICdkYXRhJyBhbmQgJHtyb2xlRmlsdGVyfWA7XG4gIFxuICB0cnkge1xuICAgIC8vIOaknOe0ouWun+ihjFxuICAgIGNvbnN0IHJlbGV2YW50RG9jdW1lbnRzID0gYXdhaXQgc2ltaWxhcml0eVNlYXJjaFZlY3RvcldpdGhTY29yZShxdWVyeSwgMTAsIHtcbiAgICAgIGZpbHRlcjogY29tYmluZWRGaWx0ZXIsXG4gICAgfSk7XG4gICAgXG4gICAgLy8g5qSc57Si57WQ5p6c44KS44Gd44Gu44G+44G+6L+U44GZ77yI5LiK5L2NMTDku7bjgYzml6Ljgavlj5blvpfjgZXjgozjgabjgYTjgovvvIlcbiAgICByZXR1cm4gcmVsZXZhbnREb2N1bWVudHM7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcihcIkVycm9yIGluIGRvY3VtZW50IHNlYXJjaCB3aXRoIFJCQUM6XCIsIGVycm9yKTtcbiAgICByZXR1cm4gW107XG4gIH1cbn07Il0sIm5hbWVzIjpbInVzZXJIYXNoZWRJZCIsIk9wZW5BSUluc3RhbmNlIiwiQUlfTkFNRSIsIk9wZW5BSVN0cmVhbSIsIlN0cmVhbWluZ1RleHRSZXNwb25zZSIsInNpbWlsYXJpdHlTZWFyY2hWZWN0b3JXaXRoU2NvcmUiLCJpbml0QW5kR3VhcmRDaGF0U2Vzc2lvbiIsIkNvc21vc0RCQ2hhdE1lc3NhZ2VIaXN0b3J5IiwiU1lTVEVNX1BST01QVCIsIlFVRVJZX1JFRk9STVVMQVRJT05fUFJPTVBUIiwiQ09OVEVYVF9QUk9NUFQiLCJjb250ZXh0IiwidXNlclF1ZXN0aW9uIiwidXNlclJvbGUiLCJDaGF0QVBJRG9jIiwicHJvcHMiLCJsYXN0SHVtYW5NZXNzYWdlIiwiaWQiLCJjaGF0VGhyZWFkIiwib3BlbkFJIiwidXNlcklkIiwiZ2V0VXNlclJvbGUiLCJjaGF0QVBJTW9kZWwiLCJjaGF0SGlzdG9yeSIsInNlc3Npb25JZCIsImhpc3RvcnkiLCJnZXRNZXNzYWdlcyIsInRvcEhpc3RvcnkiLCJzbGljZSIsIk1hdGgiLCJtYXgiLCJsZW5ndGgiLCJvcHRpbWl6ZWRRdWVyeSIsInJlZm9ybXVsYXRlUXVlcnkiLCJjb250ZW50IiwicmVsZXZhbnREb2N1bWVudHMiLCJmaW5kUmVsZXZhbnREb2N1bWVudHNXaXRoUkJBQyIsIm5vUmVzdWx0c1Jlc3BvbnNlIiwiY2hhdCIsImNvbXBsZXRpb25zIiwiY3JlYXRlIiwibWVzc2FnZXMiLCJyb2xlIiwibW9kZWwiLCJzdHJlYW0iLCJvbkNvbXBsZXRpb24iLCJjb21wbGV0aW9uIiwiYWRkTWVzc2FnZSIsInByb2Nlc3NTZWFyY2hSZXN1bHRzIiwicmVzcG9uc2UiLCJ0ZW1wZXJhdHVyZSIsIm1heF90b2tlbnMiLCJ0b3BfcCIsImUiLCJFcnJvciIsIlJlc3BvbnNlIiwibWVzc2FnZSIsInN0YXR1cyIsInN0YXR1c1RleHQiLCJ0b1N0cmluZyIsIm9yaWdpbmFsUXVlcnkiLCJyZWZvcm11bGF0aW9uUHJvbXB0IiwicmVwbGFjZSIsImNob2ljZXMiLCJtYXRjaCIsInRyaW0iLCJjb25zb2xlIiwibG9nIiwiZXJyb3IiLCJkb2N1bWVudHMiLCJtYXAiLCJyZXN1bHQiLCJpbmRleCIsInBhZ2VDb250ZW50IiwiZmlsZU5hbWUiLCJtZXRhZGF0YSIsImZpbGVJZCIsImpvaW4iLCJnZW5lcmF0ZVJvbGVCYXNlZEZpbHRlciIsInF1ZXJ5IiwiY2hhdFRocmVhZElkIiwicm9sZUZpbHRlciIsImNvbWJpbmVkRmlsdGVyIiwiZmlsdGVyIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./features/chat/chat-services/chat-api-doc.ts\n");

/***/ }),

/***/ "(rsc)/./features/chat/chat-services/chat-api-entry.ts":
/*!*******************************************************!*\
  !*** ./features/chat/chat-services/chat-api-entry.ts ***!
  \*******************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   chatAPIEntry: () => (/* binding */ chatAPIEntry)\n/* harmony export */ });\n/* harmony import */ var _chat_api_data__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./chat-api-data */ \"(rsc)/./features/chat/chat-services/chat-api-data.ts\");\n/* harmony import */ var _chat_api_doc__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./chat-api-doc */ \"(rsc)/./features/chat/chat-services/chat-api-doc.ts\");\n/* harmony import */ var _chat_api_simple__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./chat-api-simple */ \"(rsc)/./features/chat/chat-services/chat-api-simple.ts\");\n/* harmony import */ var _chat_api_web__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./chat-api-web */ \"(rsc)/./features/chat/chat-services/chat-api-web.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_chat_api_web__WEBPACK_IMPORTED_MODULE_3__]);\n_chat_api_web__WEBPACK_IMPORTED_MODULE_3__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\nconst chatAPIEntry = async (props)=>{\n    if (props.chatType === \"simple\") {\n        return await (0,_chat_api_simple__WEBPACK_IMPORTED_MODULE_2__.ChatAPISimple)(props);\n    } else if (props.chatType === \"web\") {\n        return await (0,_chat_api_web__WEBPACK_IMPORTED_MODULE_3__.ChatAPIWeb)(props);\n    } else if (props.chatType === \"data\") {\n        return await (0,_chat_api_data__WEBPACK_IMPORTED_MODULE_0__.ChatAPIData)(props);\n    } else if (props.chatType === \"doc\") {\n        return await (0,_chat_api_doc__WEBPACK_IMPORTED_MODULE_1__.ChatAPIDoc)(props);\n    } else if (props.chatType === \"mssql\") {\n        return await (0,_chat_api_data__WEBPACK_IMPORTED_MODULE_0__.ChatAPIData)(props);\n    } else {\n        return await (0,_chat_api_simple__WEBPACK_IMPORTED_MODULE_2__.ChatAPISimple)(props);\n    }\n};\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9mZWF0dXJlcy9jaGF0L2NoYXQtc2VydmljZXMvY2hhdC1hcGktZW50cnkudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBOEM7QUFDRjtBQUNNO0FBQ047QUFHckMsTUFBTUksZUFBZSxPQUFPQztJQUNqQyxJQUFJQSxNQUFNQyxRQUFRLEtBQUssVUFBVTtRQUMvQixPQUFPLE1BQU1KLCtEQUFhQSxDQUFDRztJQUM3QixPQUFPLElBQUlBLE1BQU1DLFFBQVEsS0FBSyxPQUFPO1FBQ25DLE9BQU8sTUFBTUgseURBQVVBLENBQUNFO0lBQzFCLE9BQU8sSUFBSUEsTUFBTUMsUUFBUSxLQUFLLFFBQVE7UUFDcEMsT0FBTyxNQUFNTiwyREFBV0EsQ0FBQ0s7SUFDM0IsT0FBTyxJQUFJQSxNQUFNQyxRQUFRLEtBQUssT0FBTztRQUNuQyxPQUFPLE1BQU1MLHlEQUFVQSxDQUFDSTtJQUMxQixPQUFPLElBQUlBLE1BQU1DLFFBQVEsS0FBSyxTQUFTO1FBQ3JDLE9BQU8sTUFBTU4sMkRBQVdBLENBQUNLO0lBQzNCLE9BQU87UUFDTCxPQUFPLE1BQU1ILCtEQUFhQSxDQUFDRztJQUM3QjtBQUNGLEVBQUUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9henVyZS1vcGVuLWFpLWFjY2VsZXJhdG9yLy4vZmVhdHVyZXMvY2hhdC9jaGF0LXNlcnZpY2VzL2NoYXQtYXBpLWVudHJ5LnRzPzIxNmIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ2hhdEFQSURhdGEgfSBmcm9tIFwiLi9jaGF0LWFwaS1kYXRhXCI7XG5pbXBvcnQgeyBDaGF0QVBJRG9jIH0gZnJvbSBcIi4vY2hhdC1hcGktZG9jXCI7XG5pbXBvcnQgeyBDaGF0QVBJU2ltcGxlIH0gZnJvbSBcIi4vY2hhdC1hcGktc2ltcGxlXCI7XG5pbXBvcnQgeyBDaGF0QVBJV2ViIH0gZnJvbSBcIi4vY2hhdC1hcGktd2ViXCI7XG5pbXBvcnQgeyBQcm9tcHRHUFRQcm9wcyB9IGZyb20gXCIuL21vZGVsc1wiO1xuXG5leHBvcnQgY29uc3QgY2hhdEFQSUVudHJ5ID0gYXN5bmMgKHByb3BzOiBQcm9tcHRHUFRQcm9wcykgPT4ge1xuICBpZiAocHJvcHMuY2hhdFR5cGUgPT09IFwic2ltcGxlXCIpIHtcbiAgICByZXR1cm4gYXdhaXQgQ2hhdEFQSVNpbXBsZShwcm9wcyk7XG4gIH0gZWxzZSBpZiAocHJvcHMuY2hhdFR5cGUgPT09IFwid2ViXCIpIHtcbiAgICByZXR1cm4gYXdhaXQgQ2hhdEFQSVdlYihwcm9wcyk7XG4gIH0gZWxzZSBpZiAocHJvcHMuY2hhdFR5cGUgPT09IFwiZGF0YVwiKSB7XG4gICAgcmV0dXJuIGF3YWl0IENoYXRBUElEYXRhKHByb3BzKTtcbiAgfSBlbHNlIGlmIChwcm9wcy5jaGF0VHlwZSA9PT0gXCJkb2NcIikge1xuICAgIHJldHVybiBhd2FpdCBDaGF0QVBJRG9jKHByb3BzKTtcbiAgfSBlbHNlIGlmIChwcm9wcy5jaGF0VHlwZSA9PT0gXCJtc3NxbFwiKSB7XG4gICAgcmV0dXJuIGF3YWl0IENoYXRBUElEYXRhKHByb3BzKTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gYXdhaXQgQ2hhdEFQSVNpbXBsZShwcm9wcyk7XG4gIH1cbn07Il0sIm5hbWVzIjpbIkNoYXRBUElEYXRhIiwiQ2hhdEFQSURvYyIsIkNoYXRBUElTaW1wbGUiLCJDaGF0QVBJV2ViIiwiY2hhdEFQSUVudHJ5IiwicHJvcHMiLCJjaGF0VHlwZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./features/chat/chat-services/chat-api-entry.ts\n");

/***/ }),

/***/ "(rsc)/./features/chat/chat-services/chat-api-simple.ts":
/*!********************************************************!*\
  !*** ./features/chat/chat-services/chat-api-simple.ts ***!
  \********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ChatAPISimple: () => (/* binding */ ChatAPISimple)\n/* harmony export */ });\n/* harmony import */ var _features_auth_helpers__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/features/auth/helpers */ \"(rsc)/./features/auth/helpers.ts\");\n/* harmony import */ var _features_theme_customise__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/features/theme/customise */ \"(rsc)/./features/theme/customise.ts\");\n/* harmony import */ var ai__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ai */ \"(rsc)/./node_modules/ai/dist/index.mjs\");\n/* harmony import */ var _chat_thread_service__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./chat-thread-service */ \"(rsc)/./features/chat/chat-services/chat-thread-service.ts\");\n/* harmony import */ var _cosmosdb_cosmosdb__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./cosmosdb/cosmosdb */ \"(rsc)/./features/chat/chat-services/cosmosdb/cosmosdb.ts\");\n/* harmony import */ var openai__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! openai */ \"(rsc)/./node_modules/openai/index.mjs\");\n\n\n\n\n\n\nconst ChatAPISimple = async (props)=>{\n    const { lastHumanMessage, chatThread } = await (0,_chat_thread_service__WEBPACK_IMPORTED_MODULE_2__.initAndGuardChatSession)(props);\n    const userId = await (0,_features_auth_helpers__WEBPACK_IMPORTED_MODULE_0__.userHashedId)();\n    const chatHistory = new _cosmosdb_cosmosdb__WEBPACK_IMPORTED_MODULE_3__.CosmosDBChatMessageHistory({\n        sessionId: chatThread.id,\n        userId: userId\n    });\n    await chatHistory.addMessage({\n        content: lastHumanMessage.content,\n        role: \"user\"\n    });\n    const history = await chatHistory.getMessages();\n    const topHistory = history.slice(history.length - 30, history.length);\n    try {\n        // \n        const isImageGenerationRequest = checkIfImageGenerationRequest(lastHumanMessage.content);\n        if (isImageGenerationRequest) {\n            try {\n                // \n                // \n                const dalleEndpoint = \"https://noka-m7xtz7xj-swedencentral.cognitiveservices.azure.com/\";\n                const dalleDeploymentName = \"dall-e-3\";\n                const dalleApiVersion = \"2024-02-01\";\n                // DALL-EAPI\n                const dalleApiKey = process.env.AZURE_OPENAI_DALLE_API_KEY;\n                if (!dalleApiKey) {\n                    throw new Error(\"Azure OpenAI DALL-EAPIAZURE_OPENAI_DALLE_API_KEY \");\n                }\n                // \n                // fetch API\n                const endpoint = `${dalleEndpoint}openai/deployments/${dalleDeploymentName}/images/generations?api-version=${dalleApiVersion}`;\n                // \n                const response = await fetch(endpoint, {\n                    method: \"POST\",\n                    headers: {\n                        \"Content-Type\": \"application/json\",\n                        \"api-key\": dalleApiKey\n                    },\n                    body: JSON.stringify({\n                        prompt: lastHumanMessage.content,\n                        n: 1,\n                        size: \"1024x1024\"\n                    })\n                });\n                if (!response.ok) {\n                    const errorText = await response.text();\n                    // API\n                    throw new Error(`API: ${response.status} ${errorText}`);\n                }\n                const imageData = await response.json();\n                //  API \n                // OpenAI\n                /* \n        const dalleClient = new OpenAI({\n          apiKey: apiKey,\n          baseURL: `${dalleEndpoint}openai/deployments/${dalleDeploymentName}`,\n          defaultQuery: { \"api-version\": dalleApiVersion },\n          defaultHeaders: { \"api-key\": apiKey },\n        });\n        */ //  URL  - Azure OpenAI\n                const imageUrl = imageData.data?.[0]?.url;\n                if (imageUrl) {\n                    //  URL \n                    const imageCompletion = `![](${imageUrl})`;\n                    // \n                    await chatHistory.addMessage({\n                        content: imageCompletion,\n                        role: \"assistant\"\n                    });\n                    //  URL \n                    // return new Response(JSON.stringify({ type: \"image\", url: imageUrl,text:\"l\" }), {\n                    //   headers: { \"Content-Type\": \"application/json\" },\n                    // });          \n                    return new Response(imageCompletion, {\n                        headers: {\n                            \"Content-Type\": \"application/json\"\n                        }\n                    });\n                    //   return new Response(JSON.stringify({ type: \"image\", url: imageUrl, text: imageCompletion }), {\n                    //     headers: { \"Content-Type\": \"application/json\" },\n                    //   });\n                    // } else {\n                    throw new Error(\" URL \");\n                }\n            } catch (imageError) {\n                // \n                // \n                const errorMessage = \"\";\n                // \n                await chatHistory.addMessage({\n                    content: errorMessage,\n                    role: \"assistant\"\n                });\n            // \n            }\n        }\n        // \n        let chatDeploymentName = \"\";\n        if (props.chatAPIModel === \"Current_Version\") {\n            // Azure OpenAI Service \n            chatDeploymentName = process.env.AZURE_OPENAI_GPT_DEPLOYMENT_NAME || \"gpt-4o-mini\";\n        } else {\n            chatDeploymentName = \"o1-mini\"; // Current_Version  o1-mini \n        }\n        // \n        // Azure OpenAI\n        const endpoint = process.env.AZURE_OPENAI_ENDPOINT;\n        const apiKey = process.env.AZURE_OPENAI_API_KEY;\n        const apiVersion = process.env.OPENAI_API_VERSION || \"2023-05-15\";\n        if (!endpoint || !apiKey) {\n            throw new Error(\"Azure OpenAIAZURE_OPENAI_ENDPOINT  AZURE_OPENAI_API_KEY \");\n        }\n        // OpenAI\n        const chatClient = new openai__WEBPACK_IMPORTED_MODULE_4__[\"default\"]({\n            apiKey: apiKey,\n            baseURL: `${endpoint}openai/deployments/${chatDeploymentName}`,\n            defaultQuery: {\n                \"api-version\": apiVersion\n            },\n            defaultHeaders: {\n                \"api-key\": apiKey\n            }\n        });\n        // \n        const systemPrompt = ` ${_features_theme_customise__WEBPACK_IMPORTED_MODULE_1__.AI_NAME} \n- \n- \n- \n- \n- \n- `;\n        // \n        const response = await chatClient.chat.completions.create({\n            messages: [\n                {\n                    role: \"system\",\n                    content: systemPrompt\n                },\n                ...topHistory\n            ],\n            model: chatDeploymentName,\n            stream: true\n        });\n        const stream = (0,ai__WEBPACK_IMPORTED_MODULE_5__.OpenAIStream)(response, {\n            async onCompletion (completion) {\n                await chatHistory.addMessage({\n                    content: completion,\n                    role: \"assistant\"\n                });\n            }\n        });\n        return new ai__WEBPACK_IMPORTED_MODULE_5__.StreamingTextResponse(stream);\n    } catch (e) {\n        // \n        if (e instanceof Error) {\n            return new Response(e.message, {\n                status: 500,\n                statusText: e.toString()\n            });\n        } else {\n            return new Response(\"An unknown error occurred.\", {\n                status: 500,\n                statusText: \"Unknown Error\"\n            });\n        }\n    }\n};\n/**\n * \n */ function checkIfImageGenerationRequest(content) {\n    const imageGenerationKeywords = [\n        \"\",\n        \"\",\n        \"\",\n        \"\",\n        \"\",\n        \"\",\n        \"\",\n        \"\",\n        \"\",\n        \"\",\n        \"\",\n        \"\",\n        \"visualize\",\n        \"draw\",\n        \"generate image\"\n    ];\n    const lowerContent = content.toLowerCase();\n    return imageGenerationKeywords.some((keyword)=>lowerContent.includes(keyword));\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9mZWF0dXJlcy9jaGF0L2NoYXQtc2VydmljZXMvY2hhdC1hcGktc2ltcGxlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFBdUQ7QUFDRjtBQUNJO0FBQ087QUFDQztBQUVyQztBQUVyQixNQUFNTyxnQkFBZ0IsT0FBT0M7SUFDbEMsTUFBTSxFQUFFQyxnQkFBZ0IsRUFBRUMsVUFBVSxFQUFFLEdBQUcsTUFBTU4sNkVBQXVCQSxDQUFDSTtJQUN2RSxNQUFNRyxTQUFTLE1BQU1YLG9FQUFZQTtJQUNqQyxNQUFNWSxjQUFjLElBQUlQLDBFQUEwQkEsQ0FBQztRQUNqRFEsV0FBV0gsV0FBV0ksRUFBRTtRQUN4QkgsUUFBUUE7SUFDVjtJQUVBLE1BQU1DLFlBQVlHLFVBQVUsQ0FBQztRQUMzQkMsU0FBU1AsaUJBQWlCTyxPQUFPO1FBQ2pDQyxNQUFNO0lBQ1I7SUFFQSxNQUFNQyxVQUFVLE1BQU1OLFlBQVlPLFdBQVc7SUFDN0MsTUFBTUMsYUFBYUYsUUFBUUcsS0FBSyxDQUFDSCxRQUFRSSxNQUFNLEdBQUcsSUFBSUosUUFBUUksTUFBTTtJQUVwRSxJQUFJO1FBQ0YsaUJBQWlCO1FBQ2pCLE1BQU1DLDJCQUEyQkMsOEJBQThCZixpQkFBaUJPLE9BQU87UUFFdkYsSUFBSU8sMEJBQTBCO1lBQzVCLElBQUk7Z0JBQ0YsZUFBZTtnQkFFZixvQkFBb0I7Z0JBQ3BCLE1BQU1FLGdCQUFnQjtnQkFDdEIsTUFBTUMsc0JBQXNCO2dCQUM1QixNQUFNQyxrQkFBa0I7Z0JBRXhCLG9CQUFvQjtnQkFDcEIsTUFBTUMsY0FBY0MsUUFBUUMsR0FBRyxDQUFDQywwQkFBMEI7Z0JBRTFELElBQUksQ0FBQ0gsYUFBYTtvQkFDaEIsTUFBTSxJQUFJSSxNQUFNO2dCQUNsQjtnQkFFQSxtQkFBbUI7Z0JBRW5CLCtCQUErQjtnQkFDL0IsTUFBTUMsV0FBVyxDQUFDLEVBQUVSLGNBQWMsbUJBQW1CLEVBQUVDLG9CQUFvQixnQ0FBZ0MsRUFBRUMsZ0JBQWdCLENBQUM7Z0JBQzlI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QkFDckNqRDthQUNKO1lBQ0RzRCxPQUFPakI7WUFDUGtCLFFBQVE7UUFDVjtRQUVBLE1BQU1BLFNBQVN6RSxnREFBWUEsQ0FBQ2dDLFVBQVU7WUFDcEMsTUFBTTBDLGNBQWFDLFVBQVU7Z0JBQzNCLE1BQU1qRSxZQUFZRyxVQUFVLENBQUM7b0JBQzNCQyxTQUFTNkQ7b0JBQ1Q1RCxNQUFNO2dCQUNSO1lBQ0Y7UUFDRjtRQUVBLE9BQU8sSUFBSWQscURBQXFCQSxDQUFDd0U7SUFDbkMsRUFBRSxPQUFPRyxHQUFZO1FBQ25CLFlBQVk7UUFFWixJQUFJQSxhQUFhOUMsT0FBTztZQUN0QixPQUFPLElBQUlzQixTQUFTd0IsRUFBRUMsT0FBTyxFQUFFO2dCQUM3QmhDLFFBQVE7Z0JBQ1JpQyxZQUFZRixFQUFFRyxRQUFRO1lBQ3hCO1FBQ0YsT0FBTztZQUNMLE9BQU8sSUFBSTNCLFNBQVMsOEJBQThCO2dCQUNoRFAsUUFBUTtnQkFDUmlDLFlBQVk7WUFDZDtRQUNGO0lBQ0Y7QUFDRixFQUFFO0FBRUY7O0NBRUMsR0FDRCxTQUFTeEQsOEJBQThCUixPQUFlO0lBQ3BELE1BQU1rRSwwQkFBMEI7UUFDOUI7UUFBUztRQUFTO1FBQVk7UUFBUztRQUN2QztRQUFPO1FBQVM7UUFBVztRQUFRO1FBQ25DO1FBQVM7UUFBUTtRQUFhO1FBQVE7S0FDdkM7SUFFRCxNQUFNQyxlQUFlbkUsUUFBUW9FLFdBQVc7SUFDeEMsT0FBT0Ysd0JBQXdCRyxJQUFJLENBQUNDLENBQUFBLFVBQVdILGFBQWFJLFFBQVEsQ0FBQ0Q7QUFDdkUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9henVyZS1vcGVuLWFpLWFjY2VsZXJhdG9yLy4vZmVhdHVyZXMvY2hhdC9jaGF0LXNlcnZpY2VzL2NoYXQtYXBpLXNpbXBsZS50cz84MDYzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHVzZXJIYXNoZWRJZCB9IGZyb20gXCJAL2ZlYXR1cmVzL2F1dGgvaGVscGVyc1wiO1xuaW1wb3J0IHsgQUlfTkFNRSB9IGZyb20gXCJAL2ZlYXR1cmVzL3RoZW1lL2N1c3RvbWlzZVwiO1xuaW1wb3J0IHsgT3BlbkFJU3RyZWFtLCBTdHJlYW1pbmdUZXh0UmVzcG9uc2UgfSBmcm9tIFwiYWlcIjtcbmltcG9ydCB7IGluaXRBbmRHdWFyZENoYXRTZXNzaW9uIH0gZnJvbSBcIi4vY2hhdC10aHJlYWQtc2VydmljZVwiO1xuaW1wb3J0IHsgQ29zbW9zREJDaGF0TWVzc2FnZUhpc3RvcnkgfSBmcm9tIFwiLi9jb3Ntb3NkYi9jb3Ntb3NkYlwiO1xuaW1wb3J0IHsgUHJvbXB0R1BUUHJvcHMgfSBmcm9tIFwiLi9tb2RlbHNcIjtcbmltcG9ydCBPcGVuQUkgZnJvbSBcIm9wZW5haVwiO1xuXG5leHBvcnQgY29uc3QgQ2hhdEFQSVNpbXBsZSA9IGFzeW5jIChwcm9wczogUHJvbXB0R1BUUHJvcHMpID0+IHtcbiAgY29uc3QgeyBsYXN0SHVtYW5NZXNzYWdlLCBjaGF0VGhyZWFkIH0gPSBhd2FpdCBpbml0QW5kR3VhcmRDaGF0U2Vzc2lvbihwcm9wcyk7XG4gIGNvbnN0IHVzZXJJZCA9IGF3YWl0IHVzZXJIYXNoZWRJZCgpO1xuICBjb25zdCBjaGF0SGlzdG9yeSA9IG5ldyBDb3Ntb3NEQkNoYXRNZXNzYWdlSGlzdG9yeSh7XG4gICAgc2Vzc2lvbklkOiBjaGF0VGhyZWFkLmlkLFxuICAgIHVzZXJJZDogdXNlcklkLFxuICB9KTtcblxuICBhd2FpdCBjaGF0SGlzdG9yeS5hZGRNZXNzYWdlKHtcbiAgICBjb250ZW50OiBsYXN0SHVtYW5NZXNzYWdlLmNvbnRlbnQsXG4gICAgcm9sZTogXCJ1c2VyXCIsXG4gIH0pO1xuXG4gIGNvbnN0IGhpc3RvcnkgPSBhd2FpdCBjaGF0SGlzdG9yeS5nZXRNZXNzYWdlcygpO1xuICBjb25zdCB0b3BIaXN0b3J5ID0gaGlzdG9yeS5zbGljZShoaXN0b3J5Lmxlbmd0aCAtIDMwLCBoaXN0b3J5Lmxlbmd0aCk7XG5cbiAgdHJ5IHtcbiAgICAvLyDnlLvlg4/nlJ/miJDjgYzlv4XopoHjgYvjganjgYbjgYvjgpLliKTmlq1cbiAgICBjb25zdCBpc0ltYWdlR2VuZXJhdGlvblJlcXVlc3QgPSBjaGVja0lmSW1hZ2VHZW5lcmF0aW9uUmVxdWVzdChsYXN0SHVtYW5NZXNzYWdlLmNvbnRlbnQpO1xuICAgIFxuICAgIGlmIChpc0ltYWdlR2VuZXJhdGlvblJlcXVlc3QpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIC8vIOeUu+WDj+eUn+aIkOODquOCr+OCqOOCueODiOOCkuWHpueQhlxuICAgICAgICBcbiAgICAgICAgLy8g5Zu65a6a44Gu55S75YOP55Sf5oiQ44Ko44Oz44OJ44Od44Kk44Oz44OI44KS5L2/55SoXG4gICAgICAgIGNvbnN0IGRhbGxlRW5kcG9pbnQgPSBcImh0dHBzOi8vbm9rYS1tN3h0ejd4ai1zd2VkZW5jZW50cmFsLmNvZ25pdGl2ZXNlcnZpY2VzLmF6dXJlLmNvbS9cIjtcbiAgICAgICAgY29uc3QgZGFsbGVEZXBsb3ltZW50TmFtZSA9IFwiZGFsbC1lLTNcIjtcbiAgICAgICAgY29uc3QgZGFsbGVBcGlWZXJzaW9uID0gXCIyMDI0LTAyLTAxXCI7XG4gICAgICAgIFxuICAgICAgICAvLyBEQUxMLUXlsILnlKjjga5BUEnjgq3jg7zjgpLlj5blvpdcbiAgICAgICAgY29uc3QgZGFsbGVBcGlLZXkgPSBwcm9jZXNzLmVudi5BWlVSRV9PUEVOQUlfREFMTEVfQVBJX0tFWTtcbiAgICAgICAgXG4gICAgICAgIGlmICghZGFsbGVBcGlLZXkpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJBenVyZSBPcGVuQUkgREFMTC1F55So44GuQVBJ44Kt44O844GM6Kit5a6a44GV44KM44Gm44GE44G+44Gb44KT44CCQVpVUkVfT1BFTkFJX0RBTExFX0FQSV9LRVkg44KS6Kit5a6a44GX44Gm44GP44Gg44GV44GE44CCXCIpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAvLyDjg4fjg5fjg63jgqTjg6Hjg7Pjg4jlkI3jgafnlLvlg4/nlJ/miJDjgpLplovlp4tcbiAgICAgICAgXG4gICAgICAgIC8vIOebtOaOpWZldGNoIEFQSeOCkuS9v+eUqOOBl+OBpueUu+WDj+eUn+aIkOODquOCr+OCqOOCueODiOOCkumAgeS/oVxuICAgICAgICBjb25zdCBlbmRwb2ludCA9IGAke2RhbGxlRW5kcG9pbnR9b3BlbmFpL2RlcGxveW1lbnRzLyR7ZGFsbGVEZXBsb3ltZW50TmFtZX0vaW1hZ2VzL2dlbmVyYXRpb25zP2FwaS12ZXJzaW9uPSR7ZGFsbGVBcGlWZXJzaW9ufWA7XG4gICAgICAgIC8vIOOCqOODs+ODieODneOCpOODs+ODiOOBq+ODquOCr+OCqOOCueODiOmAgeS/oVxuICAgICAgICBcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChlbmRwb2ludCwge1xuICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICAgICAgICAnYXBpLWtleSc6IGRhbGxlQXBpS2V5XG4gICAgICAgICAgfSxcbiAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICBwcm9tcHQ6IGxhc3RIdW1hbk1lc3NhZ2UuY29udGVudCxcbiAgICAgICAgICAgIG46IDEsXG4gICAgICAgICAgICBzaXplOiAnMTAyNHgxMDI0J1xuICAgICAgICAgIH0pXG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgICAgIGNvbnN0IGVycm9yVGV4dCA9IGF3YWl0IHJlc3BvbnNlLnRleHQoKTtcbiAgICAgICAgICAvLyBBUEnlv5znrZTjgqjjg6njg7zlh6bnkIZcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYOeUu+WDj+eUn+aIkEFQSeOCqOODqeODvDogJHtyZXNwb25zZS5zdGF0dXN9ICR7ZXJyb3JUZXh0fWApO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBjb25zdCBpbWFnZURhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgICAgIC8vIOeUu+WDj+eUn+aIkCBBUEkg44Gu5b+c562U44KS5Y+X5L+hXG4gICAgICAgIFxuICAgICAgICAvLyBPcGVuQUnjgq/jg6njgqTjgqLjg7Pjg4jjga/kvb/nlKjjgZfjgarjgYRcbiAgICAgICAgLyogXG4gICAgICAgIGNvbnN0IGRhbGxlQ2xpZW50ID0gbmV3IE9wZW5BSSh7XG4gICAgICAgICAgYXBpS2V5OiBhcGlLZXksXG4gICAgICAgICAgYmFzZVVSTDogYCR7ZGFsbGVFbmRwb2ludH1vcGVuYWkvZGVwbG95bWVudHMvJHtkYWxsZURlcGxveW1lbnROYW1lfWAsXG4gICAgICAgICAgZGVmYXVsdFF1ZXJ5OiB7IFwiYXBpLXZlcnNpb25cIjogZGFsbGVBcGlWZXJzaW9uIH0sXG4gICAgICAgICAgZGVmYXVsdEhlYWRlcnM6IHsgXCJhcGkta2V5XCI6IGFwaUtleSB9LFxuICAgICAgICB9KTtcbiAgICAgICAgKi9cbiAgICAgICAgXG4gICAgICAgIC8vIOeUu+WDjyBVUkwg44KS5Y+W5b6XIC0g5b+c562U44Gu5b2i5byP44GvQXp1cmUgT3BlbkFJ5Zu65pyJ44Gu44KC44Gu44Go44Gq44KLXG4gICAgICAgIGNvbnN0IGltYWdlVXJsID0gaW1hZ2VEYXRhLmRhdGE/LlswXT8udXJsO1xuICAgICAgICBcbiAgICAgICAgaWYgKGltYWdlVXJsKSB7XG4gICAgICAgICAgLy8g55S75YOPIFVSTCDjgpLlj5blvpdcbiAgICAgICAgICBcbiAgICAgICAgICBjb25zdCBpbWFnZUNvbXBsZXRpb24gPSBgIVvnlJ/miJDnlLvlg49dKCR7aW1hZ2VVcmx9KWA7XG4gICAgICAgICAgXG4gICAgICAgICAgLy8g5bGl5q2044Gr55S75YOP55Sf5oiQ57WQ5p6c44KS6L+95YqgXG4gICAgICAgICAgYXdhaXQgY2hhdEhpc3RvcnkuYWRkTWVzc2FnZSh7XG4gICAgICAgICAgICBjb250ZW50OiBpbWFnZUNvbXBsZXRpb24sXG4gICAgICAgICAgICByb2xlOiBcImFzc2lzdGFudFwiLFxuICAgICAgICAgIH0pO1xuICAgICAgICAgIFxuICAgICAgICAgIC8vIOeUu+WDjyBVUkwg44KS44Os44K544Od44Oz44K544Go44GX44Gm6L+U44GZXG4gICAgICAgICAgLy8gcmV0dXJuIG5ldyBSZXNwb25zZShKU09OLnN0cmluZ2lmeSh7IHR5cGU6IFwiaW1hZ2VcIiwgdXJsOiBpbWFnZVVybCx0ZXh0OlwibFwiIH0pLCB7XG4gICAgICAgICAgLy8gICBoZWFkZXJzOiB7IFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiIH0sXG4gICAgICAgICAgLy8gfSk7ICAgICAgICAgIFxuICAgICAgICAgIHJldHVybiBuZXcgUmVzcG9uc2UoKGltYWdlQ29tcGxldGlvbiksIHtcbiAgICAgICAgICAgIGhlYWRlcnM6IHsgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIgfSxcbiAgICAgICAgICB9KTtcbiAgICAgICAgLy8gICByZXR1cm4gbmV3IFJlc3BvbnNlKEpTT04uc3RyaW5naWZ5KHsgdHlwZTogXCJpbWFnZVwiLCB1cmw6IGltYWdlVXJsLCB0ZXh0OiBpbWFnZUNvbXBsZXRpb24gfSksIHtcbiAgICAgICAgLy8gICAgIGhlYWRlcnM6IHsgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIgfSxcbiAgICAgICAgLy8gICB9KTtcbiAgICAgICAgLy8gfSBlbHNlIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCLnlLvlg48gVVJMIOOBjOWPluW+l+OBp+OBjeOBvuOBm+OCk+OBp+OBl+OBn1wiKTtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoaW1hZ2VFcnJvcikge1xuICAgICAgICAvLyDnlLvlg4/nlJ/miJDjgqjjg6njg7zlh6bnkIZcbiAgICAgICAgXG4gICAgICAgIC8vIOOCqOODqeODvOODoeODg+OCu+ODvOOCuOOCkuODpuODvOOCtuODvOOBq+i/lOOBmVxuICAgICAgICBjb25zdCBlcnJvck1lc3NhZ2UgPSBcIueUu+WDj+eUn+aIkOapn+iDveOBr+ePvuWcqOWIqeeUqOOBp+OBjeOBvuOBm+OCk+OAguODhuOCreOCueODiOOBq+OCiOOCi+WbnuetlOOBq+WIh+OCiuabv+OBiOOBvuOBmeOAglwiO1xuICAgICAgICBcbiAgICAgICAgLy8g5bGl5q2044Gr44Ko44Op44O844Oh44OD44K744O844K444KS6L+95YqgXG4gICAgICAgIGF3YWl0IGNoYXRIaXN0b3J5LmFkZE1lc3NhZ2Uoe1xuICAgICAgICAgIGNvbnRlbnQ6IGVycm9yTWVzc2FnZSxcbiAgICAgICAgICByb2xlOiBcImFzc2lzdGFudFwiLFxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIC8vIOODhuOCreOCueODiOW/nOetlOOBq+ODleOCqeODvOODq+ODkOODg+OCr1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIOODouODh+ODq+mBuOaKnuODreOCuOODg+OCr1xuICAgIGxldCBjaGF0RGVwbG95bWVudE5hbWUgPSBcIlwiO1xuICAgIGlmIChwcm9wcy5jaGF0QVBJTW9kZWwgPT09IFwiQ3VycmVudF9WZXJzaW9uXCIpIHtcbiAgICAgIC8vIEF6dXJlIE9wZW5BSSBTZXJ2aWNlIOOBruODh+ODl+ODreOCpOODoeODs+ODiOWQjeOCkuS9v+eUqFxuICAgICAgY2hhdERlcGxveW1lbnROYW1lID0gcHJvY2Vzcy5lbnYuQVpVUkVfT1BFTkFJX0dQVF9ERVBMT1lNRU5UX05BTUUgfHwgXCJncHQtNG8tbWluaVwiO1xuICAgIH0gZWxzZSB7XG4gICAgICBjaGF0RGVwbG95bWVudE5hbWUgPSBcIm8xLW1pbmlcIjsgLy8gQ3VycmVudF9WZXJzaW9uIOOBp+OBquOBhOWgtOWQiOOBryBvMS1taW5pIOOCkuS9v+eUqFxuICAgIH1cbiAgICBcbiAgICAvLyDjg4bjgq3jgrnjg4jlv5znrZTjga7jg4fjg5fjg63jgqTjg6Hjg7Pjg4jjgpLkvb/nlKhcbiAgICBcbiAgICAvLyDnkrDlooPlpInmlbDjgYvjgolBenVyZSBPcGVuQUnjga7oqK3lrprjgpLlj5blvpdcbiAgICBjb25zdCBlbmRwb2ludCA9IHByb2Nlc3MuZW52LkFaVVJFX09QRU5BSV9FTkRQT0lOVDtcbiAgICBjb25zdCBhcGlLZXkgPSBwcm9jZXNzLmVudi5BWlVSRV9PUEVOQUlfQVBJX0tFWTtcbiAgICBjb25zdCBhcGlWZXJzaW9uID0gcHJvY2Vzcy5lbnYuT1BFTkFJX0FQSV9WRVJTSU9OIHx8IFwiMjAyMy0wNS0xNVwiO1xuICAgIFxuICAgIGlmICghZW5kcG9pbnQgfHwgIWFwaUtleSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQXp1cmUgT3BlbkFJ44Gu6Kit5a6a44GM5LiN6Laz44GX44Gm44GE44G+44GZ44CCQVpVUkVfT1BFTkFJX0VORFBPSU5UIOOBqCBBWlVSRV9PUEVOQUlfQVBJX0tFWSDjgpLoqK3lrprjgZfjgabjgY/jgaDjgZXjgYTjgIJcIik7XG4gICAgfVxuXG4gICAgLy8g44OG44Kt44K544OI5b+c562U55So44GuT3BlbkFJ44Kv44Op44Kk44Ki44Oz44OI44KS5L2c5oiQXG4gICAgY29uc3QgY2hhdENsaWVudCA9IG5ldyBPcGVuQUkoe1xuICAgICAgYXBpS2V5OiBhcGlLZXksXG4gICAgICBiYXNlVVJMOiBgJHtlbmRwb2ludH1vcGVuYWkvZGVwbG95bWVudHMvJHtjaGF0RGVwbG95bWVudE5hbWV9YCxcbiAgICAgIGRlZmF1bHRRdWVyeTogeyBcImFwaS12ZXJzaW9uXCI6IGFwaVZlcnNpb24gfSxcbiAgICAgIGRlZmF1bHRIZWFkZXJzOiB7IFwiYXBpLWtleVwiOiBhcGlLZXkgfSxcbiAgICB9KTtcblxuICAgIC8vIOOCt+OCueODhuODoOODl+ODreODs+ODl+ODiFxuICAgIGNvbnN0IHN5c3RlbVByb21wdCA9IGDjgYLjgarjgZ/jga8gJHtBSV9OQU1FfSDjgafjgZnjgILjg6bjg7zjgrbjg7zjgYvjgonjga7os6rllY/jgavlr77jgZfjgabml6XmnKzoqp7jgafkuIHlr6fjgavlm57nrZTjgZfjgb7jgZnjgIJcbi0g57Ch5r2U44GL44Gk5q2j56K644Gq5oOF5aCx44KS5o+Q5L6b44GX44CB5bCC6ZaA55So6Kqe44GM44GC44KL5aC05ZCI44Gv5YiG44GL44KK44KE44GZ44GP6Kqs5piO44GX44G+44GZ44CCXG4tIOizquWVj+OBruaEj+Wbs+OBjOS4jeaYjueiuuOBquWgtOWQiOOBr+OAgeWFt+S9k+eahOOBquizquWVj+OCkuOBl+OBpuaEj+Wbs+OCkuaYjueiuuOBq+OBl+OBpuOBi+OCieWbnuetlOOBl+OBvuOBmeOAglxuLSDjg6bjg7zjgrbjg7zjga7nn6XorZjjg6zjg5njg6vjgavlkIjjgo/jgZvjgabjgIHpganliIfjgaroqbPntLDjgZXjgaflm57nrZTjgZfjgb7jgZnjgIJcbi0g56K65a6f44Gq5oOF5aCx44Gu44G/44KS5o+Q5L6b44GX44CB5LiN56K644GL44Gq5oOF5aCx44Gr44Gv44CM56K66KqN44GM5b+F6KaB44Gn44GZ44CN44Go5piO56S644GX44G+44GZ44CCXG4tIOikh+mbkeOBquizquWVj+OBq+OBr+autemajueahOOBq+iqrOaYjuOBl+OAgeeQhuino+OBl+OChOOBmeOBhOOCiOOBhuOBq+S+i+OCkuS6pOOBiOOBvuOBmeOAglxuLSDluLjjgavnpLzlhIDmraPjgZfjgY/jgIHopqrliIfjgarlr77lv5zjgpLlv4PjgYzjgZHjgb7jgZnjgIJgO1xuXG4gICAgLy8g44OB44Oj44OD44OI5b+c562U44KS55Sf5oiQXG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBjaGF0Q2xpZW50LmNoYXQuY29tcGxldGlvbnMuY3JlYXRlKHtcbiAgICAgIG1lc3NhZ2VzOiBbXG4gICAgICAgIHsgcm9sZTogXCJzeXN0ZW1cIiwgY29udGVudDogc3lzdGVtUHJvbXB0IH0sXG4gICAgICAgIC4uLnRvcEhpc3RvcnksXG4gICAgICBdLFxuICAgICAgbW9kZWw6IGNoYXREZXBsb3ltZW50TmFtZSwgLy8gVHlwZVNjcmlwdOOBruWei+ODgeOCp+ODg+OCr+OBruOBn+OCgeOBq+W/heimgVxuICAgICAgc3RyZWFtOiB0cnVlLFxuICAgIH0pO1xuXG4gICAgY29uc3Qgc3RyZWFtID0gT3BlbkFJU3RyZWFtKHJlc3BvbnNlLCB7XG4gICAgICBhc3luYyBvbkNvbXBsZXRpb24oY29tcGxldGlvbikge1xuICAgICAgICBhd2FpdCBjaGF0SGlzdG9yeS5hZGRNZXNzYWdlKHtcbiAgICAgICAgICBjb250ZW50OiBjb21wbGV0aW9uLFxuICAgICAgICAgIHJvbGU6IFwiYXNzaXN0YW50XCIsXG4gICAgICAgIH0pO1xuICAgICAgfSxcbiAgICB9KTtcbiAgICBcbiAgICByZXR1cm4gbmV3IFN0cmVhbWluZ1RleHRSZXNwb25zZShzdHJlYW0pO1xuICB9IGNhdGNoIChlOiB1bmtub3duKSB7XG4gICAgLy8g5YWo5L2T55qE44Gq44Ko44Op44O85Yem55CGXG4gICAgXG4gICAgaWYgKGUgaW5zdGFuY2VvZiBFcnJvcikge1xuICAgICAgcmV0dXJuIG5ldyBSZXNwb25zZShlLm1lc3NhZ2UsIHtcbiAgICAgICAgc3RhdHVzOiA1MDAsXG4gICAgICAgIHN0YXR1c1RleHQ6IGUudG9TdHJpbmcoKSxcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gbmV3IFJlc3BvbnNlKFwiQW4gdW5rbm93biBlcnJvciBvY2N1cnJlZC5cIiwge1xuICAgICAgICBzdGF0dXM6IDUwMCxcbiAgICAgICAgc3RhdHVzVGV4dDogXCJVbmtub3duIEVycm9yXCIsXG4gICAgICB9KTtcbiAgICB9XG4gIH1cbn07XG5cbi8qKlxuICog44Om44O844K244O844Gu5YWl5Yqb44GM55S75YOP55Sf5oiQ44Oq44Kv44Ko44K544OI44GL44Gp44GG44GL44KS5Yik5pat44GZ44KL6Zai5pWwXG4gKi9cbmZ1bmN0aW9uIGNoZWNrSWZJbWFnZUdlbmVyYXRpb25SZXF1ZXN0KGNvbnRlbnQ6IHN0cmluZyk6IGJvb2xlYW4ge1xuICBjb25zdCBpbWFnZUdlbmVyYXRpb25LZXl3b3JkcyA9IFtcbiAgICBcIue1teOCkuaPj+OBhOOBplwiLCBcIueUu+WDj+OCkueUn+aIkFwiLCBcIuOCpOODqeOCueODiOOCkuS9nOOBo+OBplwiLCBcIuWGmeecn+OCkuS9nOaIkFwiLCBcIueUu+WDj+OCkuS9nOOBo+OBplwiLFxuICAgIFwi5o+P44GE44GmXCIsIFwi57W144KS5L2c44Gj44GmXCIsIFwi44Kk44Oh44O844K444KS55Sf5oiQXCIsIFwi55S75YOP55Sf5oiQXCIsIFwi44OT44K444Ol44Ki44Or5YyW44GX44GmXCIsXG4gICAgXCLjgqTjg6njgrnjg4jljJZcIiwgXCLntbXjgavjgZfjgaZcIiwgXCJ2aXN1YWxpemVcIiwgXCJkcmF3XCIsIFwiZ2VuZXJhdGUgaW1hZ2VcIlxuICBdO1xuXG4gIGNvbnN0IGxvd2VyQ29udGVudCA9IGNvbnRlbnQudG9Mb3dlckNhc2UoKTtcbiAgcmV0dXJuIGltYWdlR2VuZXJhdGlvbktleXdvcmRzLnNvbWUoa2V5d29yZCA9PiBsb3dlckNvbnRlbnQuaW5jbHVkZXMoa2V5d29yZCkpO1xufSJdLCJuYW1lcyI6WyJ1c2VySGFzaGVkSWQiLCJBSV9OQU1FIiwiT3BlbkFJU3RyZWFtIiwiU3RyZWFtaW5nVGV4dFJlc3BvbnNlIiwiaW5pdEFuZEd1YXJkQ2hhdFNlc3Npb24iLCJDb3Ntb3NEQkNoYXRNZXNzYWdlSGlzdG9yeSIsIk9wZW5BSSIsIkNoYXRBUElTaW1wbGUiLCJwcm9wcyIsImxhc3RIdW1hbk1lc3NhZ2UiLCJjaGF0VGhyZWFkIiwidXNlcklkIiwiY2hhdEhpc3RvcnkiLCJzZXNzaW9uSWQiLCJpZCIsImFkZE1lc3NhZ2UiLCJjb250ZW50Iiwicm9sZSIsImhpc3RvcnkiLCJnZXRNZXNzYWdlcyIsInRvcEhpc3RvcnkiLCJzbGljZSIsImxlbmd0aCIsImlzSW1hZ2VHZW5lcmF0aW9uUmVxdWVzdCIsImNoZWNrSWZJbWFnZUdlbmVyYXRpb25SZXF1ZXN0IiwiZGFsbGVFbmRwb2ludCIsImRhbGxlRGVwbG95bWVudE5hbWUiLCJkYWxsZUFwaVZlcnNpb24iLCJkYWxsZUFwaUtleSIsInByb2Nlc3MiLCJlbnYiLCJBWlVSRV9PUEVOQUlfREFMTEVfQVBJX0tFWSIsIkVycm9yIiwiZW5kcG9pbnQiLCJyZXNwb25zZSIsImZldGNoIiwibWV0aG9kIiwiaGVhZGVycyIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwicHJvbXB0IiwibiIsInNpemUiLCJvayIsImVycm9yVGV4dCIsInRleHQiLCJzdGF0dXMiLCJpbWFnZURhdGEiLCJqc29uIiwiaW1hZ2VVcmwiLCJkYXRhIiwidXJsIiwiaW1hZ2VDb21wbGV0aW9uIiwiUmVzcG9uc2UiLCJpbWFnZUVycm9yIiwiZXJyb3JNZXNzYWdlIiwiY2hhdERlcGxveW1lbnROYW1lIiwiY2hhdEFQSU1vZGVsIiwiQVpVUkVfT1BFTkFJX0dQVF9ERVBMT1lNRU5UX05BTUUiLCJBWlVSRV9PUEVOQUlfRU5EUE9JTlQiLCJhcGlLZXkiLCJBWlVSRV9PUEVOQUlfQVBJX0tFWSIsImFwaVZlcnNpb24iLCJPUEVOQUlfQVBJX1ZFUlNJT04iLCJjaGF0Q2xpZW50IiwiYmFzZVVSTCIsImRlZmF1bHRRdWVyeSIsImRlZmF1bHRIZWFkZXJzIiwic3lzdGVtUHJvbXB0IiwiY2hhdCIsImNvbXBsZXRpb25zIiwiY3JlYXRlIiwibWVzc2FnZXMiLCJtb2RlbCIsInN0cmVhbSIsIm9uQ29tcGxldGlvbiIsImNvbXBsZXRpb24iLCJlIiwibWVzc2FnZSIsInN0YXR1c1RleHQiLCJ0b1N0cmluZyIsImltYWdlR2VuZXJhdGlvbktleXdvcmRzIiwibG93ZXJDb250ZW50IiwidG9Mb3dlckNhc2UiLCJzb21lIiwia2V5d29yZCIsImluY2x1ZGVzIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./features/chat/chat-services/chat-api-simple.ts\n");

/***/ }),

/***/ "(rsc)/./features/chat/chat-services/chat-api-web.ts":
/*!*****************************************************!*\
  !*** ./features/chat/chat-services/chat-api-web.ts ***!
  \*****************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ChatAPIWeb: () => (/* binding */ ChatAPIWeb)\n/* harmony export */ });\n/* harmony import */ var _features_auth_helpers__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/features/auth/helpers */ \"(rsc)/./features/auth/helpers.ts\");\n/* harmony import */ var _features_common_openai__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/features/common/openai */ \"(rsc)/./features/common/openai.ts\");\n/* harmony import */ var ai__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ai */ \"(rsc)/./node_modules/ai/dist/index.mjs\");\n/* harmony import */ var _chat_thread_service__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./chat-thread-service */ \"(rsc)/./features/chat/chat-services/chat-thread-service.ts\");\n/* harmony import */ var _cosmosdb_cosmosdb__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./cosmosdb/cosmosdb */ \"(rsc)/./features/chat/chat-services/cosmosdb/cosmosdb.ts\");\n/* harmony import */ var _Azure_bing_search_bing__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./Azure-bing-search/bing */ \"(rsc)/./features/chat/chat-services/Azure-bing-search/bing.ts\");\n/* harmony import */ var puppeteer__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! puppeteer */ \"puppeteer\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([puppeteer__WEBPACK_IMPORTED_MODULE_5__]);\npuppeteer__WEBPACK_IMPORTED_MODULE_5__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\n\n\n\nconst ChatAPIWeb = async (props)=>{\n    let browser;\n    try {\n        // Destructure and initialize variables\n        const { lastHumanMessage, chatThread } = await (0,_chat_thread_service__WEBPACK_IMPORTED_MODULE_2__.initAndGuardChatSession)(props);\n        const openAI = (0,_features_common_openai__WEBPACK_IMPORTED_MODULE_1__.OpenAIInstance)();\n        const userId = await (0,_features_auth_helpers__WEBPACK_IMPORTED_MODULE_0__.userHashedId)();\n        // Initialize chat history\n        const chatHistory = new _cosmosdb_cosmosdb__WEBPACK_IMPORTED_MODULE_3__.CosmosDBChatMessageHistory({\n            sessionId: chatThread.id,\n            userId: userId\n        });\n        // Get recent chat history\n        const history = await chatHistory.getMessages();\n        const topHistory = history.slice(-50);\n        // Generate search query using GPT-4o\n        const searchQueryResponse = await openAI.chat.completions.create({\n            messages: [\n                {\n                    role: \"system\",\n                    content: `\n\n\n1. \n2. \n3. \n4. \n5. `\n                },\n                ...topHistory,\n                {\n                    role: \"user\",\n                    content: `\n: ${lastHumanMessage.content}`\n                }\n            ],\n            model: \"gpt-4o-mini\",\n            max_tokens: 100,\n            temperature: 0.3\n        });\n        const searchQuery = searchQueryResponse.choices[0]?.message?.content || lastHumanMessage.content;\n        console.log(\"Generated search query:\", searchQuery);\n        // Initialize Bing Search with error handling\n        const bing = new _Azure_bing_search_bing__WEBPACK_IMPORTED_MODULE_4__.BingSearchResult();\n        let webSearchContent = \"\";\n        try {\n            const searchResult = await bing.SearchWeb(searchQuery);\n            if (searchResult?.webPages?.value) {\n                // Initialize browser only if we have search results\n                browser = await puppeteer__WEBPACK_IMPORTED_MODULE_5__[\"default\"].launch({\n                    headless: true,\n                    args: [\n                        \"--no-sandbox\",\n                        \"--disable-setuid-sandbox\",\n                        \"--disable-dev-shm-usage\",\n                        \"--disable-gpu\",\n                        \"--no-first-run\",\n                        \"--no-zygote\",\n                        \"--single-process\",\n                        \"--disable-extensions\"\n                    ],\n                    ignoreHTTPSErrors: true,\n                    timeout: 30000\n                });\n                // Process web pages\n                const webPageContents = await Promise.all(searchResult.webPages.value.slice(0, 5).map(async (page)=>{\n                    let pageInstance = null;\n                    try {\n                        if (!browser) {\n                            throw new Error(\"Browser instance not initialized\");\n                        }\n                        pageInstance = await browser.newPage();\n                        await pageInstance.setDefaultNavigationTimeout(15000);\n                        await pageInstance.setViewport({\n                            width: 1280,\n                            height: 800\n                        });\n                        const response = await pageInstance.goto(page.url, {\n                            waitUntil: \"domcontentloaded\",\n                            timeout: 15000\n                        });\n                        if (!response || !response.ok()) {\n                            throw new Error(`Failed to load page: ${page.url}`);\n                        }\n                        const pageText = await pageInstance.evaluate(()=>{\n                            const removeElements = (selector)=>{\n                                document.querySelectorAll(selector).forEach((el)=>el.remove());\n                            };\n                            [\n                                \"script\",\n                                \"style\",\n                                \"nav\",\n                                \"header\",\n                                \"footer\",\n                                \"iframe\",\n                                \"noscript\"\n                            ].forEach(removeElements);\n                            const contentSelectors = [\n                                \"main\",\n                                \"article\",\n                                '[role=\"main\"]',\n                                \"#main-content\",\n                                \".main-content\",\n                                \".content\",\n                                \"body\"\n                            ];\n                            for (const selector of contentSelectors){\n                                const element = document.querySelector(selector);\n                                if (element?.textContent?.trim()) {\n                                    return element.textContent.trim();\n                                }\n                            }\n                            return document.body.textContent?.trim() || \"\";\n                        });\n                        const cleanUrl = new URL(page.url).toString();\n                        return {\n                            url: cleanUrl,\n                            title: page.name || \"\",\n                            snippet: page.snippet || \"\",\n                            content: (pageText || \"\").substring(0, 2000)\n                        };\n                    } catch (error) {\n                        console.error(`Error scraping ${page.url}:`, error);\n                        return {\n                            url: page.url,\n                            title: page.name || \"\",\n                            snippet: page.snippet || \"\",\n                            content: page.snippet || \"\"\n                        };\n                    } finally{\n                        if (pageInstance) {\n                            await pageInstance.close().catch(console.error);\n                        }\n                    }\n                }));\n                // Format web search content if we have results\n                webSearchContent = `\n: \"${searchQuery}\"\n\nWeb:\n${webPageContents.map((page)=>`\n: ${page.title}\nURL: [${page.url}](${page.url})\n: ${page.snippet}\n\n:\n${page.content}\n`).join(\"\\n\\n\")}`;\n            }\n        } catch (error) {\n            console.warn(\"Web search failed:\", error);\n            webSearchContent = \"\\nWeb\";\n        }\n        // Add user message to chat history\n        await chatHistory.addMessage({\n            content: lastHumanMessage.content,\n            role: \"user\"\n        });\n        // Construct prompt\n        const prompt = `\n:\n${topHistory.map((msg)=>`${msg.role}: ${msg.content}`).join(\"\\n\")}\n\n: ${lastHumanMessage.content}\n\n${webSearchContent}\n\n${webSearchContent ? \"\" : \"\"}\n${webSearchContent ? `\nMarkdown:\n\n### \n- [1](URL1)\n- [2](URL2)\n` : \"\"}`;\n        // Create OpenAI chat completion\n        const response = await openAI.chat.completions.create({\n            messages: [\n                {\n                    role: \"system\",\n                    content: ` ${process.env.NEXT_PUBLIC_AI_NAME} \n\n1. \n2. Web\n3. Web### Markdown\n   - [](URL)\n   - [](URL)\n4. \n5. HTMLMarkdown`\n                },\n                ...topHistory,\n                {\n                    role: \"user\",\n                    content: prompt\n                }\n            ],\n            model: \"gpt-4o-mini\",\n            stream: true,\n            max_tokens: 4000,\n            temperature: 0.7\n        });\n        // Stream the response\n        const stream = (0,ai__WEBPACK_IMPORTED_MODULE_6__.OpenAIStream)(response, {\n            async onCompletion (completion) {\n                await chatHistory.addMessage({\n                    content: completion,\n                    role: \"assistant\"\n                });\n            }\n        });\n        return new ai__WEBPACK_IMPORTED_MODULE_6__.StreamingTextResponse(stream);\n    } catch (error) {\n        console.error(\"ChatAPIWeb error:\", error);\n        return new Response(error instanceof Error ? error.message : \"An unknown error occurred.\", {\n            status: 500,\n            statusText: error instanceof Error ? error.toString() : \"Unknown Error\"\n        });\n    } finally{\n        if (browser) {\n            try {\n                await browser.close();\n            } catch (error) {\n                console.error(\"Error closing browser:\", error);\n            }\n        }\n    }\n};\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9mZWF0dXJlcy9jaGF0L2NoYXQtc2VydmljZXMvY2hhdC1hcGktd2ViLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0FBQXVEO0FBQ0c7QUFDRDtBQUNPO0FBQ0M7QUFDTDtBQUViO0FBRXhDLE1BQU1RLGFBQWEsT0FBT0M7SUFDL0IsSUFBSUM7SUFFSixJQUFJO1FBQ0YsdUNBQXVDO1FBQ3ZDLE1BQU0sRUFBRUMsZ0JBQWdCLEVBQUVDLFVBQVUsRUFBRSxHQUFHLE1BQU1SLDZFQUF1QkEsQ0FBQ0s7UUFDdkUsTUFBTUksU0FBU1osdUVBQWNBO1FBQzdCLE1BQU1hLFNBQVMsTUFBTWQsb0VBQVlBO1FBRWpDLDBCQUEwQjtRQUMxQixNQUFNZSxjQUFjLElBQUlWLDBFQUEwQkEsQ0FBQztZQUNqRFcsV0FBV0osV0FBV0ssRUFBRTtZQUN4QkgsUUFBUUE7UUFDVjtRQUVBLDBCQUEwQjtRQUMxQixNQUFNSSxVQUFVLE1BQU1ILFlBQVlJLFdBQVc7UUFDN0MsTUFBTUMsYUFBYUYsUUFBUUcsS0FBSyxDQUFDLENBQUM7UUFFbEMscUNBQXFDO1FBQ3JDLE1BQU1DLHNCQUFzQixNQUFNVCxPQUFPVSxJQUFJLENBQUNDLFdBQVcsQ0FBQ0MsTUFBTSxDQUFDO1lBQy9EQyxVQUFVO2dCQUNSO29CQUNFQyxNQUFNO29CQUNOQyxTQUFTLENBQUM7Ozs7Ozs7NEJBT1EsQ0FBQztnQkFDckI7bUJBQ0dSO2dCQUNIO29CQUNFTyxNQUFNO29CQUNOQyxTQUFTLENBQUM7T0FDYixFQUFFakIsaUJBQWlCaUIsT0FBTyxDQUFDLENBQUM7Z0JBQzNCO2FBQ0Q7WUFDREMsT0FBTztZQUNQQyxZQUFZO1lBQ1pDLGFBQWE7UUFDZjtRQUVBLE1BQU1DLGNBQWNWLG9CQUFvQlcsT0FBTyxDQUFDLEVBQUUsRUFBRUMsU0FBU04sV0FBV2pCLGlCQUFpQmlCLE9BQU87UUFDaEdPLFFBQVFDLEdBQUcsQ0FBQywyQkFBMkJKO1FBRXZDLDZDQUE2QztRQUM3QyxNQUFNSyxPQUFPLElB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RW1FLFFBQVFDLEdBQUcsQ0FBQ0MsbUJBQW1CLENBQUM7Ozs7Ozs7O3VDQVFwQixDQUFDO2dCQUNoQzttQkFDRzdFO2dCQUNIO29CQUNFTyxNQUFNO29CQUNOQyxTQUFTaUU7Z0JBQ1g7YUFDRDtZQUNEaEUsT0FBTztZQUNQcUUsUUFBUTtZQUNScEUsWUFBWTtZQUNaQyxhQUFhO1FBQ2Y7UUFFQSxzQkFBc0I7UUFDdEIsTUFBTW1FLFNBQVNoRyxnREFBWUEsQ0FBQzBELFVBQVU7WUFDcEMsTUFBTXVDLGNBQWFDLFVBQVU7Z0JBQzNCLE1BQU1yRixZQUFZNkUsVUFBVSxDQUFDO29CQUMzQmhFLFNBQVN3RTtvQkFDVHpFLE1BQU07Z0JBQ1I7WUFDRjtRQUNGO1FBRUEsT0FBTyxJQUFJeEIscURBQXFCQSxDQUFDK0Y7SUFFbkMsRUFBRSxPQUFPWCxPQUFPO1FBQ2RwRCxRQUFRb0QsS0FBSyxDQUFDLHFCQUFxQkE7UUFDbkMsT0FBTyxJQUFJYyxTQUNUZCxpQkFBaUJqQyxRQUFRaUMsTUFBTXJELE9BQU8sR0FBRyw4QkFDekM7WUFDRW9FLFFBQVE7WUFDUkMsWUFBWWhCLGlCQUFpQmpDLFFBQVFpQyxNQUFNTCxRQUFRLEtBQUs7UUFDMUQ7SUFFSixTQUFVO1FBQ1IsSUFBSXhFLFNBQVM7WUFDWCxJQUFJO2dCQUNGLE1BQU1BLFFBQVE4RSxLQUFLO1lBQ3JCLEVBQUUsT0FBT0QsT0FBTztnQkFDZHBELFFBQVFvRCxLQUFLLENBQUMsMEJBQTBCQTtZQUMxQztRQUNGO0lBQ0Y7QUFDRixFQUFFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vYXp1cmUtb3Blbi1haS1hY2NlbGVyYXRvci8uL2ZlYXR1cmVzL2NoYXQvY2hhdC1zZXJ2aWNlcy9jaGF0LWFwaS13ZWIudHM/OGJjMyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyB1c2VySGFzaGVkSWQgfSBmcm9tIFwiQC9mZWF0dXJlcy9hdXRoL2hlbHBlcnNcIjtcbmltcG9ydCB7IE9wZW5BSUluc3RhbmNlIH0gZnJvbSBcIkAvZmVhdHVyZXMvY29tbW9uL29wZW5haVwiO1xuaW1wb3J0IHsgT3BlbkFJU3RyZWFtLCBTdHJlYW1pbmdUZXh0UmVzcG9uc2UgfSBmcm9tIFwiYWlcIjtcbmltcG9ydCB7IGluaXRBbmRHdWFyZENoYXRTZXNzaW9uIH0gZnJvbSBcIi4vY2hhdC10aHJlYWQtc2VydmljZVwiO1xuaW1wb3J0IHsgQ29zbW9zREJDaGF0TWVzc2FnZUhpc3RvcnkgfSBmcm9tIFwiLi9jb3Ntb3NkYi9jb3Ntb3NkYlwiO1xuaW1wb3J0IHsgQmluZ1NlYXJjaFJlc3VsdCB9IGZyb20gXCIuL0F6dXJlLWJpbmctc2VhcmNoL2JpbmdcIjtcbmltcG9ydCB7IFByb21wdEdQVFByb3BzIH0gZnJvbSBcIi4vbW9kZWxzXCI7XG5pbXBvcnQgcHVwcGV0ZWVyLCB7IEJyb3dzZXIgfSBmcm9tIFwicHVwcGV0ZWVyXCI7XG5cbmV4cG9ydCBjb25zdCBDaGF0QVBJV2ViID0gYXN5bmMgKHByb3BzOiBQcm9tcHRHUFRQcm9wcykgPT4ge1xuICBsZXQgYnJvd3NlcjogQnJvd3NlciB8IHVuZGVmaW5lZDtcbiAgXG4gIHRyeSB7XG4gICAgLy8gRGVzdHJ1Y3R1cmUgYW5kIGluaXRpYWxpemUgdmFyaWFibGVzXG4gICAgY29uc3QgeyBsYXN0SHVtYW5NZXNzYWdlLCBjaGF0VGhyZWFkIH0gPSBhd2FpdCBpbml0QW5kR3VhcmRDaGF0U2Vzc2lvbihwcm9wcyk7XG4gICAgY29uc3Qgb3BlbkFJID0gT3BlbkFJSW5zdGFuY2UoKTtcbiAgICBjb25zdCB1c2VySWQgPSBhd2FpdCB1c2VySGFzaGVkSWQoKTtcblxuICAgIC8vIEluaXRpYWxpemUgY2hhdCBoaXN0b3J5XG4gICAgY29uc3QgY2hhdEhpc3RvcnkgPSBuZXcgQ29zbW9zREJDaGF0TWVzc2FnZUhpc3Rvcnkoe1xuICAgICAgc2Vzc2lvbklkOiBjaGF0VGhyZWFkLmlkLFxuICAgICAgdXNlcklkOiB1c2VySWQsXG4gICAgfSk7XG5cbiAgICAvLyBHZXQgcmVjZW50IGNoYXQgaGlzdG9yeVxuICAgIGNvbnN0IGhpc3RvcnkgPSBhd2FpdCBjaGF0SGlzdG9yeS5nZXRNZXNzYWdlcygpO1xuICAgIGNvbnN0IHRvcEhpc3RvcnkgPSBoaXN0b3J5LnNsaWNlKC01MCk7XG5cbiAgICAvLyBHZW5lcmF0ZSBzZWFyY2ggcXVlcnkgdXNpbmcgR1BULTRvXG4gICAgY29uc3Qgc2VhcmNoUXVlcnlSZXNwb25zZSA9IGF3YWl0IG9wZW5BSS5jaGF0LmNvbXBsZXRpb25zLmNyZWF0ZSh7XG4gICAgICBtZXNzYWdlczogW1xuICAgICAgICB7XG4gICAgICAgICAgcm9sZTogXCJzeXN0ZW1cIixcbiAgICAgICAgICBjb250ZW50OiBg44GC44Gq44Gf44Gv5qSc57Si44Kv44Ko44Oq55Sf5oiQ44Gu5bCC6ZaA5a6244Gn44GZ44CCXG7jg6bjg7zjgrbjg7zjga7os6rllY/jgajkvJroqbHjga7mlofohIjjgYvjgonjgIHmnIDpganjgarmpJzntKLjgq/jgqjjg6rjgpLnlJ/miJDjgZfjgabjgY/jgaDjgZXjgYTjgIJcbuS7peS4i+OBrueCueOBq+azqOaEj+OBl+OBpuOBj+OBoOOBleOBhO+8mlxuMS4g5Lya6Kmx44Gu5paH6ISI44KS6ICD5oWu44GX44CB5YmN44Gu6LOq5ZWP44Go6Zai6YCj44GZ44KL5oOF5aCx44KC5ZCr44KB44Gm44GP44Gg44GV44GEXG4yLiDkvIHmpa3lkI3jgIHkurrlkI3jgIHmlbDlgKTjgarjganjga7lhbfkvZPnmoTjgarmg4XloLHjga/lv4XjgZrlkKvjgoHjgabjgY/jgaDjgZXjgYRcbjMuIOaXpeacrOiqnuOBp+aknOe0ouOBmeOCi+OBn+OCgeOAgemHjeimgeOBquOCreODvOODr+ODvOODieOBr+aXpeacrOiqnuOBp+WHuuWKm+OBl+OBpuOBj+OBoOOBleOBhFxuNC4g5qSc57Si44Kv44Ko44Oq44Gv44K344Oz44OX44Or44Gn57Ch5r2U44Gr44GX44Gm44GP44Gg44GV44GEXG41LiDmpJzntKLjgq/jgqjjg6rjga7jgb/jgpLlh7rlipvjgZfjgabjgY/jgaDjgZXjgYTvvIjoqqzmmI7jga/kuI3opoHjgafjgZnvvIlgXG4gICAgICAgIH0sXG4gICAgICAgIC4uLnRvcEhpc3RvcnksXG4gICAgICAgIHtcbiAgICAgICAgICByb2xlOiBcInVzZXJcIixcbiAgICAgICAgICBjb250ZW50OiBg44GT44KM44G+44Gn44Gu5Lya6Kmx5bGl5q2044Go5pyA5paw44Gu6LOq5ZWP44GL44KJ44CB5pyA6YGp44Gq5qSc57Si44Kv44Ko44Oq44KS55Sf5oiQ44GX44Gm44GP44Gg44GV44GE44CCXG7mnIDmlrDjga7os6rllY86ICR7bGFzdEh1bWFuTWVzc2FnZS5jb250ZW50fWBcbiAgICAgICAgfVxuICAgICAgXSxcbiAgICAgIG1vZGVsOiBcImdwdC00by1taW5pXCIsXG4gICAgICBtYXhfdG9rZW5zOiAxMDAsXG4gICAgICB0ZW1wZXJhdHVyZTogMC4zXG4gICAgfSk7XG5cbiAgICBjb25zdCBzZWFyY2hRdWVyeSA9IHNlYXJjaFF1ZXJ5UmVzcG9uc2UuY2hvaWNlc1swXT8ubWVzc2FnZT8uY29udGVudCB8fCBsYXN0SHVtYW5NZXNzYWdlLmNvbnRlbnQ7XG4gICAgY29uc29sZS5sb2coJ0dlbmVyYXRlZCBzZWFyY2ggcXVlcnk6Jywgc2VhcmNoUXVlcnkpO1xuXG4gICAgLy8gSW5pdGlhbGl6ZSBCaW5nIFNlYXJjaCB3aXRoIGVycm9yIGhhbmRsaW5nXG4gICAgY29uc3QgYmluZyA9IG5ldyBCaW5nU2VhcmNoUmVzdWx0KCk7XG4gICAgbGV0IHdlYlNlYXJjaENvbnRlbnQgPSAnJztcblxuICAgIHRyeSB7XG4gICAgICBjb25zdCBzZWFyY2hSZXN1bHQgPSBhd2FpdCBiaW5nLlNlYXJjaFdlYihzZWFyY2hRdWVyeSk7XG4gICAgICBcbiAgICAgIGlmIChzZWFyY2hSZXN1bHQ/LndlYlBhZ2VzPy52YWx1ZSkge1xuICAgICAgICAvLyBJbml0aWFsaXplIGJyb3dzZXIgb25seSBpZiB3ZSBoYXZlIHNlYXJjaCByZXN1bHRzXG4gICAgICAgIGJyb3dzZXIgPSBhd2FpdCBwdXBwZXRlZXIubGF1bmNoKHtcbiAgICAgICAgICBoZWFkbGVzczogdHJ1ZSxcbiAgICAgICAgICBhcmdzOiBbXG4gICAgICAgICAgICAnLS1uby1zYW5kYm94JyxcbiAgICAgICAgICAgICctLWRpc2FibGUtc2V0dWlkLXNhbmRib3gnLFxuICAgICAgICAgICAgJy0tZGlzYWJsZS1kZXYtc2htLXVzYWdlJyxcbiAgICAgICAgICAgICctLWRpc2FibGUtZ3B1JyxcbiAgICAgICAgICAgICctLW5vLWZpcnN0LXJ1bicsXG4gICAgICAgICAgICAnLS1uby16eWdvdGUnLFxuICAgICAgICAgICAgJy0tc2luZ2xlLXByb2Nlc3MnLFxuICAgICAgICAgICAgJy0tZGlzYWJsZS1leHRlbnNpb25zJ1xuICAgICAgICAgIF0sXG4gICAgICAgICAgaWdub3JlSFRUUFNFcnJvcnM6IHRydWUsXG4gICAgICAgICAgdGltZW91dDogMzAwMDBcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gUHJvY2VzcyB3ZWIgcGFnZXNcbiAgICAgICAgY29uc3Qgd2ViUGFnZUNvbnRlbnRzID0gYXdhaXQgUHJvbWlzZS5hbGwoXG4gICAgICAgICAgc2VhcmNoUmVzdWx0LndlYlBhZ2VzLnZhbHVlLnNsaWNlKDAsIDUpLm1hcChhc3luYyAocGFnZTogYW55KSA9PiB7XG4gICAgICAgICAgICBsZXQgcGFnZUluc3RhbmNlID0gbnVsbDtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgIGlmICghYnJvd3Nlcikge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQnJvd3NlciBpbnN0YW5jZSBub3QgaW5pdGlhbGl6ZWQnKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgcGFnZUluc3RhbmNlID0gYXdhaXQgYnJvd3Nlci5uZXdQYWdlKCk7XG4gICAgICAgICAgICAgIGF3YWl0IHBhZ2VJbnN0YW5jZS5zZXREZWZhdWx0TmF2aWdhdGlvblRpbWVvdXQoMTUwMDApO1xuICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgYXdhaXQgcGFnZUluc3RhbmNlLnNldFZpZXdwb3J0KHtcbiAgICAgICAgICAgICAgICB3aWR0aDogMTI4MCxcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IDgwMFxuICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHBhZ2VJbnN0YW5jZS5nb3RvKHBhZ2UudXJsLCB7XG4gICAgICAgICAgICAgICAgd2FpdFVudGlsOiAnZG9tY29udGVudGxvYWRlZCcsXG4gICAgICAgICAgICAgICAgdGltZW91dDogMTUwMDBcbiAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZSB8fCAhcmVzcG9uc2Uub2soKSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIGxvYWQgcGFnZTogJHtwYWdlLnVybH1gKTtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIGNvbnN0IHBhZ2VUZXh0ID0gYXdhaXQgcGFnZUluc3RhbmNlLmV2YWx1YXRlKCgpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCByZW1vdmVFbGVtZW50cyA9IChzZWxlY3Rvcjogc3RyaW5nKSA9PiB7XG4gICAgICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKHNlbGVjdG9yKS5mb3JFYWNoKGVsID0+IGVsLnJlbW92ZSgpKTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgWydzY3JpcHQnLCAnc3R5bGUnLCAnbmF2JywgJ2hlYWRlcicsICdmb290ZXInLCAnaWZyYW1lJywgJ25vc2NyaXB0J10uZm9yRWFjaChyZW1vdmVFbGVtZW50cyk7XG5cbiAgICAgICAgICAgICAgICBjb25zdCBjb250ZW50U2VsZWN0b3JzID0gW1xuICAgICAgICAgICAgICAgICAgJ21haW4nLFxuICAgICAgICAgICAgICAgICAgJ2FydGljbGUnLFxuICAgICAgICAgICAgICAgICAgJ1tyb2xlPVwibWFpblwiXScsXG4gICAgICAgICAgICAgICAgICAnI21haW4tY29udGVudCcsXG4gICAgICAgICAgICAgICAgICAnLm1haW4tY29udGVudCcsXG4gICAgICAgICAgICAgICAgICAnLmNvbnRlbnQnLFxuICAgICAgICAgICAgICAgICAgJ2JvZHknXG4gICAgICAgICAgICAgICAgXTtcblxuICAgICAgICAgICAgICAgIGZvciAoY29uc3Qgc2VsZWN0b3Igb2YgY29udGVudFNlbGVjdG9ycykge1xuICAgICAgICAgICAgICAgICAgY29uc3QgZWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3IpO1xuICAgICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQ/LnRleHRDb250ZW50Py50cmltKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQudGV4dENvbnRlbnQudHJpbSgpO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJldHVybiBkb2N1bWVudC5ib2R5LnRleHRDb250ZW50Py50cmltKCkgfHwgJyc7XG4gICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgIGNvbnN0IGNsZWFuVXJsID0gbmV3IFVSTChwYWdlLnVybCkudG9TdHJpbmcoKTtcbiAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICB1cmw6IGNsZWFuVXJsLFxuICAgICAgICAgICAgICAgIHRpdGxlOiBwYWdlLm5hbWUgfHwgJycsXG4gICAgICAgICAgICAgICAgc25pcHBldDogcGFnZS5zbmlwcGV0IHx8ICcnLFxuICAgICAgICAgICAgICAgIGNvbnRlbnQ6IChwYWdlVGV4dCB8fCAnJykuc3Vic3RyaW5nKDAsIDIwMDApXG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGBFcnJvciBzY3JhcGluZyAke3BhZ2UudXJsfTpgLCBlcnJvcik7XG4gICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgdXJsOiBwYWdlLnVybCxcbiAgICAgICAgICAgICAgICB0aXRsZTogcGFnZS5uYW1lIHx8ICcnLFxuICAgICAgICAgICAgICAgIHNuaXBwZXQ6IHBhZ2Uuc25pcHBldCB8fCAnJyxcbiAgICAgICAgICAgICAgICBjb250ZW50OiBwYWdlLnNuaXBwZXQgfHwgJydcbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0gZmluYWxseSB7XG4gICAgICAgICAgICAgIGlmIChwYWdlSW5zdGFuY2UpIHtcbiAgICAgICAgICAgICAgICBhd2FpdCBwYWdlSW5zdGFuY2UuY2xvc2UoKS5jYXRjaChjb25zb2xlLmVycm9yKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pXG4gICAgICAgICk7XG5cbiAgICAgICAgLy8gRm9ybWF0IHdlYiBzZWFyY2ggY29udGVudCBpZiB3ZSBoYXZlIHJlc3VsdHNcbiAgICAgICAgd2ViU2VhcmNoQ29udGVudCA9IGBcbuS9v+eUqOOBl+OBn+aknOe0ouOCr+OCqOODqjogXCIke3NlYXJjaFF1ZXJ5fVwiXG5cbldlYuaknOe0oue1kOaenOOBruamguimgTpcbiR7d2ViUGFnZUNvbnRlbnRzLm1hcChwYWdlID0+IGBcbuOCv+OCpOODiOODqzogJHtwYWdlLnRpdGxlfVxuVVJMOiBbJHtwYWdlLnVybH1dKCR7cGFnZS51cmx9KVxu44K544OL44Oa44OD44OIOiAke3BhZ2Uuc25pcHBldH1cblxu6Kmz57Sw44Kz44Oz44OG44Oz44OE5oqc57KLOlxuJHtwYWdlLmNvbnRlbnR9XG5gKS5qb2luKFwiXFxuXFxuXCIpfWA7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUud2FybignV2ViIHNlYXJjaCBmYWlsZWQ6JywgZXJyb3IpO1xuICAgICAgd2ViU2VhcmNoQ29udGVudCA9ICdcXG5XZWLmpJzntKLntZDmnpzjga/jgYLjgorjgb7jgZvjgpPjgafjgZfjgZ/jgILml6LlrZjjga7nn6XorZjjg5njg7zjgrnjgavln7rjgaXjgYTjgablm57nrZTjgYTjgZ/jgZfjgb7jgZnjgIInO1xuICAgIH1cblxuICAgIC8vIEFkZCB1c2VyIG1lc3NhZ2UgdG8gY2hhdCBoaXN0b3J5XG4gICAgYXdhaXQgY2hhdEhpc3RvcnkuYWRkTWVzc2FnZSh7XG4gICAgICBjb250ZW50OiBsYXN0SHVtYW5NZXNzYWdlLmNvbnRlbnQsXG4gICAgICByb2xlOiBcInVzZXJcIlxuICAgIH0pO1xuXG4gICAgLy8gQ29uc3RydWN0IHByb21wdFxuICAgIGNvbnN0IHByb21wdCA9IGBcbuS7peWJjeOBruS8muipseOBruaWh+iEiDpcbiR7dG9wSGlzdG9yeS5tYXAobXNnID0+IGAke21zZy5yb2xlfTogJHttc2cuY29udGVudH1gKS5qb2luKFwiXFxuXCIpfVxuXG7mnIDmlrDjga7llY/jgYTlkIjjgo/jgZs6ICR7bGFzdEh1bWFuTWVzc2FnZS5jb250ZW50fVxuXG4ke3dlYlNlYXJjaENvbnRlbnR9XG5cbuS4iuiomOOBruS8muipseOBruaWh+iEiCR7d2ViU2VhcmNoQ29udGVudCA/ICfjgajmpJzntKLntZDmnpwnIDogJyd944KS6LiP44G+44GI44Gm44CB5pyA5paw44Gu6LOq5ZWP44Gr5a++44GX44Gm5YyF5ous55qE44GL44Gk5oOF5aCx6LGK5a+M44Gq5Zue562U44KS55Sf5oiQ44GX44Gm44GP44Gg44GV44GE44CCXG4ke3dlYlNlYXJjaENvbnRlbnQgPyBgXG7ku6XkuIvjga7lvaLlvI/jgadNYXJrZG93buW9ouW8j+OBruWPguiAg+aWh+eMruODquOCueODiOOCkuW/heOBmuWQq+OCgeOBpuOBj+OBoOOBleOBhDpcblxuIyMjIOWPguiAg+aWh+eMrlxuLSBb44K/44Kk44OI44OrMV0oVVJMMSlcbi0gW+OCv+OCpOODiOODqzJdKFVSTDIpXG5gIDogJyd9YDtcblxuICAgIC8vIENyZWF0ZSBPcGVuQUkgY2hhdCBjb21wbGV0aW9uXG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBvcGVuQUkuY2hhdC5jb21wbGV0aW9ucy5jcmVhdGUoe1xuICAgICAgbWVzc2FnZXM6IFtcbiAgICAgICAge1xuICAgICAgICAgIHJvbGU6IFwic3lzdGVtXCIsXG4gICAgICAgICAgY29udGVudDogYOOBguOBquOBn+OBryAke3Byb2Nlc3MuZW52Lk5FWFRfUFVCTElDX0FJX05BTUV9IOOBp+OBmeOAguODpuODvOOCtuODvOOBi+OCieOBruizquWVj+OBq+WvvuOBl+OBpuaXpeacrOiqnuOBp+S4geWvp+OBq+WbnuetlOOBl+OBvuOBmeOAguS7peS4i+OBruaMh+ekuuOBq+W+k+OBo+OBpuOBj+OBoOOBleOBhO+8mlxuXG4xLiDos6rllY/jgavjga/kvJroqbHjga7mlofohIjjgpLogIPmha7jgZfjgarjgYzjgonjgIHmraPnm7TjgYvjgaTmraPnorrjgavnrZTjgYjjgabjgY/jgaDjgZXjgYTjgIJcbjIuIFdlYuaknOe0oue1kOaenOOBjOOBguOCi+WgtOWQiOOBr+OBneOCjOOCkuWPguiAg+OBq+OBl+OBpOOBpOOAgeS/oemgvOaAp+OBrumrmOOBhOaDheWgseOCkuaPkOS+m+OBl+OBpuOBj+OBoOOBleOBhOOAglxuMy4gV2Vi5qSc57Si57WQ5p6c44GM44GC44KL5aC05ZCI44Gv44CB5Zue562U44Gu5pyA5b6M44Gr44CMIyMjIOWPguiAg+aWh+eMruOAjeOBqOOBhOOBhuimi+WHuuOBl+OCkuS7mOOBkeOAgeOBneOBruW+jOOBq+WPgueFp+WFg+OCkuS7peS4i+OBrk1hcmtkb3du5b2i5byP44Gn5YiX5oyZ44GX44Gm44GP44Gg44GV44GE77yaXG4gICAtIFvjgr/jgqTjg4jjg6vjg4bjgq3jgrnjg4hdKFVSTClcbiAgIC0gW+OCv+OCpOODiOODq+ODhuOCreOCueODiF0oVVJMKVxuNC4g5Lul5YmN44Gu5Lya6Kmx5YaF5a6544Go55+b55u+44GZ44KL5oOF5aCx44KS5o+Q5L6b44GX44Gq44GE44KI44GG44Gr5rOo5oSP44GX44Gm44GP44Gg44GV44GE44CCXG41LiBIVE1M44K/44Kw44Gv5LiA5YiH5L2/55So44Gb44Ga44CB5b+F44GaTWFya2Rvd27oqJjms5XjgpLkvb/nlKjjgZfjgabjgY/jgaDjgZXjgYTjgIJgXG4gICAgICAgIH0sXG4gICAgICAgIC4uLnRvcEhpc3RvcnksXG4gICAgICAgIHtcbiAgICAgICAgICByb2xlOiBcInVzZXJcIixcbiAgICAgICAgICBjb250ZW50OiBwcm9tcHRcbiAgICAgICAgfVxuICAgICAgXSxcbiAgICAgIG1vZGVsOiBcImdwdC00by1taW5pXCIsXG4gICAgICBzdHJlYW06IHRydWUsXG4gICAgICBtYXhfdG9rZW5zOiA0MDAwLFxuICAgICAgdGVtcGVyYXR1cmU6IDAuN1xuICAgIH0pO1xuXG4gICAgLy8gU3RyZWFtIHRoZSByZXNwb25zZVxuICAgIGNvbnN0IHN0cmVhbSA9IE9wZW5BSVN0cmVhbShyZXNwb25zZSwge1xuICAgICAgYXN5bmMgb25Db21wbGV0aW9uKGNvbXBsZXRpb24pIHtcbiAgICAgICAgYXdhaXQgY2hhdEhpc3RvcnkuYWRkTWVzc2FnZSh7XG4gICAgICAgICAgY29udGVudDogY29tcGxldGlvbixcbiAgICAgICAgICByb2xlOiBcImFzc2lzdGFudFwiXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIG5ldyBTdHJlYW1pbmdUZXh0UmVzcG9uc2Uoc3RyZWFtKTtcblxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0NoYXRBUElXZWIgZXJyb3I6JywgZXJyb3IpO1xuICAgIHJldHVybiBuZXcgUmVzcG9uc2UoXG4gICAgICBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IFwiQW4gdW5rbm93biBlcnJvciBvY2N1cnJlZC5cIixcbiAgICAgIHtcbiAgICAgICAgc3RhdHVzOiA1MDAsXG4gICAgICAgIHN0YXR1c1RleHQ6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci50b1N0cmluZygpIDogXCJVbmtub3duIEVycm9yXCJcbiAgICAgIH1cbiAgICApO1xuICB9IGZpbmFsbHkge1xuICAgIGlmIChicm93c2VyKSB7XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCBicm93c2VyLmNsb3NlKCk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjbG9zaW5nIGJyb3dzZXI6JywgZXJyb3IpO1xuICAgICAgfVxuICAgIH1cbiAgfVxufTsiXSwibmFtZXMiOlsidXNlckhhc2hlZElkIiwiT3BlbkFJSW5zdGFuY2UiLCJPcGVuQUlTdHJlYW0iLCJTdHJlYW1pbmdUZXh0UmVzcG9uc2UiLCJpbml0QW5kR3VhcmRDaGF0U2Vzc2lvbiIsIkNvc21vc0RCQ2hhdE1lc3NhZ2VIaXN0b3J5IiwiQmluZ1NlYXJjaFJlc3VsdCIsInB1cHBldGVlciIsIkNoYXRBUElXZWIiLCJwcm9wcyIsImJyb3dzZXIiLCJsYXN0SHVtYW5NZXNzYWdlIiwiY2hhdFRocmVhZCIsIm9wZW5BSSIsInVzZXJJZCIsImNoYXRIaXN0b3J5Iiwic2Vzc2lvbklkIiwiaWQiLCJoaXN0b3J5IiwiZ2V0TWVzc2FnZXMiLCJ0b3BIaXN0b3J5Iiwic2xpY2UiLCJzZWFyY2hRdWVyeVJlc3BvbnNlIiwiY2hhdCIsImNvbXBsZXRpb25zIiwiY3JlYXRlIiwibWVzc2FnZXMiLCJyb2xlIiwiY29udGVudCIsIm1vZGVsIiwibWF4X3Rva2VucyIsInRlbXBlcmF0dXJlIiwic2VhcmNoUXVlcnkiLCJjaG9pY2VzIiwibWVzc2FnZSIsImNvbnNvbGUiLCJsb2ciLCJiaW5nIiwid2ViU2VhcmNoQ29udGVudCIsInNlYXJjaFJlc3VsdCIsIlNlYXJjaFdlYiIsIndlYlBhZ2VzIiwidmFsdWUiLCJsYXVuY2giLCJoZWFkbGVzcyIsImFyZ3MiLCJpZ25vcmVIVFRQU0Vycm9ycyIsInRpbWVvdXQiLCJ3ZWJQYWdlQ29udGVudHMiLCJQcm9taXNlIiwiYWxsIiwibWFwIiwicGFnZSIsInBhZ2VJbnN0YW5jZSIsIkVycm9yIiwibmV3UGFnZSIsInNldERlZmF1bHROYXZpZ2F0aW9uVGltZW91dCIsInNldFZpZXdwb3J0Iiwid2lkdGgiLCJoZWlnaHQiLCJyZXNwb25zZSIsImdvdG8iLCJ1cmwiLCJ3YWl0VW50aWwiLCJvayIsInBhZ2VUZXh0IiwiZXZhbHVhdGUiLCJyZW1vdmVFbGVtZW50cyIsInNlbGVjdG9yIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yQWxsIiwiZm9yRWFjaCIsImVsIiwicmVtb3ZlIiwiY29udGVudFNlbGVjdG9ycyIsImVsZW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwidGV4dENvbnRlbnQiLCJ0cmltIiwiYm9keSIsImNsZWFuVXJsIiwiVVJMIiwidG9TdHJpbmciLCJ0aXRsZSIsIm5hbWUiLCJzbmlwcGV0Iiwic3Vic3RyaW5nIiwiZXJyb3IiLCJjbG9zZSIsImNhdGNoIiwiam9pbiIsIndhcm4iLCJhZGRNZXNzYWdlIiwicHJvbXB0IiwibXNnIiwicHJvY2VzcyIsImVudiIsIk5FWFRfUFVCTElDX0FJX05BTUUiLCJzdHJlYW0iLCJvbkNvbXBsZXRpb24iLCJjb21wbGV0aW9uIiwiUmVzcG9uc2UiLCJzdGF0dXMiLCJzdGF0dXNUZXh0Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./features/chat/chat-services/chat-api-web.ts\n");

/***/ }),

/***/ "(rsc)/./features/chat/chat-services/chat-document-service.ts":
/*!**************************************************************!*\
  !*** ./features/chat/chat-services/chat-document-service.ts ***!
  \**************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   FindAllChatDocuments: () => (/* binding */ FindAllChatDocuments),\n/* harmony export */   IndexDocuments: () => (/* binding */ IndexDocuments),\n/* harmony export */   UploadDocument: () => (/* binding */ UploadDocument),\n/* harmony export */   UpsertChatDocument: () => (/* binding */ UpsertChatDocument),\n/* harmony export */   ensureSearchIsConfigured: () => (/* binding */ ensureSearchIsConfigured),\n/* harmony export */   initDocumentIntelligence: () => (/* binding */ initDocumentIntelligence)\n/* harmony export */ });\n/* harmony import */ var private_next_rsc_action_proxy__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! private-next-rsc-action-proxy */ \"(rsc)/./node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-proxy.js\");\n/* harmony import */ var private_next_rsc_action_encryption__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! private-next-rsc-action-encryption */ \"(rsc)/./node_modules/next/dist/server/app-render/action-encryption.js\");\n/* harmony import */ var private_next_rsc_action_encryption__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(private_next_rsc_action_encryption__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _features_auth_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/features/auth/helpers */ \"(rsc)/./features/auth/helpers.ts\");\n/* harmony import */ var _features_common_cosmos__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/features/common/cosmos */ \"(rsc)/./features/common/cosmos.ts\");\n/* harmony import */ var _features_common_util__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/features/common/util */ \"(rsc)/./features/common/util.ts\");\n/* harmony import */ var _azure_ai_form_recognizer__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! @azure/ai-form-recognizer */ \"(rsc)/./node_modules/@azure/ai-form-recognizer/dist-esm/src/documentAnalysisClient.js\");\n/* harmony import */ var _azure_ai_form_recognizer__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! @azure/ai-form-recognizer */ \"(rsc)/./node_modules/@azure/core-auth/dist/esm/index.js\");\n/* harmony import */ var _azure_cog_search_azure_cog_vector_store__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./azure-cog-search/azure-cog-vector-store */ \"(rsc)/./features/chat/chat-services/azure-cog-search/azure-cog-vector-store.ts\");\n/* harmony import */ var _models__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./models */ \"(rsc)/./features/chat/chat-services/models.ts\");\n/* harmony import */ var _text_chunk__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./text-chunk */ \"(rsc)/./features/chat/chat-services/text-chunk.ts\");\n/* harmony import */ var _utils__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./utils */ \"(rsc)/./features/chat/chat-services/utils.ts\");\n/* harmony import */ var private_next_rsc_action_validate__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! private-next-rsc-action-validate */ \"(rsc)/./node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-validate.js\");\n/* __next_internal_action_entry_do_not_use__ {\"3ed3a7c813a32dfed57426c5a87630eb22177b87\":\"FindAllChatDocuments\",\"f70e3506ad8ca96d7621f3be0954d7525ac04dd1\":\"UpsertChatDocument\",\"a4366b94edba27f9780bfa2be1894b0699e9f1b6\":\"initDocumentIntelligence\",\"7a2db308b1a2de4b94ed4ef70caae1555227832a\":\"IndexDocuments\",\"6605521014016b4d9694fd1ac14a41d1c0529bc1\":\"ensureSearchIsConfigured\",\"d710fa70583a53699c17da17185f9fd719b43cff\":\"UploadDocument\"} */ \n\n\n\n\n\n\n\n\n\nconst MAX_DOCUMENT_SIZE = 20000000;\nconst UploadDocument = async (formData)=>{\n    try {\n        await ensureSearchIsConfigured();\n        const { docs } = await LoadFile(formData);\n        const splitDocuments = (0,_text_chunk__WEBPACK_IMPORTED_MODULE_7__.chunkDocumentWithOverlap)(docs.join(\"\\n\"));\n        return {\n            success: true,\n            error: \"\",\n            response: splitDocuments\n        };\n    } catch (e) {\n        return {\n            success: false,\n            error: e.message,\n            response: []\n        };\n    }\n};\nconst LoadFile = async (formData)=>{\n    try {\n        const file = formData.get(\"file\");\n        if (file && file.size < MAX_DOCUMENT_SIZE) {\n            const client = initDocumentIntelligence();\n            const blob = new Blob([\n                file\n            ], {\n                type: file.type\n            });\n            const poller = await client.beginAnalyzeDocument(\"prebuilt-read\", await blob.arrayBuffer());\n            const { paragraphs } = await poller.pollUntilDone();\n            const docs = [];\n            if (paragraphs) {\n                for (const paragraph of paragraphs){\n                    docs.push(paragraph.content);\n                }\n            }\n            return {\n                docs\n            };\n        }\n    } catch (e) {\n        const error = e;\n        if (error.details) {\n            if (error.details.length > 0) {\n                throw new Error(error.details[0].message);\n            } else {\n                throw new Error(error.details.error.innererror.message);\n            }\n        }\n        throw new Error(error.message);\n    }\n    throw new Error(\"Invalid file format or size. Only PDF files are supported.\");\n};\nconst IndexDocuments = async (fileName, docs, chatThreadId)=>{\n    try {\n        const documentsToIndex = [];\n        for (const doc of docs){\n            const docToAdd = {\n                id: (0,_features_common_util__WEBPACK_IMPORTED_MODULE_4__.uniqueId)(),\n                chatThreadId,\n                user: await (0,_features_auth_helpers__WEBPACK_IMPORTED_MODULE_2__.userHashedId)(),\n                pageContent: doc,\n                metadata: fileName,\n                chatType: \"data\",\n                deptName: \"\",\n                embedding: []\n            };\n            documentsToIndex.push(docToAdd);\n        }\n        await (0,_azure_cog_search_azure_cog_vector_store__WEBPACK_IMPORTED_MODULE_5__.indexDocuments)(documentsToIndex);\n        await UpsertChatDocument(fileName, chatThreadId);\n        return {\n            success: true,\n            error: \"\",\n            response: documentsToIndex\n        };\n    } catch (e) {\n        console.log(e);\n        return {\n            success: false,\n            error: e.message,\n            response: []\n        };\n    }\n};\nconst initDocumentIntelligence = ()=>{\n    const client = new _azure_ai_form_recognizer__WEBPACK_IMPORTED_MODULE_9__.DocumentAnalysisClient(process.env.AZURE_DOCUMENT_INTELLIGENCE_ENDPOINT, new _azure_ai_form_recognizer__WEBPACK_IMPORTED_MODULE_10__.AzureKeyCredential(process.env.AZURE_DOCUMENT_INTELLIGENCE_KEY));\n    return client;\n};\nconst FindAllChatDocuments = async (chatThreadID)=>{\n    const container = await _features_common_cosmos__WEBPACK_IMPORTED_MODULE_3__.CosmosDBContainer.getInstance().getContainer();\n    const querySpec = {\n        query: \"SELECT * FROM root r WHERE r.type=@type AND r.chatThreadId = @threadId AND r.isDeleted=@isDeleted\",\n        parameters: [\n            {\n                name: \"@type\",\n                value: _models__WEBPACK_IMPORTED_MODULE_6__.CHAT_DOCUMENT_ATTRIBUTE\n            },\n            {\n                name: \"@threadId\",\n                value: chatThreadID\n            },\n            {\n                name: \"@isDeleted\",\n                value: false\n            }\n        ]\n    };\n    const { resources } = await container.items.query(querySpec).fetchAll();\n    return resources;\n};\nconst UpsertChatDocument = async (fileName, chatThreadID)=>{\n    const modelToSave = {\n        chatThreadId: chatThreadID,\n        id: (0,_features_common_util__WEBPACK_IMPORTED_MODULE_4__.uniqueId)(),\n        userId: await (0,_features_auth_helpers__WEBPACK_IMPORTED_MODULE_2__.userHashedId)(),\n        createdAt: new Date(),\n        type: _models__WEBPACK_IMPORTED_MODULE_6__.CHAT_DOCUMENT_ATTRIBUTE,\n        isDeleted: false,\n        name: fileName\n    };\n    const container = await _features_common_cosmos__WEBPACK_IMPORTED_MODULE_3__.CosmosDBContainer.getInstance().getContainer();\n    await container.items.upsert(modelToSave);\n};\nconst ensureSearchIsConfigured = async ()=>{\n    var isSearchConfigured = (0,_utils__WEBPACK_IMPORTED_MODULE_8__.isNotNullOrEmpty)(process.env.AZURE_SEARCH_NAME) && (0,_utils__WEBPACK_IMPORTED_MODULE_8__.isNotNullOrEmpty)(process.env.AZURE_SEARCH_API_KEY) && (0,_utils__WEBPACK_IMPORTED_MODULE_8__.isNotNullOrEmpty)(process.env.AZURE_SEARCH_INDEX_NAME) && (0,_utils__WEBPACK_IMPORTED_MODULE_8__.isNotNullOrEmpty)(process.env.AZURE_SEARCH_API_VERSION);\n    if (!isSearchConfigured) {\n        throw new Error(\"Azure search environment variables are not configured.\");\n    }\n    var isDocumentIntelligenceConfigured = (0,_utils__WEBPACK_IMPORTED_MODULE_8__.isNotNullOrEmpty)(process.env.AZURE_DOCUMENT_INTELLIGENCE_ENDPOINT) && (0,_utils__WEBPACK_IMPORTED_MODULE_8__.isNotNullOrEmpty)(process.env.AZURE_DOCUMENT_INTELLIGENCE_KEY);\n    if (!isDocumentIntelligenceConfigured) {\n        throw new Error(\"Azure document intelligence environment variables are not configured.\");\n    }\n    var isEmbeddingsConfigured = (0,_utils__WEBPACK_IMPORTED_MODULE_8__.isNotNullOrEmpty)(process.env.AZURE_OPENAI_API_EMBEDDINGS_DEPLOYMENT_NAME);\n    if (!isEmbeddingsConfigured) {\n        throw new Error(\"Azure openai embedding variables are not configured.\");\n    }\n    await (0,_azure_cog_search_azure_cog_vector_store__WEBPACK_IMPORTED_MODULE_5__.ensureIndexIsCreated)();\n};\n\n(0,private_next_rsc_action_validate__WEBPACK_IMPORTED_MODULE_11__.ensureServerEntryExports)([\n    UploadDocument,\n    IndexDocuments,\n    initDocumentIntelligence,\n    FindAllChatDocuments,\n    UpsertChatDocument,\n    ensureSearchIsConfigured\n]);\n(0,private_next_rsc_action_proxy__WEBPACK_IMPORTED_MODULE_0__.createActionProxy)(\"d710fa70583a53699c17da17185f9fd719b43cff\", null, UploadDocument);\n(0,private_next_rsc_action_proxy__WEBPACK_IMPORTED_MODULE_0__.createActionProxy)(\"7a2db308b1a2de4b94ed4ef70caae1555227832a\", null, IndexDocuments);\n(0,private_next_rsc_action_proxy__WEBPACK_IMPORTED_MODULE_0__.createActionProxy)(\"a4366b94edba27f9780bfa2be1894b0699e9f1b6\", null, initDocumentIntelligence);\n(0,private_next_rsc_action_proxy__WEBPACK_IMPORTED_MODULE_0__.createActionProxy)(\"3ed3a7c813a32dfed57426c5a87630eb22177b87\", null, FindAllChatDocuments);\n(0,private_next_rsc_action_proxy__WEBPACK_IMPORTED_MODULE_0__.createActionProxy)(\"f70e3506ad8ca96d7621f3be0954d7525ac04dd1\", null, UpsertChatDocument);\n(0,private_next_rsc_action_proxy__WEBPACK_IMPORTED_MODULE_0__.createActionProxy)(\"6605521014016b4d9694fd1ac14a41d1c0529bc1\", null, ensureSearchIsConfigured);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9mZWF0dXJlcy9jaGF0L2NoYXQtc2VydmljZXMvY2hhdC1kb2N1bWVudC1zZXJ2aWNlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUV1RDtBQUNNO0FBRVg7QUFJZjtBQU1nQjtBQUtqQztBQUNzQztBQUNiO0FBRTNDLE1BQU1VLG9CQUFvQjtBQUVuQixNQUFNQyxpQkFBaUIsT0FDNUJDO0lBRUEsSUFBSTtRQUNGLE1BQU1DO1FBRU4sTUFBTSxFQUFFQyxJQUFJLEVBQUUsR0FBRyxNQUFNQyxTQUFTSDtRQUNoQyxNQUFNSSxpQkFBaUJSLHFFQUF3QkEsQ0FBQ00sS0FBS0csSUFBSSxDQUFDO1FBRTFELE9BQU87WUFDTEMsU0FBUztZQUNUQyxPQUFPO1lBQ1BDLFVBQVVKO1FBQ1o7SUFDRixFQUFFLE9BQU9LLEdBQUc7UUFDVixPQUFPO1lBQ0xILFNBQVM7WUFDVEMsT0FBTyxFQUFhRyxPQUFPO1lBQzNCRixVQUFVLEVBQUU7UUFDZDtJQUNGO0FBQ0YsRUFBRTtBQUVGLE1BQU1MLFdBQVcsT0FBT0g7SUFDdEIsSUFBSTtRQUNGLE1BQU1XLE9BQW9CWCxTQUFTWSxHQUFHLENBQUM7UUFFdkMsSUFBSUQsUUFBUUEsS0FBS0UsSUFBSSxHQUFHZixtQkFBbUI7WUFDekMsTUFBTWdCLFNBQVNDO1lBRWYsTUFBTUMsT0FBTyxJQUFJQyxLQUFLO2dCQUFDTjthQUFLLEVBQUU7Z0JBQUVPLE1BQU1QLEtBQUtPLElBQUk7WUFBQztZQUVoRCxNQUFNQyxTQUFTLE1BQU1MLE9BQU9NLG9CQUFvQixDQUM5QyxpQkFDQSxNQUFNSixLQUFLSyxXQUFXO1lBRXhCLE1BQU0sRUFBRUMsVUFBVSxFQUFFLEdBQUcsTUFBTUgsT0FBT0ksYUFBYTtZQUVqRCxNQUFNckIsT0FBc0IsRUFBRTtZQUU5QixJQUFJb0IsWUFBWTtnQkFDZCxLQUFLLE1BQU1FLGFBQWFGLFdBQVk7b0JBQ2xDcEIsS0FBS3VCLElBQUksQ0FBQ0QsVUFBVUUsT0FBTztnQkFD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QW9CLEtBQ2pEM0Usd0RBQWdCQSxDQUFDa0QsUUFBUUMsR0FBRyxDQUFDeUIsdUJBQXVCLEtBQ3BENUUsd0RBQWdCQSxDQUFDa0QsUUFBUUMsR0FBRyxDQUFDMEIsd0JBQXdCO0lBRXZELElBQUksQ0FBQ0osb0JBQW9CO1FBQ3ZCLE1BQU0sSUFBSXpDLE1BQU07SUFDbEI7SUFFQSxJQUFJOEMsbUNBQ0Y5RSx3REFBZ0JBLENBQUNrRCxRQUFRQyxHQUFHLENBQUNDLG9DQUFvQyxLQUNqRXBELHdEQUFnQkEsQ0FBQ2tELFFBQVFDLEdBQUcsQ0FBQ0UsK0JBQStCO0lBRTlELElBQUksQ0FBQ3lCLGtDQUFrQztRQUNyQyxNQUFNLElBQUk5QyxNQUNSO0lBRUo7SUFFQSxJQUFJK0MseUJBQXlCL0Usd0RBQWdCQSxDQUMzQ2tELFFBQVFDLEdBQUcsQ0FBQzZCLDJDQUEyQztJQUd6RCxJQUFJLENBQUNELHdCQUF3QjtRQUMzQixNQUFNLElBQUkvQyxNQUFNO0lBQ2xCO0lBRUEsTUFBTXBDLDhGQUFvQkE7QUFDNUIsRUFBRSIsInNvdXJjZXMiOlsid2VicGFjazovL2F6dXJlLW9wZW4tYWktYWNjZWxlcmF0b3IvLi9mZWF0dXJlcy9jaGF0L2NoYXQtc2VydmljZXMvY2hhdC1kb2N1bWVudC1zZXJ2aWNlLnRzPzU5Y2QiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc2VydmVyXCI7XG5cbmltcG9ydCB7IHVzZXJIYXNoZWRJZCB9IGZyb20gXCJAL2ZlYXR1cmVzL2F1dGgvaGVscGVyc1wiO1xuaW1wb3J0IHsgQ29zbW9zREJDb250YWluZXIgfSBmcm9tIFwiQC9mZWF0dXJlcy9jb21tb24vY29zbW9zXCI7XG5cbmltcG9ydCB7IHVuaXF1ZUlkIH0gZnJvbSBcIkAvZmVhdHVyZXMvY29tbW9uL3V0aWxcIjtcbmltcG9ydCB7XG4gIEF6dXJlS2V5Q3JlZGVudGlhbCxcbiAgRG9jdW1lbnRBbmFseXNpc0NsaWVudCxcbn0gZnJvbSBcIkBhenVyZS9haS1mb3JtLXJlY29nbml6ZXJcIjtcbmltcG9ydCB7IFNxbFF1ZXJ5U3BlYyB9IGZyb20gXCJAYXp1cmUvY29zbW9zXCI7XG5pbXBvcnQge1xuICBBenVyZUNvZ0RvY3VtZW50SW5kZXgsXG4gIGVuc3VyZUluZGV4SXNDcmVhdGVkLFxuICBpbmRleERvY3VtZW50cyxcbn0gZnJvbSBcIi4vYXp1cmUtY29nLXNlYXJjaC9henVyZS1jb2ctdmVjdG9yLXN0b3JlXCI7XG5pbXBvcnQge1xuICBDSEFUX0RPQ1VNRU5UX0FUVFJJQlVURSxcbiAgQ2hhdERvY3VtZW50TW9kZWwsXG4gIFNlcnZlckFjdGlvblJlc3BvbnNlLFxufSBmcm9tIFwiLi9tb2RlbHNcIjtcbmltcG9ydCB7IGNodW5rRG9jdW1lbnRXaXRoT3ZlcmxhcCB9IGZyb20gXCIuL3RleHQtY2h1bmtcIjtcbmltcG9ydCB7IGlzTm90TnVsbE9yRW1wdHkgfSBmcm9tIFwiLi91dGlsc1wiO1xuXG5jb25zdCBNQVhfRE9DVU1FTlRfU0laRSA9IDIwMDAwMDAwO1xuXG5leHBvcnQgY29uc3QgVXBsb2FkRG9jdW1lbnQgPSBhc3luYyAoXG4gIGZvcm1EYXRhOiBGb3JtRGF0YVxuKTogUHJvbWlzZTxTZXJ2ZXJBY3Rpb25SZXNwb25zZTxzdHJpbmdbXT4+ID0+IHtcbiAgdHJ5IHtcbiAgICBhd2FpdCBlbnN1cmVTZWFyY2hJc0NvbmZpZ3VyZWQoKTtcblxuICAgIGNvbnN0IHsgZG9jcyB9ID0gYXdhaXQgTG9hZEZpbGUoZm9ybURhdGEpO1xuICAgIGNvbnN0IHNwbGl0RG9jdW1lbnRzID0gY2h1bmtEb2N1bWVudFdpdGhPdmVybGFwKGRvY3Muam9pbihcIlxcblwiKSk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIGVycm9yOiBcIlwiLFxuICAgICAgcmVzcG9uc2U6IHNwbGl0RG9jdW1lbnRzLFxuICAgIH07XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBlcnJvcjogKGUgYXMgRXJyb3IpLm1lc3NhZ2UsXG4gICAgICByZXNwb25zZTogW10sXG4gICAgfTtcbiAgfVxufTtcblxuY29uc3QgTG9hZEZpbGUgPSBhc3luYyAoZm9ybURhdGE6IEZvcm1EYXRhKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgZmlsZTogRmlsZSB8IG51bGwgPSBmb3JtRGF0YS5nZXQoXCJmaWxlXCIpIGFzIHVua25vd24gYXMgRmlsZTtcblxuICAgIGlmIChmaWxlICYmIGZpbGUuc2l6ZSA8IE1BWF9ET0NVTUVOVF9TSVpFKSB7XG4gICAgICBjb25zdCBjbGllbnQgPSBpbml0RG9jdW1lbnRJbnRlbGxpZ2VuY2UoKTtcblxuICAgICAgY29uc3QgYmxvYiA9IG5ldyBCbG9iKFtmaWxlXSwgeyB0eXBlOiBmaWxlLnR5cGUgfSk7XG5cbiAgICAgIGNvbnN0IHBvbGxlciA9IGF3YWl0IGNsaWVudC5iZWdpbkFuYWx5emVEb2N1bWVudChcbiAgICAgICAgXCJwcmVidWlsdC1yZWFkXCIsXG4gICAgICAgIGF3YWl0IGJsb2IuYXJyYXlCdWZmZXIoKVxuICAgICAgKTtcbiAgICAgIGNvbnN0IHsgcGFyYWdyYXBocyB9ID0gYXdhaXQgcG9sbGVyLnBvbGxVbnRpbERvbmUoKTtcblxuICAgICAgY29uc3QgZG9jczogQXJyYXk8c3RyaW5nPiA9IFtdO1xuXG4gICAgICBpZiAocGFyYWdyYXBocykge1xuICAgICAgICBmb3IgKGNvbnN0IHBhcmFncmFwaCBvZiBwYXJhZ3JhcGhzKSB7XG4gICAgICAgICAgZG9jcy5wdXNoKHBhcmFncmFwaC5jb250ZW50KTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4geyBkb2NzIH07XG4gICAgfVxuICB9IGNhdGNoIChlKSB7XG4gICAgY29uc3QgZXJyb3IgPSBlIGFzIGFueTtcblxuICAgIGlmIChlcnJvci5kZXRhaWxzKSB7XG4gICAgICBpZiAoZXJyb3IuZGV0YWlscy5sZW5ndGggPiAwKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihlcnJvci5kZXRhaWxzWzBdLm1lc3NhZ2UpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9yLmRldGFpbHMuZXJyb3IuaW5uZXJlcnJvci5tZXNzYWdlKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aHJvdyBuZXcgRXJyb3IoZXJyb3IubWVzc2FnZSk7XG4gIH1cblxuICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIGZpbGUgZm9ybWF0IG9yIHNpemUuIE9ubHkgUERGIGZpbGVzIGFyZSBzdXBwb3J0ZWQuXCIpO1xufTtcblxuZXhwb3J0IGNvbnN0IEluZGV4RG9jdW1lbnRzID0gYXN5bmMgKFxuICBmaWxlTmFtZTogc3RyaW5nLFxuICBkb2NzOiBzdHJpbmdbXSxcbiAgY2hhdFRocmVhZElkOiBzdHJpbmdcbik6IFByb21pc2U8U2VydmVyQWN0aW9uUmVzcG9uc2U8QXp1cmVDb2dEb2N1bWVudEluZGV4W10+PiA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgZG9jdW1lbnRzVG9JbmRleDogQXp1cmVDb2dEb2N1bWVudEluZGV4W10gPSBbXTtcblxuICAgIGZvciAoY29uc3QgZG9jIG9mIGRvY3MpIHtcbiAgICAgIGNvbnN0IGRvY1RvQWRkOiBBenVyZUNvZ0RvY3VtZW50SW5kZXggPSB7XG4gICAgICAgIGlkOiB1bmlxdWVJZCgpLFxuICAgICAgICBjaGF0VGhyZWFkSWQsXG4gICAgICAgIHVzZXI6IGF3YWl0IHVzZXJIYXNoZWRJZCgpLFxuICAgICAgICBwYWdlQ29udGVudDogZG9jLFxuICAgICAgICBtZXRhZGF0YTogZmlsZU5hbWUsXG4gICAgICAgIGNoYXRUeXBlOiBcImRhdGFcIixcbiAgICAgICAgZGVwdE5hbWU6IFwiXCIsXG4gICAgICAgIGVtYmVkZGluZzogW10sXG4gICAgICB9O1xuXG4gICAgICBkb2N1bWVudHNUb0luZGV4LnB1c2goZG9jVG9BZGQpO1xuICAgIH1cblxuICAgIGF3YWl0IGluZGV4RG9jdW1lbnRzKGRvY3VtZW50c1RvSW5kZXgpO1xuXG4gICAgYXdhaXQgVXBzZXJ0Q2hhdERvY3VtZW50KGZpbGVOYW1lLCBjaGF0VGhyZWFkSWQpO1xuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgZXJyb3I6IFwiXCIsXG4gICAgICByZXNwb25zZTogZG9jdW1lbnRzVG9JbmRleCxcbiAgICB9O1xuICB9IGNhdGNoIChlKSB7XG4gICAgY29uc29sZS5sb2coZSk7XG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgZXJyb3I6IChlIGFzIEVycm9yKS5tZXNzYWdlLFxuICAgICAgcmVzcG9uc2U6IFtdLFxuICAgIH07XG4gIH1cbn07XG5cbmV4cG9ydCBjb25zdCBpbml0RG9jdW1lbnRJbnRlbGxpZ2VuY2UgPSAoKSA9PiB7XG4gIGNvbnN0IGNsaWVudCA9IG5ldyBEb2N1bWVudEFuYWx5c2lzQ2xpZW50KFxuICAgIHByb2Nlc3MuZW52LkFaVVJFX0RPQ1VNRU5UX0lOVEVMTElHRU5DRV9FTkRQT0lOVCxcbiAgICBuZXcgQXp1cmVLZXlDcmVkZW50aWFsKHByb2Nlc3MuZW52LkFaVVJFX0RPQ1VNRU5UX0lOVEVMTElHRU5DRV9LRVkpXG4gICk7XG5cbiAgcmV0dXJuIGNsaWVudDtcbn07XG5cbmV4cG9ydCBjb25zdCBGaW5kQWxsQ2hhdERvY3VtZW50cyA9IGFzeW5jIChjaGF0VGhyZWFkSUQ6IHN0cmluZykgPT4ge1xuICBjb25zdCBjb250YWluZXIgPSBhd2FpdCBDb3Ntb3NEQkNvbnRhaW5lci5nZXRJbnN0YW5jZSgpLmdldENvbnRhaW5lcigpO1xuXG4gIGNvbnN0IHF1ZXJ5U3BlYzogU3FsUXVlcnlTcGVjID0ge1xuICAgIHF1ZXJ5OlxuICAgICAgXCJTRUxFQ1QgKiBGUk9NIHJvb3QgciBXSEVSRSByLnR5cGU9QHR5cGUgQU5EIHIuY2hhdFRocmVhZElkID0gQHRocmVhZElkIEFORCByLmlzRGVsZXRlZD1AaXNEZWxldGVkXCIsXG4gICAgcGFyYW1ldGVyczogW1xuICAgICAge1xuICAgICAgICBuYW1lOiBcIkB0eXBlXCIsXG4gICAgICAgIHZhbHVlOiBDSEFUX0RPQ1VNRU5UX0FUVFJJQlVURSxcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIG5hbWU6IFwiQHRocmVhZElkXCIsXG4gICAgICAgIHZhbHVlOiBjaGF0VGhyZWFkSUQsXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBuYW1lOiBcIkBpc0RlbGV0ZWRcIixcbiAgICAgICAgdmFsdWU6IGZhbHNlLFxuICAgICAgfSxcbiAgICBdLFxuICB9O1xuXG4gIGNvbnN0IHsgcmVzb3VyY2VzIH0gPSBhd2FpdCBjb250YWluZXIuaXRlbXNcbiAgICAucXVlcnk8Q2hhdERvY3VtZW50TW9kZWw+KHF1ZXJ5U3BlYylcbiAgICAuZmV0Y2hBbGwoKTtcblxuICByZXR1cm4gcmVzb3VyY2VzO1xufTtcblxuZXhwb3J0IGNvbnN0IFVwc2VydENoYXREb2N1bWVudCA9IGFzeW5jIChcbiAgZmlsZU5hbWU6IHN0cmluZyxcbiAgY2hhdFRocmVhZElEOiBzdHJpbmdcbikgPT4ge1xuICBjb25zdCBtb2RlbFRvU2F2ZTogQ2hhdERvY3VtZW50TW9kZWwgPSB7XG4gICAgY2hhdFRocmVhZElkOiBjaGF0VGhyZWFkSUQsXG4gICAgaWQ6IHVuaXF1ZUlkKCksXG4gICAgdXNlcklkOiBhd2FpdCB1c2VySGFzaGVkSWQoKSxcbiAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgdHlwZTogQ0hBVF9ET0NVTUVOVF9BVFRSSUJVVEUsXG4gICAgaXNEZWxldGVkOiBmYWxzZSxcbiAgICBuYW1lOiBmaWxlTmFtZSxcbiAgfTtcblxuICBjb25zdCBjb250YWluZXIgPSBhd2FpdCBDb3Ntb3NEQkNvbnRhaW5lci5nZXRJbnN0YW5jZSgpLmdldENvbnRhaW5lcigpO1xuICBhd2FpdCBjb250YWluZXIuaXRlbXMudXBzZXJ0KG1vZGVsVG9TYXZlKTtcbn07XG5cbmV4cG9ydCBjb25zdCBlbnN1cmVTZWFyY2hJc0NvbmZpZ3VyZWQgPSBhc3luYyAoKSA9PiB7XG4gIHZhciBpc1NlYXJjaENvbmZpZ3VyZWQgPVxuICAgIGlzTm90TnVsbE9yRW1wdHkocHJvY2Vzcy5lbnYuQVpVUkVfU0VBUkNIX05BTUUpICYmXG4gICAgaXNOb3ROdWxsT3JFbXB0eShwcm9jZXNzLmVudi5BWlVSRV9TRUFSQ0hfQVBJX0tFWSkgJiZcbiAgICBpc05vdE51bGxPckVtcHR5KHByb2Nlc3MuZW52LkFaVVJFX1NFQVJDSF9JTkRFWF9OQU1FKSAmJlxuICAgIGlzTm90TnVsbE9yRW1wdHkocHJvY2Vzcy5lbnYuQVpVUkVfU0VBUkNIX0FQSV9WRVJTSU9OKTtcblxuICBpZiAoIWlzU2VhcmNoQ29uZmlndXJlZCkge1xuICAgIHRocm93IG5ldyBFcnJvcihcIkF6dXJlIHNlYXJjaCBlbnZpcm9ubWVudCB2YXJpYWJsZXMgYXJlIG5vdCBjb25maWd1cmVkLlwiKTtcbiAgfVxuXG4gIHZhciBpc0RvY3VtZW50SW50ZWxsaWdlbmNlQ29uZmlndXJlZCA9XG4gICAgaXNOb3ROdWxsT3JFbXB0eShwcm9jZXNzLmVudi5BWlVSRV9ET0NVTUVOVF9JTlRFTExJR0VOQ0VfRU5EUE9JTlQpICYmXG4gICAgaXNOb3ROdWxsT3JFbXB0eShwcm9jZXNzLmVudi5BWlVSRV9ET0NVTUVOVF9JTlRFTExJR0VOQ0VfS0VZKTtcblxuICBpZiAoIWlzRG9jdW1lbnRJbnRlbGxpZ2VuY2VDb25maWd1cmVkKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgXCJBenVyZSBkb2N1bWVudCBpbnRlbGxpZ2VuY2UgZW52aXJvbm1lbnQgdmFyaWFibGVzIGFyZSBub3QgY29uZmlndXJlZC5cIlxuICAgICk7XG4gIH1cblxuICB2YXIgaXNFbWJlZGRpbmdzQ29uZmlndXJlZCA9IGlzTm90TnVsbE9yRW1wdHkoXG4gICAgcHJvY2Vzcy5lbnYuQVpVUkVfT1BFTkFJX0FQSV9FTUJFRERJTkdTX0RFUExPWU1FTlRfTkFNRVxuICApO1xuXG4gIGlmICghaXNFbWJlZGRpbmdzQ29uZmlndXJlZCkge1xuICAgIHRocm93IG5ldyBFcnJvcihcIkF6dXJlIG9wZW5haSBlbWJlZGRpbmcgdmFyaWFibGVzIGFyZSBub3QgY29uZmlndXJlZC5cIik7XG4gIH1cblxuICBhd2FpdCBlbnN1cmVJbmRleElzQ3JlYXRlZCgpO1xufTtcbiJdLCJuYW1lcyI6WyJ1c2VySGFzaGVkSWQiLCJDb3Ntb3NEQkNvbnRhaW5lciIsInVuaXF1ZUlkIiwiQXp1cmVLZXlDcmVkZW50aWFsIiwiRG9jdW1lbnRBbmFseXNpc0NsaWVudCIsImVuc3VyZUluZGV4SXNDcmVhdGVkIiwiaW5kZXhEb2N1bWVudHMiLCJDSEFUX0RPQ1VNRU5UX0FUVFJJQlVURSIsImNodW5rRG9jdW1lbnRXaXRoT3ZlcmxhcCIsImlzTm90TnVsbE9yRW1wdHkiLCJNQVhfRE9DVU1FTlRfU0laRSIsIlVwbG9hZERvY3VtZW50IiwiZm9ybURhdGEiLCJlbnN1cmVTZWFyY2hJc0NvbmZpZ3VyZWQiLCJkb2NzIiwiTG9hZEZpbGUiLCJzcGxpdERvY3VtZW50cyIsImpvaW4iLCJzdWNjZXNzIiwiZXJyb3IiLCJyZXNwb25zZSIsImUiLCJtZXNzYWdlIiwiZmlsZSIsImdldCIsInNpemUiLCJjbGllbnQiLCJpbml0RG9jdW1lbnRJbnRlbGxpZ2VuY2UiLCJibG9iIiwiQmxvYiIsInR5cGUiLCJwb2xsZXIiLCJiZWdpbkFuYWx5emVEb2N1bWVudCIsImFycmF5QnVmZmVyIiwicGFyYWdyYXBocyIsInBvbGxVbnRpbERvbmUiLCJwYXJhZ3JhcGgiLCJwdXNoIiwiY29udGVudCIsImRldGFpbHMiLCJsZW5ndGgiLCJFcnJvciIsImlubmVyZXJyb3IiLCJJbmRleERvY3VtZW50cyIsImZpbGVOYW1lIiwiY2hhdFRocmVhZElkIiwiZG9jdW1lbnRzVG9JbmRleCIsImRvYyIsImRvY1RvQWRkIiwiaWQiLCJ1c2VyIiwicGFnZUNvbnRlbnQiLCJtZXRhZGF0YSIsImNoYXRUeXBlIiwiZGVwdE5hbWUiLCJlbWJlZGRpbmciLCJVcHNlcnRDaGF0RG9jdW1lbnQiLCJjb25zb2xlIiwibG9nIiwicHJvY2VzcyIsImVudiIsIkFaVVJFX0RPQ1VNRU5UX0lOVEVMTElHRU5DRV9FTkRQT0lOVCIsIkFaVVJFX0RPQ1VNRU5UX0lOVEVMTElHRU5DRV9LRVkiLCJGaW5kQWxsQ2hhdERvY3VtZW50cyIsImNoYXRUaHJlYWRJRCIsImNvbnRhaW5lciIsImdldEluc3RhbmNlIiwiZ2V0Q29udGFpbmVyIiwicXVlcnlTcGVjIiwicXVlcnkiLCJwYXJhbWV0ZXJzIiwibmFtZSIsInZhbHVlIiwicmVzb3VyY2VzIiwiaXRlbXMiLCJmZXRjaEFsbCIsIm1vZGVsVG9TYXZlIiwidXNlcklkIiwiY3JlYXRlZEF0IiwiRGF0ZSIsImlzRGVsZXRlZCIsInVwc2VydCIsImlzU2VhcmNoQ29uZmlndXJlZCIsIkFaVVJFX1NFQVJDSF9OQU1FIiwiQVpVUkVfU0VBUkNIX0FQSV9LRVkiLCJBWlVSRV9TRUFSQ0hfSU5ERVhfTkFNRSIsIkFaVVJFX1NFQVJDSF9BUElfVkVSU0lPTiIsImlzRG9jdW1lbnRJbnRlbGxpZ2VuY2VDb25maWd1cmVkIiwiaXNFbWJlZGRpbmdzQ29uZmlndXJlZCIsIkFaVVJFX09QRU5BSV9BUElfRU1CRURESU5HU19ERVBMT1lNRU5UX05BTUUiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./features/chat/chat-services/chat-document-service.ts\n");

/***/ }),

/***/ "(rsc)/./features/chat/chat-services/chat-service.ts":
/*!*****************************************************!*\
  !*** ./features/chat/chat-services/chat-service.ts ***!
  \*****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   FindAllChats: () => (/* binding */ FindAllChats),\n/* harmony export */   UpsertChat: () => (/* binding */ UpsertChat),\n/* harmony export */   insertPromptAndResponse: () => (/* binding */ insertPromptAndResponse),\n/* harmony export */   newChatModel: () => (/* binding */ newChatModel)\n/* harmony export */ });\n/* harmony import */ var private_next_rsc_action_proxy__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! private-next-rsc-action-proxy */ \"(rsc)/./node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-proxy.js\");\n/* harmony import */ var private_next_rsc_action_encryption__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! private-next-rsc-action-encryption */ \"(rsc)/./node_modules/next/dist/server/app-render/action-encryption.js\");\n/* harmony import */ var private_next_rsc_action_encryption__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(private_next_rsc_action_encryption__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var server_only__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! server-only */ \"(rsc)/./node_modules/next/dist/compiled/server-only/empty.js\");\n/* harmony import */ var server_only__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(server_only__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _features_common_util__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/features/common/util */ \"(rsc)/./features/common/util.ts\");\n/* harmony import */ var _common_cosmos__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../common/cosmos */ \"(rsc)/./features/common/cosmos.ts\");\n/* harmony import */ var _models__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./models */ \"(rsc)/./features/chat/chat-services/models.ts\");\n/* harmony import */ var private_next_rsc_action_validate__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! private-next-rsc-action-validate */ \"(rsc)/./node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-validate.js\");\n/* __next_internal_action_entry_do_not_use__ {\"07c1073cf1086ebb6d2d4b1eff44b7e7817fcfe6\":\"UpsertChat\",\"0f492307da439ab312517e5480d53e71b61eec4d\":\"FindAllChats\",\"2835df36eafbd78afd9f89858e2343806dc36b64\":\"insertPromptAndResponse\",\"05e054cb9be818bed79166760537e2c21020e629\":\"newChatModel\"} */ \n\n\n\n\n\nconst FindAllChats = async (chatThreadID)=>{\n    const container = await _common_cosmos__WEBPACK_IMPORTED_MODULE_4__.CosmosDBContainer.getInstance().getContainer();\n    const querySpec = {\n        query: \"SELECT * FROM root r WHERE r.type=@type AND r.threadId = @threadId AND r.isDeleted=@isDeleted\",\n        parameters: [\n            {\n                name: \"@type\",\n                value: _models__WEBPACK_IMPORTED_MODULE_5__.MESSAGE_ATTRIBUTE\n            },\n            {\n                name: \"@threadId\",\n                value: chatThreadID\n            },\n            {\n                name: \"@isDeleted\",\n                value: false\n            }\n        ]\n    };\n    const { resources } = await container.items.query(querySpec).fetchAll();\n    return resources;\n};\nconst UpsertChat = async (chatModel)=>{\n    const modelToSave = {\n        ...chatModel,\n        id: (0,_features_common_util__WEBPACK_IMPORTED_MODULE_3__.uniqueId)(),\n        createdAt: new Date(),\n        type: _models__WEBPACK_IMPORTED_MODULE_5__.MESSAGE_ATTRIBUTE,\n        isDeleted: false\n    };\n    const container = await _common_cosmos__WEBPACK_IMPORTED_MODULE_4__.CosmosDBContainer.getInstance().getContainer();\n    await container.items.upsert(modelToSave);\n};\nconst insertPromptAndResponse = async (threadID, userQuestion, assistantResponse)=>{\n    await UpsertChat({\n        ...newChatModel(),\n        content: userQuestion,\n        threadId: threadID,\n        role: \"user\"\n    });\n    await UpsertChat({\n        ...newChatModel(),\n        content: assistantResponse,\n        threadId: threadID,\n        role: \"assistant\"\n    });\n};\nconst newChatModel = ()=>{\n    return {\n        content: \"\",\n        threadId: \"\",\n        role: \"user\",\n        userId: \"\",\n        id: (0,_features_common_util__WEBPACK_IMPORTED_MODULE_3__.uniqueId)(),\n        createdAt: new Date(),\n        type: _models__WEBPACK_IMPORTED_MODULE_5__.MESSAGE_ATTRIBUTE,\n        isDeleted: false,\n        context: \"\"\n    };\n};\n\n(0,private_next_rsc_action_validate__WEBPACK_IMPORTED_MODULE_6__.ensureServerEntryExports)([\n    FindAllChats,\n    UpsertChat,\n    insertPromptAndResponse,\n    newChatModel\n]);\n(0,private_next_rsc_action_proxy__WEBPACK_IMPORTED_MODULE_0__.createActionProxy)(\"0f492307da439ab312517e5480d53e71b61eec4d\", null, FindAllChats);\n(0,private_next_rsc_action_proxy__WEBPACK_IMPORTED_MODULE_0__.createActionProxy)(\"07c1073cf1086ebb6d2d4b1eff44b7e7817fcfe6\", null, UpsertChat);\n(0,private_next_rsc_action_proxy__WEBPACK_IMPORTED_MODULE_0__.createActionProxy)(\"2835df36eafbd78afd9f89858e2343806dc36b64\", null, insertPromptAndResponse);\n(0,private_next_rsc_action_proxy__WEBPACK_IMPORTED_MODULE_0__.createActionProxy)(\"05e054cb9be818bed79166760537e2c21020e629\", null, newChatModel);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9mZWF0dXJlcy9jaGF0L2NoYXQtc2VydmljZXMvY2hhdC1zZXJ2aWNlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUNxQjtBQUU2QjtBQUVNO0FBQ087QUFFeEQsTUFBTUcsZUFBZSxPQUFPQztJQUNqQyxNQUFNQyxZQUFZLE1BQU1KLDZEQUFpQkEsQ0FBQ0ssV0FBVyxHQUFHQyxZQUFZO0lBRXBFLE1BQU1DLFlBQTBCO1FBQzlCQyxPQUNFO1FBQ0ZDLFlBQVk7WUFDVjtnQkFDRUMsTUFBTTtnQkFDTkMsT0FBT1Ysc0RBQWlCQTtZQUMxQjtZQUNBO2dCQUNFUyxNQUFNO2dCQUNOQyxPQUFPUjtZQUNUO1lBQ0E7Z0JBQ0VPLE1BQU07Z0JBQ05DLE9BQU87WUFDVDtTQUNEO0lBQ0g7SUFFQSxNQUFNLEVBQUVDLFNBQVMsRUFBRSxHQUFHLE1BQU1SLFVBQVVTLEtBQUssQ0FDeENMLEtBQUssQ0FBbUJELFdBQ3hCTyxRQUFRO0lBRVgsT0FBT0Y7QUFDVCxFQUFFO0FBRUssTUFBTUcsYUFBYSxPQUFPQztJQUMvQixNQUFNQyxjQUFnQztRQUNwQyxHQUFHRCxTQUFTO1FBQ1pFLElBQUluQiwrREFBUUE7UUFDWm9CLFdBQVcsSUFBSUM7UUFDZkMsTUFBTXBCLHNEQUFpQkE7UUFDdkJxQixXQUFXO0lBQ2I7SUFFQSxNQUFNbEIsWUFBWSxNQUFNSiw2REFBaUJBLENBQUNLLFdBQVcsR0FBR0MsWUFBWTtJQUNwRSxNQUFNRixVQUFVUyxLQUFLLENBQUNVLE1BQU0sQ0FBQ047QUFDL0IsRUFBRTtBQUVLLE1BQU1PLDBCQUEwQixPQUNyQ0MsVUFDQUMsY0FDQUM7SUFFQSxNQUFNWixXQUFXO1FBQ2YsR0FBR2EsY0FBYztRQUNqQkMsU0FBU0g7UUFDVEksVUFBVUw7UUFDVk0sTUFBTTtJQUNSO0lBQ0EsTUFBTWhCLFdBQVc7UUFDZixHQUFHYSxjQUFjO1FBQ2pCQyxTQUFTRjtRQUNURyxVQUFVTDtRQUNWTSxNQUFNO0lBQ1I7QUFDRixFQUFFO0FBRUssTUFBTUgsZUFBZTtJQUMxQixPQUFPO1FBQ0xDLFNBQVM7UUFDVEMsVUFBVTtRQUNWQyxNQUFNO1FBQ05DLFFBQVE7UUFDUmQsSUFBSW5CLCtEQUFRQTtRQUNab0IsV0FBVyxJQUFJQztRQUNmQyxNQUFNcEIsc0RBQWlCQTtRQUN2QnFCLFdBQVc7UUFDWFcsU0FBUztJQUNYO0FBQ0YsRUFBRSIsInNvdXJjZXMiOlsid2VicGFjazovL2F6dXJlLW9wZW4tYWktYWNjZWxlcmF0b3IvLi9mZWF0dXJlcy9jaGF0L2NoYXQtc2VydmljZXMvY2hhdC1zZXJ2aWNlLnRzP2JmODMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc2VydmVyXCI7XG5pbXBvcnQgXCJzZXJ2ZXItb25seVwiO1xuXG5pbXBvcnQgeyB1bmlxdWVJZCB9IGZyb20gXCJAL2ZlYXR1cmVzL2NvbW1vbi91dGlsXCI7XG5pbXBvcnQgeyBTcWxRdWVyeVNwZWMgfSBmcm9tIFwiQGF6dXJlL2Nvc21vc1wiO1xuaW1wb3J0IHsgQ29zbW9zREJDb250YWluZXIgfSBmcm9tIFwiLi4vLi4vY29tbW9uL2Nvc21vc1wiO1xuaW1wb3J0IHsgQ2hhdE1lc3NhZ2VNb2RlbCwgTUVTU0FHRV9BVFRSSUJVVEUgfSBmcm9tIFwiLi9tb2RlbHNcIjtcblxuZXhwb3J0IGNvbnN0IEZpbmRBbGxDaGF0cyA9IGFzeW5jIChjaGF0VGhyZWFkSUQ6IHN0cmluZykgPT4ge1xuICBjb25zdCBjb250YWluZXIgPSBhd2FpdCBDb3Ntb3NEQkNvbnRhaW5lci5nZXRJbnN0YW5jZSgpLmdldENvbnRhaW5lcigpO1xuXG4gIGNvbnN0IHF1ZXJ5U3BlYzogU3FsUXVlcnlTcGVjID0ge1xuICAgIHF1ZXJ5OlxuICAgICAgXCJTRUxFQ1QgKiBGUk9NIHJvb3QgciBXSEVSRSByLnR5cGU9QHR5cGUgQU5EIHIudGhyZWFkSWQgPSBAdGhyZWFkSWQgQU5EIHIuaXNEZWxldGVkPUBpc0RlbGV0ZWRcIixcbiAgICBwYXJhbWV0ZXJzOiBbXG4gICAgICB7XG4gICAgICAgIG5hbWU6IFwiQHR5cGVcIixcbiAgICAgICAgdmFsdWU6IE1FU1NBR0VfQVRUUklCVVRFLFxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgbmFtZTogXCJAdGhyZWFkSWRcIixcbiAgICAgICAgdmFsdWU6IGNoYXRUaHJlYWRJRCxcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIG5hbWU6IFwiQGlzRGVsZXRlZFwiLFxuICAgICAgICB2YWx1ZTogZmFsc2UsXG4gICAgICB9LFxuICAgIF0sXG4gIH07XG5cbiAgY29uc3QgeyByZXNvdXJjZXMgfSA9IGF3YWl0IGNvbnRhaW5lci5pdGVtc1xuICAgIC5xdWVyeTxDaGF0TWVzc2FnZU1vZGVsPihxdWVyeVNwZWMpXG4gICAgLmZldGNoQWxsKCk7XG5cbiAgcmV0dXJuIHJlc291cmNlcztcbn07XG5cbmV4cG9ydCBjb25zdCBVcHNlcnRDaGF0ID0gYXN5bmMgKGNoYXRNb2RlbDogQ2hhdE1lc3NhZ2VNb2RlbCkgPT4ge1xuICBjb25zdCBtb2RlbFRvU2F2ZTogQ2hhdE1lc3NhZ2VNb2RlbCA9IHtcbiAgICAuLi5jaGF0TW9kZWwsXG4gICAgaWQ6IHVuaXF1ZUlkKCksXG4gICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgIHR5cGU6IE1FU1NBR0VfQVRUUklCVVRFLFxuICAgIGlzRGVsZXRlZDogZmFsc2UsXG4gIH07XG5cbiAgY29uc3QgY29udGFpbmVyID0gYXdhaXQgQ29zbW9zREJDb250YWluZXIuZ2V0SW5zdGFuY2UoKS5nZXRDb250YWluZXIoKTtcbiAgYXdhaXQgY29udGFpbmVyLml0ZW1zLnVwc2VydChtb2RlbFRvU2F2ZSk7XG59O1xuXG5leHBvcnQgY29uc3QgaW5zZXJ0UHJvbXB0QW5kUmVzcG9uc2UgPSBhc3luYyAoXG4gIHRocmVhZElEOiBzdHJpbmcsXG4gIHVzZXJRdWVzdGlvbjogc3RyaW5nLFxuICBhc3Npc3RhbnRSZXNwb25zZTogc3RyaW5nXG4pID0+IHtcbiAgYXdhaXQgVXBzZXJ0Q2hhdCh7XG4gICAgLi4ubmV3Q2hhdE1vZGVsKCksXG4gICAgY29udGVudDogdXNlclF1ZXN0aW9uLFxuICAgIHRocmVhZElkOiB0aHJlYWRJRCxcbiAgICByb2xlOiBcInVzZXJcIixcbiAgfSk7XG4gIGF3YWl0IFVwc2VydENoYXQoe1xuICAgIC4uLm5ld0NoYXRNb2RlbCgpLFxuICAgIGNvbnRlbnQ6IGFzc2lzdGFudFJlc3BvbnNlLFxuICAgIHRocmVhZElkOiB0aHJlYWRJRCxcbiAgICByb2xlOiBcImFzc2lzdGFudFwiLFxuICB9KTtcbn07XG5cbmV4cG9ydCBjb25zdCBuZXdDaGF0TW9kZWwgPSAoKTogQ2hhdE1lc3NhZ2VNb2RlbCA9PiB7XG4gIHJldHVybiB7XG4gICAgY29udGVudDogXCJcIixcbiAgICB0aHJlYWRJZDogXCJcIixcbiAgICByb2xlOiBcInVzZXJcIixcbiAgICB1c2VySWQ6IFwiXCIsXG4gICAgaWQ6IHVuaXF1ZUlkKCksXG4gICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgIHR5cGU6IE1FU1NBR0VfQVRUUklCVVRFLFxuICAgIGlzRGVsZXRlZDogZmFsc2UsXG4gICAgY29udGV4dDogXCJcIixcbiAgfTtcbn07XG4iXSwibmFtZXMiOlsidW5pcXVlSWQiLCJDb3Ntb3NEQkNvbnRhaW5lciIsIk1FU1NBR0VfQVRUUklCVVRFIiwiRmluZEFsbENoYXRzIiwiY2hhdFRocmVhZElEIiwiY29udGFpbmVyIiwiZ2V0SW5zdGFuY2UiLCJnZXRDb250YWluZXIiLCJxdWVyeVNwZWMiLCJxdWVyeSIsInBhcmFtZXRlcnMiLCJuYW1lIiwidmFsdWUiLCJyZXNvdXJjZXMiLCJpdGVtcyIsImZldGNoQWxsIiwiVXBzZXJ0Q2hhdCIsImNoYXRNb2RlbCIsIm1vZGVsVG9TYXZlIiwiaWQiLCJjcmVhdGVkQXQiLCJEYXRlIiwidHlwZSIsImlzRGVsZXRlZCIsInVwc2VydCIsImluc2VydFByb21wdEFuZFJlc3BvbnNlIiwidGhyZWFkSUQiLCJ1c2VyUXVlc3Rpb24iLCJhc3Npc3RhbnRSZXNwb25zZSIsIm5ld0NoYXRNb2RlbCIsImNvbnRlbnQiLCJ0aHJlYWRJZCIsInJvbGUiLCJ1c2VySWQiLCJjb250ZXh0Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./features/chat/chat-services/chat-service.ts\n");

/***/ }),

/***/ "(rsc)/./features/chat/chat-services/chat-thread-service.ts":
/*!************************************************************!*\
  !*** ./features/chat/chat-services/chat-thread-service.ts ***!
  \************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   CreateChatThread: () => (/* binding */ CreateChatThread),\n/* harmony export */   EnsureChatThreadIsForCurrentUser: () => (/* binding */ EnsureChatThreadIsForCurrentUser),\n/* harmony export */   FindAllChatThreadForCurrentUser: () => (/* binding */ FindAllChatThreadForCurrentUser),\n/* harmony export */   FindChatThreadByID: () => (/* binding */ FindChatThreadByID),\n/* harmony export */   SoftDeleteChatThreadByID: () => (/* binding */ SoftDeleteChatThreadByID),\n/* harmony export */   UpsertChatThread: () => (/* binding */ UpsertChatThread),\n/* harmony export */   initAndGuardChatSession: () => (/* binding */ initAndGuardChatSession),\n/* harmony export */   updateChatThreadTitle: () => (/* binding */ updateChatThreadTitle)\n/* harmony export */ });\n/* harmony import */ var private_next_rsc_action_proxy__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! private-next-rsc-action-proxy */ \"(rsc)/./node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-proxy.js\");\n/* harmony import */ var private_next_rsc_action_encryption__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! private-next-rsc-action-encryption */ \"(rsc)/./node_modules/next/dist/server/app-render/action-encryption.js\");\n/* harmony import */ var private_next_rsc_action_encryption__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(private_next_rsc_action_encryption__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var server_only__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! server-only */ \"(rsc)/./node_modules/next/dist/compiled/server-only/empty.js\");\n/* harmony import */ var server_only__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(server_only__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _features_auth_helpers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/features/auth/helpers */ \"(rsc)/./features/auth/helpers.ts\");\n/* harmony import */ var _features_chat_chat_services_chat_service__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/features/chat/chat-services/chat-service */ \"(rsc)/./features/chat/chat-services/chat-service.ts\");\n/* harmony import */ var _features_common_util__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @/features/common/util */ \"(rsc)/./features/common/util.ts\");\n/* harmony import */ var _common_cosmos__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../common/cosmos */ \"(rsc)/./features/common/cosmos.ts\");\n/* harmony import */ var _azure_cog_search_azure_cog_vector_store__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./azure-cog-search/azure-cog-vector-store */ \"(rsc)/./features/chat/chat-services/azure-cog-search/azure-cog-vector-store.ts\");\n/* harmony import */ var _chat_document_service__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./chat-document-service */ \"(rsc)/./features/chat/chat-services/chat-document-service.ts\");\n/* harmony import */ var _models__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./models */ \"(rsc)/./features/chat/chat-services/models.ts\");\n/* harmony import */ var private_next_rsc_action_validate__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! private-next-rsc-action-validate */ \"(rsc)/./node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-validate.js\");\n/* __next_internal_action_entry_do_not_use__ {\"c5b7b86eccd7bae4c4dc3380c22ed79450dd44c3\":\"EnsureChatThreadIsForCurrentUser\",\"45f818ae7fe7b3a853d519d9b2a8a198e8eb7a16\":\"UpsertChatThread\",\"d6ee201894799a6d50cb53bf33a95394cd01fee0\":\"SoftDeleteChatThreadByID\",\"9893aea81a6e5df6cd1d63b84f65c4c0b17ef12c\":\"CreateChatThread\",\"6e6c88022fa2144a3ae634ce4a884f74576cc14b\":\"FindChatThreadByID\",\"26076f7fcd7b5d42b550a2ef92726c56e0189a6c\":\"FindAllChatThreadForCurrentUser\",\"47003156cc76a4fd663055682c90c06c6cb7767e\":\"updateChatThreadTitle\",\"6b35266a524bde73522540e44d018e4c70cbaba8\":\"initAndGuardChatSession\"} */ \n\n\n\n\n\n\n\n\n\nconst FindAllChatThreadForCurrentUser = async ()=>{\n    const container = await _common_cosmos__WEBPACK_IMPORTED_MODULE_6__.CosmosDBContainer.getInstance().getContainer();\n    const querySpec = {\n        query: \"SELECT * FROM root r WHERE r.type=@type AND r.userId=@userId AND r.isDeleted=@isDeleted ORDER BY r.createdAt DESC\",\n        parameters: [\n            {\n                name: \"@type\",\n                value: _models__WEBPACK_IMPORTED_MODULE_9__.CHAT_THREAD_ATTRIBUTE\n            },\n            {\n                name: \"@userId\",\n                value: await (0,_features_auth_helpers__WEBPACK_IMPORTED_MODULE_3__.userHashedId)()\n            },\n            {\n                name: \"@isDeleted\",\n                value: false\n            }\n        ]\n    };\n    const { resources } = await container.items.query(querySpec, {\n        partitionKey: await (0,_features_auth_helpers__WEBPACK_IMPORTED_MODULE_3__.userHashedId)()\n    }).fetchAll();\n    return resources;\n};\nconst FindChatThreadByID = async (id)=>{\n    const container = await _common_cosmos__WEBPACK_IMPORTED_MODULE_6__.CosmosDBContainer.getInstance().getContainer();\n    const querySpec = {\n        query: \"SELECT * FROM root r WHERE r.type=@type AND r.userId=@userId AND r.id=@id AND r.isDeleted=@isDeleted\",\n        parameters: [\n            {\n                name: \"@type\",\n                value: _models__WEBPACK_IMPORTED_MODULE_9__.CHAT_THREAD_ATTRIBUTE\n            },\n            {\n                name: \"@userId\",\n                value: await (0,_features_auth_helpers__WEBPACK_IMPORTED_MODULE_3__.userHashedId)()\n            },\n            {\n                name: \"@id\",\n                value: id\n            },\n            {\n                name: \"@isDeleted\",\n                value: false\n            }\n        ]\n    };\n    const { resources } = await container.items.query(querySpec).fetchAll();\n    return resources;\n};\nconst SoftDeleteChatThreadByID = async (chatThreadID)=>{\n    const container = await _common_cosmos__WEBPACK_IMPORTED_MODULE_6__.CosmosDBContainer.getInstance().getContainer();\n    const threads = await FindChatThreadByID(chatThreadID);\n    if (threads.length !== 0) {\n        const chats = await (0,_features_chat_chat_services_chat_service__WEBPACK_IMPORTED_MODULE_4__.FindAllChats)(chatThreadID);\n        chats.forEach(async (chat)=>{\n            const itemToUpdate = {\n                ...chat\n            };\n            itemToUpdate.isDeleted = true;\n            await container.items.upsert(itemToUpdate);\n        });\n        const chatDocuments = await (0,_chat_document_service__WEBPACK_IMPORTED_MODULE_8__.FindAllChatDocuments)(chatThreadID);\n        if (chatDocuments.length !== 0) {\n            await (0,_azure_cog_search_azure_cog_vector_store__WEBPACK_IMPORTED_MODULE_7__.deleteDocuments)(chatThreadID);\n        }\n        chatDocuments.forEach(async (chatDocument)=>{\n            const itemToUpdate = {\n                ...chatDocument\n            };\n            itemToUpdate.isDeleted = true;\n            await container.items.upsert(itemToUpdate);\n        });\n        threads.forEach(async (thread)=>{\n            const itemToUpdate = {\n                ...thread\n            };\n            itemToUpdate.isDeleted = true;\n            await container.items.upsert(itemToUpdate);\n        });\n    }\n};\nconst EnsureChatThreadIsForCurrentUser = async (chatThreadID)=>{\n    const modelToSave = await FindChatThreadByID(chatThreadID);\n    if (modelToSave.length === 0) {\n        throw new Error(\"Chat thread not found\");\n    }\n    return modelToSave[0];\n};\nconst UpsertChatThread = async (chatThread)=>{\n    const container = await _common_cosmos__WEBPACK_IMPORTED_MODULE_6__.CosmosDBContainer.getInstance().getContainer();\n    const updatedChatThread = await container.items.upsert(chatThread);\n    if (updatedChatThread === undefined) {\n        throw new Error(\"Chat thread not found\");\n    }\n    return updatedChatThread;\n};\nconst updateChatThreadTitle = async (chatThread, messages, chatType, conversationStyle, chatAPIModel, chatOverFileName, userMessage)=>{\n    if (messages.length === 0) {\n        const updatedChatThread = await UpsertChatThread({\n            ...chatThread,\n            chatType: chatType,\n            chatOverFileName: chatOverFileName,\n            chatAPIModel: chatAPIModel,\n            conversationStyle: conversationStyle,\n            name: userMessage.substring(0, 30)\n        });\n        return updatedChatThread.resource;\n    }\n    return chatThread;\n};\nconst CreateChatThread = async ()=>{\n    const modelToSave = {\n        name: \"new chat\",\n        useName: (await (0,_features_auth_helpers__WEBPACK_IMPORTED_MODULE_3__.userSession)()).name,\n        userId: await (0,_features_auth_helpers__WEBPACK_IMPORTED_MODULE_3__.userHashedId)(),\n        id: (0,_features_common_util__WEBPACK_IMPORTED_MODULE_5__.uniqueId)(),\n        createdAt: new Date(),\n        isDeleted: false,\n        chatType: \"simple\",\n        conversationStyle: \"balanced\",\n        chatAPIModel: \"Current_Version\",\n        type: _models__WEBPACK_IMPORTED_MODULE_9__.CHAT_THREAD_ATTRIBUTE,\n        chatOverFileName: \"\",\n        chatDoc: \"\"\n    };\n    const container = await _common_cosmos__WEBPACK_IMPORTED_MODULE_6__.CosmosDBContainer.getInstance().getContainer();\n    const response = await container.items.create(modelToSave);\n    return response.resource;\n};\nconst initAndGuardChatSession = async (props)=>{\n    //export const initAndGuardChatSession = async () => {\n    const { messages, id, chatType, conversationStyle, chatAPIModel, chatOverFileName } = props;\n    //last message\n    const lastHumanMessage = messages[messages.length - 1];\n    const currentChatThread = await EnsureChatThreadIsForCurrentUser(id);\n    const chats = await (0,_features_chat_chat_services_chat_service__WEBPACK_IMPORTED_MODULE_4__.FindAllChats)(id);\n    const chatThread = await updateChatThreadTitle(currentChatThread, chats, chatType, conversationStyle, chatAPIModel, chatOverFileName, lastHumanMessage.content);\n    return {\n        id,\n        lastHumanMessage,\n        chats,\n        chatThread\n    };\n};\n\n(0,private_next_rsc_action_validate__WEBPACK_IMPORTED_MODULE_10__.ensureServerEntryExports)([\n    FindAllChatThreadForCurrentUser,\n    FindChatThreadByID,\n    SoftDeleteChatThreadByID,\n    EnsureChatThreadIsForCurrentUser,\n    UpsertChatThread,\n    updateChatThreadTitle,\n    CreateChatThread,\n    initAndGuardChatSession\n]);\n(0,private_next_rsc_action_proxy__WEBPACK_IMPORTED_MODULE_0__.createActionProxy)(\"26076f7fcd7b5d42b550a2ef92726c56e0189a6c\", null, FindAllChatThreadForCurrentUser);\n(0,private_next_rsc_action_proxy__WEBPACK_IMPORTED_MODULE_0__.createActionProxy)(\"6e6c88022fa2144a3ae634ce4a884f74576cc14b\", null, FindChatThreadByID);\n(0,private_next_rsc_action_proxy__WEBPACK_IMPORTED_MODULE_0__.createActionProxy)(\"d6ee201894799a6d50cb53bf33a95394cd01fee0\", null, SoftDeleteChatThreadByID);\n(0,private_next_rsc_action_proxy__WEBPACK_IMPORTED_MODULE_0__.createActionProxy)(\"c5b7b86eccd7bae4c4dc3380c22ed79450dd44c3\", null, EnsureChatThreadIsForCurrentUser);\n(0,private_next_rsc_action_proxy__WEBPACK_IMPORTED_MODULE_0__.createActionProxy)(\"45f818ae7fe7b3a853d519d9b2a8a198e8eb7a16\", null, UpsertChatThread);\n(0,private_next_rsc_action_proxy__WEBPACK_IMPORTED_MODULE_0__.createActionProxy)(\"47003156cc76a4fd663055682c90c06c6cb7767e\", null, updateChatThreadTitle);\n(0,private_next_rsc_action_proxy__WEBPACK_IMPORTED_MODULE_0__.createActionProxy)(\"9893aea81a6e5df6cd1d63b84f65c4c0b17ef12c\", null, CreateChatThread);\n(0,private_next_rsc_action_proxy__WEBPACK_IMPORTED_MODULE_0__.createActionProxy)(\"6b35266a524bde73522540e44d018e4c70cbaba8\", null, initAndGuardChatSession);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9mZWF0dXJlcy9jaGF0L2NoYXQtc2VydmljZXMvY2hhdC10aHJlYWQtc2VydmljZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUNxQjtBQUUrQztBQUNNO0FBQ3hCO0FBRU07QUFDb0I7QUFDYjtBQVM3QztBQUVYLE1BQU1RLGtDQUFrQztJQUM3QyxNQUFNQyxZQUFZLE1BQU1MLDZEQUFpQkEsQ0FBQ00sV0FBVyxHQUFHQyxZQUFZO0lBRXBFLE1BQU1DLFlBQTBCO1FBQzlCQyxPQUNBO1FBQ0FDLFlBQVk7WUFDVjtnQkFDRUMsTUFBTTtnQkFDTkMsT0FBT1QsMERBQXFCQTtZQUM5QjtZQUNBO2dCQUNFUSxNQUFNO2dCQUNOQyxPQUFPLE1BQU1oQixvRUFBWUE7WUFDM0I7WUFDQTtnQkFDRWUsTUFBTTtnQkFDTkMsT0FBTztZQUNUO1NBQ0Q7SUFDSDtJQUVBLE1BQU0sRUFBRUMsU0FBUyxFQUFFLEdBQUcsTUFBTVIsVUFBVVMsS0FBSyxDQUN4Q0wsS0FBSyxDQUFrQkQsV0FBVztRQUNqQ08sY0FBYyxNQUFNbkIsb0VBQVlBO0lBQ2xDLEdBQ0NvQixRQUFRO0lBQ1gsT0FBT0g7QUFDVCxFQUFFO0FBRUssTUFBTUkscUJBQXFCLE9BQU9DO0lBQ3ZDLE1BQU1iLFlBQVksTUFBTUwsNkRBQWlCQSxDQUFDTSxXQUFXLEdBQUdDLFlBQVk7SUFFcEUsTUFBTUMsWUFBMEI7UUFDOUJDLE9BQ0U7UUFDRkMsWUFBWTtZQUNWO2dCQUNFQyxNQUFNO2dCQUNOQyxPQUFPVCwwREFBcUJBO1lBQzlCO1lBQ0E7Z0JBQ0VRLE1BQU07Z0JBQ05DLE9BQU8sTUFBTWhCLG9FQUFZQTtZQUMzQjtZQUNBO2dCQUNFZSxNQUFNO2dCQUNOQyxPQUFPTTtZQUNUO1lBQ0E7Z0JBQ0VQLE1BQU07Z0JBQ05DLE9BQU87WUFDVDtTQUNEO0lBQ0g7SUFFQSxNQUFNLEVBQUVDLFNBQVMsRUFBRSxHQUFHLE1BQU1SLFVBQVVTLEtBQUssQ0FDeENMLEtBQUss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UTtBQUMxQixFQUFFO0FBRUssTUFBTVUsMEJBQTBCLE9BQU9DO0lBQzlDLHNEQUFzRDtJQUNsRCxNQUFNLEVBQUVsQixRQUFRLEVBQUV0QixFQUFFLEVBQUV1QixRQUFRLEVBQUVDLGlCQUFpQixFQUFDQyxZQUFZLEVBQUVDLGdCQUFnQixFQUFFLEdBQUdjO0lBRXZGLGNBQWM7SUFDZCxNQUFNQyxtQkFBbUJuQixRQUFRLENBQUNBLFNBQVNsQixNQUFNLEdBQUcsRUFBRTtJQUV0RCxNQUFNc0Msb0JBQW9CLE1BQU01QixpQ0FBaUNkO0lBQ2pFLE1BQU1LLFFBQVEsTUFBTXpCLHVGQUFZQSxDQUFDb0I7SUFFakMsTUFBTWtCLGFBQWEsTUFBTUcsc0JBQ3ZCcUIsbUJBQ0FyQyxPQUNBa0IsVUFDQUMsbUJBQ0FDLGNBQ0FDLGtCQUNBZSxpQkFBaUJFLE9BQU87SUFHMUIsT0FBTztRQUNMM0M7UUFDQXlDO1FBQ0FwQztRQUNBYTtJQUNGO0FBQ0YsRUFBRSIsInNvdXJjZXMiOlsid2VicGFjazovL2F6dXJlLW9wZW4tYWktYWNjZWxlcmF0b3IvLi9mZWF0dXJlcy9jaGF0L2NoYXQtc2VydmljZXMvY2hhdC10aHJlYWQtc2VydmljZS50cz9mNWM3Il0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHNlcnZlclwiO1xuaW1wb3J0IFwic2VydmVyLW9ubHlcIjtcblxuaW1wb3J0IHsgdXNlckhhc2hlZElkLCB1c2VyU2Vzc2lvbiB9IGZyb20gXCJAL2ZlYXR1cmVzL2F1dGgvaGVscGVyc1wiO1xuaW1wb3J0IHsgRmluZEFsbENoYXRzIH0gZnJvbSBcIkAvZmVhdHVyZXMvY2hhdC9jaGF0LXNlcnZpY2VzL2NoYXQtc2VydmljZVwiO1xuaW1wb3J0IHsgdW5pcXVlSWQgfSBmcm9tIFwiQC9mZWF0dXJlcy9jb21tb24vdXRpbFwiO1xuaW1wb3J0IHsgU3FsUXVlcnlTcGVjIH0gZnJvbSBcIkBhenVyZS9jb3Ntb3NcIjtcbmltcG9ydCB7IENvc21vc0RCQ29udGFpbmVyIH0gZnJvbSBcIi4uLy4uL2NvbW1vbi9jb3Ntb3NcIjtcbmltcG9ydCB7IGRlbGV0ZURvY3VtZW50cyB9IGZyb20gXCIuL2F6dXJlLWNvZy1zZWFyY2gvYXp1cmUtY29nLXZlY3Rvci1zdG9yZVwiO1xuaW1wb3J0IHsgRmluZEFsbENoYXREb2N1bWVudHMgfSBmcm9tIFwiLi9jaGF0LWRvY3VtZW50LXNlcnZpY2VcIjtcbmltcG9ydCB7XG4gIENIQVRfVEhSRUFEX0FUVFJJQlVURSxcbiAgQ2hhdEFQSU1vZGVsLFxuICBDaGF0TWVzc2FnZU1vZGVsLFxuICBDaGF0VGhyZWFkTW9kZWwsXG4gIENoYXRUeXBlLFxuICBDb252ZXJzYXRpb25TdHlsZSxcbiAgUHJvbXB0R1BUUHJvcHMsXG59IGZyb20gXCIuL21vZGVsc1wiO1xuXG5leHBvcnQgY29uc3QgRmluZEFsbENoYXRUaHJlYWRGb3JDdXJyZW50VXNlciA9IGFzeW5jICgpID0+IHtcbiAgY29uc3QgY29udGFpbmVyID0gYXdhaXQgQ29zbW9zREJDb250YWluZXIuZ2V0SW5zdGFuY2UoKS5nZXRDb250YWluZXIoKTtcblxuICBjb25zdCBxdWVyeVNwZWM6IFNxbFF1ZXJ5U3BlYyA9IHtcbiAgICBxdWVyeTpcbiAgICBcIlNFTEVDVCAqIEZST00gcm9vdCByIFdIRVJFIHIudHlwZT1AdHlwZSBBTkQgci51c2VySWQ9QHVzZXJJZCBBTkQgci5pc0RlbGV0ZWQ9QGlzRGVsZXRlZCBPUkRFUiBCWSByLmNyZWF0ZWRBdCBERVNDXCIsXG4gICAgcGFyYW1ldGVyczogW1xuICAgICAge1xuICAgICAgICBuYW1lOiBcIkB0eXBlXCIsXG4gICAgICAgIHZhbHVlOiBDSEFUX1RIUkVBRF9BVFRSSUJVVEUsXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBuYW1lOiBcIkB1c2VySWRcIixcbiAgICAgICAgdmFsdWU6IGF3YWl0IHVzZXJIYXNoZWRJZCgpLFxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgbmFtZTogXCJAaXNEZWxldGVkXCIsXG4gICAgICAgIHZhbHVlOiBmYWxzZSxcbiAgICAgIH0sXG4gICAgXSxcbiAgfTtcblxuICBjb25zdCB7IHJlc291cmNlcyB9ID0gYXdhaXQgY29udGFpbmVyLml0ZW1zXG4gICAgLnF1ZXJ5PENoYXRUaHJlYWRNb2RlbD4ocXVlcnlTcGVjLCB7XG4gICAgICBwYXJ0aXRpb25LZXk6IGF3YWl0IHVzZXJIYXNoZWRJZCgpLFxuICAgIH0pXG4gICAgLmZldGNoQWxsKCk7XG4gIHJldHVybiByZXNvdXJjZXM7XG59O1xuXG5leHBvcnQgY29uc3QgRmluZENoYXRUaHJlYWRCeUlEID0gYXN5bmMgKGlkOiBzdHJpbmcpID0+IHtcbiAgY29uc3QgY29udGFpbmVyID0gYXdhaXQgQ29zbW9zREJDb250YWluZXIuZ2V0SW5zdGFuY2UoKS5nZXRDb250YWluZXIoKTtcblxuICBjb25zdCBxdWVyeVNwZWM6IFNxbFF1ZXJ5U3BlYyA9IHtcbiAgICBxdWVyeTpcbiAgICAgIFwiU0VMRUNUICogRlJPTSByb290IHIgV0hFUkUgci50eXBlPUB0eXBlIEFORCByLnVzZXJJZD1AdXNlcklkIEFORCByLmlkPUBpZCBBTkQgci5pc0RlbGV0ZWQ9QGlzRGVsZXRlZFwiLFxuICAgIHBhcmFtZXRlcnM6IFtcbiAgICAgIHtcbiAgICAgICAgbmFtZTogXCJAdHlwZVwiLFxuICAgICAgICB2YWx1ZTogQ0hBVF9USFJFQURfQVRUUklCVVRFLFxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgbmFtZTogXCJAdXNlcklkXCIsXG4gICAgICAgIHZhbHVlOiBhd2FpdCB1c2VySGFzaGVkSWQoKSxcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIG5hbWU6IFwiQGlkXCIsXG4gICAgICAgIHZhbHVlOiBpZCxcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIG5hbWU6IFwiQGlzRGVsZXRlZFwiLFxuICAgICAgICB2YWx1ZTogZmFsc2UsXG4gICAgICB9LFxuICAgIF0sXG4gIH07XG5cbiAgY29uc3QgeyByZXNvdXJjZXMgfSA9IGF3YWl0IGNvbnRhaW5lci5pdGVtc1xuICAgIC5xdWVyeTxDaGF0VGhyZWFkTW9kZWw+KHF1ZXJ5U3BlYylcbiAgICAuZmV0Y2hBbGwoKTtcblxuICByZXR1cm4gcmVzb3VyY2VzO1xufTtcblxuZXhwb3J0IGNvbnN0IFNvZnREZWxldGVDaGF0VGhyZWFkQnlJRCA9IGFzeW5jIChjaGF0VGhyZWFkSUQ6IHN0cmluZykgPT4ge1xuICBjb25zdCBjb250YWluZXIgPSBhd2FpdCBDb3Ntb3NEQkNvbnRhaW5lci5nZXRJbnN0YW5jZSgpLmdldENvbnRhaW5lcigpO1xuICBjb25zdCB0aHJlYWRzID0gYXdhaXQgRmluZENoYXRUaHJlYWRCeUlEKGNoYXRUaHJlYWRJRCk7XG5cbiAgaWYgKHRocmVhZHMubGVuZ3RoICE9PSAwKSB7XG4gICAgY29uc3QgY2hhdHMgPSBhd2FpdCBGaW5kQWxsQ2hhdHMoY2hhdFRocmVhZElEKTtcblxuICAgIGNoYXRzLmZvckVhY2goYXN5bmMgKGNoYXQpID0+IHtcbiAgICAgIGNvbnN0IGl0ZW1Ub1VwZGF0ZSA9IHtcbiAgICAgICAgLi4uY2hhdCxcbiAgICAgIH07XG4gICAgICBpdGVtVG9VcGRhdGUuaXNEZWxldGVkID0gdHJ1ZTtcbiAgICAgIGF3YWl0IGNvbnRhaW5lci5pdGVtcy51cHNlcnQoaXRlbVRvVXBkYXRlKTtcbiAgICB9KTtcblxuICAgIGNvbnN0IGNoYXREb2N1bWVudHMgPSBhd2FpdCBGaW5kQWxsQ2hhdERvY3VtZW50cyhjaGF0VGhyZWFkSUQpO1xuXG4gICAgaWYgKGNoYXREb2N1bWVudHMubGVuZ3RoICE9PSAwKSB7XG4gICAgICBhd2FpdCBkZWxldGVEb2N1bWVudHMoY2hhdFRocmVhZElEKTtcbiAgICB9XG5cbiAgICBjaGF0RG9jdW1lbnRzLmZvckVhY2goYXN5bmMgKGNoYXREb2N1bWVudCkgPT4ge1xuICAgICAgY29uc3QgaXRlbVRvVXBkYXRlID0ge1xuICAgICAgICAuLi5jaGF0RG9jdW1lbnQsXG4gICAgICB9O1xuICAgICAgaXRlbVRvVXBkYXRlLmlzRGVsZXRlZCA9IHRydWU7XG4gICAgICBhd2FpdCBjb250YWluZXIuaXRlbXMudXBzZXJ0KGl0ZW1Ub1VwZGF0ZSk7XG4gICAgfSk7XG5cbiAgICB0aHJlYWRzLmZvckVhY2goYXN5bmMgKHRocmVhZCkgPT4ge1xuICAgICAgY29uc3QgaXRlbVRvVXBkYXRlID0ge1xuICAgICAgICAuLi50aHJlYWQsXG4gICAgICB9O1xuICAgICAgaXRlbVRvVXBkYXRlLmlzRGVsZXRlZCA9IHRydWU7XG4gICAgICBhd2FpdCBjb250YWluZXIuaXRlbXMudXBzZXJ0KGl0ZW1Ub1VwZGF0ZSk7XG4gICAgfSk7XG4gIH1cbn07XG5cbmV4cG9ydCBjb25zdCBFbnN1cmVDaGF0VGhyZWFkSXNGb3JDdXJyZW50VXNlciA9IGFzeW5jIChcbiAgY2hhdFRocmVhZElEOiBzdHJpbmdcbikgPT4ge1xuICBjb25zdCBtb2RlbFRvU2F2ZSA9IGF3YWl0IEZpbmRDaGF0VGhyZWFkQnlJRChjaGF0VGhyZWFkSUQpO1xuICBpZiAobW9kZWxUb1NhdmUubGVuZ3RoID09PSAwKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiQ2hhdCB0aHJlYWQgbm90IGZvdW5kXCIpO1xuICB9XG5cbiAgcmV0dXJuIG1vZGVsVG9TYXZlWzBdO1xufTtcblxuZXhwb3J0IGNvbnN0IFVwc2VydENoYXRUaHJlYWQgPSBhc3luYyAoY2hhdFRocmVhZDogQ2hhdFRocmVhZE1vZGVsKSA9PiB7XG4gIGNvbnN0IGNvbnRhaW5lciA9IGF3YWl0IENvc21vc0RCQ29udGFpbmVyLmdldEluc3RhbmNlKCkuZ2V0Q29udGFpbmVyKCk7XG4gIGNvbnN0IHVwZGF0ZWRDaGF0VGhyZWFkID0gYXdhaXQgY29udGFpbmVyLml0ZW1zLnVwc2VydDxDaGF0VGhyZWFkTW9kZWw+KFxuICAgIGNoYXRUaHJlYWRcbiAgKTtcblxuICBpZiAodXBkYXRlZENoYXRUaHJlYWQgPT09IHVuZGVmaW5lZCkge1xuICAgIHRocm93IG5ldyBFcnJvcihcIkNoYXQgdGhyZWFkIG5vdCBmb3VuZFwiKTtcbiAgfVxuXG4gIHJldHVybiB1cGRhdGVkQ2hhdFRocmVhZDtcbn07XG5cbmV4cG9ydCBjb25zdCB1cGRhdGVDaGF0VGhyZWFkVGl0bGUgPSBhc3luYyAoXG4gIGNoYXRUaHJlYWQ6IENoYXRUaHJlYWRNb2RlbCxcbiAgbWVzc2FnZXM6IENoYXRNZXNzYWdlTW9kZWxbXSxcbiAgY2hhdFR5cGU6IENoYXRUeXBlLFxuICBjb252ZXJzYXRpb25TdHlsZTogQ29udmVyc2F0aW9uU3R5bGUsXG4gIGNoYXRBUElNb2RlbDogQ2hhdEFQSU1vZGVsLFxuICBjaGF0T3ZlckZpbGVOYW1lOiBzdHJpbmcsXG4gIHVzZXJNZXNzYWdlOiBzdHJpbmdcbikgPT4ge1xuICBpZiAobWVzc2FnZXMubGVuZ3RoID09PSAwKSB7XG4gICAgY29uc3QgdXBkYXRlZENoYXRUaHJlYWQgPSBhd2FpdCBVcHNlcnRDaGF0VGhyZWFkKHtcbiAgICAgIC4uLmNoYXRUaHJlYWQsXG4gICAgICBjaGF0VHlwZTogY2hhdFR5cGUsXG4gICAgICBjaGF0T3ZlckZpbGVOYW1lOiBjaGF0T3ZlckZpbGVOYW1lLFxuICAgICAgY2hhdEFQSU1vZGVsOiBjaGF0QVBJTW9kZWwsXG4gICAgICBjb252ZXJzYXRpb25TdHlsZTogY29udmVyc2F0aW9uU3R5bGUsXG4gICAgICBuYW1lOiB1c2VyTWVzc2FnZS5zdWJzdHJpbmcoMCwgMzApLFxuICAgIH0pO1xuXG4gICAgcmV0dXJuIHVwZGF0ZWRDaGF0VGhyZWFkLnJlc291cmNlITtcbiAgfVxuXG4gIHJldHVybiBjaGF0VGhyZWFkO1xufTtcblxuZXhwb3J0IGNvbnN0IENyZWF0ZUNoYXRUaHJlYWQgPSBhc3luYyAoKSA9PiB7XG4gIGNvbnN0IG1vZGVsVG9TYXZlOiBDaGF0VGhyZWFkTW9kZWwgPSB7XG4gICAgbmFtZTogXCJuZXcgY2hhdFwiLFxuICAgIHVzZU5hbWU6IChhd2FpdCB1c2VyU2Vzc2lvbigpKSEubmFtZSxcbiAgICB1c2VySWQ6IGF3YWl0IHVzZXJIYXNoZWRJZCgpLFxuICAgIGlkOiB1bmlxdWVJZCgpLFxuICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICBpc0RlbGV0ZWQ6IGZhbHNlLFxuICAgIGNoYXRUeXBlOiBcInNpbXBsZVwiLFxuICAgIGNvbnZlcnNhdGlvblN0eWxlOiBcImJhbGFuY2VkXCIsXG4gICAgY2hhdEFQSU1vZGVsOiBcIkN1cnJlbnRfVmVyc2lvblwiLFxuICAgIHR5cGU6IENIQVRfVEhSRUFEX0FUVFJJQlVURSxcbiAgICBjaGF0T3ZlckZpbGVOYW1lOiBcIlwiLFxuICAgIGNoYXREb2M6IFwiXCJcbiAgfTtcblxuICBjb25zdCBjb250YWluZXIgPSBhd2FpdCBDb3Ntb3NEQkNvbnRhaW5lci5nZXRJbnN0YW5jZSgpLmdldENvbnRhaW5lcigpO1xuICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGNvbnRhaW5lci5pdGVtcy5jcmVhdGU8Q2hhdFRocmVhZE1vZGVsPihtb2RlbFRvU2F2ZSk7XG4gIHJldHVybiByZXNwb25zZS5yZXNvdXJjZTtcbn07XG5cbmV4cG9ydCBjb25zdCBpbml0QW5kR3VhcmRDaGF0U2Vzc2lvbiA9IGFzeW5jIChwcm9wczogUHJvbXB0R1BUUHJvcHMpID0+IHtcbi8vZXhwb3J0IGNvbnN0IGluaXRBbmRHdWFyZENoYXRTZXNzaW9uID0gYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IHsgbWVzc2FnZXMsIGlkLCBjaGF0VHlwZSwgY29udmVyc2F0aW9uU3R5bGUsY2hhdEFQSU1vZGVsLCBjaGF0T3ZlckZpbGVOYW1lIH0gPSBwcm9wcztcblxuICAvL2xhc3QgbWVzc2FnZVxuICBjb25zdCBsYXN0SHVtYW5NZXNzYWdlID0gbWVzc2FnZXNbbWVzc2FnZXMubGVuZ3RoIC0gMV07XG5cbiAgY29uc3QgY3VycmVudENoYXRUaHJlYWQgPSBhd2FpdCBFbnN1cmVDaGF0VGhyZWFkSXNGb3JDdXJyZW50VXNlcihpZCk7XG4gIGNvbnN0IGNoYXRzID0gYXdhaXQgRmluZEFsbENoYXRzKGlkKTtcblxuICBjb25zdCBjaGF0VGhyZWFkID0gYXdhaXQgdXBkYXRlQ2hhdFRocmVhZFRpdGxlKFxuICAgIGN1cnJlbnRDaGF0VGhyZWFkLFxuICAgIGNoYXRzLFxuICAgIGNoYXRUeXBlLFxuICAgIGNvbnZlcnNhdGlvblN0eWxlLFxuICAgIGNoYXRBUElNb2RlbCxcbiAgICBjaGF0T3ZlckZpbGVOYW1lLFxuICAgIGxhc3RIdW1hbk1lc3NhZ2UuY29udGVudFxuICApO1xuXG4gIHJldHVybiB7XG4gICAgaWQsXG4gICAgbGFzdEh1bWFuTWVzc2FnZSxcbiAgICBjaGF0cyxcbiAgICBjaGF0VGhyZWFkLFxuICB9O1xufTtcbiJdLCJuYW1lcyI6WyJ1c2VySGFzaGVkSWQiLCJ1c2VyU2Vzc2lvbiIsIkZpbmRBbGxDaGF0cyIsInVuaXF1ZUlkIiwiQ29zbW9zREJDb250YWluZXIiLCJkZWxldGVEb2N1bWVudHMiLCJGaW5kQWxsQ2hhdERvY3VtZW50cyIsIkNIQVRfVEhSRUFEX0FUVFJJQlVURSIsIkZpbmRBbGxDaGF0VGhyZWFkRm9yQ3VycmVudFVzZXIiLCJjb250YWluZXIiLCJnZXRJbnN0YW5jZSIsImdldENvbnRhaW5lciIsInF1ZXJ5U3BlYyIsInF1ZXJ5IiwicGFyYW1ldGVycyIsIm5hbWUiLCJ2YWx1ZSIsInJlc291cmNlcyIsIml0ZW1zIiwicGFydGl0aW9uS2V5IiwiZmV0Y2hBbGwiLCJGaW5kQ2hhdFRocmVhZEJ5SUQiLCJpZCIsIlNvZnREZWxldGVDaGF0VGhyZWFkQnlJRCIsImNoYXRUaHJlYWRJRCIsInRocmVhZHMiLCJsZW5ndGgiLCJjaGF0cyIsImZvckVhY2giLCJjaGF0IiwiaXRlbVRvVXBkYXRlIiwiaXNEZWxldGVkIiwidXBzZXJ0IiwiY2hhdERvY3VtZW50cyIsImNoYXREb2N1bWVudCIsInRocmVhZCIsIkVuc3VyZUNoYXRUaHJlYWRJc0ZvckN1cnJlbnRVc2VyIiwibW9kZWxUb1NhdmUiLCJFcnJvciIsIlVwc2VydENoYXRUaHJlYWQiLCJjaGF0VGhyZWFkIiwidXBkYXRlZENoYXRUaHJlYWQiLCJ1bmRlZmluZWQiLCJ1cGRhdGVDaGF0VGhyZWFkVGl0bGUiLCJtZXNzYWdlcyIsImNoYXRUeXBlIiwiY29udmVyc2F0aW9uU3R5bGUiLCJjaGF0QVBJTW9kZWwiLCJjaGF0T3ZlckZpbGVOYW1lIiwidXNlck1lc3NhZ2UiLCJzdWJzdHJpbmciLCJyZXNvdXJjZSIsIkNyZWF0ZUNoYXRUaHJlYWQiLCJ1c2VOYW1lIiwidXNlcklkIiwiY3JlYXRlZEF0IiwiRGF0ZSIsInR5cGUiLCJjaGF0RG9jIiwicmVzcG9uc2UiLCJjcmVhdGUiLCJpbml0QW5kR3VhcmRDaGF0U2Vzc2lvbiIsInByb3BzIiwibGFzdEh1bWFuTWVzc2FnZSIsImN1cnJlbnRDaGF0VGhyZWFkIiwiY29udGVudCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./features/chat/chat-services/chat-thread-service.ts\n");

/***/ }),

/***/ "(rsc)/./features/chat/chat-services/cosmosdb/cosmosdb.ts":
/*!**********************************************************!*\
  !*** ./features/chat/chat-services/cosmosdb/cosmosdb.ts ***!
  \**********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   CosmosDBChatMessageHistory: () => (/* binding */ CosmosDBChatMessageHistory)\n/* harmony export */ });\n/* harmony import */ var _features_chat_chat_services_chat_service__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/features/chat/chat-services/chat-service */ \"(rsc)/./features/chat/chat-services/chat-service.ts\");\n/* harmony import */ var _features_chat_chat_services_models__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/features/chat/chat-services/models */ \"(rsc)/./features/chat/chat-services/models.ts\");\n/* harmony import */ var _features_common_cosmos__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/features/common/cosmos */ \"(rsc)/./features/common/cosmos.ts\");\n/* harmony import */ var _features_common_util__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/features/common/util */ \"(rsc)/./features/common/util.ts\");\n\n\n\n\nclass CosmosDBChatMessageHistory {\n    constructor({ sessionId, userId }){\n        this.sessionId = sessionId;\n        this.userId = userId;\n    }\n    async getMessages() {\n        const chats = await (0,_features_chat_chat_services_chat_service__WEBPACK_IMPORTED_MODULE_0__.FindAllChats)(this.sessionId);\n        return mapOpenAIChatMessages(chats);\n    }\n    async clear() {\n        const container = await _features_common_cosmos__WEBPACK_IMPORTED_MODULE_2__.CosmosDBContainer.getInstance().getContainer();\n        await container.delete();\n    }\n    async addMessage(message, citations = \"\") {\n        const modelToSave = {\n            id: (0,_features_common_util__WEBPACK_IMPORTED_MODULE_3__.uniqueId)(),\n            createdAt: new Date(),\n            type: _features_chat_chat_services_models__WEBPACK_IMPORTED_MODULE_1__.MESSAGE_ATTRIBUTE,\n            isDeleted: false,\n            content: message.content ?? \"\",\n            role: message.role,\n            threadId: this.sessionId,\n            userId: this.userId,\n            context: citations\n        };\n        await (0,_features_chat_chat_services_chat_service__WEBPACK_IMPORTED_MODULE_0__.UpsertChat)(modelToSave);\n    }\n}\nfunction mapOpenAIChatMessages(messages) {\n    return messages.map((message)=>{\n        return {\n            role: message.role,\n            content: message.content\n        };\n    });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9mZWF0dXJlcy9jaGF0L2NoYXQtc2VydmljZXMvY29zbW9zZGIvY29zbW9zZGIudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFHb0Q7QUFJTjtBQUNlO0FBQ1g7QUFRM0MsTUFBTUs7SUFJWEMsWUFBWSxFQUFFQyxTQUFTLEVBQUVDLE1BQU0sRUFBb0MsQ0FBRTtRQUNuRSxJQUFJLENBQUNELFNBQVMsR0FBR0E7UUFDakIsSUFBSSxDQUFDQyxNQUFNLEdBQUdBO0lBQ2hCO0lBRUEsTUFBTUMsY0FBZ0Q7UUFDcEQsTUFBTUMsUUFBUSxNQUFNVix1RkFBWUEsQ0FBQyxJQUFJLENBQUNPLFNBQVM7UUFDL0MsT0FBT0ksc0JBQXNCRDtJQUMvQjtJQUVBLE1BQU1FLFFBQXVCO1FBQzNCLE1BQU1DLFlBQVksTUFBTVYsc0VBQWlCQSxDQUFDVyxXQUFXLEdBQUdDLFlBQVk7UUFDcEUsTUFBTUYsVUFBVUcsTUFBTTtJQUN4QjtJQUVBLE1BQU1DLFdBQVdDLE9BQThCLEVBQUVDLFlBQW9CLEVBQUUsRUFBRTtRQUN2RSxNQUFNQyxjQUFnQztZQUNwQ0MsSUFBSWpCLCtEQUFRQTtZQUNaa0IsV0FBVyxJQUFJQztZQUNmQyxNQUFNdEIsa0ZBQWlCQTtZQUN2QnVCLFdBQVc7WUFDWEMsU0FBU1IsUUFBUVEsT0FBTyxJQUFJO1lBQzVCQyxNQUFNVCxRQUFRUyxJQUFJO1lBQ2xCQyxVQUFVLElBQUksQ0FBQ3JCLFNBQVM7WUFDeEJDLFFBQVEsSUFBSSxDQUFDQSxNQUFNO1lBQ25CcUIsU0FBU1Y7UUFDWDtRQUVBLE1BQU1sQixxRkFBVUEsQ0FBQ21CO0lBQ25CO0FBQ0Y7QUFFQSxTQUFTVCxzQkFDUG1CLFFBQTRCO0lBRTVCLE9BQU9BLFNBQVNDLEdBQUcsQ0FBQyxDQUFDYjtRQUNuQixPQUFPO1lBQ0xTLE1BQU1ULFFBQVFTLElBQUk7WUFDbEJELFNBQVNSLFFBQVFRLE9BQU87UUFDMUI7SUFDRjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vYXp1cmUtb3Blbi1haS1hY2NlbGVyYXRvci8uL2ZlYXR1cmVzL2NoYXQvY2hhdC1zZXJ2aWNlcy9jb3Ntb3NkYi9jb3Ntb3NkYi50cz8zYjA2Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIEZpbmRBbGxDaGF0cyxcbiAgVXBzZXJ0Q2hhdCxcbn0gZnJvbSBcIkAvZmVhdHVyZXMvY2hhdC9jaGF0LXNlcnZpY2VzL2NoYXQtc2VydmljZVwiO1xuaW1wb3J0IHtcbiAgQ2hhdE1lc3NhZ2VNb2RlbCxcbiAgTUVTU0FHRV9BVFRSSUJVVEUsXG59IGZyb20gXCJAL2ZlYXR1cmVzL2NoYXQvY2hhdC1zZXJ2aWNlcy9tb2RlbHNcIjtcbmltcG9ydCB7IENvc21vc0RCQ29udGFpbmVyIH0gZnJvbSBcIkAvZmVhdHVyZXMvY29tbW9uL2Nvc21vc1wiO1xuaW1wb3J0IHsgdW5pcXVlSWQgfSBmcm9tIFwiQC9mZWF0dXJlcy9jb21tb24vdXRpbFwiO1xuaW1wb3J0IHsgQ2hhdENvbXBsZXRpb25NZXNzYWdlIH0gZnJvbSBcIm9wZW5haS9yZXNvdXJjZXNcIjtcblxuZXhwb3J0IGludGVyZmFjZSBDb3Ntb3NEQkNoYXRNZXNzYWdlSGlzdG9yeUZpZWxkcyB7XG4gIHNlc3Npb25JZDogc3RyaW5nO1xuICB1c2VySWQ6IHN0cmluZztcbn1cblxuZXhwb3J0IGNsYXNzIENvc21vc0RCQ2hhdE1lc3NhZ2VIaXN0b3J5IHtcbiAgcHJpdmF0ZSBzZXNzaW9uSWQ6IHN0cmluZztcbiAgcHJpdmF0ZSB1c2VySWQ6IHN0cmluZztcblxuICBjb25zdHJ1Y3Rvcih7IHNlc3Npb25JZCwgdXNlcklkIH06IENvc21vc0RCQ2hhdE1lc3NhZ2VIaXN0b3J5RmllbGRzKSB7XG4gICAgdGhpcy5zZXNzaW9uSWQgPSBzZXNzaW9uSWQ7XG4gICAgdGhpcy51c2VySWQgPSB1c2VySWQ7XG4gIH1cblxuICBhc3luYyBnZXRNZXNzYWdlcygpOiBQcm9taXNlPENoYXRDb21wbGV0aW9uTWVzc2FnZVtdPiB7XG4gICAgY29uc3QgY2hhdHMgPSBhd2FpdCBGaW5kQWxsQ2hhdHModGhpcy5zZXNzaW9uSWQpO1xuICAgIHJldHVybiBtYXBPcGVuQUlDaGF0TWVzc2FnZXMoY2hhdHMpO1xuICB9XG5cbiAgYXN5bmMgY2xlYXIoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgY29udGFpbmVyID0gYXdhaXQgQ29zbW9zREJDb250YWluZXIuZ2V0SW5zdGFuY2UoKS5nZXRDb250YWluZXIoKTtcbiAgICBhd2FpdCBjb250YWluZXIuZGVsZXRlKCk7XG4gIH1cblxuICBhc3luYyBhZGRNZXNzYWdlKG1lc3NhZ2U6IENoYXRDb21wbGV0aW9uTWVzc2FnZSwgY2l0YXRpb25zOiBzdHJpbmcgPSBcIlwiKSB7XG4gICAgY29uc3QgbW9kZWxUb1NhdmU6IENoYXRNZXNzYWdlTW9kZWwgPSB7XG4gICAgICBpZDogdW5pcXVlSWQoKSxcbiAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIHR5cGU6IE1FU1NBR0VfQVRUUklCVVRFLFxuICAgICAgaXNEZWxldGVkOiBmYWxzZSxcbiAgICAgIGNvbnRlbnQ6IG1lc3NhZ2UuY29udGVudCA/PyBcIlwiLFxuICAgICAgcm9sZTogbWVzc2FnZS5yb2xlLFxuICAgICAgdGhyZWFkSWQ6IHRoaXMuc2Vzc2lvbklkLFxuICAgICAgdXNlcklkOiB0aGlzLnVzZXJJZCxcbiAgICAgIGNvbnRleHQ6IGNpdGF0aW9ucyxcbiAgICB9O1xuXG4gICAgYXdhaXQgVXBzZXJ0Q2hhdChtb2RlbFRvU2F2ZSk7XG4gIH1cbn1cblxuZnVuY3Rpb24gbWFwT3BlbkFJQ2hhdE1lc3NhZ2VzKFxuICBtZXNzYWdlczogQ2hhdE1lc3NhZ2VNb2RlbFtdXG4pOiBDaGF0Q29tcGxldGlvbk1lc3NhZ2VbXSB7XG4gIHJldHVybiBtZXNzYWdlcy5tYXAoKG1lc3NhZ2UpID0+IHtcbiAgICByZXR1cm4ge1xuICAgICAgcm9sZTogbWVzc2FnZS5yb2xlLFxuICAgICAgY29udGVudDogbWVzc2FnZS5jb250ZW50LFxuICAgIH07XG4gIH0pO1xufVxuIl0sIm5hbWVzIjpbIkZpbmRBbGxDaGF0cyIsIlVwc2VydENoYXQiLCJNRVNTQUdFX0FUVFJJQlVURSIsIkNvc21vc0RCQ29udGFpbmVyIiwidW5pcXVlSWQiLCJDb3Ntb3NEQkNoYXRNZXNzYWdlSGlzdG9yeSIsImNvbnN0cnVjdG9yIiwic2Vzc2lvbklkIiwidXNlcklkIiwiZ2V0TWVzc2FnZXMiLCJjaGF0cyIsIm1hcE9wZW5BSUNoYXRNZXNzYWdlcyIsImNsZWFyIiwiY29udGFpbmVyIiwiZ2V0SW5zdGFuY2UiLCJnZXRDb250YWluZXIiLCJkZWxldGUiLCJhZGRNZXNzYWdlIiwibWVzc2FnZSIsImNpdGF0aW9ucyIsIm1vZGVsVG9TYXZlIiwiaWQiLCJjcmVhdGVkQXQiLCJEYXRlIiwidHlwZSIsImlzRGVsZXRlZCIsImNvbnRlbnQiLCJyb2xlIiwidGhyZWFkSWQiLCJjb250ZXh0IiwibWVzc2FnZXMiLCJtYXAiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./features/chat/chat-services/cosmosdb/cosmosdb.ts\n");

/***/ }),

/***/ "(rsc)/./features/chat/chat-services/models.ts":
/*!***********************************************!*\
  !*** ./features/chat/chat-services/models.ts ***!
  \***********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   CHAT_DOCUMENT_ATTRIBUTE: () => (/* binding */ CHAT_DOCUMENT_ATTRIBUTE),\n/* harmony export */   CHAT_THREAD_ATTRIBUTE: () => (/* binding */ CHAT_THREAD_ATTRIBUTE),\n/* harmony export */   MESSAGE_ATTRIBUTE: () => (/* binding */ MESSAGE_ATTRIBUTE)\n/* harmony export */ });\nconst CHAT_DOCUMENT_ATTRIBUTE = \"CHAT_DOCUMENT\";\nconst CHAT_THREAD_ATTRIBUTE = \"CHAT_THREAD\";\nconst MESSAGE_ATTRIBUTE = \"CHAT_MESSAGE\";\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9mZWF0dXJlcy9jaGF0L2NoYXQtc2VydmljZXMvbW9kZWxzLnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUVPLE1BQU1BLDBCQUEwQixnQkFBZ0I7QUFDaEQsTUFBTUMsd0JBQXdCLGNBQWM7QUFDNUMsTUFBTUMsb0JBQW9CLGVBQWUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9henVyZS1vcGVuLWFpLWFjY2VsZXJhdG9yLy4vZmVhdHVyZXMvY2hhdC9jaGF0LXNlcnZpY2VzL21vZGVscy50cz83NGQ3Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE1lc3NhZ2UgfSBmcm9tIFwiYWlcIjtcblxuZXhwb3J0IGNvbnN0IENIQVRfRE9DVU1FTlRfQVRUUklCVVRFID0gXCJDSEFUX0RPQ1VNRU5UXCI7XG5leHBvcnQgY29uc3QgQ0hBVF9USFJFQURfQVRUUklCVVRFID0gXCJDSEFUX1RIUkVBRFwiO1xuZXhwb3J0IGNvbnN0IE1FU1NBR0VfQVRUUklCVVRFID0gXCJDSEFUX01FU1NBR0VcIjtcblxuZXhwb3J0IGludGVyZmFjZSBDaGF0TWVzc2FnZU1vZGVsIHtcbiAgaWQ6IHN0cmluZztcbiAgY3JlYXRlZEF0OiBEYXRlO1xuICBpc0RlbGV0ZWQ6IGJvb2xlYW47XG4gIHRocmVhZElkOiBzdHJpbmc7XG4gIHVzZXJJZDogc3RyaW5nO1xuICBjb250ZW50OiBzdHJpbmc7XG4gIHJvbGU6IENoYXRSb2xlO1xuICBjb250ZXh0OiBzdHJpbmc7XG4gIHR5cGU6IFwiQ0hBVF9NRVNTQUdFXCI7XG59XG5cbmV4cG9ydCB0eXBlIENvbnZlcnNhdGlvblN0eWxlID0gXCJjcmVhdGl2ZVwiIHwgXCJiYWxhbmNlZFwiIHwgXCJwcmVjaXNlXCI7XG5leHBvcnQgdHlwZSBDaGF0VHlwZSA9IFwic2ltcGxlXCIgfCBcIndlYlwiIHwgXCJkb2N1bWVudFwiIHwgXCJkYXRhXCIgfCBcImRvY1wiIHwgXCJtc3NxbFwiO1xuZXhwb3J0IHR5cGUgQ2hhdEFQSU1vZGVsID0gXCJDdXJyZW50X1ZlcnNpb25cIiB8IFwiUHJldmlld19WZXJzaW9uXCI7XG5leHBvcnQgdHlwZSBDaGF0RG9jID0gXCJEZXB0QVwiIHwgXCJEZXB0QlwiIHwgXCJEZXB0Q1wiIHwgXCJEZXB0RFwiIHwgXCJcIjtcbmV4cG9ydCB0eXBlIENoYXRBdXRoID0gXCJFeGNlY3RpdmVcIiB8IFwiTWFuYWdlclwiIHwgXCJFbXBsb3llZVwiIHwgXCJDb250cmFjdFwiO1xuZXhwb3J0IHR5cGUgQ2hhdFJvbGUgPSBcInN5c3RlbVwiIHwgXCJ1c2VyXCIgfCBcImFzc2lzdGFudFwiIHwgXCJmdW5jdGlvblwiO1xuXG5leHBvcnQgaW50ZXJmYWNlIENoYXRUaHJlYWRNb2RlbCB7XG4gIGlkOiBzdHJpbmc7XG4gIG5hbWU6IHN0cmluZztcbiAgY3JlYXRlZEF0OiBEYXRlO1xuICB1c2VySWQ6IHN0cmluZztcbiAgdXNlTmFtZTogc3RyaW5nO1xuICBpc0RlbGV0ZWQ6IGJvb2xlYW47XG4gIGNoYXRUeXBlOiBDaGF0VHlwZTtcbiAgY2hhdERvYzogQ2hhdERvYztcbiAgY29udmVyc2F0aW9uU3R5bGU6IENvbnZlcnNhdGlvblN0eWxlO1xuICBjaGF0QVBJTW9kZWw6IENoYXRBUElNb2RlbDtcbiAgY2hhdE92ZXJGaWxlTmFtZTogc3RyaW5nO1xuICB0eXBlOiBcIkNIQVRfVEhSRUFEXCI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUHJvbXB0TW9kZWwge1xuICBpZDogc3RyaW5nOyBcbiAgY3JlYXRlZEF0OiBEYXRlO1xuICB1c2VySWQ6IHN0cmluZztcbiAgdXNlTmFtZTogc3RyaW5nO1xuICBpc0RlbGV0ZWQ6IGJvb2xlYW47XG4gIHRocmVhZElkOiBzdHJpbmc7XG4gIHRpdGxlOiBzdHJpbmc7XG4gIGNvbnRlbnQ6IHN0cmluZztcbiAgZGVwdDogc3RyaW5nO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFByb21wdEdQVEJvZHkge1xuICBpZDogc3RyaW5nOyAvLyB0aHJlYWQgaWRcbiAgY2hhdFR5cGU6IENoYXRUeXBlO1xuICBjaGF0RG9jOiBDaGF0RG9jO1xuICBjb252ZXJzYXRpb25TdHlsZTogQ29udmVyc2F0aW9uU3R5bGU7XG4gIGNoYXRBUElNb2RlbDpDaGF0QVBJTW9kZWw7XG4gIGNoYXRPdmVyRmlsZU5hbWU6IHN0cmluZztcbn1cblxuXG5leHBvcnQgaW50ZXJmYWNlIFByb21wdEdQVFByb3BzIGV4dGVuZHMgUHJvbXB0R1BUQm9keSB7XG4gIG1lc3NhZ2VzOiBNZXNzYWdlW107XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ2hhdERvY3VtZW50TW9kZWwge1xuICBpZDogc3RyaW5nO1xuICBuYW1lOiBzdHJpbmc7XG4gIGNoYXRUaHJlYWRJZDogc3RyaW5nO1xuICB1c2VySWQ6IHN0cmluZztcbiAgaXNEZWxldGVkOiBib29sZWFuO1xuICBjcmVhdGVkQXQ6IERhdGU7XG4gIHR5cGU6IFwiQ0hBVF9ET0NVTUVOVFwiO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFNlcnZlckFjdGlvblJlc3BvbnNlPFQ+IHtcbiAgc3VjY2VzczogYm9vbGVhbjtcbiAgZXJyb3I6IHN0cmluZztcbiAgcmVzcG9uc2U6IFQ7XG59XG5cblxuZXhwb3J0IGludGVyZmFjZSBQcm9tcHRMaXN0IHtcbiAgaWQ6IHN0cmluZztcbiAgdGl0bGU6IHN0cmluZztcbiAgY29udGVudDogc3RyaW5nO1xuICBkZXB0OiBzdHJpbmc7XG4vKiAgY3JlYXRlZEF0OiBEYXRlO1xuICB1c2VySWQ6IHN0cmluZztcbiAgdXNlTmFtZTogc3RyaW5nO1xuICBpc0RlbGV0ZWQ6IGJvb2xlYW47Ki9cbn0iXSwibmFtZXMiOlsiQ0hBVF9ET0NVTUVOVF9BVFRSSUJVVEUiLCJDSEFUX1RIUkVBRF9BVFRSSUJVVEUiLCJNRVNTQUdFX0FUVFJJQlVURSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./features/chat/chat-services/models.ts\n");

/***/ }),

/***/ "(rsc)/./features/chat/chat-services/text-chunk.ts":
/*!***************************************************!*\
  !*** ./features/chat/chat-services/text-chunk.ts ***!
  \***************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   chunkDocumentWithOverlap: () => (/* binding */ chunkDocumentWithOverlap)\n/* harmony export */ });\n// Updated chunking parameters for text-embedding-3-small\nconst chunkSize = 4096; // Increased from 1000\nconst chunkOverlap = 500; // Increased from 200\n/**\n * Splits a document into chunks of specified size with overlap between chunks\n * Optimized for text-embedding-3-small model\n */ function chunkDocumentWithOverlap(document) {\n    const chunks = [];\n    if (document.length <= chunkSize) {\n        // If the document is smaller than the desired chunk size, return it as a single chunk.\n        chunks.push(document);\n        return chunks;\n    }\n    let startIndex = 0;\n    // Split the document into chunks of the desired size, with overlap.\n    while(startIndex < document.length){\n        const endIndex = Math.min(startIndex + chunkSize, document.length);\n        // Get the chunk\n        let chunk = document.substring(startIndex, endIndex);\n        // Try to end chunks at natural boundaries like paragraph or sentence endings\n        if (endIndex < document.length) {\n            // Look for paragraph breaks first\n            const paragraphBreakIndex = chunk.lastIndexOf(\"\\n\\n\");\n            // Look for single line breaks\n            const lineBreakIndex = chunk.lastIndexOf(\"\\n\");\n            // Look for sentence endings\n            const sentenceEndIndex = Math.max(chunk.lastIndexOf(\". \"), chunk.lastIndexOf(\"! \"), chunk.lastIndexOf(\"? \"));\n            // Choose the most appropriate break point that's not too far from the end\n            // Prefer paragraph breaks, then line breaks, then sentence endings\n            // Only use break points that are at least 75% into the chunk to maintain meaningful size\n            const minBreakPoint = Math.floor(chunkSize * 0.75);\n            if (paragraphBreakIndex > minBreakPoint) {\n                chunk = chunk.substring(0, paragraphBreakIndex + 2); // Include the paragraph break\n                startIndex += paragraphBreakIndex + 2;\n            } else if (lineBreakIndex > minBreakPoint) {\n                chunk = chunk.substring(0, lineBreakIndex + 1); // Include the line break\n                startIndex += lineBreakIndex + 1;\n            } else if (sentenceEndIndex > minBreakPoint) {\n                chunk = chunk.substring(0, sentenceEndIndex + 2); // Include the sentence ending and space\n                startIndex += sentenceEndIndex + 2;\n            } else {\n                // If no natural break point is found, use the original chunk\n                startIndex = endIndex - chunkOverlap;\n            }\n        } else {\n            // This is the last chunk\n            startIndex = endIndex;\n        }\n        // Add the chunk to the list\n        chunks.push(chunk);\n    }\n    return chunks;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9mZWF0dXJlcy9jaGF0L2NoYXQtc2VydmljZXMvdGV4dC1jaHVuay50cyIsIm1hcHBpbmdzIjoiOzs7O0FBQUEseURBQXlEO0FBQ3pELE1BQU1BLFlBQVksTUFBTSxzQkFBc0I7QUFDOUMsTUFBTUMsZUFBZSxLQUFLLHFCQUFxQjtBQUUvQzs7O0NBR0MsR0FDTSxTQUFTQyx5QkFBeUJDLFFBQWdCO0lBQ3ZELE1BQU1DLFNBQW1CLEVBQUU7SUFFM0IsSUFBSUQsU0FBU0UsTUFBTSxJQUFJTCxXQUFXO1FBQ2hDLHVGQUF1RjtRQUN2RkksT0FBT0UsSUFBSSxDQUFDSDtRQUNaLE9BQU9DO0lBQ1Q7SUFFQSxJQUFJRyxhQUFhO0lBRWpCLG9FQUFvRTtJQUNwRSxNQUFPQSxhQUFhSixTQUFTRSxNQUFNLENBQUU7UUFDbkMsTUFBTUcsV0FBV0MsS0FBS0MsR0FBRyxDQUFDSCxhQUFhUCxXQUFXRyxTQUFTRSxNQUFNO1FBRWpFLGdCQUFnQjtRQUNoQixJQUFJTSxRQUFRUixTQUFTUyxTQUFTLENBQUNMLFlBQVlDO1FBRTNDLDZFQUE2RTtRQUM3RSxJQUFJQSxXQUFXTCxTQUFTRSxNQUFNLEVBQUU7WUFDOUIsa0NBQWtDO1lBQ2xDLE1BQU1RLHNCQUFzQkYsTUFBTUcsV0FBVyxDQUFDO1lBQzlDLDhCQUE4QjtZQUM5QixNQUFNQyxpQkFBaUJKLE1BQU1HLFdBQVcsQ0FBQztZQUN6Qyw0QkFBNEI7WUFDNUIsTUFBTUUsbUJBQW1CUCxLQUFLUSxHQUFHLENBQy9CTixNQUFNRyxXQUFXLENBQUMsT0FDbEJILE1BQU1HLFdBQVcsQ0FBQyxPQUNsQkgsTUFBTUcsV0FBVyxDQUFDO1lBR3BCLDBFQUEwRTtZQUMxRSxtRUFBbUU7WUFDbkUseUZBQXlGO1lBQ3pGLE1BQU1JLGdCQUFnQlQsS0FBS1UsS0FBSyxDQUFDbkIsWUFBWTtZQUU3QyxJQUFJYSxzQkFBc0JLLGVBQWU7Z0JBQ3ZDUCxRQUFRQSxNQUFNQyxTQUFTLENBQUMsR0FBR0Msc0JBQXNCLElBQUksOEJBQThCO2dCQUNuRk4sY0FBY00sc0JBQXNCO1lBQ3RDLE9BQU8sSUFBSUUsaUJBQWlCRyxlQUFlO2dCQUN6Q1AsUUFBUUEsTUFBTUMsU0FBUyxDQUFDLEdBQUdHLGlCQUFpQixJQUFJLHlCQUF5QjtnQkFDekVSLGNBQWNRLGlCQUFpQjtZQUNqQyxPQUFPLElBQUlDLG1CQUFtQkUsZUFBZTtnQkFDM0NQLFFBQVFBLE1BQU1DLFNBQVMsQ0FBQyxHQUFHSSxtQkFBbUIsSUFBSSx3Q0FBd0M7Z0JBQzFGVCxjQUFjUyxtQkFBbUI7WUFDbkMsT0FBTztnQkFDTCw2REFBNkQ7Z0JBQzdEVCxhQUFhQyxXQUFXUDtZQUMxQjtRQUNGLE9BQU87WUFDTCx5QkFBeUI7WUFDekJNLGFBQWFDO1FBQ2Y7UUFFQSw0QkFBNEI7UUFDNUJKLE9BQU9FLElBQUksQ0FBQ0s7SUFDZDtJQUVBLE9BQU9QO0FBQ1QiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9henVyZS1vcGVuLWFpLWFjY2VsZXJhdG9yLy4vZmVhdHVyZXMvY2hhdC9jaGF0LXNlcnZpY2VzL3RleHQtY2h1bmsudHM/NDQ1OCJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBVcGRhdGVkIGNodW5raW5nIHBhcmFtZXRlcnMgZm9yIHRleHQtZW1iZWRkaW5nLTMtc21hbGxcbmNvbnN0IGNodW5rU2l6ZSA9IDQwOTY7IC8vIEluY3JlYXNlZCBmcm9tIDEwMDBcbmNvbnN0IGNodW5rT3ZlcmxhcCA9IDUwMDsgLy8gSW5jcmVhc2VkIGZyb20gMjAwXG5cbi8qKlxuICogU3BsaXRzIGEgZG9jdW1lbnQgaW50byBjaHVua3Mgb2Ygc3BlY2lmaWVkIHNpemUgd2l0aCBvdmVybGFwIGJldHdlZW4gY2h1bmtzXG4gKiBPcHRpbWl6ZWQgZm9yIHRleHQtZW1iZWRkaW5nLTMtc21hbGwgbW9kZWxcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNodW5rRG9jdW1lbnRXaXRoT3ZlcmxhcChkb2N1bWVudDogc3RyaW5nKTogc3RyaW5nW10ge1xuICBjb25zdCBjaHVua3M6IHN0cmluZ1tdID0gW107XG5cbiAgaWYgKGRvY3VtZW50Lmxlbmd0aCA8PSBjaHVua1NpemUpIHtcbiAgICAvLyBJZiB0aGUgZG9jdW1lbnQgaXMgc21hbGxlciB0aGFuIHRoZSBkZXNpcmVkIGNodW5rIHNpemUsIHJldHVybiBpdCBhcyBhIHNpbmdsZSBjaHVuay5cbiAgICBjaHVua3MucHVzaChkb2N1bWVudCk7XG4gICAgcmV0dXJuIGNodW5rcztcbiAgfVxuXG4gIGxldCBzdGFydEluZGV4ID0gMDtcblxuICAvLyBTcGxpdCB0aGUgZG9jdW1lbnQgaW50byBjaHVua3Mgb2YgdGhlIGRlc2lyZWQgc2l6ZSwgd2l0aCBvdmVybGFwLlxuICB3aGlsZSAoc3RhcnRJbmRleCA8IGRvY3VtZW50Lmxlbmd0aCkge1xuICAgIGNvbnN0IGVuZEluZGV4ID0gTWF0aC5taW4oc3RhcnRJbmRleCArIGNodW5rU2l6ZSwgZG9jdW1lbnQubGVuZ3RoKTtcbiAgICBcbiAgICAvLyBHZXQgdGhlIGNodW5rXG4gICAgbGV0IGNodW5rID0gZG9jdW1lbnQuc3Vic3RyaW5nKHN0YXJ0SW5kZXgsIGVuZEluZGV4KTtcbiAgICBcbiAgICAvLyBUcnkgdG8gZW5kIGNodW5rcyBhdCBuYXR1cmFsIGJvdW5kYXJpZXMgbGlrZSBwYXJhZ3JhcGggb3Igc2VudGVuY2UgZW5kaW5nc1xuICAgIGlmIChlbmRJbmRleCA8IGRvY3VtZW50Lmxlbmd0aCkge1xuICAgICAgLy8gTG9vayBmb3IgcGFyYWdyYXBoIGJyZWFrcyBmaXJzdFxuICAgICAgY29uc3QgcGFyYWdyYXBoQnJlYWtJbmRleCA9IGNodW5rLmxhc3RJbmRleE9mKCdcXG5cXG4nKTtcbiAgICAgIC8vIExvb2sgZm9yIHNpbmdsZSBsaW5lIGJyZWFrc1xuICAgICAgY29uc3QgbGluZUJyZWFrSW5kZXggPSBjaHVuay5sYXN0SW5kZXhPZignXFxuJyk7XG4gICAgICAvLyBMb29rIGZvciBzZW50ZW5jZSBlbmRpbmdzXG4gICAgICBjb25zdCBzZW50ZW5jZUVuZEluZGV4ID0gTWF0aC5tYXgoXG4gICAgICAgIGNodW5rLmxhc3RJbmRleE9mKCcuICcpLFxuICAgICAgICBjaHVuay5sYXN0SW5kZXhPZignISAnKSxcbiAgICAgICAgY2h1bmsubGFzdEluZGV4T2YoJz8gJylcbiAgICAgICk7XG4gICAgICBcbiAgICAgIC8vIENob29zZSB0aGUgbW9zdCBhcHByb3ByaWF0ZSBicmVhayBwb2ludCB0aGF0J3Mgbm90IHRvbyBmYXIgZnJvbSB0aGUgZW5kXG4gICAgICAvLyBQcmVmZXIgcGFyYWdyYXBoIGJyZWFrcywgdGhlbiBsaW5lIGJyZWFrcywgdGhlbiBzZW50ZW5jZSBlbmRpbmdzXG4gICAgICAvLyBPbmx5IHVzZSBicmVhayBwb2ludHMgdGhhdCBhcmUgYXQgbGVhc3QgNzUlIGludG8gdGhlIGNodW5rIHRvIG1haW50YWluIG1lYW5pbmdmdWwgc2l6ZVxuICAgICAgY29uc3QgbWluQnJlYWtQb2ludCA9IE1hdGguZmxvb3IoY2h1bmtTaXplICogMC43NSk7XG4gICAgICBcbiAgICAgIGlmIChwYXJhZ3JhcGhCcmVha0luZGV4ID4gbWluQnJlYWtQb2ludCkge1xuICAgICAgICBjaHVuayA9IGNodW5rLnN1YnN0cmluZygwLCBwYXJhZ3JhcGhCcmVha0luZGV4ICsgMik7IC8vIEluY2x1ZGUgdGhlIHBhcmFncmFwaCBicmVha1xuICAgICAgICBzdGFydEluZGV4ICs9IHBhcmFncmFwaEJyZWFrSW5kZXggKyAyO1xuICAgICAgfSBlbHNlIGlmIChsaW5lQnJlYWtJbmRleCA+IG1pbkJyZWFrUG9pbnQpIHtcbiAgICAgICAgY2h1bmsgPSBjaHVuay5zdWJzdHJpbmcoMCwgbGluZUJyZWFrSW5kZXggKyAxKTsgLy8gSW5jbHVkZSB0aGUgbGluZSBicmVha1xuICAgICAgICBzdGFydEluZGV4ICs9IGxpbmVCcmVha0luZGV4ICsgMTtcbiAgICAgIH0gZWxzZSBpZiAoc2VudGVuY2VFbmRJbmRleCA+IG1pbkJyZWFrUG9pbnQpIHtcbiAgICAgICAgY2h1bmsgPSBjaHVuay5zdWJzdHJpbmcoMCwgc2VudGVuY2VFbmRJbmRleCArIDIpOyAvLyBJbmNsdWRlIHRoZSBzZW50ZW5jZSBlbmRpbmcgYW5kIHNwYWNlXG4gICAgICAgIHN0YXJ0SW5kZXggKz0gc2VudGVuY2VFbmRJbmRleCArIDI7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBJZiBubyBuYXR1cmFsIGJyZWFrIHBvaW50IGlzIGZvdW5kLCB1c2UgdGhlIG9yaWdpbmFsIGNodW5rXG4gICAgICAgIHN0YXJ0SW5kZXggPSBlbmRJbmRleCAtIGNodW5rT3ZlcmxhcDtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgLy8gVGhpcyBpcyB0aGUgbGFzdCBjaHVua1xuICAgICAgc3RhcnRJbmRleCA9IGVuZEluZGV4O1xuICAgIH1cbiAgICBcbiAgICAvLyBBZGQgdGhlIGNodW5rIHRvIHRoZSBsaXN0XG4gICAgY2h1bmtzLnB1c2goY2h1bmspO1xuICB9XG5cbiAgcmV0dXJuIGNodW5rcztcbn0iXSwibmFtZXMiOlsiY2h1bmtTaXplIiwiY2h1bmtPdmVybGFwIiwiY2h1bmtEb2N1bWVudFdpdGhPdmVybGFwIiwiZG9jdW1lbnQiLCJjaHVua3MiLCJsZW5ndGgiLCJwdXNoIiwic3RhcnRJbmRleCIsImVuZEluZGV4IiwiTWF0aCIsIm1pbiIsImNodW5rIiwic3Vic3RyaW5nIiwicGFyYWdyYXBoQnJlYWtJbmRleCIsImxhc3RJbmRleE9mIiwibGluZUJyZWFrSW5kZXgiLCJzZW50ZW5jZUVuZEluZGV4IiwibWF4IiwibWluQnJlYWtQb2ludCIsImZsb29yIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./features/chat/chat-services/text-chunk.ts\n");

/***/ }),

/***/ "(rsc)/./features/chat/chat-services/utils.ts":
/*!**********************************************!*\
  !*** ./features/chat/chat-services/utils.ts ***!
  \**********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   isNotNullOrEmpty: () => (/* binding */ isNotNullOrEmpty),\n/* harmony export */   transformConversationStyleToTemperature: () => (/* binding */ transformConversationStyleToTemperature),\n/* harmony export */   transformCosmosToAIModel: () => (/* binding */ transformCosmosToAIModel)\n/* harmony export */ });\nconst transformCosmosToAIModel = (chats)=>{\n    return chats.map((chat)=>{\n        return {\n            role: chat.role,\n            content: chat.content,\n            id: chat.id,\n            createdAt: chat.createdAt\n        };\n    });\n};\nconst transformConversationStyleToTemperature = (conversationStyle)=>{\n    switch(conversationStyle){\n        case \"precise\":\n            return 0.1;\n        case \"balanced\":\n            return 0.5;\n        case \"creative\":\n            return 1;\n        default:\n            return 0.5;\n    }\n};\nconst isNotNullOrEmpty = (value)=>{\n    return value !== null && value !== undefined && value !== \"\";\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9mZWF0dXJlcy9jaGF0L2NoYXQtc2VydmljZXMvdXRpbHMudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBR08sTUFBTUEsMkJBQTJCLENBQ3RDQztJQUVBLE9BQU9BLE1BQU1DLEdBQUcsQ0FBQyxDQUFDQztRQUNoQixPQUFPO1lBQ0xDLE1BQU1ELEtBQUtDLElBQUk7WUFDZkMsU0FBU0YsS0FBS0UsT0FBTztZQUNyQkMsSUFBSUgsS0FBS0csRUFBRTtZQUNYQyxXQUFXSixLQUFLSSxTQUFTO1FBQzNCO0lBQ0Y7QUFDRixFQUFFO0FBRUssTUFBTUMsMENBQTBDLENBQ3JEQztJQUVBLE9BQVFBO1FBQ04sS0FBSztZQUNILE9BQU87UUFDVCxLQUFLO1lBQ0gsT0FBTztRQUNULEtBQUs7WUFDSCxPQUFPO1FBQ1Q7WUFDRSxPQUFPO0lBQ1g7QUFDRixFQUFFO0FBRUssTUFBTUMsbUJBQW1CLENBQUNDO0lBQy9CLE9BQU9BLFVBQVUsUUFBUUEsVUFBVUMsYUFBYUQsVUFBVTtBQUM1RCxFQUFFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vYXp1cmUtb3Blbi1haS1hY2NlbGVyYXRvci8uL2ZlYXR1cmVzL2NoYXQvY2hhdC1zZXJ2aWNlcy91dGlscy50cz9jNzQ0Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE1lc3NhZ2UgfSBmcm9tIFwiYWlcIjtcbmltcG9ydCB7IENoYXRNZXNzYWdlTW9kZWwsIENvbnZlcnNhdGlvblN0eWxlIH0gZnJvbSBcIi4vbW9kZWxzXCI7XG5cbmV4cG9ydCBjb25zdCB0cmFuc2Zvcm1Db3Ntb3NUb0FJTW9kZWwgPSAoXG4gIGNoYXRzOiBBcnJheTxDaGF0TWVzc2FnZU1vZGVsPlxuKTogQXJyYXk8TWVzc2FnZT4gPT4ge1xuICByZXR1cm4gY2hhdHMubWFwKChjaGF0KSA9PiB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHJvbGU6IGNoYXQucm9sZSxcbiAgICAgIGNvbnRlbnQ6IGNoYXQuY29udGVudCxcbiAgICAgIGlkOiBjaGF0LmlkLFxuICAgICAgY3JlYXRlZEF0OiBjaGF0LmNyZWF0ZWRBdCxcbiAgICB9O1xuICB9KTtcbn07XG5cbmV4cG9ydCBjb25zdCB0cmFuc2Zvcm1Db252ZXJzYXRpb25TdHlsZVRvVGVtcGVyYXR1cmUgPSAoXG4gIGNvbnZlcnNhdGlvblN0eWxlOiBDb252ZXJzYXRpb25TdHlsZVxuKSA9PiB7XG4gIHN3aXRjaCAoY29udmVyc2F0aW9uU3R5bGUpIHtcbiAgICBjYXNlIFwicHJlY2lzZVwiOlxuICAgICAgcmV0dXJuIDAuMTtcbiAgICBjYXNlIFwiYmFsYW5jZWRcIjpcbiAgICAgIHJldHVybiAwLjU7XG4gICAgY2FzZSBcImNyZWF0aXZlXCI6XG4gICAgICByZXR1cm4gMTtcbiAgICBkZWZhdWx0OlxuICAgICAgcmV0dXJuIDAuNTtcbiAgfVxufTtcblxuZXhwb3J0IGNvbnN0IGlzTm90TnVsbE9yRW1wdHkgPSAodmFsdWU/OiBzdHJpbmcpID0+IHtcbiAgcmV0dXJuIHZhbHVlICE9PSBudWxsICYmIHZhbHVlICE9PSB1bmRlZmluZWQgJiYgdmFsdWUgIT09IFwiXCI7XG59O1xuIl0sIm5hbWVzIjpbInRyYW5zZm9ybUNvc21vc1RvQUlNb2RlbCIsImNoYXRzIiwibWFwIiwiY2hhdCIsInJvbGUiLCJjb250ZW50IiwiaWQiLCJjcmVhdGVkQXQiLCJ0cmFuc2Zvcm1Db252ZXJzYXRpb25TdHlsZVRvVGVtcGVyYXR1cmUiLCJjb252ZXJzYXRpb25TdHlsZSIsImlzTm90TnVsbE9yRW1wdHkiLCJ2YWx1ZSIsInVuZGVmaW5lZCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./features/chat/chat-services/utils.ts\n");

/***/ }),

/***/ "(rsc)/./features/common/cosmos.ts":
/*!***********************************!*\
  !*** ./features/common/cosmos.ts ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   CosmosDBContainer: () => (/* binding */ CosmosDBContainer),\n/* harmony export */   initDBContainer: () => (/* binding */ initDBContainer)\n/* harmony export */ });\n/* harmony import */ var _azure_cosmos__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @azure/cosmos */ \"(rsc)/./node_modules/@azure/cosmos/dist-esm/src/CosmosClient.js\");\n\n// Read Cosmos DB_NAME and CONTAINER_NAME from .env\nconst DB_NAME = process.env.AZURE_COSMOSDB_DB_NAME || \"chat\";\nconst CONTAINER_NAME = process.env.AZURE_COSMOSDB_CONTAINER_NAME || \"history\";\nconst initDBContainer = async ()=>{\n    const endpoint = process.env.AZURE_COSMOSDB_URI;\n    const key = process.env.AZURE_COSMOSDB_KEY;\n    const client = new _azure_cosmos__WEBPACK_IMPORTED_MODULE_0__.CosmosClient({\n        endpoint,\n        key\n    });\n    const databaseResponse = await client.databases.createIfNotExists({\n        id: DB_NAME\n    });\n    const containerResponse = await databaseResponse.database.containers.createIfNotExists({\n        id: CONTAINER_NAME,\n        partitionKey: {\n            paths: [\n                \"/userId\"\n            ]\n        }\n    });\n    return containerResponse.container;\n};\nclass CosmosDBContainer {\n    constructor(){\n        const endpoint = process.env.AZURE_COSMOSDB_URI;\n        const key = process.env.AZURE_COSMOSDB_KEY;\n        const client = new _azure_cosmos__WEBPACK_IMPORTED_MODULE_0__.CosmosClient({\n            endpoint,\n            key\n        });\n        this.container = new Promise((resolve, reject)=>{\n            client.databases.createIfNotExists({\n                id: DB_NAME\n            }).then((databaseResponse)=>{\n                databaseResponse.database.containers.createIfNotExists({\n                    id: CONTAINER_NAME,\n                    partitionKey: {\n                        paths: [\n                            \"/userId\"\n                        ]\n                    }\n                }).then((containerResponse)=>{\n                    resolve(containerResponse.container);\n                });\n            }).catch((err)=>{\n                reject(err);\n            });\n        });\n    }\n    static getInstance() {\n        if (!CosmosDBContainer.instance) {\n            CosmosDBContainer.instance = new CosmosDBContainer();\n        }\n        return CosmosDBContainer.instance;\n    }\n    async getContainer() {\n        return await this.container;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9mZWF0dXJlcy9jb21tb24vY29zbW9zLnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUF3RDtBQUV4RCxtREFBbUQ7QUFDbkQsTUFBTUMsVUFBVUMsUUFBUUMsR0FBRyxDQUFDQyxzQkFBc0IsSUFBSTtBQUN0RCxNQUFNQyxpQkFBaUJILFFBQVFDLEdBQUcsQ0FBQ0csNkJBQTZCLElBQUk7QUFFN0QsTUFBTUMsa0JBQWtCO0lBQzdCLE1BQU1DLFdBQVdOLFFBQVFDLEdBQUcsQ0FBQ00sa0JBQWtCO0lBQy9DLE1BQU1DLE1BQU1SLFFBQVFDLEdBQUcsQ0FBQ1Esa0JBQWtCO0lBRTFDLE1BQU1DLFNBQVMsSUFBSVosdURBQVlBLENBQUM7UUFBRVE7UUFBVUU7SUFBSTtJQUVoRCxNQUFNRyxtQkFBbUIsTUFBTUQsT0FBT0UsU0FBUyxDQUFDQyxpQkFBaUIsQ0FBQztRQUNoRUMsSUFBSWY7SUFDTjtJQUVBLE1BQU1nQixvQkFDSixNQUFNSixpQkFBaUJLLFFBQVEsQ0FBQ0MsVUFBVSxDQUFDSixpQkFBaUIsQ0FBQztRQUMzREMsSUFBSVg7UUFDSmUsY0FBYztZQUNaQyxPQUFPO2dCQUFDO2FBQVU7UUFDcEI7SUFDRjtJQUVGLE9BQU9KLGtCQUFrQkssU0FBUztBQUNwQyxFQUFFO0FBRUssTUFBTUM7SUFJWCxhQUFzQjtRQUNwQixNQUFNZixXQUFXTixRQUFRQyxHQUFHLENBQUNNLGtCQUFrQjtRQUMvQyxNQUFNQyxNQUFNUixRQUFRQyxHQUFHLENBQUNRLGtCQUFrQjtRQUUxQyxNQUFNQyxTQUFTLElBQUlaLHVEQUFZQSxDQUFDO1lBQUVRO1lBQVVFO1FBQUk7UUFFaEQsSUFBSSxDQUFDWSxTQUFTLEdBQUcsSUFBSUUsUUFBUSxDQUFDQyxTQUFTQztZQUNyQ2QsT0FBT0UsU0FBUyxDQUNiQyxpQkFBaUIsQ0FBQztnQkFDakJDLElBQUlmO1lBQ04sR0FDQzBCLElBQUksQ0FBQyxDQUFDZDtnQkFDTEEsaUJBQWlCSyxRQUFRLENBQUNDLFVBQVUsQ0FDakNKLGlCQUFpQixDQUFDO29CQUNqQkMsSUFBSVg7b0JBQ0plLGNBQWM7d0JBQ1pDLE9BQU87NEJBQUM7eUJBQVU7b0JBQ3BCO2dCQUNGLEdBQ0NNLElBQUksQ0FBQyxDQUFDVjtvQkFDTFEsUUFBUVIsa0JBQWtCSyxTQUFTO2dCQUNyQztZQUNKLEdBQ0NNLEtBQUssQ0FBQyxDQUFDQztnQkFDTkgsT0FBT0c7WUFDVDtRQUNKO0lBQ0Y7SUFFQSxPQUFjQyxjQUFpQztRQUM3QyxJQUFJLENBQUNQLGtCQUFrQlEsUUFBUSxFQUFFO1lBQy9CUixrQkFBa0JRLFFBQVEsR0FBRyxJQUFJUjtRQUNuQztRQUVBLE9BQU9BLGtCQUFrQlEsUUFBUTtJQUNuQztJQUVBLE1BQWFDLGVBQW1DO1FBQzlDLE9BQU8sTUFBTSxJQUFJLENBQUNWLFNBQVM7SUFDN0I7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL2F6dXJlLW9wZW4tYWktYWNjZWxlcmF0b3IvLi9mZWF0dXJlcy9jb21tb24vY29zbW9zLnRzPzU4MmIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29udGFpbmVyLCBDb3Ntb3NDbGllbnQgfSBmcm9tIFwiQGF6dXJlL2Nvc21vc1wiO1xuXG4vLyBSZWFkIENvc21vcyBEQl9OQU1FIGFuZCBDT05UQUlORVJfTkFNRSBmcm9tIC5lbnZcbmNvbnN0IERCX05BTUUgPSBwcm9jZXNzLmVudi5BWlVSRV9DT1NNT1NEQl9EQl9OQU1FIHx8IFwiY2hhdFwiO1xuY29uc3QgQ09OVEFJTkVSX05BTUUgPSBwcm9jZXNzLmVudi5BWlVSRV9DT1NNT1NEQl9DT05UQUlORVJfTkFNRSB8fCBcImhpc3RvcnlcIjtcblxuZXhwb3J0IGNvbnN0IGluaXREQkNvbnRhaW5lciA9IGFzeW5jICgpID0+IHtcbiAgY29uc3QgZW5kcG9pbnQgPSBwcm9jZXNzLmVudi5BWlVSRV9DT1NNT1NEQl9VUkk7XG4gIGNvbnN0IGtleSA9IHByb2Nlc3MuZW52LkFaVVJFX0NPU01PU0RCX0tFWTtcblxuICBjb25zdCBjbGllbnQgPSBuZXcgQ29zbW9zQ2xpZW50KHsgZW5kcG9pbnQsIGtleSB9KTtcblxuICBjb25zdCBkYXRhYmFzZVJlc3BvbnNlID0gYXdhaXQgY2xpZW50LmRhdGFiYXNlcy5jcmVhdGVJZk5vdEV4aXN0cyh7XG4gICAgaWQ6IERCX05BTUUsXG4gIH0pO1xuXG4gIGNvbnN0IGNvbnRhaW5lclJlc3BvbnNlID1cbiAgICBhd2FpdCBkYXRhYmFzZVJlc3BvbnNlLmRhdGFiYXNlLmNvbnRhaW5lcnMuY3JlYXRlSWZOb3RFeGlzdHMoe1xuICAgICAgaWQ6IENPTlRBSU5FUl9OQU1FLFxuICAgICAgcGFydGl0aW9uS2V5OiB7XG4gICAgICAgIHBhdGhzOiBbXCIvdXNlcklkXCJdLFxuICAgICAgfSxcbiAgICB9KTtcblxuICByZXR1cm4gY29udGFpbmVyUmVzcG9uc2UuY29udGFpbmVyO1xufTtcblxuZXhwb3J0IGNsYXNzIENvc21vc0RCQ29udGFpbmVyIHtcbiAgcHJpdmF0ZSBzdGF0aWMgaW5zdGFuY2U6IENvc21vc0RCQ29udGFpbmVyO1xuICBwcml2YXRlIGNvbnRhaW5lcjogUHJvbWlzZTxDb250YWluZXI+O1xuXG4gIHByaXZhdGUgY29uc3RydWN0b3IoKSB7XG4gICAgY29uc3QgZW5kcG9pbnQgPSBwcm9jZXNzLmVudi5BWlVSRV9DT1NNT1NEQl9VUkk7XG4gICAgY29uc3Qga2V5ID0gcHJvY2Vzcy5lbnYuQVpVUkVfQ09TTU9TREJfS0VZO1xuXG4gICAgY29uc3QgY2xpZW50ID0gbmV3IENvc21vc0NsaWVudCh7IGVuZHBvaW50LCBrZXkgfSk7XG5cbiAgICB0aGlzLmNvbnRhaW5lciA9IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIGNsaWVudC5kYXRhYmFzZXNcbiAgICAgICAgLmNyZWF0ZUlmTm90RXhpc3RzKHtcbiAgICAgICAgICBpZDogREJfTkFNRSxcbiAgICAgICAgfSlcbiAgICAgICAgLnRoZW4oKGRhdGFiYXNlUmVzcG9uc2UpID0+IHtcbiAgICAgICAgICBkYXRhYmFzZVJlc3BvbnNlLmRhdGFiYXNlLmNvbnRhaW5lcnNcbiAgICAgICAgICAgIC5jcmVhdGVJZk5vdEV4aXN0cyh7XG4gICAgICAgICAgICAgIGlkOiBDT05UQUlORVJfTkFNRSxcbiAgICAgICAgICAgICAgcGFydGl0aW9uS2V5OiB7XG4gICAgICAgICAgICAgICAgcGF0aHM6IFtcIi91c2VySWRcIl0sXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLnRoZW4oKGNvbnRhaW5lclJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgICAgIHJlc29sdmUoY29udGFpbmVyUmVzcG9uc2UuY29udGFpbmVyKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyBzdGF0aWMgZ2V0SW5zdGFuY2UoKTogQ29zbW9zREJDb250YWluZXIge1xuICAgIGlmICghQ29zbW9zREJDb250YWluZXIuaW5zdGFuY2UpIHtcbiAgICAgIENvc21vc0RCQ29udGFpbmVyLmluc3RhbmNlID0gbmV3IENvc21vc0RCQ29udGFpbmVyKCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIENvc21vc0RCQ29udGFpbmVyLmluc3RhbmNlO1xuICB9XG5cbiAgcHVibGljIGFzeW5jIGdldENvbnRhaW5lcigpOiBQcm9taXNlPENvbnRhaW5lcj4ge1xuICAgIHJldHVybiBhd2FpdCB0aGlzLmNvbnRhaW5lcjtcbiAgfVxufVxuIl0sIm5hbWVzIjpbIkNvc21vc0NsaWVudCIsIkRCX05BTUUiLCJwcm9jZXNzIiwiZW52IiwiQVpVUkVfQ09TTU9TREJfREJfTkFNRSIsIkNPTlRBSU5FUl9OQU1FIiwiQVpVUkVfQ09TTU9TREJfQ09OVEFJTkVSX05BTUUiLCJpbml0REJDb250YWluZXIiLCJlbmRwb2ludCIsIkFaVVJFX0NPU01PU0RCX1VSSSIsImtleSIsIkFaVVJFX0NPU01PU0RCX0tFWSIsImNsaWVudCIsImRhdGFiYXNlUmVzcG9uc2UiLCJkYXRhYmFzZXMiLCJjcmVhdGVJZk5vdEV4aXN0cyIsImlkIiwiY29udGFpbmVyUmVzcG9uc2UiLCJkYXRhYmFzZSIsImNvbnRhaW5lcnMiLCJwYXJ0aXRpb25LZXkiLCJwYXRocyIsImNvbnRhaW5lciIsIkNvc21vc0RCQ29udGFpbmVyIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJ0aGVuIiwiY2F0Y2giLCJlcnIiLCJnZXRJbnN0YW5jZSIsImluc3RhbmNlIiwiZ2V0Q29udGFpbmVyIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./features/common/cosmos.ts\n");

/***/ }),

/***/ "(rsc)/./features/common/openai.ts":
/*!***********************************!*\
  !*** ./features/common/openai.ts ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   OpenAIEmbeddingInstance: () => (/* binding */ OpenAIEmbeddingInstance),\n/* harmony export */   OpenAIInstance: () => (/* binding */ OpenAIInstance)\n/* harmony export */ });\n/* harmony import */ var openai__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! openai */ \"(rsc)/./node_modules/openai/index.mjs\");\n\nconst OpenAIInstance = ()=>{\n    const openai = new openai__WEBPACK_IMPORTED_MODULE_0__.OpenAI({\n        apiKey: process.env.OPENAI_API_KEY,\n        baseURL: `https://${process.env.AZURE_OPENAI_API_INSTANCE_NAME}.openai.azure.com/openai/deployments/${process.env.AZURE_OPENAI_API_DEPLOYMENT_NAME}`,\n        defaultQuery: {\n            \"api-version\": process.env.AZURE_OPENAI_API_VERSION\n        },\n        defaultHeaders: {\n            \"api-key\": process.env.OPENAI_API_KEY\n        }\n    });\n    return openai;\n};\nconst OpenAIEmbeddingInstance = ()=>{\n    const openai = new openai__WEBPACK_IMPORTED_MODULE_0__.OpenAI({\n        apiKey: process.env.OPENAI_API_KEY,\n        baseURL: `https://${process.env.AZURE_OPENAI_API_INSTANCE_NAME}.openai.azure.com/openai/deployments/${process.env.AZURE_OPENAI_API_EMBEDDINGS_DEPLOYMENT_NAME}`,\n        defaultQuery: {\n            \"api-version\": process.env.AZURE_OPENAI_API_VERSION\n        },\n        defaultHeaders: {\n            \"api-key\": process.env.OPENAI_API_KEY\n        }\n    });\n    return openai;\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9mZWF0dXJlcy9jb21tb24vb3BlbmFpLnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUFnQztBQUl6QixNQUFNQyxpQkFBaUI7SUFHNUIsTUFBTUMsU0FBUyxJQUFJRiwwQ0FBTUEsQ0FBQztRQUN4QkcsUUFBUUMsUUFBUUMsR0FBRyxDQUFDQyxjQUFjO1FBQ2xDQyxTQUFTLENBQUMsUUFBUSxFQUFFSCxRQUFRQyxHQUFHLENBQUNHLDhCQUE4QixDQUFDLHFDQUFxQyxFQUFFSixRQUFRQyxHQUFHLENBQUNJLGdDQUFnQyxDQUFDLENBQUM7UUFDcEpDLGNBQWM7WUFBRSxlQUFlTixRQUFRQyxHQUFHLENBQUNNLHdCQUF3QjtRQUFDO1FBQ3BFQyxnQkFBZ0I7WUFBRSxXQUFXUixRQUFRQyxHQUFHLENBQUNDLGNBQWM7UUFBQztJQUMxRDtJQUNBLE9BQU9KO0FBQ1QsRUFBRTtBQUVLLE1BQU1XLDBCQUEwQjtJQUNyQyxNQUFNWCxTQUFTLElBQUlGLDBDQUFNQSxDQUFDO1FBQ3hCRyxRQUFRQyxRQUFRQyxHQUFHLENBQUNDLGNBQWM7UUFDbENDLFNBQVMsQ0FBQyxRQUFRLEVBQUVILFFBQVFDLEdBQUcsQ0FBQ0csOEJBQThCLENBQUMscUNBQXFDLEVBQUVKLFFBQVFDLEdBQUcsQ0FBQ1MsMkNBQTJDLENBQUMsQ0FBQztRQUMvSkosY0FBYztZQUFFLGVBQWVOLFFBQVFDLEdBQUcsQ0FBQ00sd0JBQXdCO1FBQUM7UUFDcEVDLGdCQUFnQjtZQUFFLFdBQVdSLFFBQVFDLEdBQUcsQ0FBQ0MsY0FBYztRQUFDO0lBQzFEO0lBQ0EsT0FBT0o7QUFDVCxFQUFFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vYXp1cmUtb3Blbi1haS1hY2NlbGVyYXRvci8uL2ZlYXR1cmVzL2NvbW1vbi9vcGVuYWkudHM/YmJlZiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBPcGVuQUkgfSBmcm9tIFwib3BlbmFpXCI7XG5cbmltcG9ydCB7IFByb21wdEdQVFByb3BzIH0gZnJvbSBcIi4uL2NoYXQvY2hhdC1zZXJ2aWNlcy9tb2RlbHNcIjtcblxuZXhwb3J0IGNvbnN0IE9wZW5BSUluc3RhbmNlID0gKCkgPT4ge1xuXG4gICAgXG4gIGNvbnN0IG9wZW5haSA9IG5ldyBPcGVuQUkoe1xuICAgIGFwaUtleTogcHJvY2Vzcy5lbnYuT1BFTkFJX0FQSV9LRVksXG4gICAgYmFzZVVSTDogYGh0dHBzOi8vJHtwcm9jZXNzLmVudi5BWlVSRV9PUEVOQUlfQVBJX0lOU1RBTkNFX05BTUV9Lm9wZW5haS5henVyZS5jb20vb3BlbmFpL2RlcGxveW1lbnRzLyR7cHJvY2Vzcy5lbnYuQVpVUkVfT1BFTkFJX0FQSV9ERVBMT1lNRU5UX05BTUV9YCxcbiAgICBkZWZhdWx0UXVlcnk6IHsgXCJhcGktdmVyc2lvblwiOiBwcm9jZXNzLmVudi5BWlVSRV9PUEVOQUlfQVBJX1ZFUlNJT04gfSxcbiAgICBkZWZhdWx0SGVhZGVyczogeyBcImFwaS1rZXlcIjogcHJvY2Vzcy5lbnYuT1BFTkFJX0FQSV9LRVkgfSxcbiAgfSk7XG4gIHJldHVybiBvcGVuYWk7XG59O1xuXG5leHBvcnQgY29uc3QgT3BlbkFJRW1iZWRkaW5nSW5zdGFuY2UgPSAoKSA9PiB7XG4gIGNvbnN0IG9wZW5haSA9IG5ldyBPcGVuQUkoe1xuICAgIGFwaUtleTogcHJvY2Vzcy5lbnYuT1BFTkFJX0FQSV9LRVksXG4gICAgYmFzZVVSTDogYGh0dHBzOi8vJHtwcm9jZXNzLmVudi5BWlVSRV9PUEVOQUlfQVBJX0lOU1RBTkNFX05BTUV9Lm9wZW5haS5henVyZS5jb20vb3BlbmFpL2RlcGxveW1lbnRzLyR7cHJvY2Vzcy5lbnYuQVpVUkVfT1BFTkFJX0FQSV9FTUJFRERJTkdTX0RFUExPWU1FTlRfTkFNRX1gLFxuICAgIGRlZmF1bHRRdWVyeTogeyBcImFwaS12ZXJzaW9uXCI6IHByb2Nlc3MuZW52LkFaVVJFX09QRU5BSV9BUElfVkVSU0lPTiB9LFxuICAgIGRlZmF1bHRIZWFkZXJzOiB7IFwiYXBpLWtleVwiOiBwcm9jZXNzLmVudi5PUEVOQUlfQVBJX0tFWSB9LFxuICB9KTtcbiAgcmV0dXJuIG9wZW5haTtcbn07XG4iXSwibmFtZXMiOlsiT3BlbkFJIiwiT3BlbkFJSW5zdGFuY2UiLCJvcGVuYWkiLCJhcGlLZXkiLCJwcm9jZXNzIiwiZW52IiwiT1BFTkFJX0FQSV9LRVkiLCJiYXNlVVJMIiwiQVpVUkVfT1BFTkFJX0FQSV9JTlNUQU5DRV9OQU1FIiwiQVpVUkVfT1BFTkFJX0FQSV9ERVBMT1lNRU5UX05BTUUiLCJkZWZhdWx0UXVlcnkiLCJBWlVSRV9PUEVOQUlfQVBJX1ZFUlNJT04iLCJkZWZhdWx0SGVhZGVycyIsIk9wZW5BSUVtYmVkZGluZ0luc3RhbmNlIiwiQVpVUkVfT1BFTkFJX0FQSV9FTUJFRERJTkdTX0RFUExPWU1FTlRfTkFNRSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./features/common/openai.ts\n");

/***/ }),

/***/ "(rsc)/./features/common/util.ts":
/*!*********************************!*\
  !*** ./features/common/util.ts ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   uniqueId: () => (/* binding */ uniqueId)\n/* harmony export */ });\n/* harmony import */ var nanoid__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! nanoid */ \"(rsc)/./node_modules/nanoid/index.js\");\n\nconst uniqueId = ()=>{\n    const alphabet = \"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\";\n    const nanoid = (0,nanoid__WEBPACK_IMPORTED_MODULE_0__.customAlphabet)(alphabet, 36);\n    return nanoid();\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9mZWF0dXJlcy9jb21tb24vdXRpbC50cyIsIm1hcHBpbmdzIjoiOzs7OztBQUF3QztBQUVqQyxNQUFNQyxXQUFXO0lBQ3RCLE1BQU1DLFdBQ0o7SUFDRixNQUFNQyxTQUFTSCxzREFBY0EsQ0FBQ0UsVUFBVTtJQUN4QyxPQUFPQztBQUNULEVBQUUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9henVyZS1vcGVuLWFpLWFjY2VsZXJhdG9yLy4vZmVhdHVyZXMvY29tbW9uL3V0aWwudHM/YzE4MiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjdXN0b21BbHBoYWJldCB9IGZyb20gXCJuYW5vaWRcIjtcblxuZXhwb3J0IGNvbnN0IHVuaXF1ZUlkID0gKCkgPT4ge1xuICBjb25zdCBhbHBoYWJldCA9XG4gICAgXCIwMTIzNDU2Nzg5QUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5elwiO1xuICBjb25zdCBuYW5vaWQgPSBjdXN0b21BbHBoYWJldChhbHBoYWJldCwgMzYpO1xuICByZXR1cm4gbmFub2lkKCk7XG59O1xuIl0sIm5hbWVzIjpbImN1c3RvbUFscGhhYmV0IiwidW5pcXVlSWQiLCJhbHBoYWJldCIsIm5hbm9pZCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./features/common/util.ts\n");

/***/ }),

/***/ "(rsc)/./features/theme/customise.ts":
/*!*************************************!*\
  !*** ./features/theme/customise.ts ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AI_NAME: () => (/* binding */ AI_NAME)\n/* harmony export */ });\nconst AI_NAME = \" Fujibo ChatGPT\";\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9mZWF0dXJlcy90aGVtZS9jdXN0b21pc2UudHMiLCJtYXBwaW5ncyI6Ijs7OztBQUFPLE1BQU1BLFVBQVUsa0JBQWtCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vYXp1cmUtb3Blbi1haS1hY2NlbGVyYXRvci8uL2ZlYXR1cmVzL3RoZW1lL2N1c3RvbWlzZS50cz85YTIzIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBjb25zdCBBSV9OQU1FID0gXCIgRnVqaWJvIENoYXRHUFRcIjtcbiJdLCJuYW1lcyI6WyJBSV9OQU1FIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./features/theme/customise.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/formdata-node","vendor-chunks/next-auth","vendor-chunks/jose","vendor-chunks/openid-client","vendor-chunks/@babel","vendor-chunks/oauth","vendor-chunks/preact","vendor-chunks/preact-render-to-string","vendor-chunks/uuid","vendor-chunks/yallist","vendor-chunks/lru-cache","vendor-chunks/cookie","vendor-chunks/oidc-token-hash","vendor-chunks/@panva","vendor-chunks/@azure","vendor-chunks/tr46","vendor-chunks/web-streams-polyfill","vendor-chunks/openai","vendor-chunks/node-fetch","vendor-chunks/whatwg-url","vendor-chunks/jsbi","vendor-chunks/tslib","vendor-chunks/debug","vendor-chunks/event-target-shim","vendor-chunks/https-proxy-agent","vendor-chunks/agentkeepalive","vendor-chunks/http-proxy-agent","vendor-chunks/form-data-encoder","vendor-chunks/webidl-conversions","vendor-chunks/ms","vendor-chunks/supports-color","vendor-chunks/priorityqueuejs","vendor-chunks/abort-controller","vendor-chunks/semaphore","vendor-chunks/fast-json-stable-stringify","vendor-chunks/nanoid","vendor-chunks/has-flag","vendor-chunks/humanize-ms","vendor-chunks/ai","vendor-chunks/eventsource-parser"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fchat%2Froute&page=%2Fapi%2Fchat%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fchat%2Froute.ts&appDir=%2FUsers%2Fokamotonobuhiro%2Ffujibo2025%2Ftest%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fokamotonobuhiro%2Ffujibo2025%2Ftest%2Fsrc&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();